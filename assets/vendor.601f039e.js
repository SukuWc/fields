var Md=Object.defineProperty;var fu=Object.getOwnPropertySymbols;var wd=Object.prototype.hasOwnProperty,Sd=Object.prototype.propertyIsEnumerable;var du=(i,t,e)=>t in i?Md(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,_u=(i,t)=>{for(var e in t||(t={}))wd.call(t,e)&&du(i,e,t[e]);if(fu)for(var e of fu(t))Sd.call(t,e)&&du(i,e,t[e]);return i};function Bd(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Td={},aa={exports:{}};var Wi=function(i,t){(i===null||typeof i=="undefined")&&(i={});var e=Object.assign({},i);for(var n in t)t.hasOwnProperty(n)&&typeof i[n]=="undefined"&&(e[n]=t[n]);if(typeof Object.getOwnPropertySymbols=="function")for(var s=Object.getOwnPropertySymbols(t),r=0;r<s.length;r++){var a=s[r];t.propertyIsEnumerable(a)&&typeof i[n]=="undefined"&&(e[a]=t[a])}return e},ie={},Cd=typeof DEBUG=="undefined"?!1:DEBUG,Ed=typeof ASSERT=="undefined"?!1:ASSERT;ie.debug=function(){!Cd||console.log.apply(console,arguments)};ie.assert=function(i,t,e){if(!!Ed&&!i)throw e&&console.log(e),new Error(t)};var de={exports:{}},Ld=typeof DEBUG=="undefined"?!1:DEBUG,Pd=typeof ASSERT=="undefined"?!1:ASSERT,Id=ie,Wh=Math,Fn=de.exports=Object.create(Wh);Fn.EPSILON=1e-9;Fn.isFinite=function(i){return typeof i=="number"&&isFinite(i)&&!isNaN(i)};Fn.assert=function(i){if(!!Pd&&!Fn.isFinite(i))throw Ld&&Id.debug(i),new Error("Invalid Number!")};Fn.invSqrt=function(i){return 1/Wh.sqrt(i)};Fn.nextPowerOfTwo=function(i){return i|=i>>1,i|=i>>2,i|=i>>4,i|=i>>8,i|=i>>16,i+1};Fn.isPowerOfTwo=function(i){return i>0&&(i&i-1)==0};Fn.mod=function(i,t,e){return typeof t=="undefined"?(e=1,t=0):typeof e=="undefined"&&(e=t,t=0),e>t?(i=(i-t)%(e-t),i+(i<0?e:t)):(i=(i-e)%(t-e),i+(i<=0?t:e))};Fn.clamp=function(i,t,e){return i<t?t:i>e?e:i};Fn.random=function(i,t){return typeof i=="undefined"?(t=1,i=0):typeof t=="undefined"&&(t=i,i=0),i==t?i:Wh.random()*(t-i)+i};var Rd=typeof DEBUG=="undefined"?!1:DEBUG,Bt=typeof ASSERT=="undefined"?!1:ASSERT,Yt=tt,vu=ie,ve=de.exports;function tt(i,t){if(!(this instanceof tt))return new tt(i,t);typeof i=="undefined"?(this.x=0,this.y=0):typeof i=="object"?(this.x=i.x,this.y=i.y):(this.x=i,this.y=t),Bt&&tt.assert(this)}tt.prototype._serialize=function(){return{x:this.x,y:this.y}};tt._deserialize=function(i){var t=Object.create(tt.prototype);return t.x=i.x,t.y=i.y,t};tt.zero=function(){var i=Object.create(tt.prototype);return i.x=0,i.y=0,i};tt.neo=function(i,t){var e=Object.create(tt.prototype);return e.x=i,e.y=t,e};tt.clone=function(i){return Bt&&tt.assert(i),tt.neo(i.x,i.y)};tt.prototype.toString=function(){return JSON.stringify(this)};tt.isValid=function(i){return i&&ve.isFinite(i.x)&&ve.isFinite(i.y)};tt.assert=function(i){if(!!Bt&&!tt.isValid(i))throw Rd&&vu.debug(i),new Error("Invalid Vec2!")};tt.prototype.clone=function(){return tt.clone(this)};tt.prototype.setZero=function(){return this.x=0,this.y=0,this};tt.prototype.set=function(i,t){return typeof i=="object"?(Bt&&tt.assert(i),this.x=i.x,this.y=i.y):(Bt&&ve.assert(i),Bt&&ve.assert(t),this.x=i,this.y=t),this};tt.prototype.wSet=function(i,t,e,n){return typeof e!="undefined"||typeof n!="undefined"?this.setCombine(i,t,e,n):this.setMul(i,t)};tt.prototype.setCombine=function(i,t,e,n){Bt&&ve.assert(i),Bt&&tt.assert(t),Bt&&ve.assert(e),Bt&&tt.assert(n);var s=i*t.x+e*n.x,r=i*t.y+e*n.y;return this.x=s,this.y=r,this};tt.prototype.setMul=function(i,t){Bt&&ve.assert(i),Bt&&tt.assert(t);var e=i*t.x,n=i*t.y;return this.x=e,this.y=n,this};tt.prototype.add=function(i){return Bt&&tt.assert(i),this.x+=i.x,this.y+=i.y,this};tt.prototype.wAdd=function(i,t,e,n){return typeof e!="undefined"||typeof n!="undefined"?this.addCombine(i,t,e,n):this.addMul(i,t)};tt.prototype.addCombine=function(i,t,e,n){Bt&&ve.assert(i),Bt&&tt.assert(t),Bt&&ve.assert(e),Bt&&tt.assert(n);var s=i*t.x+e*n.x,r=i*t.y+e*n.y;return this.x+=s,this.y+=r,this};tt.prototype.addMul=function(i,t){Bt&&ve.assert(i),Bt&&tt.assert(t);var e=i*t.x,n=i*t.y;return this.x+=e,this.y+=n,this};tt.prototype.wSub=function(i,t,e,n){return typeof e!="undefined"||typeof n!="undefined"?this.subCombine(i,t,e,n):this.subMul(i,t)};tt.prototype.subCombine=function(i,t,e,n){Bt&&ve.assert(i),Bt&&tt.assert(t),Bt&&ve.assert(e),Bt&&tt.assert(n);var s=i*t.x+e*n.x,r=i*t.y+e*n.y;return this.x-=s,this.y-=r,this};tt.prototype.subMul=function(i,t){Bt&&ve.assert(i),Bt&&tt.assert(t);var e=i*t.x,n=i*t.y;return this.x-=e,this.y-=n,this};tt.prototype.sub=function(i){return Bt&&tt.assert(i),this.x-=i.x,this.y-=i.y,this};tt.prototype.mul=function(i){return Bt&&ve.assert(i),this.x*=i,this.y*=i,this};tt.prototype.length=function(){return tt.lengthOf(this)};tt.prototype.lengthSquared=function(){return tt.lengthSquared(this)};tt.prototype.normalize=function(){var i=this.length();if(i<ve.EPSILON)return 0;var t=1/i;return this.x*=t,this.y*=t,i};tt.lengthOf=function(i){return Bt&&tt.assert(i),ve.sqrt(i.x*i.x+i.y*i.y)};tt.lengthSquared=function(i){return Bt&&tt.assert(i),i.x*i.x+i.y*i.y};tt.distance=function(i,t){Bt&&tt.assert(i),Bt&&tt.assert(t);var e=i.x-t.x,n=i.y-t.y;return ve.sqrt(e*e+n*n)};tt.distanceSquared=function(i,t){Bt&&tt.assert(i),Bt&&tt.assert(t);var e=i.x-t.x,n=i.y-t.y;return e*e+n*n};tt.areEqual=function(i,t){return Bt&&tt.assert(i),Bt&&tt.assert(t),i==t||typeof t=="object"&&t!==null&&i.x===t.x&&i.y===t.y};tt.skew=function(i){return Bt&&tt.assert(i),tt.neo(-i.y,i.x)};tt.dot=function(i,t){return Bt&&tt.assert(i),Bt&&tt.assert(t),i.x*t.x+i.y*t.y};tt.cross=function(i,t){return typeof t=="number"?(Bt&&tt.assert(i),Bt&&ve.assert(t),tt.neo(t*i.y,-t*i.x)):typeof i=="number"?(Bt&&ve.assert(i),Bt&&tt.assert(t),tt.neo(-i*t.y,i*t.x)):(Bt&&tt.assert(i),Bt&&tt.assert(t),i.x*t.y-i.y*t.x)};tt.addCross=function(i,t,e){if(typeof e=="number")return Bt&&tt.assert(t),Bt&&ve.assert(e),tt.neo(e*t.y+i.x,-e*t.x+i.y);if(typeof t=="number")return Bt&&ve.assert(t),Bt&&tt.assert(e),tt.neo(-t*e.y+i.x,t*e.x+i.y);Bt&&vu.assert(!1)};tt.add=function(i,t){return Bt&&tt.assert(i),Bt&&tt.assert(t),tt.neo(i.x+t.x,i.y+t.y)};tt.wAdd=function(i,t,e,n){return typeof e!="undefined"||typeof n!="undefined"?tt.combine(i,t,e,n):tt.mul(i,t)};tt.combine=function(i,t,e,n){return tt.zero().setCombine(i,t,e,n)};tt.sub=function(i,t){return Bt&&tt.assert(i),Bt&&tt.assert(t),tt.neo(i.x-t.x,i.y-t.y)};tt.mul=function(i,t){if(typeof i=="object")return Bt&&tt.assert(i),Bt&&ve.assert(t),tt.neo(i.x*t,i.y*t);if(typeof t=="object")return Bt&&ve.assert(i),Bt&&tt.assert(t),tt.neo(i*t.x,i*t.y)};tt.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};tt.neg=function(i){return Bt&&tt.assert(i),tt.neo(-i.x,-i.y)};tt.abs=function(i){return Bt&&tt.assert(i),tt.neo(ve.abs(i.x),ve.abs(i.y))};tt.mid=function(i,t){return Bt&&tt.assert(i),Bt&&tt.assert(t),tt.neo((i.x+t.x)*.5,(i.y+t.y)*.5)};tt.upper=function(i,t){return Bt&&tt.assert(i),Bt&&tt.assert(t),tt.neo(ve.max(i.x,t.x),ve.max(i.y,t.y))};tt.lower=function(i,t){return Bt&&tt.assert(i),Bt&&tt.assert(t),tt.neo(ve.min(i.x,t.x),ve.min(i.y,t.y))};tt.prototype.clamp=function(i){var t=this.x*this.x+this.y*this.y;if(t>i*i){var e=ve.invSqrt(t);this.x*=e*i,this.y*=e*i}return this};tt.clamp=function(i,t){return i=tt.neo(i.x,i.y),i.clamp(t),i};tt.scaleFn=function(i,t){return function(e){return tt.neo(e.x*i,e.y*t)}};tt.translateFn=function(i,t){return function(e){return tt.neo(e.x+i,e.y+t)}};var je={};(function(i){typeof DEBUG=="undefined"||DEBUG,typeof ASSERT=="undefined"||ASSERT;var t=i;t.maxManifoldPoints=2,t.maxPolygonVertices=12,t.aabbExtension=.1,t.aabbMultiplier=2,t.linearSlop=.005,t.linearSlopSquared=t.linearSlop*t.linearSlop,t.angularSlop=2/180*Math.PI,t.polygonRadius=2*t.linearSlop,t.maxSubSteps=8,t.maxTOIContacts=32,t.maxTOIIterations=20,t.maxDistnceIterations=20,t.velocityThreshold=1,t.maxLinearCorrection=.2,t.maxAngularCorrection=8/180*Math.PI,t.maxTranslation=2,t.maxTranslationSquared=t.maxTranslation*t.maxTranslation,t.maxRotation=.5*Math.PI,t.maxRotationSquared=t.maxRotation*t.maxRotation,t.baumgarte=.2,t.toiBaugarte=.75,t.timeToSleep=.5,t.linearSleepTolerance=.01,t.linearSleepToleranceSqr=Math.pow(t.linearSleepTolerance,2),t.angularSleepTolerance=2/180*Math.PI,t.angularSleepToleranceSqr=Math.pow(t.angularSleepTolerance,2)})(je);var Dd=typeof DEBUG=="undefined"?!1:DEBUG,zd=typeof ASSERT=="undefined"?!1:ASSERT,Fd=ie,Ti=de.exports,rn=Yt,ha=We;function We(i,t){if(!(this instanceof We))return new We(i,t);this.lowerBound=rn.zero(),this.upperBound=rn.zero(),typeof i=="object"&&this.lowerBound.set(i),typeof t=="object"?this.upperBound.set(t):typeof i=="object"&&this.upperBound.set(i)}We.prototype.isValid=function(){return We.isValid(this)};We.isValid=function(i){var t=rn.sub(i.upperBound,i.lowerBound),e=t.x>=0&&t.y>=0&&rn.isValid(i.lowerBound)&&rn.isValid(i.upperBound);return e};We.assert=function(i){if(!!zd&&!We.isValid(i))throw Dd&&Fd.debug(i),new Error("Invalid AABB!")};We.prototype.getCenter=function(){return rn.neo((this.lowerBound.x+this.upperBound.x)*.5,(this.lowerBound.y+this.upperBound.y)*.5)};We.prototype.getExtents=function(){return rn.neo((this.upperBound.x-this.lowerBound.x)*.5,(this.upperBound.y-this.lowerBound.y)*.5)};We.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)};We.prototype.combine=function(i,t){t=t||this;var e=i.lowerBound,n=i.upperBound,s=t.lowerBound,r=t.upperBound,a=Ti.min(e.x,s.x),h=Ti.min(e.y,s.y),o=Ti.max(r.x,n.x),l=Ti.max(r.y,n.y);this.lowerBound.set(a,h),this.upperBound.set(o,l)};We.prototype.combinePoints=function(i,t){this.lowerBound.set(Ti.min(i.x,t.x),Ti.min(i.y,t.y)),this.upperBound.set(Ti.max(i.x,t.x),Ti.max(i.y,t.y))};We.prototype.set=function(i){this.lowerBound.set(i.lowerBound.x,i.lowerBound.y),this.upperBound.set(i.upperBound.x,i.upperBound.y)};We.prototype.contains=function(i){var t=!0;return t=t&&this.lowerBound.x<=i.lowerBound.x,t=t&&this.lowerBound.y<=i.lowerBound.y,t=t&&i.upperBound.x<=this.upperBound.x,t=t&&i.upperBound.y<=this.upperBound.y,t};We.prototype.extend=function(i){return We.extend(this,i),this};We.extend=function(i,t){i.lowerBound.x-=t,i.lowerBound.y-=t,i.upperBound.x+=t,i.upperBound.y+=t};We.testOverlap=function(i,t){var e=t.lowerBound.x-i.upperBound.x,n=i.lowerBound.x-t.upperBound.x,s=t.lowerBound.y-i.upperBound.y,r=i.lowerBound.y-t.upperBound.y;return!(e>0||s>0||n>0||r>0)};We.areEqual=function(i,t){return rn.areEqual(i.lowerBound,t.lowerBound)&&rn.areEqual(i.upperBound,t.upperBound)};We.diff=function(i,t){var e=Ti.max(0,Ti.min(i.upperBound.x,t.upperBound.x)-Ti.max(t.lowerBound.x,i.lowerBound.x)),n=Ti.max(0,Ti.min(i.upperBound.y,t.upperBound.y)-Ti.max(t.lowerBound.y,i.lowerBound.y)),s=i.upperBound.x-i.lowerBound.x,r=i.upperBound.y-i.lowerBound.y,a=t.upperBound.x-t.lowerBound.x,h=t.upperBound.y-t.lowerBound.y;return s*r+a*h-e*n};We.prototype.rayCast=function(i,t){for(var e=-1/0,n=1/0,s=t.p1,r=rn.sub(t.p2,t.p1),a=rn.abs(r),h=rn.zero(),o="x";o!==null;o=o==="x"?"y":null)if(a.x<Ti.EPSILON){if(s[o]<this.lowerBound[o]||this.upperBound[o]<s[o])return!1}else{var l=1/r[o],u=(this.lowerBound[o]-s[o])*l,m=(this.upperBound[o]-s[o])*l,p=-1;if(u>m){var c=u;u=m,m=c,p=1}if(u>e&&(h.setZero(),h[o]=p,e=u),n=Ti.min(n,m),e>n)return!1}return e<0||t.maxFraction<e?!1:(i.fraction=e,i.normal=h,!0)};We.prototype.toString=function(){return JSON.stringify(this)};var Vd=Nd;function Nd(i){var t=[],e=i.max||1/0,n=i.create,s=i.allocate,r=i.release,a=i.discard,h=0,o=0,l=0,u=0;this.max=function(m){return typeof m=="number"?(e=m,this):e},this.size=function(){return t.length},this.allocate=function(){var m;return t.length>0?m=t.shift():(h++,typeof n=="function"?m=n():m={}),o++,typeof s=="function"&&s(m),m},this.release=function(m){t.length<e?(l++,typeof r=="function"&&r(m),t.push(m)):(u++,typeof a=="function"&&(m=a(m)))},this.toString=function(){return" +"+h+" >"+o+" <"+l+" -"+u+" ="+t.length+"/"+e}}var ye=typeof ASSERT=="undefined"?!1:ASSERT,hr=je,ge=ie,la=Vd,vn=Yt,Ci=de.exports,gi=ha,yu=$e;function gu(i){this.id=i,this.aabb=new gi,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.toString=function(){return this.id+": "+this.userData}}gu.prototype.isLeaf=function(){return this.child1==null};function $e(){this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new la({create:function(){return new gu}})}$e.prototype.getUserData=function(i){var t=this.m_nodes[i];return ye&&ge.assert(!!t),t.userData};$e.prototype.getFatAABB=function(i){var t=this.m_nodes[i];return ye&&ge.assert(!!t),t.aabb};$e.prototype.allocateNode=function(){var i=this.m_pool.allocate();return i.id=++this.m_lastProxyId,i.userData=null,i.parent=null,i.child1=null,i.child2=null,i.height=-1,this.m_nodes[i.id]=i,i};$e.prototype.freeNode=function(i){this.m_pool.release(i),i.height=-1,delete this.m_nodes[i.id]};$e.prototype.createProxy=function(i,t){ye&&ge.assert(gi.isValid(i));var e=this.allocateNode();return e.aabb.set(i),gi.extend(e.aabb,hr.aabbExtension),e.userData=t,e.height=0,this.insertLeaf(e),e.id};$e.prototype.destroyProxy=function(i){var t=this.m_nodes[i];ye&&ge.assert(!!t),ye&&ge.assert(t.isLeaf()),this.removeLeaf(t),this.freeNode(t)};$e.prototype.moveProxy=function(i,t,e){ye&&ge.assert(gi.isValid(t)),ye&&ge.assert(!e||vn.isValid(e));var n=this.m_nodes[i];return ye&&ge.assert(!!n),ye&&ge.assert(n.isLeaf()),n.aabb.contains(t)?!1:(this.removeLeaf(n),n.aabb.set(t),t=n.aabb,gi.extend(t,hr.aabbExtension),e.x<0?t.lowerBound.x+=e.x*hr.aabbMultiplier:t.upperBound.x+=e.x*hr.aabbMultiplier,e.y<0?t.lowerBound.y+=e.y*hr.aabbMultiplier:t.upperBound.y+=e.y*hr.aabbMultiplier,this.insertLeaf(n),!0)};$e.prototype.insertLeaf=function(i){if(ye&&ge.assert(gi.isValid(i.aabb)),this.m_root==null){this.m_root=i,this.m_root.parent=null;return}for(var t=i.aabb,e=this.m_root;e.isLeaf()==!1;){var n=e.child1,s=e.child2,r=e.aabb.getPerimeter(),a=new gi;a.combine(e.aabb,t);var h=a.getPerimeter(),o=2*h,l=2*(h-r),u;if(n.isLeaf()){var m=new gi;m.combine(t,n.aabb),u=m.getPerimeter()+l}else{var m=new gi;m.combine(t,n.aabb);var p=n.aabb.getPerimeter(),c=m.getPerimeter();u=c-p+l}var f;if(s.isLeaf()){var m=new gi;m.combine(t,s.aabb),f=m.getPerimeter()+l}else{var m=new gi;m.combine(t,s.aabb);var p=s.aabb.getPerimeter(),c=m.getPerimeter();f=c-p+l}if(o<u&&o<f)break;u<f?e=n:e=s}var d=e,y=d.parent,_=this.allocateNode();for(_.parent=y,_.userData=null,_.aabb.combine(t,d.aabb),_.height=d.height+1,y!=null?(y.child1==d?y.child1=_:y.child2=_,_.child1=d,_.child2=i,d.parent=_,i.parent=_):(_.child1=d,_.child2=i,d.parent=_,i.parent=_,this.m_root=_),e=i.parent;e!=null;){e=this.balance(e);var n=e.child1,s=e.child2;ye&&ge.assert(n!=null),ye&&ge.assert(s!=null),e.height=1+Ci.max(n.height,s.height),e.aabb.combine(n.aabb,s.aabb),e=e.parent}};$e.prototype.removeLeaf=function(i){if(i==this.m_root){this.m_root=null;return}var t=i.parent,e=t.parent,n;if(t.child1==i?n=t.child2:n=t.child1,e!=null){e.child1==t?e.child1=n:e.child2=n,n.parent=e,this.freeNode(t);for(var s=e;s!=null;){s=this.balance(s);var r=s.child1,a=s.child2;s.aabb.combine(r.aabb,a.aabb),s.height=1+Ci.max(r.height,a.height),s=s.parent}}else this.m_root=n,n.parent=null,this.freeNode(t)};$e.prototype.balance=function(i){ye&&ge.assert(i!=null);var t=i;if(t.isLeaf()||t.height<2)return i;var e=t.child1,n=t.child2,s=n.height-e.height;if(s>1){var r=n.child1,a=n.child2;return n.child1=t,n.parent=t.parent,t.parent=n,n.parent!=null?n.parent.child1==i?n.parent.child1=n:n.parent.child2=n:this.m_root=n,r.height>a.height?(n.child2=r,t.child2=a,a.parent=t,t.aabb.combine(e.aabb,a.aabb),n.aabb.combine(t.aabb,r.aabb),t.height=1+Ci.max(e.height,a.height),n.height=1+Ci.max(t.height,r.height)):(n.child2=a,t.child2=r,r.parent=t,t.aabb.combine(e.aabb,r.aabb),n.aabb.combine(t.aabb,a.aabb),t.height=1+Ci.max(e.height,r.height),n.height=1+Ci.max(t.height,a.height)),n}if(s<-1){var h=e.child1,o=e.child2;return e.child1=t,e.parent=t.parent,t.parent=e,e.parent!=null?e.parent.child1==t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,h.height>o.height?(e.child2=h,t.child1=o,o.parent=t,t.aabb.combine(n.aabb,o.aabb),e.aabb.combine(t.aabb,h.aabb),t.height=1+Ci.max(n.height,o.height),e.height=1+Ci.max(t.height,h.height)):(e.child2=o,t.child1=h,h.parent=t,t.aabb.combine(n.aabb,h.aabb),e.aabb.combine(t.aabb,o.aabb),t.height=1+Ci.max(n.height,h.height),e.height=1+Ci.max(t.height,o.height)),e}return t};$e.prototype.getHeight=function(){return this.m_root==null?0:this.m_root.height};$e.prototype.getAreaRatio=function(){if(this.m_root==null)return 0;for(var i=this.m_root,t=i.aabb.getPerimeter(),e=0,n,s=ls.allocate().preorder(this.m_root);n=s.next();)n.height<0||(e+=n.aabb.getPerimeter());return ls.release(s),e/t};$e.prototype.computeHeight=function(i){var t;if(typeof i!="undefined"?t=this.m_nodes[i]:t=this.m_root,t.isLeaf())return 0;var e=this.computeHeight(t.child1.id),n=this.computeHeight(t.child2.id);return 1+Ci.max(e,n)};$e.prototype.validateStructure=function(i){if(i!=null){i==this.m_root&&ye&&ge.assert(i.parent==null);var t=i.child1,e=i.child2;if(i.isLeaf()){ye&&ge.assert(t==null),ye&&ge.assert(e==null),ye&&ge.assert(i.height==0);return}ye&&ge.assert(t.parent==i),ye&&ge.assert(e.parent==i),this.validateStructure(t),this.validateStructure(e)}};$e.prototype.validateMetrics=function(i){if(i!=null){var t=i.child1,e=i.child2;if(i.isLeaf()){ye&&ge.assert(t==null),ye&&ge.assert(e==null),ye&&ge.assert(i.height==0);return}var n=t.height,s=e.height,r=1+Ci.max(n,s);ye&&ge.assert(i.height==r);var a=new gi;a.combine(t.aabb,e.aabb),ye&&ge.assert(gi.areEqual(a,i.aabb)),this.validateMetrics(t),this.validateMetrics(e)}};$e.prototype.validate=function(){this.validateStructure(this.m_root),this.validateMetrics(this.m_root),ye&&ge.assert(this.getHeight()==this.computeHeight())};$e.prototype.getMaxBalance=function(){for(var i=0,t,e=ls.allocate().preorder(this.m_root);t=e.next();)if(!(t.height<=1)){ye&&ge.assert(t.isLeaf()==!1);var n=Ci.abs(t.child2.height-t.child1.height);i=Ci.max(i,n)}return ls.release(e),i};$e.prototype.rebuildBottomUp=function(){for(var i=[],t=0,e,n=ls.allocate().preorder(this.m_root);e=n.next();)e.height<0||(e.isLeaf()?(e.parent=null,i[t]=e,++t):this.freeNode(e));for(ls.release(n);t>1;){for(var s=1/0,r=-1,a=-1,h=0;h<t;++h)for(var o=i[h].aabb,l=h+1;l<t;++l){var u=i[l].aabb,m=new gi;m.combine(o,u);var p=m.getPerimeter();p<s&&(r=h,a=l,s=p)}var c=i[r],f=i[a],d=this.allocateNode();d.child1=c,d.child2=f,d.height=1+Ci.max(c.height,f.height),d.aabb.combine(c.aabb,f.aabb),d.parent=null,c.parent=d,f.parent=d,i[a]=i[t-1],i[r]=d,--t}this.m_root=i[0],this.validate()};$e.prototype.shiftOrigin=function(i){for(var t,e=ls.allocate().preorder(this.m_root);t=e.next();){var n=t.aabb;n.lowerBound.x-=i.x,n.lowerBound.y-=i.y,n.upperBound.x-=i.x,n.upperBound.y-=i.y}ls.release(e)};$e.prototype.query=function(i,t){ye&&ge.assert(typeof t=="function");var e=ca.allocate();for(e.push(this.m_root);e.length>0;){var n=e.pop();if(n!=null&&gi.testOverlap(n.aabb,i))if(n.isLeaf()){var s=t(n.id);if(s==!1)return}else e.push(n.child1),e.push(n.child2)}ca.release(e)};$e.prototype.rayCast=function(i,t){ye&&ge.assert(typeof t=="function");var e=i.p1,n=i.p2,s=vn.sub(n,e);ye&&ge.assert(s.lengthSquared()>0),s.normalize();var r=vn.cross(1,s),a=vn.abs(r),h=i.maxFraction,o=new gi,l=vn.combine(1-h,e,h,n);o.combinePoints(e,l);var u=ca.allocate(),m=xu.allocate();for(u.push(this.m_root);u.length>0;){var p=u.pop();if(p!=null&&gi.testOverlap(p.aabb,o)!=!1){var c=p.aabb.getCenter(),f=p.aabb.getExtents(),d=Ci.abs(vn.dot(r,vn.sub(e,c)))-vn.dot(a,f);if(!(d>0))if(p.isLeaf()){m.p1=vn.clone(i.p1),m.p2=vn.clone(i.p2),m.maxFraction=h;var y=t(m,p.id);if(y==0)return;y>0&&(h=y,l=vn.combine(1-h,e,h,n),o.combinePoints(e,l))}else u.push(p.child1),u.push(p.child2)}}ca.release(u),xu.release(m)};var xu=new la({create:function(){return{}},release:function(i){}}),ca=new la({create:function(){return[]},release:function(i){i.length=0}}),ls=new la({create:function(){return new Od},release:function(i){i.close()}});function Od(){var i=[],t=[];return{preorder:function(e){return i.length=0,i.push(e),t.length=0,t.push(0),this},next:function(){for(;i.length>0;){var e=i.length-1,n=i[e];if(t[e]===0)return t[e]=1,n;if(t[e]===1&&(t[e]=2,n.child1))return i.push(n.child1),t.push(1),n.child1;if(t[e]===2&&(t[e]=3,n.child2))return i.push(n.child2),t.push(1),n.child2;i.pop(),t.pop()}},close:function(){i.length=0}}}var Yh=typeof ASSERT=="undefined"?!1:ASSERT,qh=ie,Au=de.exports,Jh=ha,Ud=yu,Hd=si;function si(){this.m_tree=new Ud,this.m_proxyCount=0,this.m_moveBuffer=[],this.queryCallback=this.queryCallback.bind(this)}si.prototype.getUserData=function(i){return this.m_tree.getUserData(i)};si.prototype.testOverlap=function(i,t){var e=this.m_tree.getFatAABB(i),n=this.m_tree.getFatAABB(t);return Jh.testOverlap(e,n)};si.prototype.getFatAABB=function(i){return this.m_tree.getFatAABB(i)};si.prototype.getProxyCount=function(){return this.m_proxyCount};si.prototype.getTreeHeight=function(){return this.m_tree.getHeight()};si.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()};si.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()};si.prototype.query=function(i,t){this.m_tree.query(i,t)};si.prototype.rayCast=function(i,t){this.m_tree.rayCast(i,t)};si.prototype.shiftOrigin=function(i){this.m_tree.shiftOrigin(i)};si.prototype.createProxy=function(i,t){Yh&&qh.assert(Jh.isValid(i));var e=this.m_tree.createProxy(i,t);return this.m_proxyCount++,this.bufferMove(e),e};si.prototype.destroyProxy=function(i){this.unbufferMove(i),this.m_proxyCount--,this.m_tree.destroyProxy(i)};si.prototype.moveProxy=function(i,t,e){Yh&&qh.assert(Jh.isValid(t));var n=this.m_tree.moveProxy(i,t,e);n&&this.bufferMove(i)};si.prototype.touchProxy=function(i){this.bufferMove(i)};si.prototype.bufferMove=function(i){this.m_moveBuffer.push(i)};si.prototype.unbufferMove=function(i){for(var t=0;t<this.m_moveBuffer.length;++t)this.m_moveBuffer[t]==i&&(this.m_moveBuffer[t]=null)};si.prototype.updatePairs=function(i){for(Yh&&qh.assert(typeof i=="function"),this.m_callback=i;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),this.m_queryProxyId!==null){var t=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(t,this.queryCallback)}};si.prototype.queryCallback=function(i){if(i==this.m_queryProxyId)return!0;var t=Au.min(i,this.m_queryProxyId),e=Au.max(i,this.m_queryProxyId),n=this.m_tree.getUserData(t),s=this.m_tree.getUserData(e);return this.m_callback(n,s),!0};var $h={exports:{}},Gd=typeof DEBUG=="undefined"?!1:DEBUG,Ei=typeof ASSERT=="undefined"?!1:ASSERT,Ve=jt,kd=ie,yn=Yt,$n=de.exports;function jt(i){if(!(this instanceof jt))return new jt(i);typeof i=="number"?this.setAngle(i):typeof i=="object"?this.set(i):this.setIdentity()}jt.neo=function(i){var t=Object.create(jt.prototype);return t.setAngle(i),t};jt.clone=function(i){Ei&&jt.assert(i);var t=Object.create(jt.prototype);return t.s=i.s,t.c=i.c,t};jt.identity=function(){var i=Object.create(jt.prototype);return i.s=0,i.c=1,i};jt.isValid=function(i){return i&&$n.isFinite(i.s)&&$n.isFinite(i.c)};jt.assert=function(i){if(!!Ei&&!jt.isValid(i))throw Gd&&kd.debug(i),new Error("Invalid Rot!")};jt.prototype.setIdentity=function(){this.s=0,this.c=1};jt.prototype.set=function(i){typeof i=="object"?(Ei&&jt.assert(i),this.s=i.s,this.c=i.c):(Ei&&$n.assert(i),this.s=$n.sin(i),this.c=$n.cos(i))};jt.prototype.setAngle=function(i){Ei&&$n.assert(i),this.s=$n.sin(i),this.c=$n.cos(i)};jt.prototype.getAngle=function(){return $n.atan2(this.s,this.c)};jt.prototype.getXAxis=function(){return yn.neo(this.c,this.s)};jt.prototype.getYAxis=function(){return yn.neo(-this.s,this.c)};jt.mul=function(i,t){if(Ei&&jt.assert(i),"c"in t&&"s"in t){Ei&&jt.assert(t);var e=jt.identity();return e.s=i.s*t.c+i.c*t.s,e.c=i.c*t.c-i.s*t.s,e}else if("x"in t&&"y"in t)return Ei&&yn.assert(t),yn.neo(i.c*t.x-i.s*t.y,i.s*t.x+i.c*t.y)};jt.mulRot=function(i,t){Ei&&jt.assert(i),Ei&&jt.assert(t);var e=jt.identity();return e.s=i.s*t.c+i.c*t.s,e.c=i.c*t.c-i.s*t.s,e};jt.mulVec2=function(i,t){return Ei&&jt.assert(i),Ei&&yn.assert(t),yn.neo(i.c*t.x-i.s*t.y,i.s*t.x+i.c*t.y)};jt.mulSub=function(i,t,e){var n=i.c*(t.x-e.x)-i.s*(t.y-e.y),s=i.s*(t.x-e.x)+i.c*(t.y-e.y);return yn.neo(n,s)};jt.mulT=function(i,t){if("c"in t&&"s"in t){Ei&&jt.assert(t);var e=jt.identity();return e.s=i.c*t.s-i.s*t.c,e.c=i.c*t.c+i.s*t.s,e}else if("x"in t&&"y"in t)return Ei&&yn.assert(t),yn.neo(i.c*t.x+i.s*t.y,-i.s*t.x+i.c*t.y)};jt.mulTRot=function(i,t){Ei&&jt.assert(t);var e=jt.identity();return e.s=i.c*t.s-i.s*t.c,e.c=i.c*t.c+i.s*t.s,e};jt.mulTVec2=function(i,t){return Ei&&yn.assert(t),yn.neo(i.c*t.x+i.s*t.y,-i.s*t.x+i.c*t.y)};var Wd=typeof DEBUG=="undefined"?!1:DEBUG,xi=typeof ASSERT=="undefined"?!1:ASSERT,Li=Wt,Yd=ie,Ai=Yt,ji=Ve;function Wt(i,t){if(!(this instanceof Wt))return new Wt(i,t);this.p=Ai.zero(),this.q=ji.identity(),typeof i!="undefined"&&this.p.set(i),typeof t!="undefined"&&this.q.set(t)}Wt.clone=function(i){var t=Object.create(Wt.prototype);return t.p=Ai.clone(i.p),t.q=ji.clone(i.q),t};Wt.neo=function(i,t){var e=Object.create(Wt.prototype);return e.p=Ai.clone(i),e.q=ji.clone(t),e};Wt.identity=function(){var i=Object.create(Wt.prototype);return i.p=Ai.zero(),i.q=ji.identity(),i};Wt.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()};Wt.prototype.set=function(i,t){typeof t=="undefined"?(this.p.set(i.p),this.q.set(i.q)):(this.p.set(i),this.q.set(t))};Wt.isValid=function(i){return i&&Ai.isValid(i.p)&&ji.isValid(i.q)};Wt.assert=function(i){if(!!xi&&!Wt.isValid(i))throw Wd&&Yd.debug(i),new Error("Invalid Transform!")};Wt.mul=function(i,t){if(xi&&Wt.assert(i),Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e[n]=Wt.mul(i,t[n]);return e}else if("x"in t&&"y"in t){xi&&Ai.assert(t);var s=i.q.c*t.x-i.q.s*t.y+i.p.x,r=i.q.s*t.x+i.q.c*t.y+i.p.y;return Ai.neo(s,r)}else if("p"in t&&"q"in t){xi&&Wt.assert(t);var a=Wt.identity();return a.q=ji.mulRot(i.q,t.q),a.p=Ai.add(ji.mulVec2(i.q,t.p),i.p),a}};Wt.mulAll=function(i,t){xi&&Wt.assert(i);for(var e=[],n=0;n<t.length;n++)e[n]=Wt.mul(i,t[n]);return e};Wt.mulFn=function(i){return xi&&Wt.assert(i),function(t){return Wt.mul(i,t)}};Wt.mulVec2=function(i,t){xi&&Wt.assert(i),xi&&Ai.assert(t);var e=i.q.c*t.x-i.q.s*t.y+i.p.x,n=i.q.s*t.x+i.q.c*t.y+i.p.y;return Ai.neo(e,n)};Wt.mulXf=function(i,t){xi&&Wt.assert(i),xi&&Wt.assert(t);var e=Wt.identity();return e.q=ji.mulRot(i.q,t.q),e.p=Ai.add(ji.mulVec2(i.q,t.p),i.p),e};Wt.mulT=function(i,t){if(xi&&Wt.assert(i),"x"in t&&"y"in t){xi&&Ai.assert(t);var e=t.x-i.p.x,n=t.y-i.p.y,s=i.q.c*e+i.q.s*n,r=-i.q.s*e+i.q.c*n;return Ai.neo(s,r)}else if("p"in t&&"q"in t){xi&&Wt.assert(t);var a=Wt.identity();return a.q.set(ji.mulTRot(i.q,t.q)),a.p.set(ji.mulTVec2(i.q,Ai.sub(t.p,i.p))),a}};Wt.mulTVec2=function(i,t){xi&&Wt.assert(i),xi&&Ai.assert(t);var e=t.x-i.p.x,n=t.y-i.p.y,s=i.q.c*e+i.q.s*n,r=-i.q.s*e+i.q.c*n;return Ai.neo(s,r)};Wt.mulTXf=function(i,t){xi&&Wt.assert(i),xi&&Wt.assert(t);var e=Wt.identity();return e.q.set(ji.mulTRot(i.q,t.q)),e.p.set(ji.mulTVec2(i.q,Ai.sub(t.p,i.p))),e};var Xh=typeof ASSERT=="undefined"?!1:ASSERT,jh=Vn,Zh=ie,Kh=de.exports,Qh=Yt,qd=Ve,bu=Li;function Vn(i,t){Xh&&Zh.assert(typeof i=="undefined"),Xh&&Zh.assert(typeof t=="undefined"),this.localCenter=Qh.zero(),this.c=Qh.zero(),this.a=0,this.alpha0=0,this.c0=Qh.zero(),this.a0=0}Vn.prototype.setTransform=function(i){var t=bu.mulVec2(i,this.localCenter);this.c.set(t),this.c0.set(t),this.a=i.q.getAngle(),this.a0=i.q.getAngle()};Vn.prototype.setLocalCenter=function(i,t){this.localCenter.set(i);var e=bu.mulVec2(t,this.localCenter);this.c.set(e),this.c0.set(e)};Vn.prototype.getTransform=function(i,t){t=typeof t=="undefined"?0:t,i.q.setAngle((1-t)*this.a0+t*this.a),i.p.setCombine(1-t,this.c0,t,this.c),i.p.sub(qd.mulVec2(i.q,this.localCenter))};Vn.prototype.advance=function(i){Xh&&Zh.assert(this.alpha0<1);var t=(i-this.alpha0)/(1-this.alpha0);this.c0.setCombine(t,this.c,1-t,this.c0),this.a0=t*this.a+(1-t)*this.a0,this.alpha0=i};Vn.prototype.forward=function(){this.a0=this.a,this.c0.set(this.c)};Vn.prototype.normalize=function(){var i=Kh.mod(this.a0,-Kh.PI,+Kh.PI);this.a-=this.a0-i,this.a0=i};Vn.prototype.clone=function(){var i=new Vn;return i.localCenter.set(this.localCenter),i.alpha0=this.alpha0,i.a0=this.a0,i.a=this.a,i.c0.set(this.c0),i.c.set(this.c),i};Vn.prototype.set=function(i){this.localCenter.set(i.localCenter),this.alpha0=i.alpha0,this.a0=i.a0,this.a=i.a,this.c0.set(i.c0),this.c.set(i.c)};var Jd=Xd,$d=Yt;function Xd(){this.v=$d.zero(),this.w=0}var jd=wu,Mu=Yt,Zd=Ve;function wu(){this.c=Mu.zero(),this.a=0}wu.prototype.getTransform=function(i,t){return i.q.set(this.a),i.p.set(Mu.sub(this.c,Zd.mulVec2(i.q,t))),i};var Gs=Pi;function Pi(){this.m_type,this.m_radius}Pi.prototype._reset=function(){};Pi.prototype._serialize=function(){return{}};Pi.TYPES={};Pi._deserialize=function(i,t,e){var n=Pi.TYPES[i.type];return n&&e(n,i)};Pi.isValid=function(i){return!!i};Pi.prototype.getRadius=function(){return this.m_radius};Pi.prototype.getType=function(){return this.m_type};Pi.prototype._clone=function(){};Pi.prototype.getChildCount=function(){};Pi.prototype.testPoint=function(i,t){};Pi.prototype.rayCast=function(i,t,e,n){};Pi.prototype.computeAABB=function(i,t,e){};Pi.prototype.computeMass=function(i,t){};Pi.prototype.computeDistanceProxy=function(i){};var tl=typeof ASSERT=="undefined"?!1:ASSERT,el=se,il=ie,Kd=Wi,Qd=de.exports,t_=Yt,nl=ha,e_=Gs,i_={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535};function Su(i,t){this.aabb=new nl,this.fixture=i,this.childIndex=t,this.proxyId}function se(i,t,e){t.shape?(e=t,t=t.shape):typeof e=="number"&&(e={density:e}),e=Kd(e,i_),this.m_body=i,this.m_friction=e.friction,this.m_restitution=e.restitution,this.m_density=e.density,this.m_isSensor=e.isSensor,this.m_filterGroupIndex=e.filterGroupIndex,this.m_filterCategoryBits=e.filterCategoryBits,this.m_filterMaskBits=e.filterMaskBits,this.m_shape=t,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var n=this.m_shape.getChildCount(),s=0;s<n;++s)this.m_proxies[s]=new Su(this,s);this.m_userData=e.userData}se.prototype._reset=function(){var i=this.getBody(),t=i.m_world.m_broadPhase;this.destroyProxies(t),this.m_shape._reset&&this.m_shape._reset();for(var e=this.m_shape.getChildCount(),n=0;n<e;++n)this.m_proxies[n]=new Su(this,n);this.createProxies(t,i.m_xf),i.resetMassData()};se.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}};se._deserialize=function(i,t,e){var n=e(e_,i.shape),s=n&&new se(t,n,i);return s};se.prototype.getType=function(){return this.m_shape.getType()};se.prototype.getShape=function(){return this.m_shape};se.prototype.isSensor=function(){return this.m_isSensor};se.prototype.setSensor=function(i){i!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=i)};se.prototype.getUserData=function(){return this.m_userData};se.prototype.setUserData=function(i){this.m_userData=i};se.prototype.getBody=function(){return this.m_body};se.prototype.getNext=function(){return this.m_next};se.prototype.getDensity=function(){return this.m_density};se.prototype.setDensity=function(i){tl&&il.assert(Qd.isFinite(i)&&i>=0),this.m_density=i};se.prototype.getFriction=function(){return this.m_friction};se.prototype.setFriction=function(i){this.m_friction=i};se.prototype.getRestitution=function(){return this.m_restitution};se.prototype.setRestitution=function(i){this.m_restitution=i};se.prototype.testPoint=function(i){return this.m_shape.testPoint(this.m_body.getTransform(),i)};se.prototype.rayCast=function(i,t,e){return this.m_shape.rayCast(i,t,this.m_body.getTransform(),e)};se.prototype.getMassData=function(i){this.m_shape.computeMass(i,this.m_density)};se.prototype.getAABB=function(i){return tl&&il.assert(0<=i&&i<this.m_proxyCount),this.m_proxies[i].aabb};se.prototype.createProxies=function(i,t){tl&&il.assert(this.m_proxyCount==0),this.m_proxyCount=this.m_shape.getChildCount();for(var e=0;e<this.m_proxyCount;++e){var n=this.m_proxies[e];this.m_shape.computeAABB(n.aabb,t,e),n.proxyId=i.createProxy(n.aabb,n)}};se.prototype.destroyProxies=function(i){for(var t=0;t<this.m_proxyCount;++t){var e=this.m_proxies[t];i.destroyProxy(e.proxyId),e.proxyId=null}this.m_proxyCount=0};se.prototype.synchronize=function(i,t,e){for(var n=0;n<this.m_proxyCount;++n){var s=this.m_proxies[n],r=new nl,a=new nl;this.m_shape.computeAABB(r,t,s.childIndex),this.m_shape.computeAABB(a,e,s.childIndex),s.aabb.combine(r,a);var h=t_.sub(e.p,t.p);i.moveProxy(s.proxyId,s.aabb,h)}};se.prototype.setFilterData=function(i){this.m_filterGroupIndex=i.groupIndex,this.m_filterCategoryBits=i.categoryBits,this.m_filterMaskBits=i.maskBits,this.refilter()};se.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex};se.prototype.setFilterGroupIndex=function(i){return this.m_filterGroupIndex=i};se.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits};se.prototype.setFilterCategoryBits=function(i){this.m_filterCategoryBits=i};se.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits};se.prototype.setFilterMaskBits=function(i){this.m_filterMaskBits=i};se.prototype.refilter=function(){if(this.m_body!=null){for(var i=this.m_body.getContactList();i;){var t=i.contact,e=t.getFixtureA(),n=t.getFixtureB();(e==this||n==this)&&t.flagForFiltering(),i=i.next}var s=this.m_body.getWorld();if(s!=null)for(var r=s.m_broadPhase,a=0;a<this.m_proxyCount;++a)r.touchProxy(this.m_proxies[a].proxyId)}};se.prototype.shouldCollide=function(i){if(i.m_filterGroupIndex===this.m_filterGroupIndex&&i.m_filterGroupIndex!==0)return i.m_filterGroupIndex>0;var t=(i.m_filterMaskBits&this.m_filterCategoryBits)!=0,e=(i.m_filterCategoryBits&this.m_filterMaskBits)!=0,n=t&&e;return n};var ri=typeof ASSERT=="undefined"?!1:ASSERT,Fi=wt,oi=ie,n_=Wi,Ie=Yt,Bu=Ve,ua=de.exports,s_=jh,ma=Li,r_=Jd,o_=jd,Tu=el,ks=wt.STATIC="static",sl=wt.KINEMATIC="kinematic",on=wt.DYNAMIC="dynamic",a_={type:ks,position:Ie.zero(),angle:0,linearVelocity:Ie.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null};function wt(i,t){t=n_(t,a_),ri&&oi.assert(Ie.isValid(t.position)),ri&&oi.assert(Ie.isValid(t.linearVelocity)),ri&&oi.assert(ua.isFinite(t.angle)),ri&&oi.assert(ua.isFinite(t.angularVelocity)),ri&&oi.assert(ua.isFinite(t.angularDamping)&&t.angularDamping>=0),ri&&oi.assert(ua.isFinite(t.linearDamping)&&t.linearDamping>=0),this.m_world=i,this.m_awakeFlag=t.awake,this.m_autoSleepFlag=t.allowSleep,this.m_bulletFlag=t.bullet,this.m_fixedRotationFlag=t.fixedRotation,this.m_activeFlag=t.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=t.userData,this.m_type=t.type,this.m_type==on?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=ma.identity(),this.m_xf.p=Ie.clone(t.position),this.m_xf.q.setAngle(t.angle),this.m_sweep=new s_,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new r_,this.c_position=new o_,this.m_force=Ie.zero(),this.m_torque=0,this.m_linearVelocity=Ie.clone(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_gravityScale=t.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}wt.prototype._serialize=function(){for(var i=[],t=this.m_fixtureList;t;t=t.m_next)i.push(t);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:i}};wt._deserialize=function(i,t,e){var n=new wt(t,i);if(i.fixtures)for(var s=i.fixtures.length-1;s>=0;s--){var r=e(Tu,i.fixtures[s],n);n._addFixture(r)}return n};wt.prototype.isWorldLocked=function(){return!!(this.m_world&&this.m_world.isLocked())};wt.prototype.getWorld=function(){return this.m_world};wt.prototype.getNext=function(){return this.m_next};wt.prototype.setUserData=function(i){this.m_userData=i};wt.prototype.getUserData=function(){return this.m_userData};wt.prototype.getFixtureList=function(){return this.m_fixtureList};wt.prototype.getJointList=function(){return this.m_jointList};wt.prototype.getContactList=function(){return this.m_contactList};wt.prototype.isStatic=function(){return this.m_type==ks};wt.prototype.isDynamic=function(){return this.m_type==on};wt.prototype.isKinematic=function(){return this.m_type==sl};wt.prototype.setStatic=function(){return this.setType(ks),this};wt.prototype.setDynamic=function(){return this.setType(on),this};wt.prototype.setKinematic=function(){return this.setType(sl),this};wt.prototype.getType=function(){return this.m_type};wt.prototype.setType=function(i){if(ri&&oi.assert(i===ks||i===sl||i===on),ri&&oi.assert(this.isWorldLocked()==!1),this.isWorldLocked()!=!0&&this.m_type!=i){this.m_type=i,this.resetMassData(),this.m_type==ks&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var t=this.m_contactList;t;){var e=t;t=t.next,this.m_world.destroyContact(e.contact)}this.m_contactList=null;for(var n=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)for(var r=s.m_proxyCount,a=0;a<r;++a)n.touchProxy(s.m_proxies[a].proxyId)}};wt.prototype.isBullet=function(){return this.m_bulletFlag};wt.prototype.setBullet=function(i){this.m_bulletFlag=!!i};wt.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag};wt.prototype.setSleepingAllowed=function(i){this.m_autoSleepFlag=!!i,this.m_autoSleepFlag==!1&&this.setAwake(!0)};wt.prototype.isAwake=function(){return this.m_awakeFlag};wt.prototype.setAwake=function(i){i?this.m_awakeFlag==!1&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)};wt.prototype.isActive=function(){return this.m_activeFlag};wt.prototype.setActive=function(i){if(ri&&oi.assert(this.isWorldLocked()==!1),i!=this.m_activeFlag)if(this.m_activeFlag=!!i,this.m_activeFlag)for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.createProxies(t,this.m_xf);else{for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.destroyProxies(t);for(var n=this.m_contactList;n;){var s=n;n=n.next,this.m_world.destroyContact(s.contact)}this.m_contactList=null}};wt.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag};wt.prototype.setFixedRotation=function(i){this.m_fixedRotationFlag!=i&&(this.m_fixedRotationFlag=!!i,this.m_angularVelocity=0,this.resetMassData())};wt.prototype.getTransform=function(){return this.m_xf};wt.prototype.setTransform=function(i,t){if(ri&&oi.assert(this.isWorldLocked()==!1),this.isWorldLocked()!=!0){this.m_xf.set(i,t),this.m_sweep.setTransform(this.m_xf);for(var e=this.m_world.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.synchronize(e,this.m_xf,this.m_xf)}};wt.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)};wt.prototype.synchronizeFixtures=function(){var i=ma.identity();this.m_sweep.getTransform(i,0);for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(t,i,this.m_xf)};wt.prototype.advance=function(i){this.m_sweep.advance(i),this.m_sweep.c.set(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)};wt.prototype.getPosition=function(){return this.m_xf.p};wt.prototype.setPosition=function(i){this.setTransform(i,this.m_sweep.a)};wt.prototype.getAngle=function(){return this.m_sweep.a};wt.prototype.setAngle=function(i){this.setTransform(this.m_xf.p,i)};wt.prototype.getWorldCenter=function(){return this.m_sweep.c};wt.prototype.getLocalCenter=function(){return this.m_sweep.localCenter};wt.prototype.getLinearVelocity=function(){return this.m_linearVelocity};wt.prototype.getLinearVelocityFromWorldPoint=function(i){var t=Ie.sub(i,this.m_sweep.c);return Ie.add(this.m_linearVelocity,Ie.cross(this.m_angularVelocity,t))};wt.prototype.getLinearVelocityFromLocalPoint=function(i){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(i))};wt.prototype.setLinearVelocity=function(i){this.m_type!=ks&&(Ie.dot(i,i)>0&&this.setAwake(!0),this.m_linearVelocity.set(i))};wt.prototype.getAngularVelocity=function(){return this.m_angularVelocity};wt.prototype.setAngularVelocity=function(i){this.m_type!=ks&&(i*i>0&&this.setAwake(!0),this.m_angularVelocity=i)};wt.prototype.getLinearDamping=function(){return this.m_linearDamping};wt.prototype.setLinearDamping=function(i){this.m_linearDamping=i};wt.prototype.getAngularDamping=function(){return this.m_angularDamping};wt.prototype.setAngularDamping=function(i){this.m_angularDamping=i};wt.prototype.getGravityScale=function(){return this.m_gravityScale};wt.prototype.setGravityScale=function(i){this.m_gravityScale=i};wt.prototype.getMass=function(){return this.m_mass};wt.prototype.getInertia=function(){return this.m_I+this.m_mass*Ie.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)};function h_(){this.mass=0,this.center=Ie.zero(),this.I=0}wt.prototype.getMassData=function(i){i.mass=this.m_mass,i.I=this.getInertia(),i.center.set(this.m_sweep.localCenter)};wt.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic()){this.m_sweep.c0.set(this.m_xf.p),this.m_sweep.c.set(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}ri&&oi.assert(this.isDynamic());for(var i=Ie.zero(),t=this.m_fixtureList;t;t=t.m_next)if(t.m_density!=0){var e=new h_;t.getMassData(e),this.m_mass+=e.mass,i.addMul(e.mass,e.center),this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,i.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&this.m_fixedRotationFlag==!1?(this.m_I-=this.m_mass*Ie.dot(i,i),ri&&oi.assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=Ie.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(i,this.m_xf),this.m_linearVelocity.add(Ie.cross(this.m_angularVelocity,Ie.sub(this.m_sweep.c,n)))};wt.prototype.setMassData=function(i){if(ri&&oi.assert(this.isWorldLocked()==!1),this.isWorldLocked()!=!0&&this.m_type==on){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=i.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,i.I>0&&this.m_fixedRotationFlag==!1&&(this.m_I=i.I-this.m_mass*Ie.dot(i.center,i.center),ri&&oi.assert(this.m_I>0),this.m_invI=1/this.m_I);var t=Ie.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(i.center,this.m_xf),this.m_linearVelocity.add(Ie.cross(this.m_angularVelocity,Ie.sub(this.m_sweep.c,t)))}};wt.prototype.applyForce=function(i,t,e){this.m_type==on&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(i),this.m_torque+=Ie.cross(Ie.sub(t,this.m_sweep.c),i)))};wt.prototype.applyForceToCenter=function(i,t){this.m_type==on&&(t&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(i))};wt.prototype.applyTorque=function(i,t){this.m_type==on&&(t&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=i))};wt.prototype.applyLinearImpulse=function(i,t,e){this.m_type==on&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,i),this.m_angularVelocity+=this.m_invI*Ie.cross(Ie.sub(t,this.m_sweep.c),i)))};wt.prototype.applyAngularImpulse=function(i,t){this.m_type==on&&(t&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*i))};wt.prototype.shouldCollide=function(i){if(this.m_type!=on&&i.m_type!=on)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==i&&t.joint.m_collideConnected==!1)return!1;return!0};wt.prototype._addFixture=function(i){if(ri&&oi.assert(this.isWorldLocked()==!1),this.isWorldLocked()==!0)return null;if(this.m_activeFlag){var t=this.m_world.m_broadPhase;i.createProxies(t,this.m_xf)}return i.m_next=this.m_fixtureList,this.m_fixtureList=i,i.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,i};wt.prototype.createFixture=function(i,t){if(ri&&oi.assert(this.isWorldLocked()==!1),this.isWorldLocked()==!0)return null;var e=new Tu(this,i,t);return this._addFixture(e),e};wt.prototype.destroyFixture=function(i){if(ri&&oi.assert(this.isWorldLocked()==!1),this.isWorldLocked()!=!0){ri&&oi.assert(i.m_body==this);var t=!1;if(this.m_fixtureList===i)this.m_fixtureList=i.m_next,t=!0;else for(var e=this.m_fixtureList;e!=null;){if(e.m_next===i){e.m_next=i.m_next,t=!0;break}e=e.m_next}ri&&oi.assert(t);for(var n=this.m_contactList;n;){var s=n.contact;n=n.next;var r=s.getFixtureA(),a=s.getFixtureB();(i==r||i==a)&&this.m_world.destroyContact(s)}if(this.m_activeFlag){var h=this.m_world.m_broadPhase;i.destroyProxies(h)}i.m_body=null,i.m_next=null,this.m_world.publish("remove-fixture",i),this.resetMassData()}};wt.prototype.getWorldPoint=function(i){return ma.mulVec2(this.m_xf,i)};wt.prototype.getWorldVector=function(i){return Bu.mulVec2(this.m_xf.q,i)};wt.prototype.getLocalPoint=function(i){return ma.mulTVec2(this.m_xf,i)};wt.prototype.getLocalVector=function(i){return Bu.mulTVec2(this.m_xf.q,i)};var l_=typeof DEBUG=="undefined"?!1:DEBUG,ai=typeof ASSERT=="undefined"?!1:ASSERT,Ws=re,pa=ie,Zt=Yt;function re(i,t,e,n){typeof i=="object"&&i!==null?(this.ex=Zt.clone(i),this.ey=Zt.clone(t)):typeof i=="number"?(this.ex=Zt.neo(i,e),this.ey=Zt.neo(t,n)):(this.ex=Zt.zero(),this.ey=Zt.zero())}re.prototype.toString=function(){return JSON.stringify(this)};re.isValid=function(i){return i&&Zt.isValid(i.ex)&&Zt.isValid(i.ey)};re.assert=function(i){if(!!ai&&!re.isValid(i))throw l_&&pa.debug(i),new Error("Invalid Mat22!")};re.prototype.set=function(i,t,e,n){typeof i=="number"&&typeof t=="number"&&typeof e=="number"&&typeof n=="number"?(this.ex.set(i,e),this.ey.set(t,n)):typeof i=="object"&&typeof t=="object"?(this.ex.set(i),this.ey.set(t)):typeof i=="object"?(ai&&re.assert(i),this.ex.set(i.ex),this.ey.set(i.ey)):ai&&pa.assert(!1)};re.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1};re.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0};re.prototype.getInverse=function(){var i=this.ex.x,t=this.ey.x,e=this.ex.y,n=this.ey.y,s=i*n-t*e;s!=0&&(s=1/s);var r=new re;return r.ex.x=s*n,r.ey.x=-s*t,r.ex.y=-s*e,r.ey.y=s*i,r};re.prototype.solve=function(i){ai&&Zt.assert(i);var t=this.ex.x,e=this.ey.x,n=this.ex.y,s=this.ey.y,r=t*s-e*n;r!=0&&(r=1/r);var a=Zt.zero();return a.x=r*(s*i.x-e*i.y),a.y=r*(t*i.y-n*i.x),a};re.mul=function(i,t){if(t&&"x"in t&&"y"in t){ai&&Zt.assert(t);var e=i.ex.x*t.x+i.ey.x*t.y,n=i.ex.y*t.x+i.ey.y*t.y;return Zt.neo(e,n)}else if(t&&"ex"in t&&"ey"in t){ai&&re.assert(t);var s=i.ex.x*t.ex.x+i.ey.x*t.ex.y,r=i.ex.x*t.ey.x+i.ey.x*t.ey.y,a=i.ex.y*t.ex.x+i.ey.y*t.ex.y,h=i.ex.y*t.ey.x+i.ey.y*t.ey.y;return new re(s,r,a,h)}ai&&pa.assert(!1)};re.mulVec2=function(i,t){ai&&Zt.assert(t);var e=i.ex.x*t.x+i.ey.x*t.y,n=i.ex.y*t.x+i.ey.y*t.y;return Zt.neo(e,n)};re.mulMat22=function(i,t){ai&&re.assert(t);var e=i.ex.x*t.ex.x+i.ey.x*t.ex.y,n=i.ex.x*t.ey.x+i.ey.x*t.ey.y,s=i.ex.y*t.ex.x+i.ey.y*t.ex.y,r=i.ex.y*t.ey.x+i.ey.y*t.ey.y;return new re(e,n,s,r)};re.mulT=function(i,t){if(t&&"x"in t&&"y"in t)return ai&&Zt.assert(t),Zt.neo(Zt.dot(t,i.ex),Zt.dot(t,i.ey));if(t&&"ex"in t&&"ey"in t){ai&&re.assert(t);var e=Zt.neo(Zt.dot(i.ex,t.ex),Zt.dot(i.ey,t.ex)),n=Zt.neo(Zt.dot(i.ex,t.ey),Zt.dot(i.ey,t.ey));return new re(e,n)}ai&&pa.assert(!1)};re.mulTVec2=function(i,t){return ai&&re.assert(i),ai&&Zt.assert(t),Zt.neo(Zt.dot(t,i.ex),Zt.dot(t,i.ey))};re.mulTMat22=function(i,t){ai&&re.assert(i),ai&&re.assert(t);var e=Zt.neo(Zt.dot(i.ex,t.ex),Zt.dot(i.ey,t.ex)),n=Zt.neo(Zt.dot(i.ex,t.ey),Zt.dot(i.ey,t.ey));return new re(e,n)};re.abs=function(i){return ai&&re.assert(i),new re(Zt.abs(i.ex),Zt.abs(i.ey))};re.add=function(i,t){return ai&&re.assert(i),ai&&re.assert(t),new re(Zt.add(i.ex,t.ex),Zt.add(i.ey,t.ey))};var an={exports:{}};var Re=Yt,lr=Li,Cu=de.exports,Eu=Ve;an.exports=hn;an.exports.clipSegmentToLine=m_;an.exports.clipVertex=Iu;an.exports.getPointStates=u_;an.exports.PointState=ro;hn.e_circles=0;hn.e_faceA=1;hn.e_faceB=2;hn.e_vertex=0;hn.e_face=1;function hn(){this.type,this.localNormal=Re.zero(),this.localPoint=Re.zero(),this.points=[new Lu,new Lu],this.pointCount=0}function Lu(){this.localPoint=Re.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new fa}function fa(){this.cf=new Pu}Object.defineProperty(fa.prototype,"key",{get:function(){return this.cf.indexA+this.cf.indexB*4+this.cf.typeA*16+this.cf.typeB*64},enumerable:!0,configurable:!0});fa.prototype.set=function(i){this.cf.set(i.cf)};function Pu(){this.indexA,this.indexB,this.typeA,this.typeB}Pu.prototype.set=function(i){this.indexA=i.indexA,this.indexB=i.indexB,this.typeA=i.typeA,this.typeB=i.typeB};function c_(){this.normal,this.points=[],this.separations=[]}hn.prototype.getWorldManifold=function(i,t,e,n,s){if(this.pointCount!=0){i=i||new c_;var r=i.normal,a=i.points,h=i.separations;switch(this.type){case hn.e_circles:r=Re.neo(1,0);var o=lr.mulVec2(t,this.localPoint),l=lr.mulVec2(n,this.points[0].localPoint),u=Re.sub(l,o);Re.lengthSquared(u)>Cu.EPSILON*Cu.EPSILON&&(r.set(u),r.normalize());var m=o.clone().addMul(e,r),p=l.clone().addMul(-s,r);a[0]=Re.mid(m,p),h[0]=Re.dot(Re.sub(p,m),r),a.length=1,h.length=1;break;case hn.e_faceA:r=Eu.mulVec2(t.q,this.localNormal);for(var c=lr.mulVec2(t,this.localPoint),f=0;f<this.pointCount;++f){var d=lr.mulVec2(n,this.points[f].localPoint),m=Re.clone(d).addMul(e-Re.dot(Re.sub(d,c),r),r),p=Re.clone(d).subMul(s,r);a[f]=Re.mid(m,p),h[f]=Re.dot(Re.sub(p,m),r)}a.length=this.pointCount,h.length=this.pointCount;break;case hn.e_faceB:r=Eu.mulVec2(n.q,this.localNormal);for(var c=lr.mulVec2(n,this.localPoint),f=0;f<this.pointCount;++f){var d=lr.mulVec2(t,this.points[f].localPoint),p=Re.combine(1,d,s-Re.dot(Re.sub(d,c),r),r),m=Re.combine(1,d,-e,r);a[f]=Re.mid(m,p),h[f]=Re.dot(Re.sub(m,p),r)}a.length=this.pointCount,h.length=this.pointCount,r.mul(-1);break}return i.normal=r,i.points=a,i.separations=h,i}};var ro={nullState:0,addState:1,persistState:2,removeState:3};function u_(i,t,e,n){for(var s=0;s<e.pointCount;++s){var r=e.points[s].id;i[s]=ro.removeState;for(var a=0;a<n.pointCount;++a)if(n.points[a].id.key==r.key){i[s]=ro.persistState;break}}for(var s=0;s<n.pointCount;++s){var r=n.points[s].id;t[s]=ro.addState;for(var a=0;a<e.pointCount;++a)if(e.points[a].id.key==r.key){t[s]=ro.persistState;break}}}function Iu(){this.v=Re.zero(),this.id=new fa}Iu.prototype.set=function(i){this.v.set(i.v),this.id.set(i.id)};function m_(i,t,e,n,s){var r=0,a=Re.dot(e,t[0].v)-n,h=Re.dot(e,t[1].v)-n;if(a<=0&&i[r++].set(t[0]),h<=0&&i[r++].set(t[1]),a*h<0){var o=a/(a-h);i[r].v.setCombine(1-o,t[0].v,o,t[1].v),i[r].id.cf.indexA=s,i[r].id.cf.indexB=t[0].id.cf.indexB,i[r].id.cf.typeA=hn.e_vertex,i[r].id.cf.typeB=hn.e_face,++r}return r}var Xn={exports:{}},da={};da.toString=function(i){i=typeof i=="string"?i:`
`;var t="";for(var e in this)typeof this[e]!="function"&&typeof this[e]!="object"&&(t+=e+": "+this[e]+i);return t};var p_=typeof DEBUG=="undefined"?!1:DEBUG,oo=typeof ASSERT=="undefined"?!1:ASSERT,cr=ne,f_=ie,rl=de.exports;function ne(i,t,e){if(!(this instanceof ne))return new ne(i,t,e);typeof i=="undefined"?(this.x=0,this.y=0,this.z=0):typeof i=="object"?(this.x=i.x,this.y=i.y,this.z=i.z):(this.x=i,this.y=t,this.z=e),oo&&ne.assert(this)}ne.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}};ne._deserialize=function(i){var t=Object.create(ne.prototype);return t.x=i.x,t.y=i.y,t.z=i.z,t};ne.neo=function(i,t,e){var n=Object.create(ne.prototype);return n.x=i,n.y=t,n.z=e,n};ne.clone=function(i){return oo&&ne.assert(i),ne.neo(i.x,i.y,i.z)};ne.prototype.toString=function(){return JSON.stringify(this)};ne.isValid=function(i){return i&&rl.isFinite(i.x)&&rl.isFinite(i.y)&&rl.isFinite(i.z)};ne.assert=function(i){if(!!oo&&!ne.isValid(i))throw p_&&f_.debug(i),new Error("Invalid Vec3!")};ne.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this};ne.prototype.set=function(i,t,e){return this.x=i,this.y=t,this.z=e,this};ne.prototype.add=function(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this};ne.prototype.sub=function(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this};ne.prototype.mul=function(i){return this.x*=i,this.y*=i,this.z*=i,this};ne.areEqual=function(i,t){return oo&&ne.assert(i),oo&&ne.assert(t),i==t||typeof i=="object"&&i!==null&&typeof t=="object"&&t!==null&&i.x===t.x&&i.y===t.y&&i.z===t.z};ne.dot=function(i,t){return i.x*t.x+i.y*t.y+i.z*t.z};ne.cross=function(i,t){return new ne(i.y*t.z-i.z*t.y,i.z*t.x-i.x*t.z,i.x*t.y-i.y*t.x)};ne.add=function(i,t){return new ne(i.x+t.x,i.y+t.y,i.z+t.z)};ne.sub=function(i,t){return new ne(i.x-t.x,i.y-t.y,i.z-t.z)};ne.mul=function(i,t){return new ne(t*i.x,t*i.y,t*i.z)};ne.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this};ne.neg=function(i){return new ne(-i.x,-i.y,-i.z)};var d_=typeof DEBUG=="undefined"?!1:DEBUG,gn=typeof ASSERT=="undefined"?!1:ASSERT,_a=Ze,Ru=ie,ao=Yt,Ce=cr;function Ze(i,t,e){typeof i=="object"&&i!==null?(this.ex=Ce.clone(i),this.ey=Ce.clone(t),this.ez=Ce.clone(e)):(this.ex=Ce(),this.ey=Ce(),this.ez=Ce())}Ze.prototype.toString=function(){return JSON.stringify(this)};Ze.isValid=function(i){return i&&Ce.isValid(i.ex)&&Ce.isValid(i.ey)&&Ce.isValid(i.ez)};Ze.assert=function(i){if(!!gn&&!Ze.isValid(i))throw d_&&Ru.debug(i),new Error("Invalid Mat33!")};Ze.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this};Ze.prototype.solve33=function(i){var t=Ce.dot(this.ex,Ce.cross(this.ey,this.ez));t!=0&&(t=1/t);var e=new Ce;return e.x=t*Ce.dot(i,Ce.cross(this.ey,this.ez)),e.y=t*Ce.dot(this.ex,Ce.cross(i,this.ez)),e.z=t*Ce.dot(this.ex,Ce.cross(this.ey,i)),e};Ze.prototype.solve22=function(i){var t=this.ex.x,e=this.ey.x,n=this.ex.y,s=this.ey.y,r=t*s-e*n;r!=0&&(r=1/r);var a=ao.zero();return a.x=r*(s*i.x-e*i.y),a.y=r*(t*i.y-n*i.x),a};Ze.prototype.getInverse22=function(i){var t=this.ex.x,e=this.ey.x,n=this.ex.y,s=this.ey.y,r=t*s-e*n;r!=0&&(r=1/r),i.ex.x=r*s,i.ey.x=-r*e,i.ex.z=0,i.ex.y=-r*n,i.ey.y=r*t,i.ey.z=0,i.ez.x=0,i.ez.y=0,i.ez.z=0};Ze.prototype.getSymInverse33=function(i){var t=Ce.dot(this.ex,Ce.cross(this.ey,this.ez));t!=0&&(t=1/t);var e=this.ex.x,n=this.ey.x,s=this.ez.x,r=this.ey.y,a=this.ez.y,h=this.ez.z;i.ex.x=t*(r*h-a*a),i.ex.y=t*(s*a-n*h),i.ex.z=t*(n*a-s*r),i.ey.x=i.ex.y,i.ey.y=t*(e*h-s*s),i.ey.z=t*(s*n-e*a),i.ez.x=i.ex.z,i.ez.y=i.ey.z,i.ez.z=t*(e*r-n*n)};Ze.mul=function(i,t){if(gn&&Ze.assert(i),t&&"z"in t&&"y"in t&&"x"in t){gn&&Ce.assert(t);var e=i.ex.x*t.x+i.ey.x*t.y+i.ez.x*t.z,n=i.ex.y*t.x+i.ey.y*t.y+i.ez.y*t.z,s=i.ex.z*t.x+i.ey.z*t.y+i.ez.z*t.z;return new Ce(e,n,s)}else if(t&&"y"in t&&"x"in t){gn&&ao.assert(t);var e=i.ex.x*t.x+i.ey.x*t.y,n=i.ex.y*t.x+i.ey.y*t.y;return ao.neo(e,n)}gn&&Ru.assert(!1)};Ze.mulVec3=function(i,t){gn&&Ze.assert(i),gn&&Ce.assert(t);var e=i.ex.x*t.x+i.ey.x*t.y+i.ez.x*t.z,n=i.ex.y*t.x+i.ey.y*t.y+i.ez.y*t.z,s=i.ex.z*t.x+i.ey.z*t.y+i.ez.z*t.z;return new Ce(e,n,s)};Ze.mulVec2=function(i,t){gn&&Ze.assert(i),gn&&ao.assert(t);var e=i.ex.x*t.x+i.ey.x*t.y,n=i.ex.y*t.x+i.ey.y*t.y;return ao.neo(e,n)};Ze.add=function(i,t){return gn&&Ze.assert(i),gn&&Ze.assert(t),new Ze(Ce.add(i.ex,t.ex),Ce.add(i.ey,t.ey),Ce.add(i.ez,t.ez))};var xn=typeof ASSERT=="undefined"?!1:ASSERT;Xn.exports=ol;Xn.exports.Input=zu;Xn.exports.Output=Fu;Xn.exports.Proxy=cs;Xn.exports.Cache=Vu;var __=je,An=ie,Ys=da,ur=de.exports,Dt=Yt,Du=Ve,mr=Li;Ys.gjkCalls=0;Ys.gjkIters=0;Ys.gjkMaxIters=0;function zu(){this.proxyA=new cs,this.proxyB=new cs,this.transformA=null,this.transformB=null,this.useRadii=!1}function Fu(){this.pointA=Dt.zero(),this.pointB=Dt.zero(),this.distance,this.iterations}function Vu(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}function ol(i,t,e){++Ys.gjkCalls;var n=e.proxyA,s=e.proxyB,r=e.transformA,a=e.transformB,h=new bn;h.readCache(t,n,r,s,a);for(var o=h.m_v,l=__.maxDistnceIterations,u=[],m=[],p=0,c=0;c<l;){p=h.m_count;for(var f=0;f<p;++f)u[f]=o[f].indexA,m[f]=o[f].indexB;if(h.solve(),h.m_count==3)break;var d=h.getClosestPoint();d.lengthSquared();var y=h.getSearchDirection();if(y.lengthSquared()<ur.EPSILON*ur.EPSILON)break;var _=o[h.m_count];_.indexA=n.getSupport(Du.mulTVec2(r.q,Dt.neg(y))),_.wA=mr.mulVec2(r,n.getVertex(_.indexA)),_.indexB=s.getSupport(Du.mulTVec2(a.q,y)),_.wB=mr.mulVec2(a,s.getVertex(_.indexB)),_.w=Dt.sub(_.wB,_.wA),++c,++Ys.gjkIters;for(var v=!1,f=0;f<p;++f)if(_.indexA==u[f]&&_.indexB==m[f]){v=!0;break}if(v)break;++h.m_count}if(Ys.gjkMaxIters=ur.max(Ys.gjkMaxIters,c),h.getWitnessPoints(i.pointA,i.pointB),i.distance=Dt.distance(i.pointA,i.pointB),i.iterations=c,h.writeCache(t),e.useRadii){var g=n.m_radius,x=s.m_radius;if(i.distance>g+x&&i.distance>ur.EPSILON){i.distance-=g+x;var A=Dt.sub(i.pointB,i.pointA);A.normalize(),i.pointA.addMul(g,A),i.pointB.subMul(x,A)}else{var d=Dt.mid(i.pointA,i.pointB);i.pointA.set(d),i.pointB.set(d),i.distance=0}}}function cs(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}cs.prototype.getVertexCount=function(){return this.m_count};cs.prototype.getVertex=function(i){return xn&&An.assert(0<=i&&i<this.m_count),this.m_vertices[i]};cs.prototype.getSupport=function(i){for(var t=0,e=Dt.dot(this.m_vertices[0],i),n=0;n<this.m_count;++n){var s=Dt.dot(this.m_vertices[n],i);s>e&&(t=n,e=s)}return t};cs.prototype.getSupportVertex=function(i){return this.m_vertices[this.getSupport(i)]};cs.prototype.set=function(i,t){xn&&An.assert(typeof i.computeDistanceProxy=="function"),i.computeDistanceProxy(this,t)};function va(){this.indexA,this.indexB,this.wA=Dt.zero(),this.wB=Dt.zero(),this.w=Dt.zero(),this.a}va.prototype.set=function(i){this.indexA=i.indexA,this.indexB=i.indexB,this.wA=Dt.clone(i.wA),this.wB=Dt.clone(i.wB),this.w=Dt.clone(i.w),this.a=i.a};function bn(){this.m_v1=new va,this.m_v2=new va,this.m_v3=new va,this.m_v=[this.m_v1,this.m_v2,this.m_v3],this.m_count}bn.prototype.print=function(){return this.m_count==3?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():this.m_count==2?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():this.m_count==1?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count};bn.prototype.readCache=function(i,t,e,n,s){xn&&An.assert(i.count<=3),this.m_count=i.count;for(var r=0;r<this.m_count;++r){var a=this.m_v[r];a.indexA=i.indexA[r],a.indexB=i.indexB[r];var h=t.getVertex(a.indexA),o=n.getVertex(a.indexB);a.wA=mr.mulVec2(e,h),a.wB=mr.mulVec2(s,o),a.w=Dt.sub(a.wB,a.wA),a.a=0}if(this.m_count>1){var l=i.metric,u=this.getMetric();(u<.5*l||2*l<u||u<ur.EPSILON)&&(this.m_count=0)}if(this.m_count==0){var a=this.m_v[0];a.indexA=0,a.indexB=0;var h=t.getVertex(0),o=n.getVertex(0);a.wA=mr.mulVec2(e,h),a.wB=mr.mulVec2(s,o),a.w=Dt.sub(a.wB,a.wA),a.a=1,this.m_count=1}};bn.prototype.writeCache=function(i){i.metric=this.getMetric(),i.count=this.m_count;for(var t=0;t<this.m_count;++t)i.indexA[t]=this.m_v[t].indexA,i.indexB[t]=this.m_v[t].indexB};bn.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return Dt.neg(this.m_v1.w);case 2:{var i=Dt.sub(this.m_v2.w,this.m_v1.w),t=Dt.cross(i,Dt.neg(this.m_v1.w));return t>0?Dt.cross(1,i):Dt.cross(i,1)}default:return xn&&An.assert(!1),Dt.zero()}};bn.prototype.getClosestPoint=function(){switch(this.m_count){case 0:return xn&&An.assert(!1),Dt.zero();case 1:return Dt.clone(this.m_v1.w);case 2:return Dt.combine(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w);case 3:return Dt.zero();default:return xn&&An.assert(!1),Dt.zero()}};bn.prototype.getWitnessPoints=function(i,t){switch(this.m_count){case 0:xn&&An.assert(!1);break;case 1:i.set(this.m_v1.wA),t.set(this.m_v1.wB);break;case 2:i.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),t.setCombine(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:i.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),i.addMul(this.m_v3.a,this.m_v3.wA),t.set(i);break;default:xn&&An.assert(!1);break}};bn.prototype.getMetric=function(){switch(this.m_count){case 0:return xn&&An.assert(!1),0;case 1:return 0;case 2:return Dt.distance(this.m_v1.w,this.m_v2.w);case 3:return Dt.cross(Dt.sub(this.m_v2.w,this.m_v1.w),Dt.sub(this.m_v3.w,this.m_v1.w));default:return xn&&An.assert(!1),0}};bn.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3();break;default:xn&&An.assert(!1)}};bn.prototype.solve2=function(){var i=this.m_v1.w,t=this.m_v2.w,e=Dt.sub(t,i),n=-Dt.dot(i,e);if(n<=0){this.m_v1.a=1,this.m_count=1;return}var s=Dt.dot(t,e);if(s<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}var r=1/(s+n);this.m_v1.a=s*r,this.m_v2.a=n*r,this.m_count=2};bn.prototype.solve3=function(){var i=this.m_v1.w,t=this.m_v2.w,e=this.m_v3.w,n=Dt.sub(t,i),s=Dt.dot(i,n),r=Dt.dot(t,n),a=r,h=-s,o=Dt.sub(e,i),l=Dt.dot(i,o),u=Dt.dot(e,o),m=u,p=-l,c=Dt.sub(e,t),f=Dt.dot(t,c),d=Dt.dot(e,c),y=d,_=-f,v=Dt.cross(n,o),g=v*Dt.cross(t,e),x=v*Dt.cross(e,i),A=v*Dt.cross(i,t);if(h<=0&&p<=0){this.m_v1.a=1,this.m_count=1;return}if(a>0&&h>0&&A<=0){var b=1/(a+h);this.m_v1.a=a*b,this.m_v2.a=h*b,this.m_count=2;return}if(m>0&&p>0&&x<=0){var M=1/(m+p);this.m_v1.a=m*M,this.m_v3.a=p*M,this.m_count=2,this.m_v2.set(this.m_v3);return}if(a<=0&&_<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}if(m<=0&&y<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.set(this.m_v3);return}if(y>0&&_>0&&g<=0){var S=1/(y+_);this.m_v2.a=y*S,this.m_v3.a=_*S,this.m_count=2,this.m_v1.set(this.m_v3);return}var B=1/(g+x+A);this.m_v1.a=g*B,this.m_v2.a=x*B,this.m_v3.a=A*B,this.m_count=3};ol.testOverlap=function(i,t,e,n,s,r){var a=new zu;a.proxyA.set(i,t),a.proxyB.set(e,n),a.transformA=s,a.transformB=r,a.useRadii=!0;var h=new Vu,o=new Fu;return ol(o,h,a),o.distance<10*ur.EPSILON};var ya=typeof ASSERT=="undefined"?!1:ASSERT,ga=ie,ho=de.exports,nt=Yt,Nn=Li,xa=Ws,pr=Ve,lo=je,co=an.exports,v_=Xn.exports,us=oe;function Nu(i){this.contact=i,this.prev,this.next,this.other}function oe(i,t,e,n,s){this.m_nodeA=new Nu(this),this.m_nodeB=new Nu(this),this.m_fixtureA=i,this.m_fixtureB=e,this.m_indexA=t,this.m_indexB=n,this.m_evaluateFcn=s,this.m_manifold=new co,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=Ou(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Uu(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.v_points=[],this.v_normal=nt.zero(),this.v_normalMass=new xa,this.v_K=new xa,this.v_pointCount,this.v_tangentSpeed,this.v_friction,this.v_restitution,this.v_invMassA,this.v_invMassB,this.v_invIA,this.v_invIB,this.p_localPoints=[],this.p_localNormal=nt.zero(),this.p_localPoint=nt.zero(),this.p_localCenterA=nt.zero(),this.p_localCenterB=nt.zero(),this.p_type,this.p_radiusA,this.p_radiusB,this.p_pointCount,this.p_invMassA,this.p_invMassB,this.p_invIA,this.p_invIB}oe.prototype.initConstraint=function(i){var t=this.m_fixtureA,e=this.m_fixtureB,n=t.getShape(),s=e.getShape(),r=t.getBody(),a=e.getBody(),h=this.getManifold(),o=h.pointCount;ya&&ga.assert(o>0),this.v_invMassA=r.m_invMass,this.v_invMassB=a.m_invMass,this.v_invIA=r.m_invI,this.v_invIB=a.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=o,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=r.m_invMass,this.p_invMassB=a.m_invMass,this.p_invIA=r.m_invI,this.p_invIB=a.m_invI,this.p_localCenterA=nt.clone(r.m_sweep.localCenter),this.p_localCenterB=nt.clone(a.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=s.m_radius,this.p_type=h.type,this.p_localNormal=nt.clone(h.localNormal),this.p_localPoint=nt.clone(h.localPoint),this.p_pointCount=o;for(var l=0;l<o;++l){var u=h.points[l],m=this.v_points[l]=new y_;i.warmStarting?(m.normalImpulse=i.dtRatio*u.normalImpulse,m.tangentImpulse=i.dtRatio*u.tangentImpulse):(m.normalImpulse=0,m.tangentImpulse=0),m.rA.setZero(),m.rB.setZero(),m.normalMass=0,m.tangentMass=0,m.velocityBias=0,this.p_localPoints[l]=nt.clone(u.localPoint)}};oe.prototype.getManifold=function(){return this.m_manifold};oe.prototype.getWorldManifold=function(i){var t=this.m_fixtureA.getBody(),e=this.m_fixtureB.getBody(),n=this.m_fixtureA.getShape(),s=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(i,t.getTransform(),n.m_radius,e.getTransform(),s.m_radius)};oe.prototype.setEnabled=function(i){this.m_enabledFlag=!!i};oe.prototype.isEnabled=function(){return this.m_enabledFlag};oe.prototype.isTouching=function(){return this.m_touchingFlag};oe.prototype.getNext=function(){return this.m_next};oe.prototype.getFixtureA=function(){return this.m_fixtureA};oe.prototype.getFixtureB=function(){return this.m_fixtureB};oe.prototype.getChildIndexA=function(){return this.m_indexA};oe.prototype.getChildIndexB=function(){return this.m_indexB};oe.prototype.flagForFiltering=function(){this.m_filterFlag=!0};oe.prototype.setFriction=function(i){this.m_friction=i};oe.prototype.getFriction=function(){return this.m_friction};oe.prototype.resetFriction=function(){this.m_friction=Ou(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)};oe.prototype.setRestitution=function(i){this.m_restitution=i};oe.prototype.getRestitution=function(){return this.m_restitution};oe.prototype.resetRestitution=function(){this.m_restitution=Uu(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)};oe.prototype.setTangentSpeed=function(i){this.m_tangentSpeed=i};oe.prototype.getTangentSpeed=function(){return this.m_tangentSpeed};oe.prototype.evaluate=function(i,t,e){this.m_evaluateFcn(i,t,this.m_fixtureA,this.m_indexA,e,this.m_fixtureB,this.m_indexB)};oe.prototype.update=function(i){this.m_enabledFlag=!0;var t=!1,e=this.m_touchingFlag,n=this.m_fixtureA.isSensor(),s=this.m_fixtureB.isSensor(),r=n||s,a=this.m_fixtureA.getBody(),h=this.m_fixtureB.getBody(),o=a.getTransform(),l=h.getTransform();if(r){var u=this.m_fixtureA.getShape(),m=this.m_fixtureB.getShape();t=v_.testOverlap(u,this.m_indexA,m,this.m_indexB,o,l),this.m_manifold.pointCount=0}else{var p=this.m_manifold;this.m_manifold=new co,this.evaluate(this.m_manifold,o,l),t=this.m_manifold.pointCount>0;for(var c=0;c<this.m_manifold.pointCount;++c){var f=this.m_manifold.points[c];f.normalImpulse=0,f.tangentImpulse=0;for(var d=0;d<p.pointCount;++d){var y=p.points[d];if(y.id.key==f.id.key){f.normalImpulse=y.normalImpulse,f.tangentImpulse=y.tangentImpulse;break}}}t!=e&&(a.setAwake(!0),h.setAwake(!0))}this.m_touchingFlag=t,e==!1&&t==!0&&i&&i.beginContact(this),e==!0&&t==!1&&i&&i.endContact(this),r==!1&&t&&i&&i.preSolve(this,p)};oe.prototype.solvePositionConstraint=function(i){return this._solvePositionConstraint(i,!1)};oe.prototype.solvePositionConstraintTOI=function(i,t,e){return this._solvePositionConstraint(i,!0,t,e)};oe.prototype._solvePositionConstraint=function(i,t,e,n){var s=this.m_fixtureA,r=this.m_fixtureB,a=s.getBody(),h=r.getBody();a.c_velocity,h.c_velocity;var o=a.c_position,l=h.c_position,u=nt.clone(this.p_localCenterA),m=nt.clone(this.p_localCenterB),p=0,c=0;(!t||a==e||a==n)&&(p=this.p_invMassA,c=this.p_invIA);var f=0,d=0;(!t||h==e||h==n)&&(f=this.p_invMassB,d=this.p_invIB);for(var y=nt.clone(o.c),_=o.a,v=nt.clone(l.c),g=l.a,x=0,A=0;A<this.p_pointCount;++A){var b=Nn.identity(),M=Nn.identity();b.q.set(_),M.q.set(g),b.p=nt.sub(y,pr.mulVec2(b.q,u)),M.p=nt.sub(v,pr.mulVec2(M.q,m));var S,B,E;switch(this.p_type){case co.e_circles:var T=Nn.mulVec2(b,this.p_localPoint),w=Nn.mulVec2(M,this.p_localPoints[0]);S=nt.sub(w,T),S.normalize(),B=nt.combine(.5,T,.5,w),E=nt.dot(nt.sub(w,T),S)-this.p_radiusA-this.p_radiusB;break;case co.e_faceA:S=pr.mulVec2(b.q,this.p_localNormal);var C=Nn.mulVec2(b,this.p_localPoint),P=Nn.mulVec2(M,this.p_localPoints[A]);E=nt.dot(nt.sub(P,C),S)-this.p_radiusA-this.p_radiusB,B=P;break;case co.e_faceB:S=pr.mulVec2(M.q,this.p_localNormal);var C=Nn.mulVec2(M,this.p_localPoint),P=Nn.mulVec2(b,this.p_localPoints[A]);E=nt.dot(nt.sub(P,C),S)-this.p_radiusA-this.p_radiusB,B=P,S.mul(-1);break}var R=nt.sub(B,y),L=nt.sub(B,v);x=ho.min(x,E);var I=t?lo.toiBaugarte:lo.baumgarte,z=lo.linearSlop,F=lo.maxLinearCorrection,D=ho.clamp(I*(E+z),-F,0),V=nt.cross(R,S),G=nt.cross(L,S),Y=p+f+c*V*V+d*G*G,J=Y>0?-D/Y:0,Q=nt.mul(J,S);y.subMul(p,Q),_-=c*nt.cross(R,Q),v.addMul(f,Q),g+=d*nt.cross(L,Q)}return o.c.set(y),o.a=_,l.c.set(v),l.a=g,x};function y_(){this.rA=nt.zero(),this.rB=nt.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}oe.prototype.initVelocityConstraint=function(i){var t=this.m_fixtureA,e=this.m_fixtureB,n=t.getBody(),s=e.getBody(),r=n.c_velocity,a=s.c_velocity,h=n.c_position,o=s.c_position,l=this.p_radiusA,u=this.p_radiusB,m=this.getManifold(),p=this.v_invMassA,c=this.v_invMassB,f=this.v_invIA,d=this.v_invIB,y=nt.clone(this.p_localCenterA),_=nt.clone(this.p_localCenterB),v=nt.clone(h.c),g=h.a,x=nt.clone(r.v),A=r.w,b=nt.clone(o.c),M=o.a,S=nt.clone(a.v),B=a.w;ya&&ga.assert(m.pointCount>0);var E=Nn.identity(),T=Nn.identity();E.q.set(g),T.q.set(M),E.p.setCombine(1,v,-1,pr.mulVec2(E.q,y)),T.p.setCombine(1,b,-1,pr.mulVec2(T.q,_));var w=m.getWorldManifold(null,E,l,T,u);this.v_normal.set(w.normal);for(var C=0;C<this.v_pointCount;++C){var P=this.v_points[C];P.rA.set(nt.sub(w.points[C],v)),P.rB.set(nt.sub(w.points[C],b));var R=nt.cross(P.rA,this.v_normal),L=nt.cross(P.rB,this.v_normal),I=p+c+f*R*R+d*L*L;P.normalMass=I>0?1/I:0;var z=nt.cross(this.v_normal,1),F=nt.cross(P.rA,z),D=nt.cross(P.rB,z),V=p+c+f*F*F+d*D*D;P.tangentMass=V>0?1/V:0,P.velocityBias=0;var G=nt.dot(this.v_normal,S)+nt.dot(this.v_normal,nt.cross(B,P.rB))-nt.dot(this.v_normal,x)-nt.dot(this.v_normal,nt.cross(A,P.rA));G<-lo.velocityThreshold&&(P.velocityBias=-this.v_restitution*G)}if(this.v_pointCount==2&&i.blockSolve){var Y=this.v_points[0],J=this.v_points[1],Q=nt.cross(Y.rA,this.v_normal),W=nt.cross(Y.rB,this.v_normal),et=nt.cross(J.rA,this.v_normal),ct=nt.cross(J.rB,this.v_normal),Z=p+c+f*Q*Q+d*W*W,ot=p+c+f*et*et+d*ct*ct,xt=p+c+f*Q*et+d*W*ct,q=1e3;Z*Z<q*(Z*ot-xt*xt)?(this.v_K.ex.set(Z,xt),this.v_K.ey.set(xt,ot),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}h.c.set(v),h.a=g,r.v.set(x),r.w=A,o.c.set(b),o.a=M,a.v.set(S),a.w=B};oe.prototype.warmStartConstraint=function(i){var t=this.m_fixtureA,e=this.m_fixtureB,n=t.getBody(),s=e.getBody(),r=n.c_velocity,a=s.c_velocity;n.c_position,s.c_position;for(var h=this.v_invMassA,o=this.v_invIA,l=this.v_invMassB,u=this.v_invIB,m=nt.clone(r.v),p=r.w,c=nt.clone(a.v),f=a.w,d=this.v_normal,y=nt.cross(d,1),_=0;_<this.v_pointCount;++_){var v=this.v_points[_],g=nt.combine(v.normalImpulse,d,v.tangentImpulse,y);p-=o*nt.cross(v.rA,g),m.subMul(h,g),f+=u*nt.cross(v.rB,g),c.addMul(l,g)}r.v.set(m),r.w=p,a.v.set(c),a.w=f};oe.prototype.storeConstraintImpulses=function(i){for(var t=this.m_manifold,e=0;e<this.v_pointCount;++e)t.points[e].normalImpulse=this.v_points[e].normalImpulse,t.points[e].tangentImpulse=this.v_points[e].tangentImpulse};oe.prototype.solveVelocityConstraint=function(i){var t=this.m_fixtureA.m_body,e=this.m_fixtureB.m_body,n=t.c_velocity;t.c_position;var s=e.c_velocity;e.c_position;var r=this.v_invMassA,a=this.v_invIA,h=this.v_invMassB,o=this.v_invIB,l=nt.clone(n.v),u=n.w,m=nt.clone(s.v),p=s.w,c=this.v_normal,f=nt.cross(c,1),d=this.v_friction;ya&&ga.assert(this.v_pointCount==1||this.v_pointCount==2);for(var y=0;y<this.v_pointCount;++y){var _=this.v_points[y],v=nt.zero();v.addCombine(1,m,1,nt.cross(p,_.rB)),v.subCombine(1,l,1,nt.cross(u,_.rA));var g=nt.dot(v,f)-this.v_tangentSpeed,x=_.tangentMass*-g,A=d*_.normalImpulse,b=ho.clamp(_.tangentImpulse+x,-A,A);x=b-_.tangentImpulse,_.tangentImpulse=b;var M=nt.mul(x,f);l.subMul(r,M),u-=a*nt.cross(_.rA,M),m.addMul(h,M),p+=o*nt.cross(_.rB,M)}if(this.v_pointCount==1||i.blockSolve==!1)for(var S=0;S<this.v_pointCount;++S){var _=this.v_points[S],v=nt.zero();v.addCombine(1,m,1,nt.cross(p,_.rB)),v.subCombine(1,l,1,nt.cross(u,_.rA));var B=nt.dot(v,c),x=-_.normalMass*(B-_.velocityBias),b=ho.max(_.normalImpulse+x,0);x=b-_.normalImpulse,_.normalImpulse=b;var M=nt.mul(x,c);l.subMul(r,M),u-=a*nt.cross(_.rA,M),m.addMul(h,M),p+=o*nt.cross(_.rB,M)}else{var E=this.v_points[0],T=this.v_points[1],w=nt.neo(E.normalImpulse,T.normalImpulse);ya&&ga.assert(w.x>=0&&w.y>=0);var C=nt.zero().add(m).add(nt.cross(p,E.rB)).sub(l).sub(nt.cross(u,E.rA)),P=nt.zero().add(m).add(nt.cross(p,T.rB)).sub(l).sub(nt.cross(u,T.rA)),R=nt.dot(C,c),L=nt.dot(P,c),I=nt.neo(R-E.velocityBias,L-T.velocityBias);for(I.sub(xa.mulVec2(this.v_K,w));;){var z=xa.mulVec2(this.v_normalMass,I).neg();if(z.x>=0&&z.y>=0){var F=nt.sub(z,w),D=nt.mul(F.x,c),V=nt.mul(F.y,c);l.subCombine(r,D,r,V),u-=a*(nt.cross(E.rA,D)+nt.cross(T.rA,V)),m.addCombine(h,D,h,V),p+=o*(nt.cross(E.rB,D)+nt.cross(T.rB,V)),E.normalImpulse=z.x,T.normalImpulse=z.y;break}if(z.x=-E.normalMass*I.x,z.y=0,R=0,L=this.v_K.ex.y*z.x+I.y,z.x>=0&&L>=0){var F=nt.sub(z,w),D=nt.mul(F.x,c),V=nt.mul(F.y,c);l.subCombine(r,D,r,V),u-=a*(nt.cross(E.rA,D)+nt.cross(T.rA,V)),m.addCombine(h,D,h,V),p+=o*(nt.cross(E.rB,D)+nt.cross(T.rB,V)),E.normalImpulse=z.x,T.normalImpulse=z.y;var C;break}if(z.x=0,z.y=-T.normalMass*I.y,R=this.v_K.ey.x*z.y+I.x,L=0,z.y>=0&&R>=0){var F=nt.sub(z,w),D=nt.mul(F.x,c),V=nt.mul(F.y,c);l.subCombine(r,D,r,V),u-=a*(nt.cross(E.rA,D)+nt.cross(T.rA,V)),m.addCombine(h,D,h,V),p+=o*(nt.cross(E.rB,D)+nt.cross(T.rB,V)),E.normalImpulse=z.x,T.normalImpulse=z.y;var C;break}if(z.x=0,z.y=0,R=I.x,L=I.y,R>=0&&L>=0){var F=nt.sub(z,w),D=nt.mul(F.x,c),V=nt.mul(F.y,c);l.subCombine(r,D,r,V),u-=a*(nt.cross(E.rA,D)+nt.cross(T.rA,V)),m.addCombine(h,D,h,V),p+=o*(nt.cross(E.rB,D)+nt.cross(T.rB,V)),E.normalImpulse=z.x,T.normalImpulse=z.y;break}break}}n.v.set(l),n.w=u,s.v.set(m),s.w=p};function Ou(i,t){return ho.sqrt(i*t)}function Uu(i,t){return i>t?i:t}var ms=[];oe.addType=function(i,t,e){ms[i]=ms[i]||{},ms[i][t]=e};oe.create=function(i,t,e,n){var s=i.getType(),r=e.getType(),a,h;if(h=ms[s]&&ms[s][r])a=new oe(i,t,e,n,h);else if(h=ms[r]&&ms[r][s])a=new oe(e,n,i,t,h);else return null;i=a.getFixtureA(),e=a.getFixtureB(),t=a.getChildIndexA(),n=a.getChildIndexB();var o=i.getBody(),l=e.getBody();return a.m_nodeA.contact=a,a.m_nodeA.other=l,a.m_nodeA.prev=null,a.m_nodeA.next=o.m_contactList,o.m_contactList!=null&&(o.m_contactList.prev=a.m_nodeA),o.m_contactList=a.m_nodeA,a.m_nodeB.contact=a,a.m_nodeB.other=o,a.m_nodeB.prev=null,a.m_nodeB.next=l.m_contactList,l.m_contactList!=null&&(l.m_contactList.prev=a.m_nodeB),l.m_contactList=a.m_nodeB,i.isSensor()==!1&&e.isSensor()==!1&&(o.setAwake(!0),l.setAwake(!0)),a};oe.destroy=function(i,t){var e=i.m_fixtureA,n=i.m_fixtureB,s=e.getBody(),r=n.getBody();i.isTouching()&&t.endContact(i),i.m_nodeA.prev&&(i.m_nodeA.prev.next=i.m_nodeA.next),i.m_nodeA.next&&(i.m_nodeA.next.prev=i.m_nodeA.prev),i.m_nodeA==s.m_contactList&&(s.m_contactList=i.m_nodeA.next),i.m_nodeB.prev&&(i.m_nodeB.prev.next=i.m_nodeB.next),i.m_nodeB.next&&(i.m_nodeB.next.prev=i.m_nodeB.prev),i.m_nodeB==r.m_contactList&&(r.m_contactList=i.m_nodeB.next),i.m_manifold.pointCount>0&&e.isSensor()==!1&&n.isSensor()==!1&&(s.setAwake(!0),r.setAwake(!0));var a=e.getType(),h=n.getType(),o=ms[a][h].destroyFcn;typeof o=="function"&&o(i)};var al=typeof ASSERT=="undefined"?!1:ASSERT,Vi=Ke,hl=ie;function Hu(){this.other=null,this.joint=null,this.prev=null,this.next=null}function Ke(i,t,e){t=i.bodyA||t,e=i.bodyB||e,al&&hl.assert(t),al&&hl.assert(e),al&&hl.assert(t!=e),this.m_type="unknown-joint",this.m_bodyA=t,this.m_bodyB=e,this.m_index=0,this.m_collideConnected=!!i.collideConnected,this.m_prev=null,this.m_next=null,this.m_edgeA=new Hu,this.m_edgeB=new Hu,this.m_islandFlag=!1,this.m_userData=i.userData}Ke.TYPES={};Ke._deserialize=function(i,t,e){var n=Ke.TYPES[i.type];return n&&e(n,i)};Ke.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()};Ke.prototype.getType=function(){return this.m_type};Ke.prototype.getBodyA=function(){return this.m_bodyA};Ke.prototype.getBodyB=function(){return this.m_bodyB};Ke.prototype.getNext=function(){return this.m_next};Ke.prototype.getUserData=function(){return this.m_userData};Ke.prototype.setUserData=function(i){this.m_userData=i};Ke.prototype.getCollideConnected=function(){return this.m_collideConnected};Ke.prototype.getAnchorA=function(){};Ke.prototype.getAnchorB=function(){};Ke.prototype.getReactionForce=function(i){};Ke.prototype.getReactionTorque=function(i){};Ke.prototype.shiftOrigin=function(i){};Ke.prototype.initVelocityConstraints=function(i){};Ke.prototype.solveVelocityConstraints=function(i){};Ke.prototype.solvePositionConstraints=function(i){};var uo={exports:{}},ll={};ll.now=function(){return Date.now()};ll.diff=function(i){return Date.now()-i};var cl=typeof ASSERT=="undefined"?!1:ASSERT;uo.exports=M_;uo.exports.Input=b_;uo.exports.Output=Zi;var mo=je,ul=ie,Gu=ll,bi=da,po=de.exports,Ye=Yt,ps=Ve,ku=jh,pi=Li,fo=Xn.exports,g_=fo.Input,x_=fo.Output,Aa=fo.Proxy,A_=fo.Cache;function b_(){this.proxyA=new Aa,this.proxyB=new Aa,this.sweepA=new ku,this.sweepB=new ku,this.tMax}Zi.e_unknown=0;Zi.e_failed=1;Zi.e_overlapped=2;Zi.e_touching=3;Zi.e_separated=4;function Zi(){this.state,this.t}bi.toiTime=0;bi.toiMaxTime=0;bi.toiCalls=0;bi.toiIters=0;bi.toiMaxIters=0;bi.toiRootIters=0;bi.toiMaxRootIters=0;function M_(i,t){var e=Gu.now();++bi.toiCalls,i.state=Zi.e_unknown,i.t=t.tMax;var n=t.proxyA,s=t.proxyB,r=t.sweepA,a=t.sweepB;r.normalize(),a.normalize();var h=t.tMax,o=n.m_radius+s.m_radius,l=po.max(mo.linearSlop,o-3*mo.linearSlop),u=.25*mo.linearSlop;cl&&ul.assert(l>u);var m=0,p=mo.maxTOIIterations,c=0,f=new A_,d=new g_;for(d.proxyA=t.proxyA,d.proxyB=t.proxyB,d.useRadii=!1;;){var y=pi.identity(),_=pi.identity();r.getTransform(y,m),a.getTransform(_,m),d.transformA=y,d.transformB=_;var v=new x_;if(fo(v,f,d),v.distance<=0){i.state=Zi.e_overlapped,i.t=0;break}if(v.distance<l+u){i.state=Zi.e_touching,i.t=m;break}var g=new _o;g.initialize(f,n,r,s,a,m);for(var x=!1,A=h,b=0;;){var M=g.findMinSeparation(A);if(g.indexA,g.indexB,M>l+u){i.state=Zi.e_separated,i.t=h,x=!0;break}if(M>l-u){m=A;break}var S=g.evaluate(m);if(g.indexA,g.indexB,S<l-u){i.state=Zi.e_failed,i.t=m,x=!0;break}if(S<=l+u){i.state=Zi.e_touching,i.t=m,x=!0;break}for(var B=0,E=m,T=A;;){var w;B&1?w=E+(l-S)*(T-E)/(M-S):w=.5*(E+T),++B,++bi.toiRootIters;var C=g.evaluate(w);if(g.indexA,g.indexB,po.abs(C-l)<u){A=w;break}if(C>l?(E=w,S=C):(T=w,M=C),B==50)break}if(bi.toiMaxRootIters=po.max(bi.toiMaxRootIters,B),++b,b==mo.maxPolygonVertices)break}if(++c,++bi.toiIters,x)break;if(c==p){i.state=Zi.e_failed,i.t=m;break}}bi.toiMaxIters=po.max(bi.toiMaxIters,c);var P=Gu.diff(e);bi.toiMaxTime=po.max(bi.toiMaxTime,P),bi.toiTime+=P}var Wu=1,Yu=2,qu=3;function _o(){this.m_proxyA=new Aa,this.m_proxyB=new Aa,this.m_sweepA,this.m_sweepB,this.indexA,this.indexB,this.m_type,this.m_localPoint=Ye.zero(),this.m_axis=Ye.zero()}_o.prototype.initialize=function(i,t,e,n,s,r){this.m_proxyA=t,this.m_proxyB=n;var a=i.count;cl&&ul.assert(0<a&&a<3),this.m_sweepA=e,this.m_sweepB=s;var h=pi.identity(),o=pi.identity();if(this.m_sweepA.getTransform(h,r),this.m_sweepB.getTransform(o,r),a==1){this.m_type=Wu;var l=this.m_proxyA.getVertex(i.indexA[0]),u=this.m_proxyB.getVertex(i.indexB[0]),m=pi.mulVec2(h,l),p=pi.mulVec2(o,u);this.m_axis.setCombine(1,p,-1,m);var c=this.m_axis.normalize();return c}else if(i.indexA[0]==i.indexA[1]){this.m_type=qu;var f=n.getVertex(i.indexB[0]),d=n.getVertex(i.indexB[1]);this.m_axis=Ye.cross(Ye.sub(d,f),1),this.m_axis.normalize();var y=ps.mulVec2(o.q,this.m_axis);this.m_localPoint=Ye.mid(f,d);var p=pi.mulVec2(o,this.m_localPoint),l=t.getVertex(i.indexA[0]),m=pi.mulVec2(h,l),c=Ye.dot(m,y)-Ye.dot(p,y);return c<0&&(this.m_axis=Ye.neg(this.m_axis),c=-c),c}else{this.m_type=Yu;var _=this.m_proxyA.getVertex(i.indexA[0]),v=this.m_proxyA.getVertex(i.indexA[1]);this.m_axis=Ye.cross(Ye.sub(v,_),1),this.m_axis.normalize();var y=ps.mulVec2(h.q,this.m_axis);this.m_localPoint=Ye.mid(_,v);var m=pi.mulVec2(h,this.m_localPoint),u=this.m_proxyB.getVertex(i.indexB[0]),p=pi.mulVec2(o,u),c=Ye.dot(p,y)-Ye.dot(m,y);return c<0&&(this.m_axis=Ye.neg(this.m_axis),c=-c),c}};_o.prototype.compute=function(i,t){var e=pi.identity(),n=pi.identity();switch(this.m_sweepA.getTransform(e,t),this.m_sweepB.getTransform(n,t),this.m_type){case Wu:{if(i){var s=ps.mulTVec2(e.q,this.m_axis),r=ps.mulTVec2(n.q,Ye.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(s),this.indexB=this.m_proxyB.getSupport(r)}var a=this.m_proxyA.getVertex(this.indexA),h=this.m_proxyB.getVertex(this.indexB),o=pi.mulVec2(e,a),l=pi.mulVec2(n,h),u=Ye.dot(l,this.m_axis)-Ye.dot(o,this.m_axis);return u}case Yu:{var m=ps.mulVec2(e.q,this.m_axis),o=pi.mulVec2(e,this.m_localPoint);if(i){var r=ps.mulTVec2(n.q,Ye.neg(m));this.indexA=-1,this.indexB=this.m_proxyB.getSupport(r)}var h=this.m_proxyB.getVertex(this.indexB),l=pi.mulVec2(n,h),u=Ye.dot(l,m)-Ye.dot(o,m);return u}case qu:{var m=ps.mulVec2(n.q,this.m_axis),l=pi.mulVec2(n,this.m_localPoint);if(i){var s=ps.mulTVec2(e.q,Ye.neg(m));this.indexB=-1,this.indexA=this.m_proxyA.getSupport(s)}var a=this.m_proxyA.getVertex(this.indexA),o=pi.mulVec2(e,a),u=Ye.dot(o,m)-Ye.dot(l,m);return u}default:return cl&&ul.assert(!1),i&&(this.indexA=-1,this.indexB=-1),0}};_o.prototype.findMinSeparation=function(i){return this.compute(!0,i)};_o.prototype.evaluate=function(i){return this.compute(!1,i)};var jn=typeof DEBUG=="undefined"?!1:DEBUG,fr=typeof ASSERT=="undefined"?!1:ASSERT;$h.exports=wn;$h.exports.TimeStep=pl;var Yi=je,qs=ie,Mn=Yt,Js=de.exports,w_=Fi,S_=us,B_=Vi,ml=uo.exports,T_=ml.Input,Ju=ml.Output,ba=Xn.exports;ba.Input;ba.Output;ba.Proxy;ba.Cache;function pl(i){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}pl.prototype.reset=function(i){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=i,this.inv_dt=i==0?0:1/i,this.dtRatio=i*this.inv_dt0};function wn(i){this.m_world=i,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}wn.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0};wn.prototype.addBody=function(i){fr&&qs.assert(i instanceof w_,"Not a Body!",i),this.m_bodies.push(i)};wn.prototype.addContact=function(i){fr&&qs.assert(i instanceof S_,"Not a Contact!",i),this.m_contacts.push(i)};wn.prototype.addJoint=function(i){fr&&qs.assert(i instanceof B_,"Not a Joint!",i),this.m_joints.push(i)};wn.prototype.solveWorld=function(i){for(var t=this.m_world,e=t.m_bodyList;e;e=e.m_next)e.m_islandFlag=!1;for(var n=t.m_contactList;n;n=n.m_next)n.m_islandFlag=!1;for(var s=t.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var r=this.m_stack,a=t.m_bodyList;a;a=a.m_next)if(!a.m_islandFlag&&!(a.isAwake()==!1||a.isActive()==!1)&&!a.isStatic()){for(this.clear(),r.push(a),a.m_islandFlag=!0;r.length>0;){var e=r.pop();if(fr&&qs.assert(e.isActive()==!0),this.addBody(e),e.setAwake(!0),!e.isStatic()){for(var h=e.m_contactList;h;h=h.next){var o=h.contact;if(!o.m_islandFlag&&!(o.isEnabled()==!1||o.isTouching()==!1)){var l=o.m_fixtureA.m_isSensor,u=o.m_fixtureB.m_isSensor;if(!(l||u)){this.addContact(o),o.m_islandFlag=!0;var m=h.other;m.m_islandFlag||(r.push(m),m.m_islandFlag=!0)}}}for(var p=e.m_jointList;p;p=p.next)if(p.joint.m_islandFlag!=!0){var m=p.other;m.isActive()!=!1&&(this.addJoint(p.joint),p.joint.m_islandFlag=!0,!m.m_islandFlag&&(r.push(m),m.m_islandFlag=!0))}}}this.solveIsland(i);for(var c=0;c<this.m_bodies.length;++c){var e=this.m_bodies[c];e.isStatic()&&(e.m_islandFlag=!1)}}};wn.prototype.solveIsland=function(i){for(var t=this.m_world,e=t.m_gravity,n=t.m_allowSleep,s=i.dt,r=0;r<this.m_bodies.length;++r){var a=this.m_bodies[r],h=Mn.clone(a.m_sweep.c),o=a.m_sweep.a,l=Mn.clone(a.m_linearVelocity),u=a.m_angularVelocity;a.m_sweep.c0.set(a.m_sweep.c),a.m_sweep.a0=a.m_sweep.a,a.isDynamic()&&(l.addMul(s*a.m_gravityScale,e),l.addMul(s*a.m_invMass,a.m_force),u+=s*a.m_invI*a.m_torque,l.mul(1/(1+s*a.m_linearDamping)),u*=1/(1+s*a.m_angularDamping)),a.c_position.c=h,a.c_position.a=o,a.c_velocity.v=l,a.c_velocity.w=u}for(var r=0;r<this.m_contacts.length;++r){var m=this.m_contacts[r];m.initConstraint(i)}jn&&this.printBodies("M: ");for(var r=0;r<this.m_contacts.length;++r){var m=this.m_contacts[r];m.initVelocityConstraint(i)}if(jn&&this.printBodies("R: "),i.warmStarting)for(var r=0;r<this.m_contacts.length;++r){var m=this.m_contacts[r];m.warmStartConstraint(i)}jn&&this.printBodies("Q: ");for(var r=0;r<this.m_joints.length;++r){var p=this.m_joints[r];p.initVelocityConstraints(i)}jn&&this.printBodies("E: ");for(var r=0;r<i.velocityIterations;++r){for(var c=0;c<this.m_joints.length;++c){var p=this.m_joints[c];p.solveVelocityConstraints(i)}for(var c=0;c<this.m_contacts.length;++c){var m=this.m_contacts[c];m.solveVelocityConstraint(i)}}jn&&this.printBodies("D: ");for(var r=0;r<this.m_contacts.length;++r){var m=this.m_contacts[r];m.storeConstraintImpulses(i)}jn&&this.printBodies("C: ");for(var r=0;r<this.m_bodies.length;++r){var a=this.m_bodies[r],h=Mn.clone(a.c_position.c),o=a.c_position.a,l=Mn.clone(a.c_velocity.v),u=a.c_velocity.w,f=Mn.mul(s,l);if(Mn.lengthSquared(f)>Yi.maxTranslationSquared){var d=Yi.maxTranslation/f.length();l.mul(d)}var y=s*u;if(y*y>Yi.maxRotationSquared){var d=Yi.maxRotation/Js.abs(y);u*=d}h.addMul(s,l),o+=s*u,a.c_position.c.set(h),a.c_position.a=o,a.c_velocity.v.set(l),a.c_velocity.w=u}jn&&this.printBodies("B: ");for(var _=!1,r=0;r<i.positionIterations;++r){for(var v=0,c=0;c<this.m_contacts.length;++c){var m=this.m_contacts[c],g=m.solvePositionConstraint(i);v=Js.min(v,g)}for(var x=v>=-3*Yi.linearSlop,A=!0,c=0;c<this.m_joints.length;++c){var p=this.m_joints[c],b=p.solvePositionConstraints(i);A=A&&b}if(x&&A){_=!0;break}}jn&&this.printBodies("L: ");for(var r=0;r<this.m_bodies.length;++r){var a=this.m_bodies[r];a.m_sweep.c.set(a.c_position.c),a.m_sweep.a=a.c_position.a,a.m_linearVelocity.set(a.c_velocity.v),a.m_angularVelocity=a.c_velocity.w,a.synchronizeTransform()}if(this.postSolveIsland(),n){for(var M=1/0,S=Yi.linearSleepToleranceSqr,B=Yi.angularSleepToleranceSqr,r=0;r<this.m_bodies.length;++r){var a=this.m_bodies[r];a.isStatic()||(a.m_autoSleepFlag==!1||a.m_angularVelocity*a.m_angularVelocity>B||Mn.lengthSquared(a.m_linearVelocity)>S?(a.m_sleepTime=0,M=0):(a.m_sleepTime+=s,M=Js.min(M,a.m_sleepTime)))}if(M>=Yi.timeToSleep&&_)for(var r=0;r<this.m_bodies.length;++r){var a=this.m_bodies[r];a.setAwake(!1)}}};wn.prototype.printBodies=function(i){for(var t=0;t<this.m_bodies.length;++t){var e=this.m_bodies[t];qs.debug(i,e.c_position.a,e.c_position.c.x,e.c_position.c.y,e.c_velocity.w,e.c_velocity.v.x,e.c_velocity.v.y)}};var dr=new pl;wn.prototype.solveWorldTOI=function(i){var t=this.m_world;if(t.m_stepComplete){for(var e=t.m_bodyList;e;e=e.m_next)e.m_islandFlag=!1,e.m_sweep.alpha0=0;for(var n=t.m_contactList;n;n=n.m_next)n.m_toiFlag=!1,n.m_islandFlag=!1,n.m_toiCount=0,n.m_toi=1}for(;;){for(var s=null,r=1,n=t.m_contactList;n;n=n.m_next)if(n.isEnabled()!=!1&&!(n.m_toiCount>Yi.maxSubSteps)){var a=1;if(n.m_toiFlag)a=n.m_toi;else{var _=n.getFixtureA(),v=n.getFixtureB();if(_.isSensor()||v.isSensor())continue;var g=_.getBody(),x=v.getBody();fr&&qs.assert(g.isDynamic()||x.isDynamic());var h=g.isAwake()&&!g.isStatic(),o=x.isAwake()&&!x.isStatic();if(h==!1&&o==!1)continue;var l=g.isBullet()||!g.isDynamic(),u=x.isBullet()||!x.isDynamic();if(l==!1&&u==!1)continue;var m=g.m_sweep.alpha0;g.m_sweep.alpha0<x.m_sweep.alpha0?(m=x.m_sweep.alpha0,g.m_sweep.advance(m)):x.m_sweep.alpha0<g.m_sweep.alpha0&&(m=g.m_sweep.alpha0,x.m_sweep.advance(m)),fr&&qs.assert(m<1);var p=n.getChildIndexA(),c=n.getChildIndexB();g.m_sweep,x.m_sweep;var f=new T_;f.proxyA.set(_.getShape(),p),f.proxyB.set(v.getShape(),c),f.sweepA.set(g.m_sweep),f.sweepB.set(x.m_sweep),f.tMax=1;var d=new Ju;ml(d,f);var y=d.t;d.state==Ju.e_touching?a=Js.min(m+(1-m)*y,1):a=1,n.m_toi=a,n.m_toiFlag=!0}a<r&&(s=n,r=a)}if(s==null||1-10*Js.EPSILON<r){t.m_stepComplete=!0;break}var _=s.getFixtureA(),v=s.getFixtureB(),g=_.getBody(),x=v.getBody(),A=g.m_sweep.clone(),b=x.m_sweep.clone();if(g.advance(r),x.advance(r),s.update(t),s.m_toiFlag=!1,++s.m_toiCount,s.isEnabled()==!1||s.isTouching()==!1){s.setEnabled(!1),g.m_sweep.set(A),x.m_sweep.set(b),g.synchronizeTransform(),x.synchronizeTransform();continue}g.setAwake(!0),x.setAwake(!0),this.clear(),this.addBody(g),this.addBody(x),this.addContact(s),g.m_islandFlag=!0,x.m_islandFlag=!0,s.m_islandFlag=!0;for(var M=[g,x],S=0;S<M.length;++S){var B=M[S];if(B.isDynamic())for(var E=B.m_contactList;E;E=E.next){var T=E.contact;if(!T.m_islandFlag){var w=E.other;if(!(w.isDynamic()&&!B.isBullet()&&!w.isBullet())){var C=T.m_fixtureA.m_isSensor,P=T.m_fixtureB.m_isSensor;if(!(C||P)){var R=w.m_sweep.clone();if(w.m_islandFlag==!1&&w.advance(r),T.update(t),T.isEnabled()==!1||T.isTouching()==!1){w.m_sweep.set(R),w.synchronizeTransform();continue}T.m_islandFlag=!0,this.addContact(T),!w.m_islandFlag&&(w.m_islandFlag=!0,w.isStatic()||w.setAwake(!0),this.addBody(w))}}}}}dr.reset((1-r)*i.dt),dr.dtRatio=1,dr.positionIterations=20,dr.velocityIterations=i.velocityIterations,dr.warmStarting=!1,this.solveIslandTOI(dr,g,x);for(var S=0;S<this.m_bodies.length;++S){var B=this.m_bodies[S];if(B.m_islandFlag=!1,!!B.isDynamic()){B.synchronizeFixtures();for(var E=B.m_contactList;E;E=E.next)E.contact.m_toiFlag=!1,E.contact.m_islandFlag=!1}}if(t.findNewContacts(),t.m_subStepping){t.m_stepComplete=!1;break}}if(jn)for(var e=t.m_bodyList;e;e=e.m_next){var n=e.m_sweep.c;e.m_sweep.a,e.m_linearVelocity,e.m_angularVelocity}};wn.prototype.solveIslandTOI=function(i,t,e){this.m_world;for(var l=0;l<this.m_bodies.length;++l){var n=this.m_bodies[l];n.c_position.c.set(n.m_sweep.c),n.c_position.a=n.m_sweep.a,n.c_velocity.v.set(n.m_linearVelocity),n.c_velocity.w=n.m_angularVelocity}for(var l=0;l<this.m_contacts.length;++l){var s=this.m_contacts[l];s.initConstraint(i)}for(var l=0;l<i.positionIterations;++l){for(var r=0,a=0;a<this.m_contacts.length;++a){var s=this.m_contacts[a],h=s.solvePositionConstraintTOI(i,t,e);r=Js.min(r,h)}var o=r>=-1.5*Yi.linearSlop;if(o)break}var l,u;t.m_sweep.c0.set(t.c_position.c),t.m_sweep.a0=t.c_position.a,e.m_sweep.c0.set(e.c_position.c),e.m_sweep.a0=e.c_position.a;for(var l=0;l<this.m_contacts.length;++l){var s=this.m_contacts[l];s.initVelocityConstraint(i)}for(var l=0;l<i.velocityIterations;++l)for(var a=0;a<this.m_contacts.length;++a){var s=this.m_contacts[a];s.solveVelocityConstraint(i)}for(var m=i.dt,l=0;l<this.m_bodies.length;++l){var n=this.m_bodies[l],u=Mn.clone(n.c_position.c),p=n.c_position.a,c=Mn.clone(n.c_velocity.v),f=n.c_velocity.w,d=Mn.mul(m,c);if(Mn.dot(d,d)>Yi.maxTranslationSquared){var y=Yi.maxTranslation/d.length();c.mul(y)}var _=m*f;if(_*_>Yi.maxRotationSquared){var y=Yi.maxRotation/Js.abs(_);f*=y}u.addMul(m,c),p+=m*f,n.c_position.c=u,n.c_position.a=p,n.c_velocity.v=c,n.c_velocity.w=f,n.m_sweep.c=u,n.m_sweep.a=p,n.m_linearVelocity=c,n.m_angularVelocity=f,n.synchronizeTransform()}this.postSolveIsland()};function C_(){this.normalImpulses=[],this.tangentImpulses=[]}wn.prototype.postSolveIsland=function(){for(var i=new C_,t=0;t<this.m_contacts.length;++t){for(var e=this.m_contacts[t],n=0;n<e.v_points.length;++n)i.normalImpulses.push(e.v_points[n].normalImpulse),i.tangentImpulses.push(e.v_points[n].tangentImpulse);this.m_world.postSolve(e,i)}};var ln=typeof ASSERT=="undefined"?!1:ASSERT,$u=Lt,E_=Wi,cn=ie,Zn=Yt,L_=Hd,Xu=$h.exports,ju=Fi,P_=Vi,Zu=us,I_={gravity:Zn.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3};function Lt(i){if(!(this instanceof Lt))return new Lt(i);i&&Zn.isValid(i)&&(i={gravity:i}),i=E_(i,I_),this.m_solver=new Xu(this),this.m_broadPhase=new L_,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=i.allowSleep,this.m_gravity=Zn.clone(i.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=i.warmStarting,this.m_continuousPhysics=i.continuousPhysics,this.m_subStepping=i.subStepping,this.m_blockSolve=i.blockSolve,this.m_velocityIterations=i.velocityIterations,this.m_positionIterations=i.positionIterations,this.m_t=0,this.addPair=this.createContact.bind(this)}Lt.prototype._serialize=function(){for(var i=[],t=[],e=this.getBodyList();e;e=e.getNext())i.push(e);for(var n=this.getJointList();n;n=n.getNext())typeof n._serialize=="function"&&t.push(n);return{gravity:this.m_gravity,bodies:i,joints:t}};Lt._deserialize=function(i,t,e){if(!i)return new Lt;var n=new Lt(i.gravity);if(i.bodies)for(var s=i.bodies.length-1;s>=0;s-=1)n._addBody(e(ju,i.bodies[s],n));if(i.joints)for(var s=i.joints.length-1;s>=0;s--)n.createJoint(e(P_,i.joints[s],n));return n};Lt.prototype.getBodyList=function(){return this.m_bodyList};Lt.prototype.getJointList=function(){return this.m_jointList};Lt.prototype.getContactList=function(){return this.m_contactList};Lt.prototype.getBodyCount=function(){return this.m_bodyCount};Lt.prototype.getJointCount=function(){return this.m_jointCount};Lt.prototype.getContactCount=function(){return this.m_contactCount};Lt.prototype.setGravity=function(i){this.m_gravity=i};Lt.prototype.getGravity=function(){return this.m_gravity};Lt.prototype.isLocked=function(){return this.m_locked};Lt.prototype.setAllowSleeping=function(i){if(i!=this.m_allowSleep&&(this.m_allowSleep=i,this.m_allowSleep==!1))for(var t=this.m_bodyList;t;t=t.m_next)t.setAwake(!0)};Lt.prototype.getAllowSleeping=function(){return this.m_allowSleep};Lt.prototype.setWarmStarting=function(i){this.m_warmStarting=i};Lt.prototype.getWarmStarting=function(){return this.m_warmStarting};Lt.prototype.setContinuousPhysics=function(i){this.m_continuousPhysics=i};Lt.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics};Lt.prototype.setSubStepping=function(i){this.m_subStepping=i};Lt.prototype.getSubStepping=function(){return this.m_subStepping};Lt.prototype.setAutoClearForces=function(i){this.m_clearForces=i};Lt.prototype.getAutoClearForces=function(){return this.m_clearForces};Lt.prototype.clearForces=function(){for(var i=this.m_bodyList;i;i=i.getNext())i.m_force.setZero(),i.m_torque=0};Lt.prototype.queryAABB=function(i,t){ln&&cn.assert(typeof t=="function");var e=this.m_broadPhase;this.m_broadPhase.query(i,function(n){var s=e.getUserData(n);return t(s.fixture)})};Lt.prototype.rayCast=function(i,t,e){ln&&cn.assert(typeof e=="function");var n=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:i,p2:t},function(s,r){var a=n.getUserData(r),h=a.fixture,o=a.childIndex,l={},u=h.rayCast(l,s,o);if(u){var m=l.fraction,p=Zn.add(Zn.mul(1-m,s.p1),Zn.mul(m,s.p2));return e(h,p,l.normal,m)}return s.maxFraction})};Lt.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()};Lt.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()};Lt.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()};Lt.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()};Lt.prototype.shiftOrigin=function(i){if(ln&&cn.assert(this.m_locked==!1),!this.m_locked){for(var t=this.m_bodyList;t;t=t.m_next)t.m_xf.p.sub(i),t.m_sweep.c0.sub(i),t.m_sweep.c.sub(i);for(var e=this.m_jointList;e;e=e.m_next)e.shiftOrigin(i);this.m_broadPhase.shiftOrigin(i)}};Lt.prototype._addBody=function(i){ln&&cn.assert(this.isLocked()===!1),!this.isLocked()&&(i.m_prev=null,i.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=i),this.m_bodyList=i,++this.m_bodyCount)};Lt.prototype.createBody=function(i,t){if(ln&&cn.assert(this.isLocked()==!1),this.isLocked())return null;i&&Zn.isValid(i)&&(i={position:i,angle:t});var e=new ju(this,i);return this._addBody(e),e};Lt.prototype.createDynamicBody=function(i,t){return i?Zn.isValid(i)&&(i={position:i,angle:t}):i={},i.type="dynamic",this.createBody(i)};Lt.prototype.createKinematicBody=function(i,t){return i?Zn.isValid(i)&&(i={position:i,angle:t}):i={},i.type="kinematic",this.createBody(i)};Lt.prototype.destroyBody=function(i){if(ln&&cn.assert(this.m_bodyCount>0),ln&&cn.assert(this.isLocked()==!1),!this.isLocked()){if(i.m_destroyed)return!1;for(var t=i.m_jointList;t;){var e=t;t=t.next,this.publish("remove-joint",e.joint),this.destroyJoint(e.joint),i.m_jointList=t}i.m_jointList=null;for(var n=i.m_contactList;n;){var s=n;n=n.next,this.destroyContact(s.contact),i.m_contactList=n}i.m_contactList=null;for(var r=i.m_fixtureList;r;){var a=r;r=r.m_next,this.publish("remove-fixture",a),a.destroyProxies(this.m_broadPhase),i.m_fixtureList=r}return i.m_fixtureList=null,i.m_prev&&(i.m_prev.m_next=i.m_next),i.m_next&&(i.m_next.m_prev=i.m_prev),i==this.m_bodyList&&(this.m_bodyList=i.m_next),i.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",i),!0}};Lt.prototype.createJoint=function(i){if(ln&&cn.assert(!!i.m_bodyA),ln&&cn.assert(!!i.m_bodyB),ln&&cn.assert(this.isLocked()==!1),this.isLocked())return null;if(i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.joint=i,i.m_edgeA.other=i.m_bodyB,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.joint=i,i.m_edgeB.other=i.m_bodyA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB,i.m_collideConnected==!1)for(var t=i.m_bodyB.getContactList();t;t=t.next)t.other==i.m_bodyA&&t.contact.flagForFiltering();return i};Lt.prototype.destroyJoint=function(i){if(ln&&cn.assert(this.isLocked()==!1),!this.isLocked()){i.m_prev&&(i.m_prev.m_next=i.m_next),i.m_next&&(i.m_next.m_prev=i.m_prev),i==this.m_jointList&&(this.m_jointList=i.m_next);var t=i.m_bodyA,e=i.m_bodyB;if(t.setAwake(!0),e.setAwake(!0),i.m_edgeA.prev&&(i.m_edgeA.prev.next=i.m_edgeA.next),i.m_edgeA.next&&(i.m_edgeA.next.prev=i.m_edgeA.prev),i.m_edgeA==t.m_jointList&&(t.m_jointList=i.m_edgeA.next),i.m_edgeA.prev=null,i.m_edgeA.next=null,i.m_edgeB.prev&&(i.m_edgeB.prev.next=i.m_edgeB.next),i.m_edgeB.next&&(i.m_edgeB.next.prev=i.m_edgeB.prev),i.m_edgeB==e.m_jointList&&(e.m_jointList=i.m_edgeB.next),i.m_edgeB.prev=null,i.m_edgeB.next=null,ln&&cn.assert(this.m_jointCount>0),--this.m_jointCount,i.m_collideConnected==!1)for(var n=e.getContactList();n;)n.other==t&&n.contact.flagForFiltering(),n=n.next;this.publish("remove-joint",i)}};var $s=new Xu.TimeStep;Lt.prototype.step=function(i,t,e){if(this.publish("pre-step",i),(t|0)!==t&&(t=0),t=t||this.m_velocityIterations,e=e||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,$s.reset(i),$s.velocityIterations=t,$s.positionIterations=e,$s.warmStarting=this.m_warmStarting,$s.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&i>0){this.m_solver.solveWorld($s);for(var n=this.m_bodyList;n;n=n.getNext())n.m_islandFlag!=!1&&(n.isStatic()||n.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&i>0&&this.m_solver.solveWorldTOI($s),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",i)};Lt.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.addPair)};Lt.prototype.createContact=function(i,t){var e=i.fixture,n=t.fixture,s=i.childIndex,r=t.childIndex,a=e.getBody(),h=n.getBody();if(a!=h){for(var o=h.getContactList();o;){if(o.other==a){var l=o.contact.getFixtureA(),u=o.contact.getFixtureB(),m=o.contact.getChildIndexA(),p=o.contact.getChildIndexB();if(l==e&&u==n&&m==s&&p==r||l==n&&u==e&&m==r&&p==s)return}o=o.next}if(h.shouldCollide(a)!=!1&&n.shouldCollide(e)!=!1){var c=Zu.create(e,s,n,r);c!=null&&(c.m_prev=null,this.m_contactList!=null&&(c.m_next=this.m_contactList,this.m_contactList.m_prev=c),this.m_contactList=c,++this.m_contactCount)}}};Lt.prototype.updateContacts=function(){for(var i,t=this.m_contactList;i=t;){t=i.getNext();var e=i.getFixtureA(),n=i.getFixtureB(),s=i.getChildIndexA(),r=i.getChildIndexB(),a=e.getBody(),h=n.getBody();if(i.m_filterFlag){if(h.shouldCollide(a)==!1){this.destroyContact(i);continue}if(n.shouldCollide(e)==!1){this.destroyContact(i);continue}i.m_filterFlag=!1}var o=a.isAwake()&&!a.isStatic(),l=h.isAwake()&&!h.isStatic();if(!(o==!1&&l==!1)){var u=e.m_proxies[s].proxyId,m=n.m_proxies[r].proxyId,p=this.m_broadPhase.testOverlap(u,m);if(p==!1){this.destroyContact(i);continue}i.update(this)}}};Lt.prototype.destroyContact=function(i){Zu.destroy(i,this),i.m_prev&&(i.m_prev.m_next=i.m_next),i.m_next&&(i.m_next.m_prev=i.m_prev),i==this.m_contactList&&(this.m_contactList=i.m_next),--this.m_contactCount};Lt.prototype._listeners=null;Lt.prototype.on=function(i,t){return typeof i!="string"||typeof t!="function"?this:(this._listeners||(this._listeners={}),this._listeners[i]||(this._listeners[i]=[]),this._listeners[i].push(t),this)};Lt.prototype.off=function(i,t){if(typeof i!="string"||typeof t!="function")return this;var e=this._listeners&&this._listeners[i];if(!e||!e.length)return this;var n=e.indexOf(t);return n>=0&&e.splice(n,1),this};Lt.prototype.publish=function(i,t,e,n){var s=this._listeners&&this._listeners[i];if(!s||!s.length)return 0;for(var r=0;r<s.length;r++)s[r].call(this,t,e,n);return s.length};Lt.prototype.beginContact=function(i){this.publish("begin-contact",i)};Lt.prototype.endContact=function(i){this.publish("end-contact",i)};Lt.prototype.preSolve=function(i,t){this.publish("pre-solve",i,t)};Lt.prototype.postSolve=function(i,t){this.publish("post-solve",i,t)};var Ku=$u,R_=Fi,D_=Vi,z_=el,F_=Gs,V_=Yt,N_=cr,O_=0;function Qu(i){i=i||{};var t=i.rootClass||Ku,e=i.preSerialize||function(o){return o},n=i.postSerialize||function(o,l){return o},s=i.preDeserialize||function(o){return o},r=i.postDeserialize||function(o,l){return o},a={World:Ku,Body:R_,Joint:D_,Fixture:z_,Shape:F_},h=Object.assign({Vec2:V_,Vec3:N_},a);this.toJson=function(o){var l=[],u=[o],m={};function p(_,v){if(_.__sid=_.__sid||++O_,!m[_.__sid]){u.push(_);var g=l.length+u.length,x={refIndex:g,refType:v};m[_.__sid]=x}return m[_.__sid]}function c(_){_=e(_);var v=_._serialize();return v=n(v,_),v}function f(_,v){if(typeof _!="object"||_===null)return _;if(typeof _._serialize=="function"){if(_!==v){for(var g in a)if(_ instanceof a[g])return p(_,g)}_=c(_)}if(Array.isArray(_)){for(var x=[],A=0;A<_.length;A++)x[A]=f(_[A]);_=x}else{var x={};for(var A in _)_.hasOwnProperty(A)&&(x[A]=f(_[A]));_=x}return _}for(;u.length;){var d=u.shift(),y=f(d,d);l.push(y)}return l},this.fromJson=function(o){var l={};function u(c,f,d){f=s(f);var y=c._deserialize(f,d,m);return y=r(y,f),y}function m(c,f,d){if(!f.refIndex)return c&&c._deserialize&&u(c,f,d);c=h[f.refType]||c;var y=f.refIndex;if(!l[y]){var _=o[y],v=u(c,_,d);l[y]=v}return l[y]}var p=t._deserialize(o[0],null,m);return p}}aa.exports=Qu;var tm=new Qu;aa.exports.toJson=tm.toJson;aa.exports.fromJson=tm.fromJson;var U_=typeof ASSERT=="undefined"?!1:ASSERT,Ma=De,H_=ie,fl=de.exports,dl=Ve,Ni=Yt,em=Gs;De._super=em;De.prototype=Object.create(De._super.prototype);De.TYPE="circle";em.TYPES[De.TYPE]=De;function De(i,t){if(!(this instanceof De))return new De(i,t);De._super.call(this),this.m_type=De.TYPE,this.m_p=Ni.zero(),this.m_radius=1,typeof i=="object"&&Ni.isValid(i)?(this.m_p.set(i),typeof t=="number"&&(this.m_radius=t)):typeof i=="number"&&(this.m_radius=i)}De.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}};De._deserialize=function(i){return new De(i.p,i.radius)};De.prototype.getRadius=function(){return this.m_radius};De.prototype.getCenter=function(){return this.m_p};De.prototype.getVertex=function(i){return U_&&H_.assert(i==0),this.m_p};De.prototype.getVertexCount=function(i){return 1};De.prototype._clone=function(){var i=new De;return i.m_type=this.m_type,i.m_radius=this.m_radius,i.m_p=this.m_p.clone(),i};De.prototype.getChildCount=function(){return 1};De.prototype.testPoint=function(i,t){var e=Ni.add(i.p,dl.mulVec2(i.q,this.m_p)),n=Ni.sub(t,e);return Ni.dot(n,n)<=this.m_radius*this.m_radius};De.prototype.rayCast=function(i,t,e,n){var s=Ni.add(e.p,dl.mulVec2(e.q,this.m_p)),r=Ni.sub(t.p1,s),a=Ni.dot(r,r)-this.m_radius*this.m_radius,h=Ni.sub(t.p2,t.p1),o=Ni.dot(r,h),l=Ni.dot(h,h),u=o*o-l*a;if(u<0||l<fl.EPSILON)return!1;var m=-(o+fl.sqrt(u));return 0<=m&&m<=t.maxFraction*l?(m/=l,i.fraction=m,i.normal=Ni.add(r,Ni.mul(m,h)),i.normal.normalize(),!0):!1};De.prototype.computeAABB=function(i,t,e){var n=Ni.add(t.p,dl.mulVec2(t.q,this.m_p));i.lowerBound.set(n.x-this.m_radius,n.y-this.m_radius),i.upperBound.set(n.x+this.m_radius,n.y+this.m_radius)};De.prototype.computeMass=function(i,t){i.mass=t*fl.PI*this.m_radius*this.m_radius,i.center=this.m_p,i.I=i.mass*(.5*this.m_radius*this.m_radius+Ni.dot(this.m_p,this.m_p))};De.prototype.computeDistanceProxy=function(i){i.m_vertices.push(this.m_p),i.m_count=1,i.m_radius=this.m_radius};var wa=Ne,G_=je,im=Gs,nm=Li,Sa=Ve,Qe=Yt;Ne._super=im;Ne.prototype=Object.create(Ne._super.prototype);Ne.TYPE="edge";im.TYPES[Ne.TYPE]=Ne;function Ne(i,t){if(!(this instanceof Ne))return new Ne(i,t);Ne._super.call(this),this.m_type=Ne.TYPE,this.m_radius=G_.polygonRadius,this.m_vertex1=i?Qe.clone(i):Qe.zero(),this.m_vertex2=t?Qe.clone(t):Qe.zero(),this.m_vertex0=Qe.zero(),this.m_vertex3=Qe.zero(),this.m_hasVertex0=!1,this.m_hasVertex3=!1}Ne.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}};Ne._deserialize=function(i){var t=new Ne(i.vertex1,i.vertex2);return t.hasVertex0&&t.setPrev(i.vertex0),t.hasVertex3&&t.setNext(i.vertex3),t};Ne.prototype.setNext=function(i){return i?(this.m_vertex3.set(i),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this};Ne.prototype.setPrev=function(i){return i?(this.m_vertex0.set(i),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this};Ne.prototype._set=function(i,t){return this.m_vertex1.set(i),this.m_vertex2.set(t),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this};Ne.prototype._clone=function(){var i=new Ne;return i.m_type=this.m_type,i.m_radius=this.m_radius,i.m_vertex1.set(this.m_vertex1),i.m_vertex2.set(this.m_vertex2),i.m_vertex0.set(this.m_vertex0),i.m_vertex3.set(this.m_vertex3),i.m_hasVertex0=this.m_hasVertex0,i.m_hasVertex3=this.m_hasVertex3,i};Ne.prototype.getChildCount=function(){return 1};Ne.prototype.testPoint=function(i,t){return!1};Ne.prototype.rayCast=function(i,t,e,n){var s=Sa.mulTVec2(e.q,Qe.sub(t.p1,e.p)),r=Sa.mulTVec2(e.q,Qe.sub(t.p2,e.p)),a=Qe.sub(r,s),h=this.m_vertex1,o=this.m_vertex2,l=Qe.sub(o,h),u=Qe.neo(l.y,-l.x);u.normalize();var m=Qe.dot(u,Qe.sub(h,s)),p=Qe.dot(u,a);if(p==0)return!1;var c=m/p;if(c<0||t.maxFraction<c)return!1;var f=Qe.add(s,Qe.mul(c,a)),d=Qe.sub(o,h),y=Qe.dot(d,d);if(y==0)return!1;var _=Qe.dot(Qe.sub(f,h),d)/y;return _<0||1<_?!1:(i.fraction=c,m>0?i.normal=Sa.mulVec2(e.q,u).neg():i.normal=Sa.mulVec2(e.q,u),!0)};Ne.prototype.computeAABB=function(i,t,e){var n=nm.mulVec2(t,this.m_vertex1),s=nm.mulVec2(t,this.m_vertex2);i.combinePoints(n,s),i.extend(this.m_radius)};Ne.prototype.computeMass=function(i,t){i.mass=0,i.center.setCombine(.5,this.m_vertex1,.5,this.m_vertex2),i.I=0};Ne.prototype.computeDistanceProxy=function(i){i.m_vertices.push(this.m_vertex1),i.m_vertices.push(this.m_vertex2),i.m_count=2,i.m_radius=this.m_radius};var On=typeof ASSERT=="undefined"?!1:ASSERT,vo=Ee,Un=ie,Kn=de.exports,_l=Li,yo=Ve,kt=Yt,Ba=je,sm=Gs;Ee._super=sm;Ee.prototype=Object.create(Ee._super.prototype);Ee.TYPE="polygon";sm.TYPES[Ee.TYPE]=Ee;function Ee(i){if(!(this instanceof Ee))return new Ee(i);Ee._super.call(this),this.m_type=Ee.TYPE,this.m_radius=Ba.polygonRadius,this.m_centroid=kt.zero(),this.m_vertices=[],this.m_normals=[],this.m_count=0,i&&i.length&&this._set(i)}Ee.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}};Ee._deserialize=function(i,t,e){var n=[];if(i.vertices)for(var s=0;s<i.vertices.length;s++)n.push(e(kt,i.vertices[s]));var r=new Ee(n);return r};Ee.prototype.getVertex=function(i){return On&&Un.assert(0<=i&&i<this.m_count),this.m_vertices[i]};Ee.prototype._clone=function(){var i=new Ee;i.m_type=this.m_type,i.m_radius=this.m_radius,i.m_count=this.m_count,i.m_centroid.set(this.m_centroid);for(var t=0;t<this.m_count;t++)i.m_vertices.push(this.m_vertices[t].clone());for(var t=0;t<this.m_normals.length;t++)i.m_normals.push(this.m_normals[t].clone());return i};Ee.prototype.getChildCount=function(){return 1};function k_(i,t){On&&Un.assert(t>=3);for(var e=kt.zero(),n=0,s=kt.zero(),r,a=1/3,r=0;r<t;++r){var h=s,o=i[r],l=r+1<t?i[r+1]:i[0],u=kt.sub(o,h),m=kt.sub(l,h),p=kt.cross(u,m),c=.5*p;n+=c,e.addMul(c*a,h),e.addMul(c*a,o),e.addMul(c*a,l)}return On&&Un.assert(n>Kn.EPSILON),e.mul(1/n),e}Ee.prototype._reset=function(){this._set(this.m_vertices)};Ee.prototype._set=function(i){if(On&&Un.assert(3<=i.length&&i.length<=Ba.maxPolygonVertices),i.length<3){this._setAsBox(1,1);return}for(var t=Kn.min(i.length,Ba.maxPolygonVertices),e=[],n=0;n<t;++n){for(var s=i[n],r=!0,a=0;a<e.length;++a)if(kt.distanceSquared(s,e[a])<.25*Ba.linearSlopSquared){r=!1;break}r&&e.push(s)}if(t=e.length,t<3){On&&Un.assert(!1),this._setAsBox(1,1);return}for(var h=0,o=e[0].x,n=1;n<t;++n){var l=e[n].x;(l>o||l===o&&e[n].y<e[h].y)&&(h=n,o=l)}for(var u=[],m=0,p=h;;){u[m]=p;for(var c=0,a=1;a<t;++a){if(c===p){c=a;continue}var f=kt.sub(e[c],e[u[m]]),s=kt.sub(e[a],e[u[m]]),d=kt.cross(f,s);d<0&&(c=a),d===0&&s.lengthSquared()>f.lengthSquared()&&(c=a)}if(++m,p=c,c===h)break}if(m<3){On&&Un.assert(!1),this._setAsBox(1,1);return}this.m_count=m,this.m_vertices=[];for(var n=0;n<m;++n)this.m_vertices[n]=e[u[n]];for(var n=0;n<m;++n){var y=n,_=n+1<m?n+1:0,v=kt.sub(this.m_vertices[_],this.m_vertices[y]);On&&Un.assert(v.lengthSquared()>Kn.EPSILON*Kn.EPSILON),this.m_normals[n]=kt.cross(v,1),this.m_normals[n].normalize()}this.m_centroid=k_(this.m_vertices,m)};Ee.prototype._setAsBox=function(i,t,e,n){if(this.m_vertices[0]=kt.neo(i,-t),this.m_vertices[1]=kt.neo(i,t),this.m_vertices[2]=kt.neo(-i,t),this.m_vertices[3]=kt.neo(-i,-t),this.m_normals[0]=kt.neo(1,0),this.m_normals[1]=kt.neo(0,1),this.m_normals[2]=kt.neo(-1,0),this.m_normals[3]=kt.neo(0,-1),this.m_count=4,kt.isValid(e)){n=n||0,this.m_centroid.set(e);var s=_l.identity();s.p.set(e),s.q.set(n);for(var r=0;r<this.m_count;++r)this.m_vertices[r]=_l.mulVec2(s,this.m_vertices[r]),this.m_normals[r]=yo.mulVec2(s.q,this.m_normals[r])}};Ee.prototype.testPoint=function(i,t){for(var e=yo.mulTVec2(i.q,kt.sub(t,i.p)),n=0;n<this.m_count;++n){var s=kt.dot(this.m_normals[n],kt.sub(e,this.m_vertices[n]));if(s>0)return!1}return!0};Ee.prototype.rayCast=function(i,t,e,n){for(var s=yo.mulTVec2(e.q,kt.sub(t.p1,e.p)),r=yo.mulTVec2(e.q,kt.sub(t.p2,e.p)),a=kt.sub(r,s),h=0,o=t.maxFraction,l=-1,u=0;u<this.m_count;++u){var m=kt.dot(this.m_normals[u],kt.sub(this.m_vertices[u],s)),p=kt.dot(this.m_normals[u],a);if(p==0){if(m<0)return!1}else p<0&&m<h*p?(h=m/p,l=u):p>0&&m<o*p&&(o=m/p);if(o<h)return!1}return On&&Un.assert(0<=h&&h<=t.maxFraction),l>=0?(i.fraction=h,i.normal=yo.mulVec2(e.q,this.m_normals[l]),!0):!1};Ee.prototype.computeAABB=function(i,t,e){for(var n=1/0,s=1/0,r=-1/0,a=-1/0,h=0;h<this.m_count;++h){var o=_l.mulVec2(t,this.m_vertices[h]);n=Kn.min(n,o.x),r=Kn.max(r,o.x),s=Kn.min(s,o.y),a=Kn.max(a,o.y)}i.lowerBound.set(n,s),i.upperBound.set(r,a),i.extend(this.m_radius)};Ee.prototype.computeMass=function(i,t){On&&Un.assert(this.m_count>=3);for(var e=kt.zero(),n=0,s=0,r=kt.zero(),a=0;a<this.m_count;++a)r.add(this.m_vertices[a]);r.mul(1/this.m_count);for(var h=1/3,a=0;a<this.m_count;++a){var o=kt.sub(this.m_vertices[a],r),l=a+1<this.m_count?kt.sub(this.m_vertices[a+1],r):kt.sub(this.m_vertices[0],r),u=kt.cross(o,l),m=.5*u;n+=m,e.addCombine(m*h,o,m*h,l);var p=o.x,c=o.y,f=l.x,d=l.y,y=p*p+f*p+f*f,_=c*c+d*c+d*d;s+=.25*h*u*(y+_)}i.mass=t*n,On&&Un.assert(n>Kn.EPSILON),e.mul(1/n),i.center.setCombine(1,e,1,r),i.I=t*s,i.I+=i.mass*(kt.dot(i.center,i.center)-kt.dot(e,e))};Ee.prototype.validate=function(){for(var i=0;i<this.m_count;++i)for(var t=i,e=i<this.m_count-1?t+1:0,n=this.m_vertices[t],s=kt.sub(this.m_vertices[e],n),r=0;r<this.m_count;++r)if(!(r==t||r==e)){var a=kt.sub(this.m_vertices[r],n),h=kt.cross(s,a);if(h<0)return!1}return!0};Ee.prototype.computeDistanceProxy=function(i){i.m_vertices=this.m_vertices,i.m_count=this.m_count,i.m_radius=this.m_radius};var Sn=typeof ASSERT=="undefined"?!1:ASSERT,vl=xe,Bn=ie,rm=Li,Xs=Yt,yl=je,om=Gs,am=wa;xe._super=om;xe.prototype=Object.create(xe._super.prototype);xe.TYPE="chain";om.TYPES[xe.TYPE]=xe;function xe(i,t){if(!(this instanceof xe))return new xe(i,t);xe._super.call(this),this.m_type=xe.TYPE,this.m_radius=yl.polygonRadius,this.m_vertices=[],this.m_count=0,this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_isLoop=t,i&&i.length&&(t?this._createLoop(i):this._createChain(i))}xe.prototype._serialize=function(){const i={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex};return this.m_prevVertex&&(i.prevVertex=this.m_prevVertex),this.m_nextVertex&&(i.nextVertex=this.m_nextVertex),i};xe._deserialize=function(i,t,e){var n=[];if(i.vertices)for(var s=0;s<i.vertices.length;s++)n.push(e(Xs,i.vertices[s]));var r=new xe(n,i.isLoop);return i.prevVertex&&r.setPrevVertex(i.prevVertex),i.nextVertex&&r.setNextVertex(i.nextVertex),r};xe.prototype._createLoop=function(i){Sn&&Bn.assert(this.m_vertices.length==0&&this.m_count==0),Sn&&Bn.assert(i.length>=3);for(var t=1;t<i.length;++t){var e=i[t-1],n=i[t];Sn&&Bn.assert(Xs.distanceSquared(e,n)>yl.linearSlopSquared)}this.m_vertices=[],this.m_count=i.length+1;for(var t=0;t<i.length;++t)this.m_vertices[t]=Xs.clone(i[t]);return this.m_vertices[i.length]=Xs.clone(i[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this};xe.prototype._createChain=function(i){Sn&&Bn.assert(this.m_vertices.length==0&&this.m_count==0),Sn&&Bn.assert(i.length>=2);for(var t=1;t<i.length;++t){var e=i[t-1],n=i[t];Sn&&Bn.assert(Xs.distanceSquared(e,n)>yl.linearSlopSquared)}this.m_count=i.length;for(var t=0;t<i.length;++t)this.m_vertices[t]=Xs.clone(i[t]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this};xe.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)};xe.prototype.setPrevVertex=function(i){this.m_prevVertex=i,this.m_hasPrevVertex=!0};xe.prototype.setNextVertex=function(i){this.m_nextVertex=i,this.m_hasNextVertex=!0};xe.prototype._clone=function(){var i=new xe;return i.createChain(this.m_vertices),i.m_type=this.m_type,i.m_radius=this.m_radius,i.m_prevVertex=this.m_prevVertex,i.m_nextVertex=this.m_nextVertex,i.m_hasPrevVertex=this.m_hasPrevVertex,i.m_hasNextVertex=this.m_hasNextVertex,i};xe.prototype.getChildCount=function(){return this.m_count-1};xe.prototype.getChildEdge=function(i,t){Sn&&Bn.assert(0<=t&&t<this.m_count-1),i.m_type=am.TYPE,i.m_radius=this.m_radius,i.m_vertex1=this.m_vertices[t],i.m_vertex2=this.m_vertices[t+1],t>0?(i.m_vertex0=this.m_vertices[t-1],i.m_hasVertex0=!0):(i.m_vertex0=this.m_prevVertex,i.m_hasVertex0=this.m_hasPrevVertex),t<this.m_count-2?(i.m_vertex3=this.m_vertices[t+2],i.m_hasVertex3=!0):(i.m_vertex3=this.m_nextVertex,i.m_hasVertex3=this.m_hasNextVertex)};xe.prototype.getVertex=function(i){return Sn&&Bn.assert(0<=i&&i<=this.m_count),i<this.m_count?this.m_vertices[i]:this.m_vertices[0]};xe.prototype.testPoint=function(i,t){return!1};xe.prototype.rayCast=function(i,t,e,n){Sn&&Bn.assert(0<=n&&n<this.m_count);var s=new am(this.getVertex(n),this.getVertex(n+1));return s.rayCast(i,t,e,0)};xe.prototype.computeAABB=function(i,t,e){Sn&&Bn.assert(0<=e&&e<this.m_count);var n=rm.mulVec2(t,this.getVertex(e)),s=rm.mulVec2(t,this.getVertex(e+1));i.combinePoints(n,s)};xe.prototype.computeMass=function(i,t){i.mass=0,i.center=Xs.neo(),i.I=0};xe.prototype.computeDistanceProxy=function(i,t){Sn&&Bn.assert(0<=t&&t<this.m_count),i.m_buffer[0]=this.getVertex(t),i.m_buffer[1]=this.getVertex(t+1),i.m_vertices=i.m_buffer,i.m_count=2,i.m_radius=this.m_radius};var W_=fs,Y_=vo;fs._super=Y_;fs.prototype=Object.create(fs._super.prototype);fs.TYPE="polygon";function fs(i,t,e,n){if(!(this instanceof fs))return new fs(i,t,e,n);fs._super.call(this),this._setAsBox(i,t,e,n)}var hm=typeof ASSERT=="undefined"?!1:ASSERT,lm=ie,cm=Li,q_=Yt,J_=us,gl=an.exports,Ta=Ma;J_.addType(Ta.TYPE,Ta.TYPE,$_);function $_(i,t,e,n,s,r,a){hm&&lm.assert(e.getType()==Ta.TYPE),hm&&lm.assert(r.getType()==Ta.TYPE),X_(i,e.getShape(),t,r.getShape(),s)}function X_(i,t,e,n,s){i.pointCount=0;var r=cm.mulVec2(e,t.m_p),a=cm.mulVec2(s,n.m_p),h=q_.distanceSquared(a,r),o=t.m_radius,l=n.m_radius,u=o+l;h>u*u||(i.type=gl.e_circles,i.localPoint.set(t.m_p),i.localNormal.setZero(),i.pointCount=1,i.points[0].localPoint.set(n.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=gl.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=gl.e_vertex)}var go=typeof ASSERT=="undefined"?!1:ASSERT,xo=ie,um=Li,Ue=Yt,mm=us,Qn=an.exports,xl=wa,pm=vl,Ca=Ma;mm.addType(xl.TYPE,Ca.TYPE,j_);mm.addType(pm.TYPE,Ca.TYPE,Z_);function j_(i,t,e,n,s,r,a){go&&xo.assert(e.getType()==xl.TYPE),go&&xo.assert(r.getType()==Ca.TYPE);var h=e.getShape(),o=r.getShape();fm(i,h,t,o,s)}function Z_(i,t,e,n,s,r,a){go&&xo.assert(e.getType()==pm.TYPE),go&&xo.assert(r.getType()==Ca.TYPE);var h=e.getShape(),o=new xl;h.getChildEdge(o,n);var l=o,u=r.getShape();fm(i,l,t,u,s)}function fm(i,t,e,n,s){i.pointCount=0;var r=um.mulTVec2(e,um.mulVec2(s,n.m_p)),a=t.m_vertex1,h=t.m_vertex2,o=Ue.sub(h,a),l=Ue.dot(o,Ue.sub(h,r)),u=Ue.dot(o,Ue.sub(r,a)),m=t.m_radius+n.m_radius;if(u<=0){var A=Ue.clone(a),b=Ue.sub(r,A),M=Ue.dot(b,b);if(M>m*m)return;if(t.m_hasVertex0){var p=t.m_vertex0,c=a,f=Ue.sub(c,p),d=Ue.dot(f,Ue.sub(c,r));if(d>0)return}i.type=Qn.e_circles,i.localNormal.setZero(),i.localPoint.set(A),i.pointCount=1,i.points[0].localPoint.set(n.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=Qn.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=Qn.e_vertex;return}if(l<=0){var A=Ue.clone(h),b=Ue.sub(r,A),M=Ue.dot(b,b);if(M>m*m)return;if(t.m_hasVertex3){var y=t.m_vertex3,_=h,v=Ue.sub(y,_),g=Ue.dot(v,Ue.sub(r,_));if(g>0)return}i.type=Qn.e_circles,i.localNormal.setZero(),i.localPoint.set(A),i.pointCount=1,i.points[0].localPoint.set(n.m_p),i.points[0].id.cf.indexA=1,i.points[0].id.cf.typeA=Qn.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=Qn.e_vertex;return}var x=Ue.dot(o,o);go&&xo.assert(x>0);var A=Ue.combine(l/x,a,u/x,h),b=Ue.sub(r,A),M=Ue.dot(b,b);if(!(M>m*m)){var S=Ue.neo(-o.y,o.x);Ue.dot(S,Ue.sub(r,a))<0&&S.set(-S.x,-S.y),S.normalize(),i.type=Qn.e_faceA,i.localNormal=S,i.localPoint.set(a),i.pointCount=1,i.points[0].localPoint.set(n.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=Qn.e_face,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=Qn.e_vertex}}var Al=typeof ASSERT=="undefined"?!1:ASSERT,bl=ie,js=Li,Ea=Ve,un=Yt,K_=je,qi=an.exports,Q_=us,La=vo,tv=dm;Q_.addType(La.TYPE,La.TYPE,ev);function ev(i,t,e,n,s,r,a){Al&&bl.assert(e.getType()==La.TYPE),Al&&bl.assert(r.getType()==La.TYPE),dm(i,e.getShape(),t,r.getShape(),s)}function ds(i,t,e,n){for(var s=i.m_count,r=e.m_count,a=i.m_normals,h=i.m_vertices,o=e.m_vertices,l=js.mulTXf(n,t),u=0,m=-1/0,p=0;p<s;++p){for(var c=Ea.mulVec2(l.q,a[p]),f=js.mulVec2(l,h[p]),d=1/0,y=0;y<r;++y){var _=un.dot(c,o[y])-un.dot(c,f);_<d&&(d=_)}d>m&&(m=d,u=p)}ds._maxSeparation=m,ds._bestIndex=u}function iv(i,t,e,n,s,r){var a=t.m_normals,h=s.m_count,o=s.m_vertices,l=s.m_normals;Al&&bl.assert(0<=n&&n<t.m_count);for(var u=Ea.mulT(r.q,Ea.mulVec2(e.q,a[n])),m=0,p=1/0,c=0;c<h;++c){var f=un.dot(u,l[c]);f<p&&(p=f,m=c)}var d=m,y=d+1<h?d+1:0;i[0].v=js.mulVec2(r,o[d]),i[0].id.cf.indexA=n,i[0].id.cf.indexB=d,i[0].id.cf.typeA=qi.e_face,i[0].id.cf.typeB=qi.e_vertex,i[1].v=js.mulVec2(r,o[y]),i[1].id.cf.indexA=n,i[1].id.cf.indexB=y,i[1].id.cf.typeA=qi.e_face,i[1].id.cf.typeB=qi.e_vertex}function dm(i,t,e,n,s){i.pointCount=0;var r=t.m_radius+n.m_radius;ds(t,e,n,s);var a=ds._bestIndex,h=ds._maxSeparation;if(!(h>r)){ds(n,s,t,e);var o=ds._bestIndex,l=ds._maxSeparation;if(!(l>r)){var u,m,p,c,f,d,y=.1*K_.linearSlop;l>h+y?(u=n,m=t,p=s,c=e,f=o,i.type=qi.e_faceB,d=1):(u=t,m=n,p=e,c=s,f=a,i.type=qi.e_faceA,d=0);var _=[new qi.clipVertex,new qi.clipVertex];iv(_,u,p,f,m,c);var v=u.m_count,g=u.m_vertices,x=f,A=f+1<v?f+1:0,b=g[x],M=g[A],S=un.sub(M,b);S.normalize();var B=un.cross(S,1),E=un.combine(.5,b,.5,M),T=Ea.mulVec2(p.q,S),w=un.cross(T,1);b=js.mulVec2(p,b),M=js.mulVec2(p,M);var C=un.dot(w,b),P=-un.dot(T,b)+r,R=un.dot(T,M)+r,L=[new qi.clipVertex,new qi.clipVertex],I=[new qi.clipVertex,new qi.clipVertex],z;if(z=qi.clipSegmentToLine(L,_,un.neg(T),P,x),!(z<2)&&(z=qi.clipSegmentToLine(I,L,T,R,A),!(z<2))){i.localNormal=B,i.localPoint=E;for(var F=0,D=0;D<I.length;++D){var V=un.dot(w,I[D].v)-C;if(V<=r){var G=i.points[F];if(G.localPoint.set(js.mulTVec2(c,I[D].v)),G.id=I[D].id,d){var Y=G.id.cf,J=Y.indexA,Q=Y.indexB,W=Y.typeA,et=Y.typeB;Y.indexA=Q,Y.indexB=J,Y.typeA=et,Y.typeB=W}++F}}i.pointCount=F}}}}var _m=typeof ASSERT=="undefined"?!1:ASSERT,vm=ie,nv=de.exports,ym=Li,Ki=Yt,mn=an.exports,sv=us,gm=Ma,xm=vo;sv.addType(xm.TYPE,gm.TYPE,rv);function rv(i,t,e,n,s,r,a){_m&&vm.assert(e.getType()==xm.TYPE),_m&&vm.assert(r.getType()==gm.TYPE),ov(i,e.getShape(),t,r.getShape(),s)}function ov(i,t,e,n,s){i.pointCount=0;for(var r=ym.mulVec2(s,n.m_p),a=ym.mulTVec2(e,r),h=0,o=-1/0,l=t.m_radius+n.m_radius,u=t.m_count,m=t.m_vertices,p=t.m_normals,c=0;c<u;++c){var f=Ki.dot(p[c],Ki.sub(a,m[c]));if(f>l)return;f>o&&(o=f,h=c)}var d=h,y=d+1<u?d+1:0,_=m[d],v=m[y];if(o<nv.EPSILON){i.pointCount=1,i.type=mn.e_faceA,i.localNormal.set(p[h]),i.localPoint.setCombine(.5,_,.5,v),i.points[0].localPoint=n.m_p,i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=mn.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=mn.e_vertex;return}var g=Ki.dot(Ki.sub(a,_),Ki.sub(v,_)),x=Ki.dot(Ki.sub(a,v),Ki.sub(_,v));if(g<=0){if(Ki.distanceSquared(a,_)>l*l)return;i.pointCount=1,i.type=mn.e_faceA,i.localNormal.setCombine(1,a,-1,_),i.localNormal.normalize(),i.localPoint=_,i.points[0].localPoint.set(n.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=mn.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=mn.e_vertex}else if(x<=0){if(Ki.distanceSquared(a,v)>l*l)return;i.pointCount=1,i.type=mn.e_faceA,i.localNormal.setCombine(1,a,-1,v),i.localNormal.normalize(),i.localPoint.set(v),i.points[0].localPoint.set(n.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=mn.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=mn.e_vertex}else{var A=Ki.mid(_,v),o=Ki.dot(a,p[d])-Ki.dot(A,p[d]);if(o>l)return;i.pointCount=1,i.type=mn.e_faceA,i.localNormal.set(p[d]),i.localPoint.set(A),i.points[0].localPoint.set(n.m_p),i.points[0].id.cf.indexA=0,i.points[0].id.cf.typeA=mn.e_vertex,i.points[0].id.cf.indexB=0,i.points[0].id.cf.typeB=mn.e_vertex}}var Pa=typeof ASSERT=="undefined"?!1:ASSERT,Ia=ie,av=de.exports,Ra=Li,Ot=Yt,hv=Ve,_r=je,Am=us,fi=an.exports,Ml=wa,bm=vl,Da=vo;Am.addType(Ml.TYPE,Da.TYPE,lv);Am.addType(bm.TYPE,Da.TYPE,cv);function lv(i,t,e,n,s,r,a){Pa&&Ia.assert(e.getType()==Ml.TYPE),Pa&&Ia.assert(r.getType()==Da.TYPE),Sm(i,e.getShape(),t,r.getShape(),s)}function cv(i,t,e,n,s,r,a){Pa&&Ia.assert(e.getType()==bm.TYPE),Pa&&Ia.assert(r.getType()==Da.TYPE);var h=e.getShape(),o=new Ml;h.getChildEdge(o,n),Sm(i,o,t,r.getShape(),s)}var za=-1,Fa=1,Mm=2;function wm(){this.type,this.index,this.separation}function uv(){this.vertices=[],this.normals=[],this.count=0}function mv(){this.i1,this.i2,this.v1,this.v2,this.normal=Ot.zero(),this.sideNormal1=Ot.zero(),this.sideOffset1,this.sideNormal2=Ot.zero(),this.sideOffset2}var Hn=new wm,Oi=new wm,hi=new uv,Ut=new mv;function Sm(i,t,e,n,s){var r=Ra.mulTXf(e,s),a=Ra.mulVec2(r,n.m_centroid),h=t.m_vertex0,o=t.m_vertex1,l=t.m_vertex2,u=t.m_vertex3,m=t.m_hasVertex0,p=t.m_hasVertex3,c=Ot.sub(l,o);c.normalize();var f=Ot.neo(c.y,-c.x),d=Ot.dot(f,Ot.sub(a,o)),y=0,_=0,v=!1,g=!1;if(m){var x=Ot.sub(o,h);x.normalize();var A=Ot.neo(x.y,-x.x);v=Ot.cross(x,c)>=0,y=Ot.dot(A,a)-Ot.dot(A,h)}if(p){var b=Ot.sub(u,l);b.normalize();var M=Ot.neo(b.y,-b.x);g=Ot.cross(c,b)>0,_=Ot.dot(M,a)-Ot.dot(M,l)}var S,B=Ot.zero(),E=Ot.zero(),T=Ot.zero();m&&p?v&&g?(S=y>=0||d>=0||_>=0,S?(B.set(f),E.set(A),T.set(M)):(B.setMul(-1,f),E.setMul(-1,f),T.setMul(-1,f))):v?(S=y>=0||d>=0&&_>=0,S?(B.set(f),E.set(A),T.set(f)):(B.setMul(-1,f),E.setMul(-1,M),T.setMul(-1,f))):g?(S=_>=0||y>=0&&d>=0,S?(B.set(f),E.set(f),T.set(M)):(B.setMul(-1,f),E.setMul(-1,f),T.setMul(-1,A))):(S=y>=0&&d>=0&&_>=0,S?(B.set(f),E.set(f),T.set(f)):(B.setMul(-1,f),E.setMul(-1,M),T.setMul(-1,A))):m?v?(S=y>=0||d>=0,S?(B.set(f),E.set(A),T.setMul(-1,f)):(B.setMul(-1,f),E.set(f),T.setMul(-1,f))):(S=y>=0&&d>=0,S?(B.set(f),E.set(f),T.setMul(-1,f)):(B.setMul(-1,f),E.set(f),T.setMul(-1,A))):p?g?(S=d>=0||_>=0,S?(B.set(f),E.setMul(-1,f),T.set(M)):(B.setMul(-1,f),E.setMul(-1,f),T.set(f))):(S=d>=0&&_>=0,S?(B.set(f),E.setMul(-1,f),T.set(f)):(B.setMul(-1,f),E.setMul(-1,M),T.set(f))):(S=d>=0,S?(B.set(f),E.setMul(-1,f),T.setMul(-1,f)):(B.setMul(-1,f),E.set(f),T.set(f))),hi.count=n.m_count;for(var w=0;w<n.m_count;++w)hi.vertices[w]=Ra.mulVec2(r,n.m_vertices[w]),hi.normals[w]=hv.mulVec2(r.q,n.m_normals[w]);var C=2*_r.polygonRadius;i.pointCount=0;{Hn.type=Fa,Hn.index=S?0:1,Hn.separation=1/0;for(var w=0;w<hi.count;++w){var P=Ot.dot(B,Ot.sub(hi.vertices[w],o));P<Hn.separation&&(Hn.separation=P)}}if(Hn.type!=za&&!(Hn.separation>C)){{Oi.type=za,Oi.index=-1,Oi.separation=-1/0;for(var R=Ot.neo(-B.y,B.x),w=0;w<hi.count;++w){var L=Ot.neg(hi.normals[w]),I=Ot.dot(L,Ot.sub(hi.vertices[w],o)),z=Ot.dot(L,Ot.sub(hi.vertices[w],l)),P=av.min(I,z);if(P>C){Oi.type=Mm,Oi.index=w,Oi.separation=P;break}if(Ot.dot(L,R)>=0){if(Ot.dot(Ot.sub(L,T),B)<-_r.angularSlop)continue}else if(Ot.dot(Ot.sub(L,E),B)<-_r.angularSlop)continue;P>Oi.separation&&(Oi.type=Mm,Oi.index=w,Oi.separation=P)}}if(!(Oi.type!=za&&Oi.separation>C)){var F=.98,D=.001,V;Oi.type==za?V=Hn:Oi.separation>F*Hn.separation+D?V=Oi:V=Hn;var G=[new fi.clipVertex,new fi.clipVertex];if(V.type==Fa){i.type=fi.e_faceA;for(var Y=0,J=Ot.dot(B,hi.normals[0]),w=1;w<hi.count;++w){var Q=Ot.dot(B,hi.normals[w]);Q<J&&(J=Q,Y=w)}var W=Y,et=W+1<hi.count?W+1:0;G[0].v=hi.vertices[W],G[0].id.cf.indexA=0,G[0].id.cf.indexB=W,G[0].id.cf.typeA=fi.e_face,G[0].id.cf.typeB=fi.e_vertex,G[1].v=hi.vertices[et],G[1].id.cf.indexA=0,G[1].id.cf.indexB=et,G[1].id.cf.typeA=fi.e_face,G[1].id.cf.typeB=fi.e_vertex,S?(Ut.i1=0,Ut.i2=1,Ut.v1=o,Ut.v2=l,Ut.normal.set(f)):(Ut.i1=1,Ut.i2=0,Ut.v1=l,Ut.v2=o,Ut.normal.setMul(-1,f))}else i.type=fi.e_faceB,G[0].v=o,G[0].id.cf.indexA=0,G[0].id.cf.indexB=V.index,G[0].id.cf.typeA=fi.e_vertex,G[0].id.cf.typeB=fi.e_face,G[1].v=l,G[1].id.cf.indexA=0,G[1].id.cf.indexB=V.index,G[1].id.cf.typeA=fi.e_vertex,G[1].id.cf.typeB=fi.e_face,Ut.i1=V.index,Ut.i2=Ut.i1+1<hi.count?Ut.i1+1:0,Ut.v1=hi.vertices[Ut.i1],Ut.v2=hi.vertices[Ut.i2],Ut.normal.set(hi.normals[Ut.i1]);Ut.sideNormal1.set(Ut.normal.y,-Ut.normal.x),Ut.sideNormal2.setMul(-1,Ut.sideNormal1),Ut.sideOffset1=Ot.dot(Ut.sideNormal1,Ut.v1),Ut.sideOffset2=Ot.dot(Ut.sideNormal2,Ut.v2);var ct=[new fi.clipVertex,new fi.clipVertex],Z=[new fi.clipVertex,new fi.clipVertex],ot;if(ot=fi.clipSegmentToLine(ct,G,Ut.sideNormal1,Ut.sideOffset1,Ut.i1),!(ot<_r.maxManifoldPoints)&&(ot=fi.clipSegmentToLine(Z,ct,Ut.sideNormal2,Ut.sideOffset2,Ut.i2),!(ot<_r.maxManifoldPoints))){V.type==Fa?(i.localNormal=Ot.clone(Ut.normal),i.localPoint=Ot.clone(Ut.v1)):(i.localNormal=Ot.clone(n.m_normals[Ut.i1]),i.localPoint=Ot.clone(n.m_vertices[Ut.i1]));for(var xt=0,w=0;w<_r.maxManifoldPoints;++w){var q=Ot.dot(Ut.normal,Ot.sub(Z[w].v,Ut.v1));if(q<=C){var X=i.points[xt];V.type==Fa?(X.localPoint=Ra.mulT(r,Z[w].v),X.id=Z[w].id):(X.localPoint=Z[w].v,X.id.cf.typeA=Z[w].id.cf.typeB,X.id.cf.typeB=Z[w].id.cf.typeA,X.id.cf.indexA=Z[w].id.cf.indexB,X.id.cf.indexB=Z[w].id.cf.indexA),++xt}}i.pointCount=xt}}}}var pv=Ae,fv=Wi,Va=je,Na=de.exports,ue=Yt,_s=Ve,wl=Vi,Bm=Fi;Ae.TYPE="distance-joint";wl.TYPES[Ae.TYPE]=Ae;Ae._super=wl;Ae.prototype=Object.create(Ae._super.prototype);var dv={frequencyHz:0,dampingRatio:0};function Ae(i,t,e,n,s){if(!(this instanceof Ae))return new Ae(i,t,e,n,s);if(e&&n&&"m_type"in n&&"x"in e&&"y"in e){var r=e;e=n,n=r}i=fv(i,dv),wl.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=Ae.TYPE,this.m_localAnchorA=ue.clone(n?t.getLocalPoint(n):i.localAnchorA||ue.zero()),this.m_localAnchorB=ue.clone(s?e.getLocalPoint(s):i.localAnchorB||ue.zero()),this.m_length=Na.isFinite(i.length)?i.length:ue.distance(t.getWorldPoint(this.m_localAnchorA),e.getWorldPoint(this.m_localAnchorB)),this.m_frequencyHz=i.frequencyHz,this.m_dampingRatio=i.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}Ae.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}};Ae._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(Bm,i.bodyA,t),i.bodyB=e(Bm,i.bodyB,t);var n=new Ae(i);return n};Ae.prototype._setAnchors=function(i){i.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(i.anchorA)):i.localAnchorA&&this.m_localAnchorA.set(i.localAnchorA),i.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(i.anchorB)):i.localAnchorB&&this.m_localAnchorB.set(i.localAnchorB),i.length>0?this.m_length=+i.length:i.length<0||(i.anchorA||i.anchorA||i.anchorA||i.anchorA)&&(this.m_length=ue.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB)))};Ae.prototype.getLocalAnchorA=function(){return this.m_localAnchorA};Ae.prototype.getLocalAnchorB=function(){return this.m_localAnchorB};Ae.prototype.setLength=function(i){this.m_length=i};Ae.prototype.getLength=function(){return this.m_length};Ae.prototype.setFrequency=function(i){this.m_frequencyHz=i};Ae.prototype.getFrequency=function(){return this.m_frequencyHz};Ae.prototype.setDampingRatio=function(i){this.m_dampingRatio=i};Ae.prototype.getDampingRatio=function(){return this.m_dampingRatio};Ae.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)};Ae.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)};Ae.prototype.getReactionForce=function(i){return ue.mul(this.m_impulse,this.m_u).mul(i)};Ae.prototype.getReactionTorque=function(i){return 0};Ae.prototype.initVelocityConstraints=function(i){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,r=this.m_bodyB.c_position.c,a=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,l=_s.neo(e),u=_s.neo(a);this.m_rA=_s.mulVec2(l,ue.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=_s.mulVec2(u,ue.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=ue.sub(ue.add(r,this.m_rB),ue.add(t,this.m_rA));var m=this.m_u.length();m>Va.linearSlop?this.m_u.mul(1/m):this.m_u.set(0,0);var p=ue.cross(this.m_rA,this.m_u),c=ue.cross(this.m_rB,this.m_u),f=this.m_invMassA+this.m_invIA*p*p+this.m_invMassB+this.m_invIB*c*c;if(this.m_mass=f!=0?1/f:0,this.m_frequencyHz>0){var d=m-this.m_length,y=2*Na.PI*this.m_frequencyHz,_=2*this.m_mass*this.m_dampingRatio*y,v=this.m_mass*y*y,g=i.dt;this.m_gamma=g*(_+g*v),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=d*g*v*this.m_gamma,f+=this.m_gamma,this.m_mass=f!=0?1/f:0}else this.m_gamma=0,this.m_bias=0;if(i.warmStarting){this.m_impulse*=i.dtRatio;var x=ue.mul(this.m_impulse,this.m_u);n.subMul(this.m_invMassA,x),s-=this.m_invIA*ue.cross(this.m_rA,x),h.addMul(this.m_invMassB,x),o+=this.m_invIB*ue.cross(this.m_rB,x)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(n),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(h),this.m_bodyB.c_velocity.w=o};Ae.prototype.solveVelocityConstraints=function(i){var t=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,r=ue.add(t,ue.cross(e,this.m_rA)),a=ue.add(n,ue.cross(s,this.m_rB)),h=ue.dot(this.m_u,a)-ue.dot(this.m_u,r),o=-this.m_mass*(h+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=o;var l=ue.mul(o,this.m_u);t.subMul(this.m_invMassA,l),e-=this.m_invIA*ue.cross(this.m_rA,l),n.addMul(this.m_invMassB,l),s+=this.m_invIB*ue.cross(this.m_rB,l),this.m_bodyA.c_velocity.v.set(t),this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v.set(n),this.m_bodyB.c_velocity.w=s};Ae.prototype.solvePositionConstraints=function(i){if(this.m_frequencyHz>0)return!0;var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,r=_s.neo(e),a=_s.neo(s),h=_s.mulSub(r,this.m_localAnchorA,this.m_localCenterA),o=_s.mulSub(a,this.m_localAnchorB,this.m_localCenterB),l=ue.sub(ue.add(n,o),ue.add(t,h)),u=l.normalize(),m=u-this.m_length;m=Na.clamp(m,-Va.maxLinearCorrection,Va.maxLinearCorrection);var p=-this.m_mass*m,c=ue.mul(p,l);return t.subMul(this.m_invMassA,c),e-=this.m_invIA*ue.cross(h,c),n.addMul(this.m_invMassB,c),s+=this.m_invIB*ue.cross(o,c),this.m_bodyA.c_position.c.set(t),this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c.set(n),this.m_bodyB.c_position.a=s,Na.abs(m)<Va.linearSlop};var Tm=typeof ASSERT=="undefined"?!1:ASSERT,_v=Le,Cm=ie,vv=Wi,Sl=de.exports,ti=Yt,Em=Ws,Oa=Ve,Bl=Vi,Lm=Fi;Le.TYPE="friction-joint";Bl.TYPES[Le.TYPE]=Le;Le._super=Bl;Le.prototype=Object.create(Le._super.prototype);var yv={maxForce:0,maxTorque:0};function Le(i,t,e,n){if(!(this instanceof Le))return new Le(i,t,e,n);i=vv(i,yv),Bl.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=Le.TYPE,this.m_localAnchorA=ti.clone(n?t.getLocalPoint(n):i.localAnchorA||ti.zero()),this.m_localAnchorB=ti.clone(n?e.getLocalPoint(n):i.localAnchorB||ti.zero()),this.m_linearImpulse=ti.zero(),this.m_angularImpulse=0,this.m_maxForce=i.maxForce,this.m_maxTorque=i.maxTorque,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}Le.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}};Le._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(Lm,i.bodyA,t),i.bodyB=e(Lm,i.bodyB,t);var n=new Le(i);return n};Le.prototype._setAnchors=function(i){i.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(i.anchorA)):i.localAnchorA&&this.m_localAnchorA.set(i.localAnchorA),i.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(i.anchorB)):i.localAnchorB&&this.m_localAnchorB.set(i.localAnchorB)};Le.prototype.getLocalAnchorA=function(){return this.m_localAnchorA};Le.prototype.getLocalAnchorB=function(){return this.m_localAnchorB};Le.prototype.setMaxForce=function(i){Tm&&Cm.assert(Sl.isFinite(i)&&i>=0),this.m_maxForce=i};Le.prototype.getMaxForce=function(){return this.m_maxForce};Le.prototype.setMaxTorque=function(i){Tm&&Cm.assert(Sl.isFinite(i)&&i>=0),this.m_maxTorque=i};Le.prototype.getMaxTorque=function(){return this.m_maxTorque};Le.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)};Le.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)};Le.prototype.getReactionForce=function(i){return ti.mul(i,this.m_linearImpulse)};Le.prototype.getReactionTorque=function(i){return i*this.m_angularImpulse};Le.prototype.initVelocityConstraints=function(i){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,r=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=Oa.neo(t),o=Oa.neo(s);this.m_rA=Oa.mulVec2(h,ti.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=Oa.mulVec2(o,ti.sub(this.m_localAnchorB,this.m_localCenterB));var l=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,p=this.m_invIB,c=new Em;if(c.ex.x=l+u+m*this.m_rA.y*this.m_rA.y+p*this.m_rB.y*this.m_rB.y,c.ex.y=-m*this.m_rA.x*this.m_rA.y-p*this.m_rB.x*this.m_rB.y,c.ey.x=c.ex.y,c.ey.y=l+u+m*this.m_rA.x*this.m_rA.x+p*this.m_rB.x*this.m_rB.x,this.m_linearMass=c.getInverse(),this.m_angularMass=m+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),i.warmStarting){this.m_linearImpulse.mul(i.dtRatio),this.m_angularImpulse*=i.dtRatio;var f=ti.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);e.subMul(l,f),n-=m*(ti.cross(this.m_rA,f)+this.m_angularImpulse),r.addMul(u,f),a+=p*(ti.cross(this.m_rB,f)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=r,this.m_bodyB.c_velocity.w=a};Le.prototype.solveVelocityConstraints=function(i){var t=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,r=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,o=this.m_invIB,l=i.dt;{var u=s-e,m=-this.m_angularMass*u,p=this.m_angularImpulse,c=l*this.m_maxTorque;this.m_angularImpulse=Sl.clamp(this.m_angularImpulse+m,-c,c),m=this.m_angularImpulse-p,e-=h*m,s+=o*m}{var u=ti.sub(ti.add(n,ti.cross(s,this.m_rB)),ti.add(t,ti.cross(e,this.m_rA))),m=ti.neg(Em.mulVec2(this.m_linearMass,u)),p=this.m_linearImpulse;this.m_linearImpulse.add(m);var c=l*this.m_maxForce;this.m_linearImpulse.lengthSquared()>c*c&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(c)),m=ti.sub(this.m_linearImpulse,p),t.subMul(r,m),e-=h*ti.cross(this.m_rA,m),n.addMul(a,m),s+=o*ti.cross(this.m_rB,m)}this.m_bodyA.c_velocity.v=t,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=s};Le.prototype.solvePositionConstraints=function(i){return!0};var gv=typeof ASSERT=="undefined"?!1:ASSERT,Pm=Kt,xv=ie,Av=Wi,ts=je,Zs=de.exports,me=Yt,Tl=cr,bv=Ws,Mv=_a,vs=Ve,Cl=Vi,Im=Fi,Ao=0,Ua=1,Ha=2,Ga=3;Kt.TYPE="revolute-joint";Cl.TYPES[Kt.TYPE]=Kt;Kt._super=Cl;Kt.prototype=Object.create(Kt._super.prototype);var wv={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1};function Kt(i,t,e,n){if(!(this instanceof Kt))return new Kt(i,t,e,n);i=Av(i,wv),Cl.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=Kt.TYPE,this.m_localAnchorA=me.clone(n?t.getLocalPoint(n):i.localAnchorA||me.zero()),this.m_localAnchorB=me.clone(n?e.getLocalPoint(n):i.localAnchorB||me.zero()),this.m_referenceAngle=Zs.isFinite(i.referenceAngle)?i.referenceAngle:e.getAngle()-t.getAngle(),this.m_impulse=Tl(),this.m_motorImpulse=0,this.m_lowerAngle=i.lowerAngle,this.m_upperAngle=i.upperAngle,this.m_maxMotorTorque=i.maxMotorTorque,this.m_motorSpeed=i.motorSpeed,this.m_enableLimit=i.enableLimit,this.m_enableMotor=i.enableMotor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new Mv,this.m_motorMass,this.m_limitState=Ao}Kt.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}};Kt._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(Im,i.bodyA,t),i.bodyB=e(Im,i.bodyB,t);var n=new Kt(i);return n};Kt.prototype._setAnchors=function(i){i.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(i.anchorA)):i.localAnchorA&&this.m_localAnchorA.set(i.localAnchorA),i.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(i.anchorB)):i.localAnchorB&&this.m_localAnchorB.set(i.localAnchorB)};Kt.prototype.getLocalAnchorA=function(){return this.m_localAnchorA};Kt.prototype.getLocalAnchorB=function(){return this.m_localAnchorB};Kt.prototype.getReferenceAngle=function(){return this.m_referenceAngle};Kt.prototype.getJointAngle=function(){var i=this.m_bodyA,t=this.m_bodyB;return t.m_sweep.a-i.m_sweep.a-this.m_referenceAngle};Kt.prototype.getJointSpeed=function(){var i=this.m_bodyA,t=this.m_bodyB;return t.m_angularVelocity-i.m_angularVelocity};Kt.prototype.isMotorEnabled=function(){return this.m_enableMotor};Kt.prototype.enableMotor=function(i){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=i};Kt.prototype.getMotorTorque=function(i){return i*this.m_motorImpulse};Kt.prototype.setMotorSpeed=function(i){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=i};Kt.prototype.getMotorSpeed=function(){return this.m_motorSpeed};Kt.prototype.setMaxMotorTorque=function(i){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=i};Kt.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque};Kt.prototype.isLimitEnabled=function(){return this.m_enableLimit};Kt.prototype.enableLimit=function(i){i!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=i,this.m_impulse.z=0)};Kt.prototype.getLowerLimit=function(){return this.m_lowerAngle};Kt.prototype.getUpperLimit=function(){return this.m_upperAngle};Kt.prototype.setLimits=function(i,t){gv&&xv.assert(i<=t),(i!=this.m_lowerAngle||t!=this.m_upperAngle)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=i,this.m_upperAngle=t)};Kt.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)};Kt.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)};Kt.prototype.getReactionForce=function(i){return me.neo(this.m_impulse.x,this.m_impulse.y).mul(i)};Kt.prototype.getReactionTorque=function(i){return i*this.m_impulse.z};Kt.prototype.initVelocityConstraints=function(i){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,r=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=vs.neo(t),o=vs.neo(s);this.m_rA=vs.mulVec2(h,me.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=vs.mulVec2(o,me.sub(this.m_localAnchorB,this.m_localCenterB));var l=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,p=this.m_invIB,c=m+p===0;if(this.m_mass.ex.x=l+u+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*p,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*p,this.m_mass.ez.x=-this.m_rA.y*m-this.m_rB.y*p,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=l+u+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*p,this.m_mass.ez.y=this.m_rA.x*m+this.m_rB.x*p,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=m+p,this.m_motorMass=m+p,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(this.m_enableMotor==!1||c)&&(this.m_motorImpulse=0),this.m_enableLimit&&c==!1){var f=s-t-this.m_referenceAngle;Zs.abs(this.m_upperAngle-this.m_lowerAngle)<2*ts.angularSlop?this.m_limitState=Ga:f<=this.m_lowerAngle?(this.m_limitState!=Ua&&(this.m_impulse.z=0),this.m_limitState=Ua):f>=this.m_upperAngle?(this.m_limitState!=Ha&&(this.m_impulse.z=0),this.m_limitState=Ha):(this.m_limitState=Ao,this.m_impulse.z=0)}else this.m_limitState=Ao;if(i.warmStarting){this.m_impulse.mul(i.dtRatio),this.m_motorImpulse*=i.dtRatio;var d=me.neo(this.m_impulse.x,this.m_impulse.y);e.subMul(l,d),n-=m*(me.cross(this.m_rA,d)+this.m_motorImpulse+this.m_impulse.z),r.addMul(u,d),a+=p*(me.cross(this.m_rB,d)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=r,this.m_bodyB.c_velocity.w=a};Kt.prototype.solveVelocityConstraints=function(i){var t=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,r=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,o=this.m_invIB,l=h+o===0;if(this.m_enableMotor&&this.m_limitState!=Ga&&l==!1){var u=s-e-this.m_motorSpeed,m=-this.m_motorMass*u,p=this.m_motorImpulse,c=i.dt*this.m_maxMotorTorque;this.m_motorImpulse=Zs.clamp(this.m_motorImpulse+m,-c,c),m=this.m_motorImpulse-p,e-=h*m,s+=o*m}if(this.m_enableLimit&&this.m_limitState!=Ao&&l==!1){var f=me.zero();f.addCombine(1,n,1,me.cross(s,this.m_rB)),f.subCombine(1,t,1,me.cross(e,this.m_rA));var d=s-e,u=Tl(f.x,f.y,d),m=Tl.neg(this.m_mass.solve33(u));if(this.m_limitState==Ga)this.m_impulse.add(m);else if(this.m_limitState==Ua){var y=this.m_impulse.z+m.z;if(y<0){var _=me.combine(-1,f,this.m_impulse.z,me.neo(this.m_mass.ez.x,this.m_mass.ez.y)),v=this.m_mass.solve22(_);m.x=v.x,m.y=v.y,m.z=-this.m_impulse.z,this.m_impulse.x+=v.x,this.m_impulse.y+=v.y,this.m_impulse.z=0}else this.m_impulse.add(m)}else if(this.m_limitState==Ha){var y=this.m_impulse.z+m.z;if(y>0){var _=me.combine(-1,f,this.m_impulse.z,me.neo(this.m_mass.ez.x,this.m_mass.ez.y)),v=this.m_mass.solve22(_);m.x=v.x,m.y=v.y,m.z=-this.m_impulse.z,this.m_impulse.x+=v.x,this.m_impulse.y+=v.y,this.m_impulse.z=0}else this.m_impulse.add(m)}var g=me.neo(m.x,m.y);t.subMul(r,g),e-=h*(me.cross(this.m_rA,g)+m.z),n.addMul(a,g),s+=o*(me.cross(this.m_rB,g)+m.z)}else{var u=me.zero();u.addCombine(1,n,1,me.cross(s,this.m_rB)),u.subCombine(1,t,1,me.cross(e,this.m_rA));var m=this.m_mass.solve22(me.neg(u));this.m_impulse.x+=m.x,this.m_impulse.y+=m.y,t.subMul(r,m),e-=h*me.cross(this.m_rA,m),n.addMul(a,m),s+=o*me.cross(this.m_rB,m)}this.m_bodyA.c_velocity.v=t,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=s};Kt.prototype.solvePositionConstraints=function(i){var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,r=vs.neo(e),a=vs.neo(s),h=0,o=0,l=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=Ao&&l==!1){var u=s-e-this.m_referenceAngle,m=0;if(this.m_limitState==Ga){var p=Zs.clamp(u-this.m_lowerAngle,-ts.maxAngularCorrection,ts.maxAngularCorrection);m=-this.m_motorMass*p,h=Zs.abs(p)}else if(this.m_limitState==Ua){var p=u-this.m_lowerAngle;h=-p,p=Zs.clamp(p+ts.angularSlop,-ts.maxAngularCorrection,0),m=-this.m_motorMass*p}else if(this.m_limitState==Ha){var p=u-this.m_upperAngle;h=p,p=Zs.clamp(p-ts.angularSlop,0,ts.maxAngularCorrection),m=-this.m_motorMass*p}e-=this.m_invIA*m,s+=this.m_invIB*m}{r.set(e),a.set(s);var c=vs.mulVec2(r,me.sub(this.m_localAnchorA,this.m_localCenterA)),f=vs.mulVec2(a,me.sub(this.m_localAnchorB,this.m_localCenterB)),p=me.zero();p.addCombine(1,n,1,f),p.subCombine(1,t,1,c),o=p.length();var d=this.m_invMassA,y=this.m_invMassB,_=this.m_invIA,v=this.m_invIB,g=new bv;g.ex.x=d+y+_*c.y*c.y+v*f.y*f.y,g.ex.y=-_*c.x*c.y-v*f.x*f.y,g.ey.x=g.ex.y,g.ey.y=d+y+_*c.x*c.x+v*f.x*f.x;var x=me.neg(g.solve(p));t.subMul(d,x),e-=_*me.cross(c,x),n.addMul(y,x),s+=v*me.cross(f,x)}return this.m_bodyA.c_position.c.set(t),this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c.set(n),this.m_bodyB.c_position.a=s,o<=ts.linearSlop&&h<=ts.angularSlop};var Sv=typeof ASSERT=="undefined"?!1:ASSERT,Rm=qt,Bv=ie,Tv=Wi,bo=je,Ui=de.exports,St=Yt,ys=cr,Cv=Ws,Dm=_a,Hi=Ve,El=Vi,zm=Fi,ka=0,Ll=1,Pl=2,Fm=3;qt.TYPE="prismatic-joint";El.TYPES[qt.TYPE]=qt;qt._super=El;qt.prototype=Object.create(qt._super.prototype);var Ev={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0};function qt(i,t,e,n,s){if(!(this instanceof qt))return new qt(i,t,e,n,s);i=Tv(i,Ev),El.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=qt.TYPE,this.m_localAnchorA=St.clone(n?t.getLocalPoint(n):i.localAnchorA||St.zero()),this.m_localAnchorB=St.clone(n?e.getLocalPoint(n):i.localAnchorB||St.zero()),this.m_localXAxisA=St.clone(s?t.getLocalVector(s):i.localAxisA||St.neo(1,0)),this.m_localXAxisA.normalize(),this.m_localYAxisA=St.cross(1,this.m_localXAxisA),this.m_referenceAngle=Ui.isFinite(i.referenceAngle)?i.referenceAngle:e.getAngle()-t.getAngle(),this.m_impulse=ys(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=i.lowerTranslation,this.m_upperTranslation=i.upperTranslation,this.m_maxMotorForce=i.maxMotorForce,this.m_motorSpeed=i.motorSpeed,this.m_enableLimit=i.enableLimit,this.m_enableMotor=i.enableMotor,this.m_limitState=ka,this.m_axis=St.zero(),this.m_perp=St.zero(),this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_axis,this.m_perp,this.m_s1,this.m_s2,this.m_a1,this.m_a2,this.m_K=new Dm,this.m_motorMass}qt.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}};qt._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(zm,i.bodyA,t),i.bodyB=e(zm,i.bodyB,t),i.localAxisA=St(i.localAxisA);var n=new qt(i);return n};qt.prototype._setAnchors=function(i){i.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(i.anchorA)):i.localAnchorA&&this.m_localAnchorA.set(i.localAnchorA),i.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(i.anchorB)):i.localAnchorB&&this.m_localAnchorB.set(i.localAnchorB),i.localAxisA&&(this.m_localXAxisA.set(i.localAxisA),this.m_localYAxisA.set(St.cross(1,i.localAxisA)))};qt.prototype.getLocalAnchorA=function(){return this.m_localAnchorA};qt.prototype.getLocalAnchorB=function(){return this.m_localAnchorB};qt.prototype.getLocalAxisA=function(){return this.m_localXAxisA};qt.prototype.getReferenceAngle=function(){return this.m_referenceAngle};qt.prototype.getJointTranslation=function(){var i=this.m_bodyA.getWorldPoint(this.m_localAnchorA),t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=St.sub(t,i),n=this.m_bodyA.getWorldVector(this.m_localXAxisA),s=St.dot(e,n);return s};qt.prototype.getJointSpeed=function(){var i=this.m_bodyA,t=this.m_bodyB,e=Hi.mulVec2(i.m_xf.q,St.sub(this.m_localAnchorA,i.m_sweep.localCenter)),n=Hi.mulVec2(t.m_xf.q,St.sub(this.m_localAnchorB,t.m_sweep.localCenter)),s=St.add(i.m_sweep.c,e),r=St.add(t.m_sweep.c,n),a=St.sub(r,s),h=Hi.mulVec2(i.m_xf.q,this.m_localXAxisA),o=i.m_linearVelocity,l=t.m_linearVelocity,u=i.m_angularVelocity,m=t.m_angularVelocity,p=St.dot(a,St.cross(u,h))+St.dot(h,St.sub(St.addCross(l,m,n),St.addCross(o,u,e)));return p};qt.prototype.isLimitEnabled=function(){return this.m_enableLimit};qt.prototype.enableLimit=function(i){i!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=i,this.m_impulse.z=0)};qt.prototype.getLowerLimit=function(){return this.m_lowerTranslation};qt.prototype.getUpperLimit=function(){return this.m_upperTranslation};qt.prototype.setLimits=function(i,t){Sv&&Bv.assert(i<=t),(i!=this.m_lowerTranslation||t!=this.m_upperTranslation)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=i,this.m_upperTranslation=t,this.m_impulse.z=0)};qt.prototype.isMotorEnabled=function(){return this.m_enableMotor};qt.prototype.enableMotor=function(i){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=i};qt.prototype.setMotorSpeed=function(i){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=i};qt.prototype.setMaxMotorForce=function(i){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=i};qt.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce};qt.prototype.getMotorSpeed=function(){return this.m_motorSpeed};qt.prototype.getMotorForce=function(i){return i*this.m_motorImpulse};qt.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)};qt.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)};qt.prototype.getReactionForce=function(i){return St.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(i)};qt.prototype.getReactionTorque=function(i){return i*this.m_impulse.y};qt.prototype.initVelocityConstraints=function(i){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,r=this.m_bodyB.c_position.c,a=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,l=Hi.neo(e),u=Hi.neo(a),m=Hi.mulVec2(l,St.sub(this.m_localAnchorA,this.m_localCenterA)),p=Hi.mulVec2(u,St.sub(this.m_localAnchorB,this.m_localCenterB)),c=St.zero();c.addCombine(1,r,1,p),c.subCombine(1,t,1,m);var f=this.m_invMassA,d=this.m_invMassB,y=this.m_invIA,_=this.m_invIB;this.m_axis=Hi.mulVec2(l,this.m_localXAxisA),this.m_a1=St.cross(St.add(c,m),this.m_axis),this.m_a2=St.cross(p,this.m_axis),this.m_motorMass=f+d+y*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass);{this.m_perp=Hi.mulVec2(l,this.m_localYAxisA),this.m_s1=St.cross(St.add(c,m),this.m_perp),this.m_s2=St.cross(p,this.m_perp),St.cross(m,this.m_perp);var v=f+d+y*this.m_s1*this.m_s1+_*this.m_s2*this.m_s2,g=y*this.m_s1+_*this.m_s2,x=y*this.m_s1*this.m_a1+_*this.m_s2*this.m_a2,A=y+_;A==0&&(A=1);var b=y*this.m_a1+_*this.m_a2,M=f+d+y*this.m_a1*this.m_a1+_*this.m_a2*this.m_a2;this.m_K.ex.set(v,g,x),this.m_K.ey.set(g,A,b),this.m_K.ez.set(x,b,M)}if(this.m_enableLimit){var S=St.dot(this.m_axis,c);Ui.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*bo.linearSlop?this.m_limitState=Fm:S<=this.m_lowerTranslation?this.m_limitState!=Ll&&(this.m_limitState=Ll,this.m_impulse.z=0):S>=this.m_upperTranslation?this.m_limitState!=Pl&&(this.m_limitState=Pl,this.m_impulse.z=0):(this.m_limitState=ka,this.m_impulse.z=0)}else this.m_limitState=ka,this.m_impulse.z=0;if(this.m_enableMotor==!1&&(this.m_motorImpulse=0),i.warmStarting){this.m_impulse.mul(i.dtRatio),this.m_motorImpulse*=i.dtRatio;var B=St.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),E=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,T=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.subMul(f,B),s-=y*E,h.addMul(d,B),o+=_*T}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(n),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(h),this.m_bodyB.c_velocity.w=o};qt.prototype.solveVelocityConstraints=function(i){var t=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,r=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,o=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=Fm){var l=St.dot(this.m_axis,St.sub(n,t))+this.m_a2*s-this.m_a1*e,u=this.m_motorMass*(this.m_motorSpeed-l),m=this.m_motorImpulse,p=i.dt*this.m_maxMotorForce;this.m_motorImpulse=Ui.clamp(this.m_motorImpulse+u,-p,p),u=this.m_motorImpulse-m;var c=St.mul(u,this.m_axis),f=u*this.m_a1,d=u*this.m_a2;t.subMul(r,c),e-=h*f,n.addMul(a,c),s+=o*d}var y=St.zero();if(y.x+=St.dot(this.m_perp,n)+this.m_s2*s,y.x-=St.dot(this.m_perp,t)+this.m_s1*e,y.y=s-e,this.m_enableLimit&&this.m_limitState!=ka){var _=0;_+=St.dot(this.m_axis,n)+this.m_a2*s,_-=St.dot(this.m_axis,t)+this.m_a1*e;var l=ys(y.x,y.y,_),v=ys(this.m_impulse),g=this.m_K.solve33(ys.neg(l));this.m_impulse.add(g),this.m_limitState==Ll?this.m_impulse.z=Ui.max(this.m_impulse.z,0):this.m_limitState==Pl&&(this.m_impulse.z=Ui.min(this.m_impulse.z,0));var x=St.combine(-1,y,-(this.m_impulse.z-v.z),St.neo(this.m_K.ez.x,this.m_K.ez.y)),A=St.add(this.m_K.solve22(x),St.neo(v.x,v.y));this.m_impulse.x=A.x,this.m_impulse.y=A.y,g=ys.sub(this.m_impulse,v);var c=St.combine(g.x,this.m_perp,g.z,this.m_axis),f=g.x*this.m_s1+g.y+g.z*this.m_a1,d=g.x*this.m_s2+g.y+g.z*this.m_a2;t.subMul(r,c),e-=h*f,n.addMul(a,c),s+=o*d}else{var g=this.m_K.solve22(St.neg(y));this.m_impulse.x+=g.x,this.m_impulse.y+=g.y;var c=St.mul(g.x,this.m_perp),f=g.x*this.m_s1+g.y,d=g.x*this.m_s2+g.y;t.subMul(r,c),e-=h*f,n.addMul(a,c),s+=o*d}this.m_bodyA.c_velocity.v=t,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=s};qt.prototype.solvePositionConstraints=function(i){var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,r=Hi.neo(e),a=Hi.neo(s),h=this.m_invMassA,o=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=Hi.mulVec2(r,St.sub(this.m_localAnchorA,this.m_localCenterA)),p=Hi.mulVec2(a,St.sub(this.m_localAnchorB,this.m_localCenterB)),c=St.sub(St.add(n,p),St.add(t,m)),f=Hi.mulVec2(r,this.m_localXAxisA),d=St.cross(St.add(c,m),f),y=St.cross(p,f),_=Hi.mulVec2(r,this.m_localYAxisA),v=St.cross(St.add(c,m),_),g=St.cross(p,_),x=ys(),A=St.zero();A.x=St.dot(_,c),A.y=s-e-this.m_referenceAngle;var b=Ui.abs(A.x),M=Ui.abs(A.y),S=bo.linearSlop,B=bo.maxLinearCorrection,E=!1,T=0;if(this.m_enableLimit){var w=St.dot(f,c);Ui.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*S?(T=Ui.clamp(w,-B,B),b=Ui.max(b,Ui.abs(w)),E=!0):w<=this.m_lowerTranslation?(T=Ui.clamp(w-this.m_lowerTranslation+S,-B,0),b=Ui.max(b,this.m_lowerTranslation-w),E=!0):w>=this.m_upperTranslation&&(T=Ui.clamp(w-this.m_upperTranslation-S,0,B),b=Ui.max(b,w-this.m_upperTranslation),E=!0)}if(E){var C=h+o+l*v*v+u*g*g,P=l*v+u*g,R=l*v*d+u*g*y,L=l+u;L==0&&(L=1);var I=l*d+u*y,z=h+o+l*d*d+u*y*y,F=new Dm;F.ex.set(C,P,R),F.ey.set(P,L,I),F.ez.set(R,I,z);var D=ys();D.x=A.x,D.y=A.y,D.z=T,x=F.solve33(ys.neg(D))}else{var C=h+o+l*v*v+u*g*g,P=l*v+u*g,L=l+u;L==0&&(L=1);var F=new Cv;F.ex.set(C,P),F.ey.set(P,L);var V=F.solve(St.neg(A));x.x=V.x,x.y=V.y,x.z=0}var G=St.combine(x.x,_,x.z,f),Y=x.x*v+x.y+x.z*d,J=x.x*g+x.y+x.z*y;return t.subMul(h,G),e-=l*Y,n.addMul(o,G),s+=u*J,this.m_bodyA.c_position.c=t,this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=s,b<=bo.linearSlop&&M<=bo.angularSlop};var Il=typeof ASSERT=="undefined"?!1:ASSERT,Lv=He,Rl=ie,Pv=Wi,Iv=je,Vm=de.exports,Jt=Yt,ze=Ve,Mo=Vi,Nm=Fi,gs=Pm,Om=Rm;He.TYPE="gear-joint";Mo.TYPES[He.TYPE]=He;He._super=Mo;He.prototype=Object.create(He._super.prototype);var Rv={ratio:1};function He(i,t,e,n,s,r){if(!(this instanceof He))return new He(i,t,e,n,s,r);i=Pv(i,Rv),Mo.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=He.TYPE,Il&&Rl.assert(n.m_type===gs.TYPE||n.m_type===Om.TYPE),Il&&Rl.assert(s.m_type===gs.TYPE||s.m_type===Om.TYPE),this.m_joint1=n||i.joint1,this.m_joint2=s||i.joint2,this.m_ratio=Vm.isFinite(r)?r:i.ratio,this.m_type1=this.m_joint1.getType(),this.m_type2=this.m_joint2.getType();var a,h;this.m_bodyC=this.m_joint1.getBodyA(),this.m_bodyA=this.m_joint1.getBodyB();var o=this.m_bodyA.m_xf,l=this.m_bodyA.m_sweep.a,u=this.m_bodyC.m_xf,m=this.m_bodyC.m_sweep.a;if(this.m_type1===gs.TYPE){var p=this.m_joint1;this.m_localAnchorC=p.m_localAnchorA,this.m_localAnchorA=p.m_localAnchorB,this.m_referenceAngleA=p.m_referenceAngle,this.m_localAxisC=Jt.zero(),a=l-m-this.m_referenceAngleA}else{var c=this.m_joint1;this.m_localAnchorC=c.m_localAnchorA,this.m_localAnchorA=c.m_localAnchorB,this.m_referenceAngleA=c.m_referenceAngle,this.m_localAxisC=c.m_localXAxisA;var f=this.m_localAnchorC,d=ze.mulTVec2(u.q,Jt.add(ze.mul(o.q,this.m_localAnchorA),Jt.sub(o.p,u.p)));a=Jt.dot(d,this.m_localAxisC)-Jt.dot(f,this.m_localAxisC)}this.m_bodyD=this.m_joint2.getBodyA(),this.m_bodyB=this.m_joint2.getBodyB();var y=this.m_bodyB.m_xf,_=this.m_bodyB.m_sweep.a,v=this.m_bodyD.m_xf,g=this.m_bodyD.m_sweep.a;if(this.m_type2===gs.TYPE){var p=this.m_joint2;this.m_localAnchorD=p.m_localAnchorA,this.m_localAnchorB=p.m_localAnchorB,this.m_referenceAngleB=p.m_referenceAngle,this.m_localAxisD=Jt.zero(),h=_-g-this.m_referenceAngleB}else{var c=this.m_joint2;this.m_localAnchorD=c.m_localAnchorA,this.m_localAnchorB=c.m_localAnchorB,this.m_referenceAngleB=c.m_referenceAngle,this.m_localAxisD=c.m_localXAxisA;var x=this.m_localAnchorD,A=ze.mulTVec2(v.q,Jt.add(ze.mul(y.q,this.m_localAnchorB),Jt.sub(y.p,v.p)));h=Jt.dot(A,this.m_localAxisD)-Jt.dot(x,this.m_localAxisD)}this.m_constant=a+this.m_ratio*h,this.m_impulse=0,this.m_lcA,this.m_lcB,this.m_lcC,this.m_lcD,this.m_mA,this.m_mB,this.m_mC,this.m_mD,this.m_iA,this.m_iB,this.m_iC,this.m_iD,this.m_JvAC,this.m_JvBD,this.m_JwA,this.m_JwB,this.m_JwC,this.m_JwD,this.m_mass}He.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}};He._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(Nm,i.bodyA,t),i.bodyB=e(Nm,i.bodyB,t),i.joint1=e(Mo,i.joint1,t),i.joint2=e(Mo,i.joint2,t);var n=new He(i);return n};He.prototype.getJoint1=function(){return this.m_joint1};He.prototype.getJoint2=function(){return this.m_joint2};He.prototype.setRatio=function(i){Il&&Rl.assert(Vm.isFinite(i)),this.m_ratio=i};He.prototype.getRatio=function(){return this.m_ratio};He.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)};He.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)};He.prototype.getReactionForce=function(i){return Jt.mul(this.m_impulse,this.m_JvAC).mul(i)};He.prototype.getReactionTorque=function(i){var t=this.m_impulse*this.m_JwA;return i*t};He.prototype.initVelocityConstraints=function(i){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var t=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,r=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=this.m_bodyC.c_position.a,o=this.m_bodyC.c_velocity.v,l=this.m_bodyC.c_velocity.w,u=this.m_bodyD.c_position.a,m=this.m_bodyD.c_velocity.v,p=this.m_bodyD.c_velocity.w,c=ze.neo(t),f=ze.neo(s),d=ze.neo(h),y=ze.neo(u);if(this.m_mass=0,this.m_type1==gs.TYPE)this.m_JvAC=Jt.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var _=ze.mulVec2(d,this.m_localAxisC),v=ze.mulSub(d,this.m_localAnchorC,this.m_lcC),g=ze.mulSub(c,this.m_localAnchorA,this.m_lcA);this.m_JvAC=_,this.m_JwC=Jt.cross(v,_),this.m_JwA=Jt.cross(g,_),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==gs.TYPE)this.m_JvBD=Jt.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var _=ze.mulVec2(y,this.m_localAxisD),x=ze.mulSub(y,this.m_localAnchorD,this.m_lcD),A=ze.mulSub(f,this.m_localAnchorB,this.m_lcB);this.m_JvBD=Jt.mul(this.m_ratio,_),this.m_JwD=this.m_ratio*Jt.cross(x,_),this.m_JwB=this.m_ratio*Jt.cross(A,_),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,i.warmStarting?(e.addMul(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,r.addMul(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,o.subMul(this.m_mC*this.m_impulse,this.m_JvAC),l-=this.m_iC*this.m_impulse*this.m_JwC,m.subMul(this.m_mD*this.m_impulse,this.m_JvBD),p-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.set(r),this.m_bodyB.c_velocity.w=a,this.m_bodyC.c_velocity.v.set(o),this.m_bodyC.c_velocity.w=l,this.m_bodyD.c_velocity.v.set(m),this.m_bodyD.c_velocity.w=p};He.prototype.solveVelocityConstraints=function(i){var t=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,r=this.m_bodyC.c_velocity.v,a=this.m_bodyC.c_velocity.w,h=this.m_bodyD.c_velocity.v,o=this.m_bodyD.c_velocity.w,l=Jt.dot(this.m_JvAC,t)-Jt.dot(this.m_JvAC,r)+Jt.dot(this.m_JvBD,n)-Jt.dot(this.m_JvBD,h);l+=this.m_JwA*e-this.m_JwC*a+(this.m_JwB*s-this.m_JwD*o);var u=-this.m_mass*l;this.m_impulse+=u,t.addMul(this.m_mA*u,this.m_JvAC),e+=this.m_iA*u*this.m_JwA,n.addMul(this.m_mB*u,this.m_JvBD),s+=this.m_iB*u*this.m_JwB,r.subMul(this.m_mC*u,this.m_JvAC),a-=this.m_iC*u*this.m_JwC,h.subMul(this.m_mD*u,this.m_JvBD),o-=this.m_iD*u*this.m_JwD,this.m_bodyA.c_velocity.v.set(t),this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v.set(n),this.m_bodyB.c_velocity.w=s,this.m_bodyC.c_velocity.v.set(r),this.m_bodyC.c_velocity.w=a,this.m_bodyD.c_velocity.v.set(h),this.m_bodyD.c_velocity.w=o};He.prototype.solvePositionConstraints=function(i){var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,r=this.m_bodyC.c_position.c,a=this.m_bodyC.c_position.a,h=this.m_bodyD.c_position.c,o=this.m_bodyD.c_position.a,l=ze.neo(e),u=ze.neo(s),m=ze.neo(a),p=ze.neo(o),c=0,f,d,y,_,v,g,x,A,b=0;if(this.m_type1==gs.TYPE)y=Jt.zero(),v=1,x=1,b+=this.m_iA+this.m_iC,f=e-a-this.m_referenceAngleA;else{var M=ze.mulVec2(m,this.m_localAxisC),S=ze.mulSub(m,this.m_localAnchorC,this.m_lcC),B=ze.mulSub(l,this.m_localAnchorA,this.m_lcA);y=M,x=Jt.cross(S,M),v=Jt.cross(B,M),b+=this.m_mC+this.m_mA+this.m_iC*x*x+this.m_iA*v*v;var E=Jt.sub(this.m_localAnchorC,this.m_lcC),T=ze.mulTVec2(m,Jt.add(B,Jt.sub(t,r)));f=Jt.dot(Jt.sub(T,E),this.m_localAxisC)}if(this.m_type2==gs.TYPE)_=Jt.zero(),g=this.m_ratio,A=this.m_ratio,b+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),d=s-o-this.m_referenceAngleB;else{var M=ze.mulVec2(p,this.m_localAxisD),w=ze.mulSub(p,this.m_localAnchorD,this.m_lcD),C=ze.mulSub(u,this.m_localAnchorB,this.m_lcB);_=Jt.mul(this.m_ratio,M),A=this.m_ratio*Jt.cross(w,M),g=this.m_ratio*Jt.cross(C,M),b+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*A*A+this.m_iB*g*g;var P=Jt.sub(this.m_localAnchorD,this.m_lcD),R=ze.mulTVec2(p,Jt.add(C,Jt.sub(n,h)));d=Jt.dot(R,this.m_localAxisD)-Jt.dot(P,this.m_localAxisD)}var L=f+this.m_ratio*d-this.m_constant,I=0;return b>0&&(I=-L/b),t.addMul(this.m_mA*I,y),e+=this.m_iA*I*v,n.addMul(this.m_mB*I,_),s+=this.m_iB*I*g,r.subMul(this.m_mC*I,y),a-=this.m_iC*I*x,h.subMul(this.m_mD*I,_),o-=this.m_iD*I*A,this.m_bodyA.c_position.c.set(t),this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c.set(n),this.m_bodyB.c_position.a=s,this.m_bodyC.c_position.c.set(r),this.m_bodyC.c_position.a=a,this.m_bodyD.c_position.c.set(h),this.m_bodyD.c_position.a=o,c<Iv.linearSlop};var Dl=typeof ASSERT=="undefined"?!1:ASSERT,Dv=_e,zl=ie,zv=Wi,vr=de.exports,Ii=Yt,Um=Ws,wo=Ve,Fl=Vi,Hm=Fi;_e.TYPE="motor-joint";Fl.TYPES[_e.TYPE]=_e;_e._super=Fl;_e.prototype=Object.create(_e._super.prototype);var Fv={maxForce:1,maxTorque:1,correctionFactor:.3};function _e(i,t,e){if(!(this instanceof _e))return new _e(i,t,e);i=zv(i,Fv),Fl.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=_e.TYPE,this.m_linearOffset=vr.isFinite(i.linearOffset)?i.linearOffset:t.getLocalPoint(e.getPosition()),this.m_angularOffset=vr.isFinite(i.angularOffset)?i.angularOffset:e.getAngle()-t.getAngle(),this.m_linearImpulse=Ii.zero(),this.m_angularImpulse=0,this.m_maxForce=i.maxForce,this.m_maxTorque=i.maxTorque,this.m_correctionFactor=i.correctionFactor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_linearError,this.m_angularError,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}_e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}};_e._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(Hm,i.bodyA,t),i.bodyB=e(Hm,i.bodyB,t);var n=new _e(i);return n};_e.prototype._setAnchors=function(i){i.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(i.anchorA)):i.localAnchorA&&this.m_localAnchorA.set(i.localAnchorA),i.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(i.anchorB)):i.localAnchorB&&this.m_localAnchorB.set(i.localAnchorB)};_e.prototype.setMaxForce=function(i){Dl&&zl.assert(vr.isFinite(i)&&i>=0),this.m_maxForce=i};_e.prototype.getMaxForce=function(){return this.m_maxForce};_e.prototype.setMaxTorque=function(i){Dl&&zl.assert(vr.isFinite(i)&&i>=0),this.m_maxTorque=i};_e.prototype.getMaxTorque=function(){return this.m_maxTorque};_e.prototype.setCorrectionFactor=function(i){Dl&&zl.assert(vr.isFinite(i)&&0<=i&&i<=1),this.m_correctionFactor=i};_e.prototype.getCorrectionFactor=function(){return this.m_correctionFactor};_e.prototype.setLinearOffset=function(i){(i.x!=this.m_linearOffset.x||i.y!=this.m_linearOffset.y)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=i)};_e.prototype.getLinearOffset=function(){return this.m_linearOffset};_e.prototype.setAngularOffset=function(i){i!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=i)};_e.prototype.getAngularOffset=function(){return this.m_angularOffset};_e.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()};_e.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()};_e.prototype.getReactionForce=function(i){return Ii.mul(i,this.m_linearImpulse)};_e.prototype.getReactionTorque=function(i){return i*this.m_angularImpulse};_e.prototype.initVelocityConstraints=function(i){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,r=this.m_bodyB.c_position.c,a=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,l=wo.neo(e),u=wo.neo(a);this.m_rA=wo.mulVec2(l,Ii.neg(this.m_localCenterA)),this.m_rB=wo.mulVec2(u,Ii.neg(this.m_localCenterB));var m=this.m_invMassA,p=this.m_invMassB,c=this.m_invIA,f=this.m_invIB,d=new Um;if(d.ex.x=m+p+c*this.m_rA.y*this.m_rA.y+f*this.m_rB.y*this.m_rB.y,d.ex.y=-c*this.m_rA.x*this.m_rA.y-f*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=m+p+c*this.m_rA.x*this.m_rA.x+f*this.m_rB.x*this.m_rB.x,this.m_linearMass=d.getInverse(),this.m_angularMass=c+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=Ii.zero(),this.m_linearError.addCombine(1,r,1,this.m_rB),this.m_linearError.subCombine(1,t,1,this.m_rA),this.m_linearError.sub(wo.mulVec2(l,this.m_linearOffset)),this.m_angularError=a-e-this.m_angularOffset,i.warmStarting){this.m_linearImpulse.mul(i.dtRatio),this.m_angularImpulse*=i.dtRatio;var y=Ii.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);n.subMul(m,y),s-=c*(Ii.cross(this.m_rA,y)+this.m_angularImpulse),h.addMul(p,y),o+=f*(Ii.cross(this.m_rB,y)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=h,this.m_bodyB.c_velocity.w=o};_e.prototype.solveVelocityConstraints=function(i){var t=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,r=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,o=this.m_invIB,l=i.dt,u=i.inv_dt;{var m=s-e+u*this.m_correctionFactor*this.m_angularError,p=-this.m_angularMass*m,c=this.m_angularImpulse,f=l*this.m_maxTorque;this.m_angularImpulse=vr.clamp(this.m_angularImpulse+p,-f,f),p=this.m_angularImpulse-c,e-=h*p,s+=o*p}{var m=Ii.zero();m.addCombine(1,n,1,Ii.cross(s,this.m_rB)),m.subCombine(1,t,1,Ii.cross(e,this.m_rA)),m.addMul(u*this.m_correctionFactor,this.m_linearError);var p=Ii.neg(Um.mulVec2(this.m_linearMass,m)),c=Ii.clone(this.m_linearImpulse);this.m_linearImpulse.add(p);var f=l*this.m_maxForce;this.m_linearImpulse.clamp(f),p=Ii.sub(this.m_linearImpulse,c),t.subMul(r,p),e-=h*Ii.cross(this.m_rA,p),n.addMul(a,p),s+=o*Ii.cross(this.m_rB,p)}this.m_bodyA.c_velocity.v=t,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=s};_e.prototype.solvePositionConstraints=function(i){return!0};var Wa=typeof ASSERT=="undefined"?!1:ASSERT,Vv=be,Ya=ie,Nv=Wi,So=de.exports,Mi=Yt,Vl=Ws,Gm=Ve,Ov=Li,Nl=Vi,km=Fi;be.TYPE="mouse-joint";Nl.TYPES[be.TYPE]=be;be._super=Nl;be.prototype=Object.create(be._super.prototype);var Uv={maxForce:0,frequencyHz:5,dampingRatio:.7};function be(i,t,e,n){if(!(this instanceof be))return new be(i,t,e,n);i=Nv(i,Uv),Nl.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=be.TYPE,Wa&&Ya.assert(So.isFinite(i.maxForce)&&i.maxForce>=0),Wa&&Ya.assert(So.isFinite(i.frequencyHz)&&i.frequencyHz>=0),Wa&&Ya.assert(So.isFinite(i.dampingRatio)&&i.dampingRatio>=0),this.m_targetA=n?Mi.clone(n):i.target||Mi.zero(),this.m_localAnchorB=Ov.mulTVec2(e.getTransform(),this.m_targetA),this.m_maxForce=i.maxForce,this.m_impulse=Mi.zero(),this.m_frequencyHz=i.frequencyHz,this.m_dampingRatio=i.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_rB=Mi.zero(),this.m_localCenterB=Mi.zero(),this.m_invMassB=0,this.m_invIB=0,this.mass=new Vl,this.m_C=Mi.zero()}be.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}};be._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(km,i.bodyA,t),i.bodyB=e(km,i.bodyB,t),i.target=Mi(i.target);var n=new be(i);return i._localAnchorB&&(n.m_localAnchorB=i._localAnchorB),n};be.prototype.setTarget=function(i){this.m_bodyB.isAwake()==!1&&this.m_bodyB.setAwake(!0),this.m_targetA=Mi.clone(i)};be.prototype.getTarget=function(){return this.m_targetA};be.prototype.setMaxForce=function(i){this.m_maxForce=i};be.getMaxForce=function(){return this.m_maxForce};be.prototype.setFrequency=function(i){this.m_frequencyHz=i};be.prototype.getFrequency=function(){return this.m_frequencyHz};be.prototype.setDampingRatio=function(i){this.m_dampingRatio=i};be.prototype.getDampingRatio=function(){return this.m_dampingRatio};be.prototype.getAnchorA=function(){return Mi.clone(this.m_targetA)};be.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)};be.prototype.getReactionForce=function(i){return Mi.mul(i,this.m_impulse)};be.prototype.getReactionTorque=function(i){return i*0};be.prototype.shiftOrigin=function(i){this.m_targetA.sub(i)};be.prototype.initVelocityConstraints=function(i){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_bodyB.c_position,e=this.m_bodyB.c_velocity,n=t.c,s=t.a,r=e.v,a=e.w,h=Gm.neo(s),o=this.m_bodyB.getMass(),l=2*So.PI*this.m_frequencyHz,u=2*o*this.m_dampingRatio*l,m=o*(l*l),p=i.dt;Wa&&Ya.assert(u+p*m>So.EPSILON),this.m_gamma=p*(u+p*m),this.m_gamma!=0&&(this.m_gamma=1/this.m_gamma),this.m_beta=p*m*this.m_gamma,this.m_rB=Gm.mulVec2(h,Mi.sub(this.m_localAnchorB,this.m_localCenterB));var c=new Vl;c.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,c.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,c.ey.x=c.ex.y,c.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=c.getInverse(),this.m_C.set(n),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),a*=.98,i.warmStarting?(this.m_impulse.mul(i.dtRatio),r.addMul(this.m_invMassB,this.m_impulse),a+=this.m_invIB*Mi.cross(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),e.v.set(r),e.w=a};be.prototype.solveVelocityConstraints=function(i){var t=this.m_bodyB.c_velocity,e=Mi.clone(t.v),n=t.w,s=Mi.cross(n,this.m_rB);s.add(e),s.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),s.neg();var r=Vl.mulVec2(this.m_mass,s),a=Mi.clone(this.m_impulse);this.m_impulse.add(r);var h=i.dt*this.m_maxForce;this.m_impulse.clamp(h),r=Mi.sub(this.m_impulse,a),e.addMul(this.m_invMassB,r),n+=this.m_invIB*Mi.cross(this.m_rB,r),t.v.set(e),t.w=n};be.prototype.solvePositionConstraints=function(i){return!0};var Hv=typeof ASSERT=="undefined"?!1:ASSERT,Gv=Me,kv=ie,Wv=Wi,Bo=je,To=de.exports,Ht=Yt,xs=Ve,Ol=Vi,Wm=Fi;Me.TYPE="pulley-joint";Me.MIN_PULLEY_LENGTH=2;Ol.TYPES[Me.TYPE]=Me;Me._super=Ol;Me.prototype=Object.create(Me._super.prototype);var Yv={collideConnected:!0};function Me(i,t,e,n,s,r,a,h){if(!(this instanceof Me))return new Me(i,t,e,n,s,r,a,h);i=Wv(i,Yv),Ol.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=Me.TYPE,this.m_groundAnchorA=n||i.groundAnchorA||Ht.neo(-1,1),this.m_groundAnchorB=s||i.groundAnchorB||Ht.neo(1,1),this.m_localAnchorA=r?t.getLocalPoint(r):i.localAnchorA||Ht.neo(-1,0),this.m_localAnchorB=a?e.getLocalPoint(a):i.localAnchorB||Ht.neo(1,0),this.m_lengthA=To.isFinite(i.lengthA)?i.lengthA:Ht.distance(r,n),this.m_lengthB=To.isFinite(i.lengthB)?i.lengthB:Ht.distance(a,s),this.m_ratio=To.isFinite(h)?h:i.ratio,Hv&&kv.assert(h>To.EPSILON),this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0,this.m_uA,this.m_uB,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}Me.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}};Me._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(Wm,i.bodyA,t),i.bodyB=e(Wm,i.bodyB,t);var n=new Me(i);return n};Me.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA};Me.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB};Me.prototype.getLengthA=function(){return this.m_lengthA};Me.prototype.getLengthB=function(){return this.m_lengthB};Me.prototype.getRatio=function(){return this.m_ratio};Me.prototype.getCurrentLengthA=function(){var i=this.m_bodyA.getWorldPoint(this.m_localAnchorA),t=this.m_groundAnchorA;return Ht.distance(i,t)};Me.prototype.getCurrentLengthB=function(){var i=this.m_bodyB.getWorldPoint(this.m_localAnchorB),t=this.m_groundAnchorB;return Ht.distance(i,t)};Me.prototype.shiftOrigin=function(i){this.m_groundAnchorA.sub(i),this.m_groundAnchorB.sub(i)};Me.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)};Me.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)};Me.prototype.getReactionForce=function(i){return Ht.mul(this.m_impulse,this.m_uB).mul(i)};Me.prototype.getReactionTorque=function(i){return 0};Me.prototype.initVelocityConstraints=function(i){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,r=this.m_bodyB.c_position.c,a=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,l=xs.neo(e),u=xs.neo(a);this.m_rA=xs.mulVec2(l,Ht.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=xs.mulVec2(u,Ht.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=Ht.sub(Ht.add(t,this.m_rA),this.m_groundAnchorA),this.m_uB=Ht.sub(Ht.add(r,this.m_rB),this.m_groundAnchorB);var m=this.m_uA.length(),p=this.m_uB.length();m>10*Bo.linearSlop?this.m_uA.mul(1/m):this.m_uA.setZero(),p>10*Bo.linearSlop?this.m_uB.mul(1/p):this.m_uB.setZero();var c=Ht.cross(this.m_rA,this.m_uA),f=Ht.cross(this.m_rB,this.m_uB),d=this.m_invMassA+this.m_invIA*c*c,y=this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=d+this.m_ratio*this.m_ratio*y,this.m_mass>0&&(this.m_mass=1/this.m_mass),i.warmStarting){this.m_impulse*=i.dtRatio;var _=Ht.mul(-this.m_impulse,this.m_uA),v=Ht.mul(-this.m_ratio*this.m_impulse,this.m_uB);n.addMul(this.m_invMassA,_),s+=this.m_invIA*Ht.cross(this.m_rA,_),h.addMul(this.m_invMassB,v),o+=this.m_invIB*Ht.cross(this.m_rB,v)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=h,this.m_bodyB.c_velocity.w=o};Me.prototype.solveVelocityConstraints=function(i){var t=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,r=Ht.add(t,Ht.cross(e,this.m_rA)),a=Ht.add(n,Ht.cross(s,this.m_rB)),h=-Ht.dot(this.m_uA,r)-this.m_ratio*Ht.dot(this.m_uB,a),o=-this.m_mass*h;this.m_impulse+=o;var l=Ht.mul(-o,this.m_uA),u=Ht.mul(-this.m_ratio*o,this.m_uB);t.addMul(this.m_invMassA,l),e+=this.m_invIA*Ht.cross(this.m_rA,l),n.addMul(this.m_invMassB,u),s+=this.m_invIB*Ht.cross(this.m_rB,u),this.m_bodyA.c_velocity.v=t,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=s};Me.prototype.solvePositionConstraints=function(i){var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,r=xs.neo(e),a=xs.neo(s),h=xs.mulVec2(r,Ht.sub(this.m_localAnchorA,this.m_localCenterA)),o=xs.mulVec2(a,Ht.sub(this.m_localAnchorB,this.m_localCenterB)),l=Ht.sub(Ht.add(t,this.m_rA),this.m_groundAnchorA),u=Ht.sub(Ht.add(n,this.m_rB),this.m_groundAnchorB),m=l.length(),p=u.length();m>10*Bo.linearSlop?l.mul(1/m):l.setZero(),p>10*Bo.linearSlop?u.mul(1/p):u.setZero();var c=Ht.cross(h,l),f=Ht.cross(o,u),d=this.m_invMassA+this.m_invIA*c*c,y=this.m_invMassB+this.m_invIB*f*f,_=d+this.m_ratio*this.m_ratio*y;_>0&&(_=1/_);var v=this.m_constant-m-this.m_ratio*p,g=To.abs(v),x=-_*v,A=Ht.mul(-x,l),b=Ht.mul(-this.m_ratio*x,u);return t.addMul(this.m_invMassA,A),e+=this.m_invIA*Ht.cross(h,A),n.addMul(this.m_invMassB,b),s+=this.m_invIB*Ht.cross(o,b),this.m_bodyA.c_position.c=t,this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=s,g<Bo.linearSlop};var qv=Oe,Jv=Wi,Ul=je,Ym=de.exports,ei=Yt,As=Ve,Hl=Vi,qm=Fi,Jm=0,$v=2;Oe.TYPE="rope-joint";Hl.TYPES[Oe.TYPE]=Oe;Oe._super=Hl;Oe.prototype=Object.create(Oe._super.prototype);var Xv={maxLength:0};function Oe(i,t,e,n){if(!(this instanceof Oe))return new Oe(i,t,e,n);i=Jv(i,Xv),Hl.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=Oe.TYPE,this.m_localAnchorA=n?t.getLocalPoint(n):i.localAnchorA||ei.neo(-1,0),this.m_localAnchorB=n?e.getLocalPoint(n):i.localAnchorB||ei.neo(1,0),this.m_maxLength=i.maxLength,this.m_mass=0,this.m_impulse=0,this.m_length=0,this.m_state=Jm,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}Oe.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}};Oe._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(qm,i.bodyA,t),i.bodyB=e(qm,i.bodyB,t);var n=new Oe(i);return n};Oe.prototype.getLocalAnchorA=function(){return this.m_localAnchorA};Oe.prototype.getLocalAnchorB=function(){return this.m_localAnchorB};Oe.prototype.setMaxLength=function(i){this.m_maxLength=i};Oe.prototype.getMaxLength=function(){return this.m_maxLength};Oe.prototype.getLimitState=function(){return this.m_state};Oe.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)};Oe.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)};Oe.prototype.getReactionForce=function(i){return ei.mul(this.m_impulse,this.m_u).mul(i)};Oe.prototype.getReactionTorque=function(i){return 0};Oe.prototype.initVelocityConstraints=function(i){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,r=this.m_bodyB.c_position.c,a=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,l=As.neo(e),u=As.neo(a);this.m_rA=As.mulSub(l,this.m_localAnchorA,this.m_localCenterA),this.m_rB=As.mulSub(u,this.m_localAnchorB,this.m_localCenterB),this.m_u=ei.zero(),this.m_u.addCombine(1,r,1,this.m_rB),this.m_u.subCombine(1,t,1,this.m_rA),this.m_length=this.m_u.length();var m=this.m_length-this.m_maxLength;if(m>0?this.m_state=$v:this.m_state=Jm,this.m_length>Ul.linearSlop)this.m_u.mul(1/this.m_length);else{this.m_u.setZero(),this.m_mass=0,this.m_impulse=0;return}var p=ei.cross(this.m_rA,this.m_u),c=ei.cross(this.m_rB,this.m_u),f=this.m_invMassA+this.m_invIA*p*p+this.m_invMassB+this.m_invIB*c*c;if(this.m_mass=f!=0?1/f:0,i.warmStarting){this.m_impulse*=i.dtRatio;var d=ei.mul(this.m_impulse,this.m_u);n.subMul(this.m_invMassA,d),s-=this.m_invIA*ei.cross(this.m_rA,d),h.addMul(this.m_invMassB,d),o+=this.m_invIB*ei.cross(this.m_rB,d)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(n),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(h),this.m_bodyB.c_velocity.w=o};Oe.prototype.solveVelocityConstraints=function(i){var t=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,r=ei.addCross(t,e,this.m_rA),a=ei.addCross(n,s,this.m_rB),h=this.m_length-this.m_maxLength,o=ei.dot(this.m_u,ei.sub(a,r));h<0&&(o+=i.inv_dt*h);var l=-this.m_mass*o,u=this.m_impulse;this.m_impulse=Ym.min(0,this.m_impulse+l),l=this.m_impulse-u;var m=ei.mul(l,this.m_u);t.subMul(this.m_invMassA,m),e-=this.m_invIA*ei.cross(this.m_rA,m),n.addMul(this.m_invMassB,m),s+=this.m_invIB*ei.cross(this.m_rB,m),this.m_bodyA.c_velocity.v=t,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=s};Oe.prototype.solvePositionConstraints=function(i){var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,r=As.neo(e),a=As.neo(s),h=As.mulSub(r,this.m_localAnchorA,this.m_localCenterA),o=As.mulSub(a,this.m_localAnchorB,this.m_localCenterB),l=ei.zero();l.addCombine(1,n,1,o),l.subCombine(1,t,1,h);var u=l.normalize(),m=u-this.m_maxLength;m=Ym.clamp(m,0,Ul.maxLinearCorrection);var p=-this.m_mass*m,c=ei.mul(p,l);return t.subMul(this.m_invMassA,c),e-=this.m_invIA*ei.cross(h,c),n.addMul(this.m_invMassB,c),s+=this.m_invIB*ei.cross(o,c),this.m_bodyA.c_position.c.set(t),this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c.set(n),this.m_bodyB.c_position.a=s,u-this.m_maxLength<Ul.linearSlop};var jv=Be,Zv=Wi,$m=je,Gl=de.exports,he=Yt,yr=cr,Co=_a,bs=Ve,kl=Vi,Xm=Fi;Be.TYPE="weld-joint";kl.TYPES[Be.TYPE]=Be;Be._super=kl;Be.prototype=Object.create(Be._super.prototype);var Kv={frequencyHz:0,dampingRatio:0};function Be(i,t,e,n){if(!(this instanceof Be))return new Be(i,t,e,n);i=Zv(i,Kv),kl.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=Be.TYPE,this.m_localAnchorA=he.clone(n?t.getLocalPoint(n):i.localAnchorA||he.zero()),this.m_localAnchorB=he.clone(n?e.getLocalPoint(n):i.localAnchorB||he.zero()),this.m_referenceAngle=Gl.isFinite(i.referenceAngle)?i.referenceAngle:e.getAngle()-t.getAngle(),this.m_frequencyHz=i.frequencyHz,this.m_dampingRatio=i.dampingRatio,this.m_impulse=yr(),this.m_bias=0,this.m_gamma=0,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new Co}Be.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}};Be._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(Xm,i.bodyA,t),i.bodyB=e(Xm,i.bodyB,t);var n=new Be(i);return n};Be.prototype._setAnchors=function(i){i.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(i.anchorA)):i.localAnchorA&&this.m_localAnchorA.set(i.localAnchorA),i.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(i.anchorB)):i.localAnchorB&&this.m_localAnchorB.set(i.localAnchorB)};Be.prototype.getLocalAnchorA=function(){return this.m_localAnchorA};Be.prototype.getLocalAnchorB=function(){return this.m_localAnchorB};Be.prototype.getReferenceAngle=function(){return this.m_referenceAngle};Be.prototype.setFrequency=function(i){this.m_frequencyHz=i};Be.prototype.getFrequency=function(){return this.m_frequencyHz};Be.prototype.setDampingRatio=function(i){this.m_dampingRatio=i};Be.prototype.getDampingRatio=function(){return this.m_dampingRatio};Be.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)};Be.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)};Be.prototype.getReactionForce=function(i){return he.neo(this.m_impulse.x,this.m_impulse.y).mul(i)};Be.prototype.getReactionTorque=function(i){return i*this.m_impulse.z};Be.prototype.initVelocityConstraints=function(i){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,r=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=bs.neo(t),o=bs.neo(s);this.m_rA=bs.mulVec2(h,he.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=bs.mulVec2(o,he.sub(this.m_localAnchorB,this.m_localCenterB));var l=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,p=this.m_invIB,c=new Co;if(c.ex.x=l+u+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*p,c.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*p,c.ez.x=-this.m_rA.y*m-this.m_rB.y*p,c.ex.y=c.ey.x,c.ey.y=l+u+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*p,c.ez.y=this.m_rA.x*m+this.m_rB.x*p,c.ex.z=c.ez.x,c.ey.z=c.ez.y,c.ez.z=m+p,this.m_frequencyHz>0){c.getInverse22(this.m_mass);var f=m+p,d=f>0?1/f:0,y=s-t-this.m_referenceAngle,_=2*Gl.PI*this.m_frequencyHz,v=2*d*this.m_dampingRatio*_,g=d*_*_,x=i.dt;this.m_gamma=x*(v+x*g),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=y*x*g*this.m_gamma,f+=this.m_gamma,this.m_mass.ez.z=f!=0?1/f:0}else c.ez.z==0?(c.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(c.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(i.warmStarting){this.m_impulse.mul(i.dtRatio);var A=he.neo(this.m_impulse.x,this.m_impulse.y);e.subMul(l,A),n-=m*(he.cross(this.m_rA,A)+this.m_impulse.z),r.addMul(u,A),a+=p*(he.cross(this.m_rB,A)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=r,this.m_bodyB.c_velocity.w=a};Be.prototype.solveVelocityConstraints=function(i){var t=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,r=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,o=this.m_invIB;if(this.m_frequencyHz>0){var l=s-e,u=-this.m_mass.ez.z*(l+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=u,e-=h*u,s+=o*u;var m=he.zero();m.addCombine(1,n,1,he.cross(s,this.m_rB)),m.subCombine(1,t,1,he.cross(e,this.m_rA));var p=he.neg(Co.mulVec2(this.m_mass,m));this.m_impulse.x+=p.x,this.m_impulse.y+=p.y;var c=he.clone(p);t.subMul(r,c),e-=h*he.cross(this.m_rA,c),n.addMul(a,c),s+=o*he.cross(this.m_rB,c)}else{var m=he.zero();m.addCombine(1,n,1,he.cross(s,this.m_rB)),m.subCombine(1,t,1,he.cross(e,this.m_rA));var l=s-e,f=yr(m.x,m.y,l),d=yr.neg(Co.mulVec3(this.m_mass,f));this.m_impulse.add(d);var c=he.neo(d.x,d.y);t.subMul(r,c),e-=h*(he.cross(this.m_rA,c)+d.z),n.addMul(a,c),s+=o*(he.cross(this.m_rB,c)+d.z)}this.m_bodyA.c_velocity.v=t,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=s};Be.prototype.solvePositionConstraints=function(i){var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,r=bs.neo(e),a=bs.neo(s),h=this.m_invMassA,o=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=bs.mulVec2(r,he.sub(this.m_localAnchorA,this.m_localCenterA)),p=bs.mulVec2(a,he.sub(this.m_localAnchorB,this.m_localCenterB)),c,f,d=new Co;if(d.ex.x=h+o+m.y*m.y*l+p.y*p.y*u,d.ey.x=-m.y*m.x*l-p.y*p.x*u,d.ez.x=-m.y*l-p.y*u,d.ex.y=d.ey.x,d.ey.y=h+o+m.x*m.x*l+p.x*p.x*u,d.ez.y=m.x*l+p.x*u,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=l+u,this.m_frequencyHz>0){var y=he.zero();y.addCombine(1,n,1,p),y.subCombine(1,t,1,m),c=y.length(),f=0;var _=he.neg(d.solve22(y));t.subMul(h,_),e-=l*he.cross(m,_),n.addMul(o,_),s+=u*he.cross(p,_)}else{var y=he.zero();y.addCombine(1,n,1,p),y.subCombine(1,t,1,m);var v=s-e-this.m_referenceAngle;c=y.length(),f=Gl.abs(v);var g=yr(y.x,y.y,v),x=yr();if(d.ez.z>0)x=yr.neg(d.solve33(g));else{var A=he.neg(d.solve22(y));x.set(A.x,A.y,0)}var _=he.neo(x.x,x.y);t.subMul(h,_),e-=l*(he.cross(m,_)+x.z),n.addMul(o,_),s+=u*(he.cross(p,_)+x.z)}return this.m_bodyA.c_position.c=t,this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=s,c<=$m.linearSlop&&f<=$m.angularSlop};var Qv=te,ty=Wi,ey=je,Wl=de.exports,Qt=Yt,Tn=Ve,Yl=Vi,jm=Fi;te.TYPE="wheel-joint";Yl.TYPES[te.TYPE]=te;te._super=Yl;te.prototype=Object.create(te._super.prototype);var iy={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7};function te(i,t,e,n,s){if(!(this instanceof te))return new te(i,t,e,n,s);i=ty(i,iy),Yl.call(this,i,t,e),t=this.m_bodyA,e=this.m_bodyB,this.m_type=te.TYPE,this.m_localAnchorA=Qt.clone(n?t.getLocalPoint(n):i.localAnchorA||Qt.zero()),this.m_localAnchorB=Qt.clone(n?e.getLocalPoint(n):i.localAnchorB||Qt.zero()),this.m_localXAxisA=Qt.clone(s?t.getLocalVector(s):i.localAxisA||i.localAxis||Qt.neo(1,0)),this.m_localYAxisA=Qt.cross(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=i.maxMotorTorque,this.m_motorSpeed=i.motorSpeed,this.m_enableMotor=i.enableMotor,this.m_frequencyHz=i.frequencyHz,this.m_dampingRatio=i.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_ax=Qt.zero(),this.m_ay=Qt.zero(),this.m_sAx,this.m_sBx,this.m_sAy,this.m_sBy}te.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}};te._deserialize=function(i,t,e){i=Object.assign({},i),i.bodyA=e(jm,i.bodyA,t),i.bodyB=e(jm,i.bodyB,t);var n=new te(i);return n};te.prototype._setAnchors=function(i){i.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(i.anchorA)):i.localAnchorA&&this.m_localAnchorA.set(i.localAnchorA),i.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(i.anchorB)):i.localAnchorB&&this.m_localAnchorB.set(i.localAnchorB),i.localAxisA&&(this.m_localXAxisA.set(i.localAxisA),this.m_localYAxisA.set(Qt.cross(1,i.localAxisA)))};te.prototype.getLocalAnchorA=function(){return this.m_localAnchorA};te.prototype.getLocalAnchorB=function(){return this.m_localAnchorB};te.prototype.getLocalAxisA=function(){return this.m_localXAxisA};te.prototype.getJointTranslation=function(){var i=this.m_bodyA,t=this.m_bodyB,e=i.getWorldPoint(this.m_localAnchorA),n=t.getWorldPoint(this.m_localAnchorB),s=Qt.sub(n,e),r=i.getWorldVector(this.m_localXAxisA),a=Qt.dot(s,r);return a};te.prototype.getJointSpeed=function(){var i=this.m_bodyA.m_angularVelocity,t=this.m_bodyB.m_angularVelocity;return t-i};te.prototype.isMotorEnabled=function(){return this.m_enableMotor};te.prototype.enableMotor=function(i){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=i};te.prototype.setMotorSpeed=function(i){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=i};te.prototype.getMotorSpeed=function(){return this.m_motorSpeed};te.prototype.setMaxMotorTorque=function(i){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=i};te.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque};te.prototype.getMotorTorque=function(i){return i*this.m_motorImpulse};te.prototype.setSpringFrequencyHz=function(i){this.m_frequencyHz=i};te.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz};te.prototype.setSpringDampingRatio=function(i){this.m_dampingRatio=i};te.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio};te.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)};te.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)};te.prototype.getReactionForce=function(i){return Qt.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(i)};te.prototype.getReactionTorque=function(i){return i*this.m_motorImpulse};te.prototype.initVelocityConstraints=function(i){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_invMassA,e=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,r=this.m_bodyA.c_position.c,a=this.m_bodyA.c_position.a,h=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,l=this.m_bodyB.c_position.c,u=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,p=this.m_bodyB.c_velocity.w,c=Tn.neo(a),f=Tn.neo(u),d=Tn.mulVec2(c,Qt.sub(this.m_localAnchorA,this.m_localCenterA)),y=Tn.mulVec2(f,Qt.sub(this.m_localAnchorB,this.m_localCenterB)),_=Qt.zero();if(_.addCombine(1,l,1,y),_.subCombine(1,r,1,d),this.m_ay=Tn.mulVec2(c,this.m_localYAxisA),this.m_sAy=Qt.cross(Qt.add(_,d),this.m_ay),this.m_sBy=Qt.cross(y,this.m_ay),this.m_mass=t+e+n*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=Tn.mulVec2(c,this.m_localXAxisA),this.m_sAx=Qt.cross(Qt.add(_,d),this.m_ax),this.m_sBx=Qt.cross(y,this.m_ax);var v=t+e+n*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;if(v>0){this.m_springMass=1/v;var g=Qt.dot(_,this.m_ax),x=2*Wl.PI*this.m_frequencyHz,_=2*this.m_springMass*this.m_dampingRatio*x,A=this.m_springMass*x*x,b=i.dt;this.m_gamma=b*(_+b*A),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=g*b*A*this.m_gamma,this.m_springMass=v+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+s,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),i.warmStarting){this.m_impulse*=i.dtRatio,this.m_springImpulse*=i.dtRatio,this.m_motorImpulse*=i.dtRatio;var M=Qt.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),S=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,B=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;h.subMul(this.m_invMassA,M),o-=this.m_invIA*S,m.addMul(this.m_invMassB,M),p+=this.m_invIB*B}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(h),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=p};te.prototype.solveVelocityConstraints=function(i){var t=this.m_invMassA,e=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,r=this.m_bodyA.c_velocity.v,a=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w;{var l=Qt.dot(this.m_ax,h)-Qt.dot(this.m_ax,r)+this.m_sBx*o-this.m_sAx*a,u=-this.m_springMass*(l+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=u;var m=Qt.mul(u,this.m_ax),p=u*this.m_sAx,c=u*this.m_sBx;r.subMul(t,m),a-=n*p,h.addMul(e,m),o+=s*c}{var l=o-a-this.m_motorSpeed,u=-this.m_motorMass*l,f=this.m_motorImpulse,d=i.dt*this.m_maxMotorTorque;this.m_motorImpulse=Wl.clamp(this.m_motorImpulse+u,-d,d),u=this.m_motorImpulse-f,a-=n*u,o+=s*u}{var l=Qt.dot(this.m_ay,h)-Qt.dot(this.m_ay,r)+this.m_sBy*o-this.m_sAy*a,u=-this.m_mass*l;this.m_impulse+=u;var m=Qt.mul(u,this.m_ay),p=u*this.m_sAy,c=u*this.m_sBy;r.subMul(t,m),a-=n*p,h.addMul(e,m),o+=s*c}this.m_bodyA.c_velocity.v.set(r),this.m_bodyA.c_velocity.w=a,this.m_bodyB.c_velocity.v.set(h),this.m_bodyB.c_velocity.w=o};te.prototype.solvePositionConstraints=function(i){var t=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,r=Tn.neo(e),a=Tn.neo(s),h=Tn.mulVec2(r,Qt.sub(this.m_localAnchorA,this.m_localCenterA)),o=Tn.mulVec2(a,Qt.sub(this.m_localAnchorB,this.m_localCenterB)),l=Qt.zero();l.addCombine(1,n,1,o),l.subCombine(1,t,1,h);var u=Tn.mulVec2(r,this.m_localYAxisA),m=Qt.cross(Qt.add(l,h),u),p=Qt.cross(o,u),c=Qt.dot(l,u),f=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,d;f!=0?d=-c/f:d=0;var y=Qt.mul(d,u),_=d*m,v=d*p;return t.subMul(this.m_invMassA,y),e-=this.m_invIA*_,n.addMul(this.m_invMassB,y),s+=this.m_invIB*v,this.m_bodyA.c_position.c.set(t),this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c.set(n),this.m_bodyB.c_position.a=s,Wl.abs(c)<=ey.linearSlop};(function(i){i.internal={},i.Serializer=aa.exports,i.Math=de.exports,i.Vec2=Yt,i.Vec3=cr,i.Mat22=Ws,i.Mat33=_a,i.Transform=Li,i.Rot=Ve,i.AABB=ha,i.Shape=Gs,i.Fixture=el,i.Body=Fi,i.Contact=us,i.Joint=Vi,i.World=$u,i.Circle=Ma,i.Edge=wa,i.Polygon=vo,i.Chain=vl,i.Box=W_,i.internal.CollidePolygons=tv,i.DistanceJoint=pv,i.FrictionJoint=_v,i.GearJoint=Lv,i.MotorJoint=Dv,i.MouseJoint=Vv,i.PrismaticJoint=Rm,i.PulleyJoint=Gv,i.RevoluteJoint=Pm,i.RopeJoint=qv,i.WeldJoint=jv,i.WheelJoint=Qv,i.Settings=je,i.internal.Sweep=jh,i.internal.stats=da,i.internal.Manifold=an.exports,i.internal.Distance=Xn.exports,i.internal.TimeOfImpact=uo.exports,i.internal.DynamicTree=yu,i.internal.Settings=i.Settings})(Td);var Zm={exports:{}};/*!
 * 
 * Planck.js v0.3.29
 * @license The MIT license
 * @copyright Copyright (c) 2021 Erin Catto, Ali Shakiba
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */(function(i,t){(function(n,s){i.exports=s()})(window,function(){return function(e){var n={};function s(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=e,s.c=n,s.d=function(r,a,h){s.o(r,a)||Object.defineProperty(r,a,{enumerable:!0,get:h})},s.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},s.t=function(r,a){if(a&1&&(r=s(r)),a&8||a&4&&typeof r=="object"&&r&&r.__esModule)return r;var h=Object.create(null);if(s.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:r}),a&2&&typeof r!="string")for(var o in r)s.d(h,o,function(l){return r[l]}.bind(null,o));return h},s.n=function(r){var a=r&&r.__esModule?function(){return r.default}:function(){return r};return s.d(a,"a",a),a},s.o=function(r,a){return Object.prototype.hasOwnProperty.call(r,a)},s.p="",s(s.s=62)}([function(e,n,s){e.exports=a,s(2);var r=s(1);function a(h,o){if(!(this instanceof a))return new a(h,o);typeof h=="undefined"?(this.x=0,this.y=0):typeof h=="object"?(this.x=h.x,this.y=h.y):(this.x=h,this.y=o)}a.prototype._serialize=function(){return{x:this.x,y:this.y}},a._deserialize=function(h){var o=Object.create(a.prototype);return o.x=h.x,o.y=h.y,o},a.zero=function(){var h=Object.create(a.prototype);return h.x=0,h.y=0,h},a.neo=function(h,o){var l=Object.create(a.prototype);return l.x=h,l.y=o,l},a.clone=function(h){return a.neo(h.x,h.y)},a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(h){return h&&r.isFinite(h.x)&&r.isFinite(h.y)},a.assert=function(h){},a.prototype.clone=function(){return a.clone(this)},a.prototype.setZero=function(){return this.x=0,this.y=0,this},a.prototype.set=function(h,o){return typeof h=="object"?(this.x=h.x,this.y=h.y):(this.x=h,this.y=o),this},a.prototype.wSet=function(h,o,l,u){return typeof l!="undefined"||typeof u!="undefined"?this.setCombine(h,o,l,u):this.setMul(h,o)},a.prototype.setCombine=function(h,o,l,u){var m=h*o.x+l*u.x,p=h*o.y+l*u.y;return this.x=m,this.y=p,this},a.prototype.setMul=function(h,o){var l=h*o.x,u=h*o.y;return this.x=l,this.y=u,this},a.prototype.add=function(h){return this.x+=h.x,this.y+=h.y,this},a.prototype.wAdd=function(h,o,l,u){return typeof l!="undefined"||typeof u!="undefined"?this.addCombine(h,o,l,u):this.addMul(h,o)},a.prototype.addCombine=function(h,o,l,u){var m=h*o.x+l*u.x,p=h*o.y+l*u.y;return this.x+=m,this.y+=p,this},a.prototype.addMul=function(h,o){var l=h*o.x,u=h*o.y;return this.x+=l,this.y+=u,this},a.prototype.wSub=function(h,o,l,u){return typeof l!="undefined"||typeof u!="undefined"?this.subCombine(h,o,l,u):this.subMul(h,o)},a.prototype.subCombine=function(h,o,l,u){var m=h*o.x+l*u.x,p=h*o.y+l*u.y;return this.x-=m,this.y-=p,this},a.prototype.subMul=function(h,o){var l=h*o.x,u=h*o.y;return this.x-=l,this.y-=u,this},a.prototype.sub=function(h){return this.x-=h.x,this.y-=h.y,this},a.prototype.mul=function(h){return this.x*=h,this.y*=h,this},a.prototype.length=function(){return a.lengthOf(this)},a.prototype.lengthSquared=function(){return a.lengthSquared(this)},a.prototype.normalize=function(){var h=this.length();if(h<r.EPSILON)return 0;var o=1/h;return this.x*=o,this.y*=o,h},a.lengthOf=function(h){return r.sqrt(h.x*h.x+h.y*h.y)},a.lengthSquared=function(h){return h.x*h.x+h.y*h.y},a.distance=function(h,o){var l=h.x-o.x,u=h.y-o.y;return r.sqrt(l*l+u*u)},a.distanceSquared=function(h,o){var l=h.x-o.x,u=h.y-o.y;return l*l+u*u},a.areEqual=function(h,o){return h==o||typeof o=="object"&&o!==null&&h.x===o.x&&h.y===o.y},a.skew=function(h){return a.neo(-h.y,h.x)},a.dot=function(h,o){return h.x*o.x+h.y*o.y},a.cross=function(h,o){return typeof o=="number"?a.neo(o*h.y,-o*h.x):typeof h=="number"?a.neo(-h*o.y,h*o.x):h.x*o.y-h.y*o.x},a.addCross=function(h,o,l){if(typeof l=="number")return a.neo(l*o.y+h.x,-l*o.x+h.y);if(typeof o=="number")return a.neo(-o*l.y+h.x,o*l.x+h.y)},a.add=function(h,o){return a.neo(h.x+o.x,h.y+o.y)},a.wAdd=function(h,o,l,u){return typeof l!="undefined"||typeof u!="undefined"?a.combine(h,o,l,u):a.mul(h,o)},a.combine=function(h,o,l,u){return a.zero().setCombine(h,o,l,u)},a.sub=function(h,o){return a.neo(h.x-o.x,h.y-o.y)},a.mul=function(h,o){if(typeof h=="object")return a.neo(h.x*o,h.y*o);if(typeof o=="object")return a.neo(h*o.x,h*o.y)},a.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},a.neg=function(h){return a.neo(-h.x,-h.y)},a.abs=function(h){return a.neo(r.abs(h.x),r.abs(h.y))},a.mid=function(h,o){return a.neo((h.x+o.x)*.5,(h.y+o.y)*.5)},a.upper=function(h,o){return a.neo(r.max(h.x,o.x),r.max(h.y,o.y))},a.lower=function(h,o){return a.neo(r.min(h.x,o.x),r.min(h.y,o.y))},a.prototype.clamp=function(h){var o=this.x*this.x+this.y*this.y;if(o>h*h){var l=r.invSqrt(o);this.x*=l*h,this.y*=l*h}return this},a.clamp=function(h,o){return h=a.neo(h.x,h.y),h.clamp(o),h},a.scaleFn=function(h,o){return function(l){return a.neo(l.x*h,l.y*o)}},a.translateFn=function(h,o){return function(l){return a.neo(l.x+h,l.y+o)}}},function(e,n,s){s(2);var r=Math,a=e.exports=Object.create(r);a.EPSILON=1e-9,a.isFinite=function(h){return typeof h=="number"&&isFinite(h)&&!isNaN(h)},a.assert=function(h){},a.invSqrt=function(h){return 1/r.sqrt(h)},a.nextPowerOfTwo=function(h){return h|=h>>1,h|=h>>2,h|=h>>4,h|=h>>8,h|=h>>16,h+1},a.isPowerOfTwo=function(h){return h>0&&(h&h-1)==0},a.mod=function(h,o,l){return typeof o=="undefined"?(l=1,o=0):typeof l=="undefined"&&(l=o,o=0),l>o?(h=(h-o)%(l-o),h+(h<0?l:o)):(h=(h-l)%(o-l),h+(h<=0?o:l))},a.clamp=function(h,o,l){return h<o?o:h>l?l:h},a.random=function(h,o){return typeof h=="undefined"?(o=1,h=0):typeof o=="undefined"&&(o=h,h=0),h==o?h:r.random()*(o-h)+h}},function(e,n,s){n.debug=function(){},n.assert=function(r,a,h){}},function(e,n,s){e.exports=h,s(2);var r=s(0),a=s(1);function h(o){if(!(this instanceof h))return new h(o);typeof o=="number"?this.setAngle(o):typeof o=="object"?this.set(o):this.setIdentity()}h.neo=function(o){var l=Object.create(h.prototype);return l.setAngle(o),l},h.clone=function(o){var l=Object.create(h.prototype);return l.s=o.s,l.c=o.c,l},h.identity=function(){var o=Object.create(h.prototype);return o.s=0,o.c=1,o},h.isValid=function(o){return o&&a.isFinite(o.s)&&a.isFinite(o.c)},h.assert=function(o){},h.prototype.setIdentity=function(){this.s=0,this.c=1},h.prototype.set=function(o){typeof o=="object"?(this.s=o.s,this.c=o.c):(this.s=a.sin(o),this.c=a.cos(o))},h.prototype.setAngle=function(o){this.s=a.sin(o),this.c=a.cos(o)},h.prototype.getAngle=function(){return a.atan2(this.s,this.c)},h.prototype.getXAxis=function(){return r.neo(this.c,this.s)},h.prototype.getYAxis=function(){return r.neo(-this.s,this.c)},h.mul=function(o,l){if("c"in l&&"s"in l){var u=h.identity();return u.s=o.s*l.c+o.c*l.s,u.c=o.c*l.c-o.s*l.s,u}else if("x"in l&&"y"in l)return r.neo(o.c*l.x-o.s*l.y,o.s*l.x+o.c*l.y)},h.mulRot=function(o,l){var u=h.identity();return u.s=o.s*l.c+o.c*l.s,u.c=o.c*l.c-o.s*l.s,u},h.mulVec2=function(o,l){return r.neo(o.c*l.x-o.s*l.y,o.s*l.x+o.c*l.y)},h.mulSub=function(o,l,u){var m=o.c*(l.x-u.x)-o.s*(l.y-u.y),p=o.s*(l.x-u.x)+o.c*(l.y-u.y);return r.neo(m,p)},h.mulT=function(o,l){if("c"in l&&"s"in l){var u=h.identity();return u.s=o.c*l.s-o.s*l.c,u.c=o.c*l.c+o.s*l.s,u}else if("x"in l&&"y"in l)return r.neo(o.c*l.x+o.s*l.y,-o.s*l.x+o.c*l.y)},h.mulTRot=function(o,l){var u=h.identity();return u.s=o.c*l.s-o.s*l.c,u.c=o.c*l.c+o.s*l.s,u},h.mulTVec2=function(o,l){return r.neo(o.c*l.x+o.s*l.y,-o.s*l.x+o.c*l.y)}},function(e,n,s){var r=n;r.maxManifoldPoints=2,r.maxPolygonVertices=12,r.aabbExtension=.1,r.aabbMultiplier=2,r.linearSlop=.005,r.linearSlopSquared=r.linearSlop*r.linearSlop,r.angularSlop=2/180*Math.PI,r.polygonRadius=2*r.linearSlop,r.maxSubSteps=8,r.maxTOIContacts=32,r.maxTOIIterations=20,r.maxDistnceIterations=20,r.velocityThreshold=1,r.maxLinearCorrection=.2,r.maxAngularCorrection=8/180*Math.PI,r.maxTranslation=2,r.maxTranslationSquared=r.maxTranslation*r.maxTranslation,r.maxRotation=.5*Math.PI,r.maxRotationSquared=r.maxRotation*r.maxRotation,r.baumgarte=.2,r.toiBaugarte=.75,r.timeToSleep=.5,r.linearSleepTolerance=.01,r.linearSleepToleranceSqr=Math.pow(r.linearSleepTolerance,2),r.angularSleepTolerance=2/180*Math.PI,r.angularSleepToleranceSqr=Math.pow(r.angularSleepTolerance,2)},function(e,n,s){e.exports=h,s(2);var r=s(0),a=s(3);function h(o,l){if(!(this instanceof h))return new h(o,l);this.p=r.zero(),this.q=a.identity(),typeof o!="undefined"&&this.p.set(o),typeof l!="undefined"&&this.q.set(l)}h.clone=function(o){var l=Object.create(h.prototype);return l.p=r.clone(o.p),l.q=a.clone(o.q),l},h.neo=function(o,l){var u=Object.create(h.prototype);return u.p=r.clone(o),u.q=a.clone(l),u},h.identity=function(){var o=Object.create(h.prototype);return o.p=r.zero(),o.q=a.identity(),o},h.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},h.prototype.set=function(o,l){typeof l=="undefined"?(this.p.set(o.p),this.q.set(o.q)):(this.p.set(o),this.q.set(l))},h.isValid=function(o){return o&&r.isValid(o.p)&&a.isValid(o.q)},h.assert=function(o){},h.mul=function(o,l){if(Array.isArray(l)){for(var u=[],m=0;m<l.length;m++)u[m]=h.mul(o,l[m]);return u}else if("x"in l&&"y"in l){var p=o.q.c*l.x-o.q.s*l.y+o.p.x,c=o.q.s*l.x+o.q.c*l.y+o.p.y;return r.neo(p,c)}else if("p"in l&&"q"in l){var f=h.identity();return f.q=a.mulRot(o.q,l.q),f.p=r.add(a.mulVec2(o.q,l.p),o.p),f}},h.mulAll=function(o,l){for(var u=[],m=0;m<l.length;m++)u[m]=h.mul(o,l[m]);return u},h.mulFn=function(o){return function(l){return h.mul(o,l)}},h.mulVec2=function(o,l){var u=o.q.c*l.x-o.q.s*l.y+o.p.x,m=o.q.s*l.x+o.q.c*l.y+o.p.y;return r.neo(u,m)},h.mulXf=function(o,l){var u=h.identity();return u.q=a.mulRot(o.q,l.q),u.p=r.add(a.mulVec2(o.q,l.p),o.p),u},h.mulT=function(o,l){if("x"in l&&"y"in l){var u=l.x-o.p.x,m=l.y-o.p.y,p=o.q.c*u+o.q.s*m,c=-o.q.s*u+o.q.c*m;return r.neo(p,c)}else if("p"in l&&"q"in l){var f=h.identity();return f.q.set(a.mulTRot(o.q,l.q)),f.p.set(a.mulTVec2(o.q,r.sub(l.p,o.p))),f}},h.mulTVec2=function(o,l){var u=l.x-o.p.x,m=l.y-o.p.y,p=o.q.c*u+o.q.s*m,c=-o.q.s*u+o.q.c*m;return r.neo(p,c)},h.mulTXf=function(o,l){var u=h.identity();return u.q.set(a.mulTRot(o.q,l.q)),u.p.set(a.mulTVec2(o.q,r.sub(l.p,o.p))),u}},function(e,n,s){e.exports=function(r,a){(r===null||typeof r=="undefined")&&(r={});var h=Object.assign({},r);for(var o in a)a.hasOwnProperty(o)&&typeof r[o]=="undefined"&&(h[o]=a[o]);if(typeof Object.getOwnPropertySymbols=="function")for(var l=Object.getOwnPropertySymbols(a),u=0;u<l.length;u++){var m=l[u];a.propertyIsEnumerable(m)&&typeof r[o]=="undefined"&&(h[m]=a[m])}return h}},function(e,n,s){e.exports=a,s(2);var r=s(1);function a(h,o,l){if(!(this instanceof a))return new a(h,o,l);typeof h=="undefined"?(this.x=0,this.y=0,this.z=0):typeof h=="object"?(this.x=h.x,this.y=h.y,this.z=h.z):(this.x=h,this.y=o,this.z=l)}a.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},a._deserialize=function(h){var o=Object.create(a.prototype);return o.x=h.x,o.y=h.y,o.z=h.z,o},a.neo=function(h,o,l){var u=Object.create(a.prototype);return u.x=h,u.y=o,u.z=l,u},a.clone=function(h){return a.neo(h.x,h.y,h.z)},a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(h){return h&&r.isFinite(h.x)&&r.isFinite(h.y)&&r.isFinite(h.z)},a.assert=function(h){},a.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},a.prototype.set=function(h,o,l){return this.x=h,this.y=o,this.z=l,this},a.prototype.add=function(h){return this.x+=h.x,this.y+=h.y,this.z+=h.z,this},a.prototype.sub=function(h){return this.x-=h.x,this.y-=h.y,this.z-=h.z,this},a.prototype.mul=function(h){return this.x*=h,this.y*=h,this.z*=h,this},a.areEqual=function(h,o){return h==o||typeof h=="object"&&h!==null&&typeof o=="object"&&o!==null&&h.x===o.x&&h.y===o.y&&h.z===o.z},a.dot=function(h,o){return h.x*o.x+h.y*o.y+h.z*o.z},a.cross=function(h,o){return new a(h.y*o.z-h.z*o.y,h.z*o.x-h.x*o.z,h.x*o.y-h.y*o.x)},a.add=function(h,o){return new a(h.x+o.x,h.y+o.y,h.z+o.z)},a.sub=function(h,o){return new a(h.x-o.x,h.y-o.y,h.z-o.z)},a.mul=function(h,o){return new a(o*h.x,o*h.y,o*h.z)},a.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},a.neg=function(h){return new a(-h.x,-h.y,-h.z)}},function(e,n,s){e.exports=_,s(2);var r=s(6),a=s(0),h=s(3);s(1);var o=s(9),l=s(5),u=s(12),m=s(13),p=s(26);s(15);var c=_.STATIC="static",f=_.KINEMATIC="kinematic",d=_.DYNAMIC="dynamic",y={type:c,position:a.zero(),angle:0,linearVelocity:a.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null};function _(g,x){x=r(x,y),this.m_world=g,this.m_awakeFlag=x.awake,this.m_autoSleepFlag=x.allowSleep,this.m_bulletFlag=x.bullet,this.m_fixedRotationFlag=x.fixedRotation,this.m_activeFlag=x.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=x.userData,this.m_type=x.type,this.m_type==d?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=l.identity(),this.m_xf.p=a.clone(x.position),this.m_xf.q.setAngle(x.angle),this.m_sweep=new o,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new u,this.c_position=new m,this.m_force=a.zero(),this.m_torque=0,this.m_linearVelocity=a.clone(x.linearVelocity),this.m_angularVelocity=x.angularVelocity,this.m_linearDamping=x.linearDamping,this.m_angularDamping=x.angularDamping,this.m_gravityScale=x.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}_.prototype._serialize=function(){for(var g=[],x=this.m_fixtureList;x;x=x.m_next)g.push(x);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:g}},_._deserialize=function(g,x,A){var b=new _(x,g);if(g.fixtures)for(var M=g.fixtures.length-1;M>=0;M--){var S=A(p,g.fixtures[M],b);b._addFixture(S)}return b},_.prototype.isWorldLocked=function(){return!!(this.m_world&&this.m_world.isLocked())},_.prototype.getWorld=function(){return this.m_world},_.prototype.getNext=function(){return this.m_next},_.prototype.setUserData=function(g){this.m_userData=g},_.prototype.getUserData=function(){return this.m_userData},_.prototype.getFixtureList=function(){return this.m_fixtureList},_.prototype.getJointList=function(){return this.m_jointList},_.prototype.getContactList=function(){return this.m_contactList},_.prototype.isStatic=function(){return this.m_type==c},_.prototype.isDynamic=function(){return this.m_type==d},_.prototype.isKinematic=function(){return this.m_type==f},_.prototype.setStatic=function(){return this.setType(c),this},_.prototype.setDynamic=function(){return this.setType(d),this},_.prototype.setKinematic=function(){return this.setType(f),this},_.prototype.getType=function(){return this.m_type},_.prototype.setType=function(g){if(this.isWorldLocked()!=!0&&this.m_type!=g){this.m_type=g,this.resetMassData(),this.m_type==c&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var x=this.m_contactList;x;){var A=x;x=x.next,this.m_world.destroyContact(A.contact)}this.m_contactList=null;for(var b=this.m_world.m_broadPhase,M=this.m_fixtureList;M;M=M.m_next)for(var S=M.m_proxyCount,B=0;B<S;++B)b.touchProxy(M.m_proxies[B].proxyId)}},_.prototype.isBullet=function(){return this.m_bulletFlag},_.prototype.setBullet=function(g){this.m_bulletFlag=!!g},_.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},_.prototype.setSleepingAllowed=function(g){this.m_autoSleepFlag=!!g,this.m_autoSleepFlag==!1&&this.setAwake(!0)},_.prototype.isAwake=function(){return this.m_awakeFlag},_.prototype.setAwake=function(g){g?this.m_awakeFlag==!1&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},_.prototype.isActive=function(){return this.m_activeFlag},_.prototype.setActive=function(g){if(g!=this.m_activeFlag)if(this.m_activeFlag=!!g,this.m_activeFlag)for(var x=this.m_world.m_broadPhase,A=this.m_fixtureList;A;A=A.m_next)A.createProxies(x,this.m_xf);else{for(var x=this.m_world.m_broadPhase,A=this.m_fixtureList;A;A=A.m_next)A.destroyProxies(x);for(var b=this.m_contactList;b;){var M=b;b=b.next,this.m_world.destroyContact(M.contact)}this.m_contactList=null}},_.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},_.prototype.setFixedRotation=function(g){this.m_fixedRotationFlag!=g&&(this.m_fixedRotationFlag=!!g,this.m_angularVelocity=0,this.resetMassData())},_.prototype.getTransform=function(){return this.m_xf},_.prototype.setTransform=function(g,x){if(this.isWorldLocked()!=!0){this.m_xf.set(g,x),this.m_sweep.setTransform(this.m_xf);for(var A=this.m_world.m_broadPhase,b=this.m_fixtureList;b;b=b.m_next)b.synchronize(A,this.m_xf,this.m_xf)}},_.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},_.prototype.synchronizeFixtures=function(){var g=l.identity();this.m_sweep.getTransform(g,0);for(var x=this.m_world.m_broadPhase,A=this.m_fixtureList;A;A=A.m_next)A.synchronize(x,g,this.m_xf)},_.prototype.advance=function(g){this.m_sweep.advance(g),this.m_sweep.c.set(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},_.prototype.getPosition=function(){return this.m_xf.p},_.prototype.setPosition=function(g){this.setTransform(g,this.m_sweep.a)},_.prototype.getAngle=function(){return this.m_sweep.a},_.prototype.setAngle=function(g){this.setTransform(this.m_xf.p,g)},_.prototype.getWorldCenter=function(){return this.m_sweep.c},_.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},_.prototype.getLinearVelocity=function(){return this.m_linearVelocity},_.prototype.getLinearVelocityFromWorldPoint=function(g){var x=a.sub(g,this.m_sweep.c);return a.add(this.m_linearVelocity,a.cross(this.m_angularVelocity,x))},_.prototype.getLinearVelocityFromLocalPoint=function(g){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(g))},_.prototype.setLinearVelocity=function(g){this.m_type!=c&&(a.dot(g,g)>0&&this.setAwake(!0),this.m_linearVelocity.set(g))},_.prototype.getAngularVelocity=function(){return this.m_angularVelocity},_.prototype.setAngularVelocity=function(g){this.m_type!=c&&(g*g>0&&this.setAwake(!0),this.m_angularVelocity=g)},_.prototype.getLinearDamping=function(){return this.m_linearDamping},_.prototype.setLinearDamping=function(g){this.m_linearDamping=g},_.prototype.getAngularDamping=function(){return this.m_angularDamping},_.prototype.setAngularDamping=function(g){this.m_angularDamping=g},_.prototype.getGravityScale=function(){return this.m_gravityScale},_.prototype.setGravityScale=function(g){this.m_gravityScale=g},_.prototype.getMass=function(){return this.m_mass},_.prototype.getInertia=function(){return this.m_I+this.m_mass*a.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)};function v(){this.mass=0,this.center=a.zero(),this.I=0}_.prototype.getMassData=function(g){g.mass=this.m_mass,g.I=this.getInertia(),g.center.set(this.m_sweep.localCenter)},_.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic()){this.m_sweep.c0.set(this.m_xf.p),this.m_sweep.c.set(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}for(var g=a.zero(),x=this.m_fixtureList;x;x=x.m_next)if(x.m_density!=0){var A=new v;x.getMassData(A),this.m_mass+=A.mass,g.addMul(A.mass,A.center),this.m_I+=A.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,g.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&this.m_fixedRotationFlag==!1?(this.m_I-=this.m_mass*a.dot(g,g),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var b=a.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(g,this.m_xf),this.m_linearVelocity.add(a.cross(this.m_angularVelocity,a.sub(this.m_sweep.c,b)))},_.prototype.setMassData=function(g){if(this.isWorldLocked()!=!0&&this.m_type==d){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=g.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,g.I>0&&this.m_fixedRotationFlag==!1&&(this.m_I=g.I-this.m_mass*a.dot(g.center,g.center),this.m_invI=1/this.m_I);var x=a.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(g.center,this.m_xf),this.m_linearVelocity.add(a.cross(this.m_angularVelocity,a.sub(this.m_sweep.c,x)))}},_.prototype.applyForce=function(g,x,A){this.m_type==d&&(A&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(g),this.m_torque+=a.cross(a.sub(x,this.m_sweep.c),g)))},_.prototype.applyForceToCenter=function(g,x){this.m_type==d&&(x&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(g))},_.prototype.applyTorque=function(g,x){this.m_type==d&&(x&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=g))},_.prototype.applyLinearImpulse=function(g,x,A){this.m_type==d&&(A&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,g),this.m_angularVelocity+=this.m_invI*a.cross(a.sub(x,this.m_sweep.c),g)))},_.prototype.applyAngularImpulse=function(g,x){this.m_type==d&&(x&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*g))},_.prototype.shouldCollide=function(g){if(this.m_type!=d&&g.m_type!=d)return!1;for(var x=this.m_jointList;x;x=x.next)if(x.other==g&&x.joint.m_collideConnected==!1)return!1;return!0},_.prototype._addFixture=function(g){if(this.isWorldLocked()==!0)return null;if(this.m_activeFlag){var x=this.m_world.m_broadPhase;g.createProxies(x,this.m_xf)}return g.m_next=this.m_fixtureList,this.m_fixtureList=g,g.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,g},_.prototype.createFixture=function(g,x){if(this.isWorldLocked()==!0)return null;var A=new p(this,g,x);return this._addFixture(A),A},_.prototype.destroyFixture=function(g){if(this.isWorldLocked()!=!0){if(this.m_fixtureList===g)this.m_fixtureList=g.m_next;else for(var x=this.m_fixtureList;x!=null;){if(x.m_next===g){x.m_next=g.m_next;break}x=x.m_next}for(var A=this.m_contactList;A;){var b=A.contact;A=A.next;var M=b.getFixtureA(),S=b.getFixtureB();(g==M||g==S)&&this.m_world.destroyContact(b)}if(this.m_activeFlag){var B=this.m_world.m_broadPhase;g.destroyProxies(B)}g.m_body=null,g.m_next=null,this.m_world.publish("remove-fixture",g),this.resetMassData()}},_.prototype.getWorldPoint=function(g){return l.mulVec2(this.m_xf,g)},_.prototype.getWorldVector=function(g){return h.mulVec2(this.m_xf.q,g)},_.prototype.getLocalPoint=function(g){return l.mulTVec2(this.m_xf,g)},_.prototype.getLocalVector=function(g){return h.mulTVec2(this.m_xf.q,g)}},function(e,n,s){e.exports=l,s(2);var r=s(1),a=s(0),h=s(3),o=s(5);function l(u,m){this.localCenter=a.zero(),this.c=a.zero(),this.a=0,this.alpha0=0,this.c0=a.zero(),this.a0=0}l.prototype.setTransform=function(u){var m=o.mulVec2(u,this.localCenter);this.c.set(m),this.c0.set(m),this.a=u.q.getAngle(),this.a0=u.q.getAngle()},l.prototype.setLocalCenter=function(u,m){this.localCenter.set(u);var p=o.mulVec2(m,this.localCenter);this.c.set(p),this.c0.set(p)},l.prototype.getTransform=function(u,m){m=typeof m=="undefined"?0:m,u.q.setAngle((1-m)*this.a0+m*this.a),u.p.setCombine(1-m,this.c0,m,this.c),u.p.sub(h.mulVec2(u.q,this.localCenter))},l.prototype.advance=function(u){var m=(u-this.alpha0)/(1-this.alpha0);this.c0.setCombine(m,this.c,1-m,this.c0),this.a0=m*this.a+(1-m)*this.a0,this.alpha0=u},l.prototype.forward=function(){this.a0=this.a,this.c0.set(this.c)},l.prototype.normalize=function(){var u=r.mod(this.a0,-r.PI,+r.PI);this.a-=this.a0-u,this.a0=u},l.prototype.clone=function(){var u=new l;return u.localCenter.set(this.localCenter),u.alpha0=this.alpha0,u.a0=this.a0,u.a=this.a,u.c0.set(this.c0),u.c.set(this.c),u},l.prototype.set=function(u){this.localCenter.set(u.localCenter),this.alpha0=u.alpha0,this.a0=u.a0,this.a=u.a,this.c0.set(u.c0),this.c.set(u.c)}},function(e,n,s){e.exports=a,s(2),s(1);var r=s(0);function a(h,o,l,u){typeof h=="object"&&h!==null?(this.ex=r.clone(h),this.ey=r.clone(o)):typeof h=="number"?(this.ex=r.neo(h,l),this.ey=r.neo(o,u)):(this.ex=r.zero(),this.ey=r.zero())}a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(h){return h&&r.isValid(h.ex)&&r.isValid(h.ey)},a.assert=function(h){},a.prototype.set=function(h,o,l,u){typeof h=="number"&&typeof o=="number"&&typeof l=="number"&&typeof u=="number"?(this.ex.set(h,l),this.ey.set(o,u)):typeof h=="object"&&typeof o=="object"?(this.ex.set(h),this.ey.set(o)):typeof h=="object"&&(this.ex.set(h.ex),this.ey.set(h.ey))},a.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},a.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},a.prototype.getInverse=function(){var h=this.ex.x,o=this.ey.x,l=this.ex.y,u=this.ey.y,m=h*u-o*l;m!=0&&(m=1/m);var p=new a;return p.ex.x=m*u,p.ey.x=-m*o,p.ex.y=-m*l,p.ey.y=m*h,p},a.prototype.solve=function(h){var o=this.ex.x,l=this.ey.x,u=this.ex.y,m=this.ey.y,p=o*m-l*u;p!=0&&(p=1/p);var c=r.zero();return c.x=p*(m*h.x-l*h.y),c.y=p*(o*h.y-u*h.x),c},a.mul=function(h,o){if(o&&"x"in o&&"y"in o){var l=h.ex.x*o.x+h.ey.x*o.y,u=h.ex.y*o.x+h.ey.y*o.y;return r.neo(l,u)}else if(o&&"ex"in o&&"ey"in o){var m=h.ex.x*o.ex.x+h.ey.x*o.ex.y,p=h.ex.x*o.ey.x+h.ey.x*o.ey.y,c=h.ex.y*o.ex.x+h.ey.y*o.ex.y,f=h.ex.y*o.ey.x+h.ey.y*o.ey.y;return new a(m,p,c,f)}},a.mulVec2=function(h,o){var l=h.ex.x*o.x+h.ey.x*o.y,u=h.ex.y*o.x+h.ey.y*o.y;return r.neo(l,u)},a.mulMat22=function(h,o){var l=h.ex.x*o.ex.x+h.ey.x*o.ex.y,u=h.ex.x*o.ey.x+h.ey.x*o.ey.y,m=h.ex.y*o.ex.x+h.ey.y*o.ex.y,p=h.ex.y*o.ey.x+h.ey.y*o.ey.y;return new a(l,u,m,p)},a.mulT=function(h,o){if(o&&"x"in o&&"y"in o)return r.neo(r.dot(o,h.ex),r.dot(o,h.ey));if(o&&"ex"in o&&"ey"in o){var l=r.neo(r.dot(h.ex,o.ex),r.dot(h.ey,o.ex)),u=r.neo(r.dot(h.ex,o.ey),r.dot(h.ey,o.ey));return new a(l,u)}},a.mulTVec2=function(h,o){return r.neo(r.dot(o,h.ex),r.dot(o,h.ey))},a.mulTMat22=function(h,o){var l=r.neo(r.dot(h.ex,o.ex),r.dot(h.ey,o.ex)),u=r.neo(r.dot(h.ex,o.ey),r.dot(h.ey,o.ey));return new a(l,u)},a.abs=function(h){return new a(r.abs(h.ex),r.abs(h.ey))},a.add=function(h,o){return new a(r.add(h.ex,o.ex),r.add(h.ey,o.ey))}},function(e,n,s){e.exports=a,s(2);function r(){this.other=null,this.joint=null,this.prev=null,this.next=null}function a(h,o,l){o=h.bodyA||o,l=h.bodyB||l,this.m_type="unknown-joint",this.m_bodyA=o,this.m_bodyB=l,this.m_index=0,this.m_collideConnected=!!h.collideConnected,this.m_prev=null,this.m_next=null,this.m_edgeA=new r,this.m_edgeB=new r,this.m_islandFlag=!1,this.m_userData=h.userData}a.TYPES={},a._deserialize=function(h,o,l){var u=a.TYPES[h.type];return u&&l(u,h)},a.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},a.prototype.getType=function(){return this.m_type},a.prototype.getBodyA=function(){return this.m_bodyA},a.prototype.getBodyB=function(){return this.m_bodyB},a.prototype.getNext=function(){return this.m_next},a.prototype.getUserData=function(){return this.m_userData},a.prototype.setUserData=function(h){this.m_userData=h},a.prototype.getCollideConnected=function(){return this.m_collideConnected},a.prototype.getAnchorA=function(){},a.prototype.getAnchorB=function(){},a.prototype.getReactionForce=function(h){},a.prototype.getReactionTorque=function(h){},a.prototype.shiftOrigin=function(h){},a.prototype.initVelocityConstraints=function(h){},a.prototype.solveVelocityConstraints=function(h){},a.prototype.solvePositionConstraints=function(h){}},function(e,n,s){e.exports=a;var r=s(0);function a(){this.v=r.zero(),this.w=0}},function(e,n,s){e.exports=h;var r=s(0),a=s(3);function h(){this.c=r.zero(),this.a=0}h.prototype.getTransform=function(o,l){return o.q.set(this.a),o.p.set(r.sub(this.c,a.mulVec2(o.q,l))),o}},function(e,n,s){e.exports=h,s(2),s(1);var r=s(0),a=s(7);function h(o,l,u){typeof o=="object"&&o!==null?(this.ex=a.clone(o),this.ey=a.clone(l),this.ez=a.clone(u)):(this.ex=a(),this.ey=a(),this.ez=a())}h.prototype.toString=function(){return JSON.stringify(this)},h.isValid=function(o){return o&&a.isValid(o.ex)&&a.isValid(o.ey)&&a.isValid(o.ez)},h.assert=function(o){},h.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},h.prototype.solve33=function(o){var l=a.dot(this.ex,a.cross(this.ey,this.ez));l!=0&&(l=1/l);var u=new a;return u.x=l*a.dot(o,a.cross(this.ey,this.ez)),u.y=l*a.dot(this.ex,a.cross(o,this.ez)),u.z=l*a.dot(this.ex,a.cross(this.ey,o)),u},h.prototype.solve22=function(o){var l=this.ex.x,u=this.ey.x,m=this.ex.y,p=this.ey.y,c=l*p-u*m;c!=0&&(c=1/c);var f=r.zero();return f.x=c*(p*o.x-u*o.y),f.y=c*(l*o.y-m*o.x),f},h.prototype.getInverse22=function(o){var l=this.ex.x,u=this.ey.x,m=this.ex.y,p=this.ey.y,c=l*p-u*m;c!=0&&(c=1/c),o.ex.x=c*p,o.ey.x=-c*u,o.ex.z=0,o.ex.y=-c*m,o.ey.y=c*l,o.ey.z=0,o.ez.x=0,o.ez.y=0,o.ez.z=0},h.prototype.getSymInverse33=function(o){var l=a.dot(this.ex,a.cross(this.ey,this.ez));l!=0&&(l=1/l);var u=this.ex.x,m=this.ey.x,p=this.ez.x,c=this.ey.y,f=this.ez.y,d=this.ez.z;o.ex.x=l*(c*d-f*f),o.ex.y=l*(p*f-m*d),o.ex.z=l*(m*f-p*c),o.ey.x=o.ex.y,o.ey.y=l*(u*d-p*p),o.ey.z=l*(p*m-u*f),o.ez.x=o.ex.z,o.ez.y=o.ey.z,o.ez.z=l*(u*c-m*m)},h.mul=function(o,l){if(l&&"z"in l&&"y"in l&&"x"in l){var u=o.ex.x*l.x+o.ey.x*l.y+o.ez.x*l.z,m=o.ex.y*l.x+o.ey.y*l.y+o.ez.y*l.z,p=o.ex.z*l.x+o.ey.z*l.y+o.ez.z*l.z;return new a(u,m,p)}else if(l&&"y"in l&&"x"in l){var u=o.ex.x*l.x+o.ey.x*l.y,m=o.ex.y*l.x+o.ey.y*l.y;return r.neo(u,m)}},h.mulVec3=function(o,l){var u=o.ex.x*l.x+o.ey.x*l.y+o.ez.x*l.z,m=o.ex.y*l.x+o.ey.y*l.y+o.ez.y*l.z,p=o.ex.z*l.x+o.ey.z*l.y+o.ez.z*l.z;return new a(u,m,p)},h.mulVec2=function(o,l){var u=o.ex.x*l.x+o.ey.x*l.y,m=o.ex.y*l.x+o.ey.y*l.y;return r.neo(u,m)},h.add=function(o,l){return new h(a.add(o.ex,l.ex),a.add(o.ey,l.ey),a.add(o.ez,l.ez))}},function(e,n,s){e.exports=r,s(1);function r(){this.m_type,this.m_radius}r.prototype._reset=function(){},r.prototype._serialize=function(){return{}},r.TYPES={},r._deserialize=function(a,h,o){var l=r.TYPES[a.type];return l&&o(l,a)},r.isValid=function(a){return!!a},r.prototype.getRadius=function(){return this.m_radius},r.prototype.getType=function(){return this.m_type},r.prototype._clone=function(){},r.prototype.getChildCount=function(){},r.prototype.testPoint=function(a,h){},r.prototype.rayCast=function(a,h,o,l){},r.prototype.computeAABB=function(a,h,o){},r.prototype.computeMass=function(a,h){},r.prototype.computeDistanceProxy=function(a){}},function(e,n,s){s(4),s(2);var r=s(1),a=s(0);e.exports=h;function h(o,l){if(!(this instanceof h))return new h(o,l);this.lowerBound=a.zero(),this.upperBound=a.zero(),typeof o=="object"&&this.lowerBound.set(o),typeof l=="object"?this.upperBound.set(l):typeof o=="object"&&this.upperBound.set(o)}h.prototype.isValid=function(){return h.isValid(this)},h.isValid=function(o){var l=a.sub(o.upperBound,o.lowerBound),u=l.x>=0&&l.y>=0&&a.isValid(o.lowerBound)&&a.isValid(o.upperBound);return u},h.assert=function(o){},h.prototype.getCenter=function(){return a.neo((this.lowerBound.x+this.upperBound.x)*.5,(this.lowerBound.y+this.upperBound.y)*.5)},h.prototype.getExtents=function(){return a.neo((this.upperBound.x-this.lowerBound.x)*.5,(this.upperBound.y-this.lowerBound.y)*.5)},h.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},h.prototype.combine=function(o,l){l=l||this;var u=o.lowerBound,m=o.upperBound,p=l.lowerBound,c=l.upperBound,f=r.min(u.x,p.x),d=r.min(u.y,p.y),y=r.max(c.x,m.x),_=r.max(c.y,m.y);this.lowerBound.set(f,d),this.upperBound.set(y,_)},h.prototype.combinePoints=function(o,l){this.lowerBound.set(r.min(o.x,l.x),r.min(o.y,l.y)),this.upperBound.set(r.max(o.x,l.x),r.max(o.y,l.y))},h.prototype.set=function(o){this.lowerBound.set(o.lowerBound.x,o.lowerBound.y),this.upperBound.set(o.upperBound.x,o.upperBound.y)},h.prototype.contains=function(o){var l=!0;return l=l&&this.lowerBound.x<=o.lowerBound.x,l=l&&this.lowerBound.y<=o.lowerBound.y,l=l&&o.upperBound.x<=this.upperBound.x,l=l&&o.upperBound.y<=this.upperBound.y,l},h.prototype.extend=function(o){return h.extend(this,o),this},h.extend=function(o,l){o.lowerBound.x-=l,o.lowerBound.y-=l,o.upperBound.x+=l,o.upperBound.y+=l},h.testOverlap=function(o,l){var u=l.lowerBound.x-o.upperBound.x,m=o.lowerBound.x-l.upperBound.x,p=l.lowerBound.y-o.upperBound.y,c=o.lowerBound.y-l.upperBound.y;return!(u>0||p>0||m>0||c>0)},h.areEqual=function(o,l){return a.areEqual(o.lowerBound,l.lowerBound)&&a.areEqual(o.upperBound,l.upperBound)},h.diff=function(o,l){var u=r.max(0,r.min(o.upperBound.x,l.upperBound.x)-r.max(l.lowerBound.x,o.lowerBound.x)),m=r.max(0,r.min(o.upperBound.y,l.upperBound.y)-r.max(l.lowerBound.y,o.lowerBound.y)),p=o.upperBound.x-o.lowerBound.x,c=o.upperBound.y-o.lowerBound.y,f=l.upperBound.x-l.lowerBound.x,d=l.upperBound.y-l.lowerBound.y;return p*c+f*d-u*m},h.prototype.rayCast=function(o,l){for(var u=-1/0,m=1/0,p=l.p1,c=a.sub(l.p2,l.p1),f=a.abs(c),d=a.zero(),y="x";y!==null;y=y==="x"?"y":null)if(f.x<r.EPSILON){if(p[y]<this.lowerBound[y]||this.upperBound[y]<p[y])return!1}else{var _=1/c[y],v=(this.lowerBound[y]-p[y])*_,g=(this.upperBound[y]-p[y])*_,x=-1;if(v>g){var A=v;v=g,g=A,x=1}if(v>u&&(d.setZero(),d[y]=x,u=v),m=r.min(m,g),u>m)return!1}return u<0||l.maxFraction<u?!1:(o.fraction=u,o.normal=d,!0)},h.prototype.toString=function(){return JSON.stringify(this)}},function(e,n,s){s(2);var r=s(1),a=s(0),h=s(5),o=s(10),l=s(3),u=s(4),m=s(18),p=s(21);e.exports=f;function c(g){this.contact=g,this.prev,this.next,this.other}function f(g,x,A,b,M){this.m_nodeA=new c(this),this.m_nodeB=new c(this),this.m_fixtureA=g,this.m_fixtureB=A,this.m_indexA=x,this.m_indexB=b,this.m_evaluateFcn=M,this.m_manifold=new m,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=y(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=_(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.v_points=[],this.v_normal=a.zero(),this.v_normalMass=new o,this.v_K=new o,this.v_pointCount,this.v_tangentSpeed,this.v_friction,this.v_restitution,this.v_invMassA,this.v_invMassB,this.v_invIA,this.v_invIB,this.p_localPoints=[],this.p_localNormal=a.zero(),this.p_localPoint=a.zero(),this.p_localCenterA=a.zero(),this.p_localCenterB=a.zero(),this.p_type,this.p_radiusA,this.p_radiusB,this.p_pointCount,this.p_invMassA,this.p_invMassB,this.p_invIA,this.p_invIB}f.prototype.initConstraint=function(g){var x=this.m_fixtureA,A=this.m_fixtureB,b=x.getShape(),M=A.getShape(),S=x.getBody(),B=A.getBody(),E=this.getManifold(),T=E.pointCount;this.v_invMassA=S.m_invMass,this.v_invMassB=B.m_invMass,this.v_invIA=S.m_invI,this.v_invIB=B.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=T,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=S.m_invMass,this.p_invMassB=B.m_invMass,this.p_invIA=S.m_invI,this.p_invIB=B.m_invI,this.p_localCenterA=a.clone(S.m_sweep.localCenter),this.p_localCenterB=a.clone(B.m_sweep.localCenter),this.p_radiusA=b.m_radius,this.p_radiusB=M.m_radius,this.p_type=E.type,this.p_localNormal=a.clone(E.localNormal),this.p_localPoint=a.clone(E.localPoint),this.p_pointCount=T;for(var w=0;w<T;++w){var C=E.points[w],P=this.v_points[w]=new d;g.warmStarting?(P.normalImpulse=g.dtRatio*C.normalImpulse,P.tangentImpulse=g.dtRatio*C.tangentImpulse):(P.normalImpulse=0,P.tangentImpulse=0),P.rA.setZero(),P.rB.setZero(),P.normalMass=0,P.tangentMass=0,P.velocityBias=0,this.p_localPoints[w]=a.clone(C.localPoint)}},f.prototype.getManifold=function(){return this.m_manifold},f.prototype.getWorldManifold=function(g){var x=this.m_fixtureA.getBody(),A=this.m_fixtureB.getBody(),b=this.m_fixtureA.getShape(),M=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(g,x.getTransform(),b.m_radius,A.getTransform(),M.m_radius)},f.prototype.setEnabled=function(g){this.m_enabledFlag=!!g},f.prototype.isEnabled=function(){return this.m_enabledFlag},f.prototype.isTouching=function(){return this.m_touchingFlag},f.prototype.getNext=function(){return this.m_next},f.prototype.getFixtureA=function(){return this.m_fixtureA},f.prototype.getFixtureB=function(){return this.m_fixtureB},f.prototype.getChildIndexA=function(){return this.m_indexA},f.prototype.getChildIndexB=function(){return this.m_indexB},f.prototype.flagForFiltering=function(){this.m_filterFlag=!0},f.prototype.setFriction=function(g){this.m_friction=g},f.prototype.getFriction=function(){return this.m_friction},f.prototype.resetFriction=function(){this.m_friction=y(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},f.prototype.setRestitution=function(g){this.m_restitution=g},f.prototype.getRestitution=function(){return this.m_restitution},f.prototype.resetRestitution=function(){this.m_restitution=_(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},f.prototype.setTangentSpeed=function(g){this.m_tangentSpeed=g},f.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},f.prototype.evaluate=function(g,x,A){this.m_evaluateFcn(g,x,this.m_fixtureA,this.m_indexA,A,this.m_fixtureB,this.m_indexB)},f.prototype.update=function(g){this.m_enabledFlag=!0;var x=!1,A=this.m_touchingFlag,b=this.m_fixtureA.isSensor(),M=this.m_fixtureB.isSensor(),S=b||M,B=this.m_fixtureA.getBody(),E=this.m_fixtureB.getBody(),T=B.getTransform(),w=E.getTransform();if(S){var C=this.m_fixtureA.getShape(),P=this.m_fixtureB.getShape();x=p.testOverlap(C,this.m_indexA,P,this.m_indexB,T,w),this.m_manifold.pointCount=0}else{var R=this.m_manifold;this.m_manifold=new m,this.evaluate(this.m_manifold,T,w),x=this.m_manifold.pointCount>0;for(var L=0;L<this.m_manifold.pointCount;++L){var I=this.m_manifold.points[L];I.normalImpulse=0,I.tangentImpulse=0;for(var z=0;z<R.pointCount;++z){var F=R.points[z];if(F.id.key==I.id.key){I.normalImpulse=F.normalImpulse,I.tangentImpulse=F.tangentImpulse;break}}}x!=A&&(B.setAwake(!0),E.setAwake(!0))}this.m_touchingFlag=x,A==!1&&x==!0&&g&&g.beginContact(this),A==!0&&x==!1&&g&&g.endContact(this),S==!1&&x&&g&&g.preSolve(this,R)},f.prototype.solvePositionConstraint=function(g){return this._solvePositionConstraint(g,!1)},f.prototype.solvePositionConstraintTOI=function(g,x,A){return this._solvePositionConstraint(g,!0,x,A)},f.prototype._solvePositionConstraint=function(g,x,A,b){var M=this.m_fixtureA,S=this.m_fixtureB,B=M.getBody(),E=S.getBody();B.c_velocity,E.c_velocity;var T=B.c_position,w=E.c_position,C=a.clone(this.p_localCenterA),P=a.clone(this.p_localCenterB),R=0,L=0;(!x||B==A||B==b)&&(R=this.p_invMassA,L=this.p_invIA);var I=0,z=0;(!x||E==A||E==b)&&(I=this.p_invMassB,z=this.p_invIB);for(var F=a.clone(T.c),D=T.a,V=a.clone(w.c),G=w.a,Y=0,J=0;J<this.p_pointCount;++J){var Q=h.identity(),W=h.identity();Q.q.set(D),W.q.set(G),Q.p=a.sub(F,l.mulVec2(Q.q,C)),W.p=a.sub(V,l.mulVec2(W.q,P));var et,ct,Z;switch(this.p_type){case m.e_circles:var ot=h.mulVec2(Q,this.p_localPoint),xt=h.mulVec2(W,this.p_localPoints[0]);et=a.sub(xt,ot),et.normalize(),ct=a.combine(.5,ot,.5,xt),Z=a.dot(a.sub(xt,ot),et)-this.p_radiusA-this.p_radiusB;break;case m.e_faceA:et=l.mulVec2(Q.q,this.p_localNormal);var q=h.mulVec2(Q,this.p_localPoint),X=h.mulVec2(W,this.p_localPoints[J]);Z=a.dot(a.sub(X,q),et)-this.p_radiusA-this.p_radiusB,ct=X;break;case m.e_faceB:et=l.mulVec2(W.q,this.p_localNormal);var q=h.mulVec2(W,this.p_localPoint),X=h.mulVec2(Q,this.p_localPoints[J]);Z=a.dot(a.sub(X,q),et)-this.p_radiusA-this.p_radiusB,ct=X,et.mul(-1);break}var at=a.sub(ct,F),ut=a.sub(ct,V);Y=r.min(Y,Z);var it=x?u.toiBaugarte:u.baumgarte,st=u.linearSlop,dt=u.maxLinearCorrection,mt=r.clamp(it*(Z+st),-dt,0),pt=a.cross(at,et),U=a.cross(ut,et),N=R+I+L*pt*pt+z*U*U,rt=N>0?-mt/N:0,ht=a.mul(rt,et);F.subMul(R,ht),D-=L*a.cross(at,ht),V.addMul(I,ht),G+=z*a.cross(ut,ht)}return T.c.set(F),T.a=D,w.c.set(V),w.a=G,Y};function d(){this.rA=a.zero(),this.rB=a.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}f.prototype.initVelocityConstraint=function(g){var x=this.m_fixtureA,A=this.m_fixtureB,b=x.getBody(),M=A.getBody(),S=b.c_velocity,B=M.c_velocity,E=b.c_position,T=M.c_position,w=this.p_radiusA,C=this.p_radiusB,P=this.getManifold(),R=this.v_invMassA,L=this.v_invMassB,I=this.v_invIA,z=this.v_invIB,F=a.clone(this.p_localCenterA),D=a.clone(this.p_localCenterB),V=a.clone(E.c),G=E.a,Y=a.clone(S.v),J=S.w,Q=a.clone(T.c),W=T.a,et=a.clone(B.v),ct=B.w,Z=h.identity(),ot=h.identity();Z.q.set(G),ot.q.set(W),Z.p.setCombine(1,V,-1,l.mulVec2(Z.q,F)),ot.p.setCombine(1,Q,-1,l.mulVec2(ot.q,D));var xt=P.getWorldManifold(null,Z,w,ot,C);this.v_normal.set(xt.normal);for(var q=0;q<this.v_pointCount;++q){var X=this.v_points[q];X.rA.set(a.sub(xt.points[q],V)),X.rB.set(a.sub(xt.points[q],Q));var at=a.cross(X.rA,this.v_normal),ut=a.cross(X.rB,this.v_normal),it=R+L+I*at*at+z*ut*ut;X.normalMass=it>0?1/it:0;var st=a.cross(this.v_normal,1),dt=a.cross(X.rA,st),mt=a.cross(X.rB,st),pt=R+L+I*dt*dt+z*mt*mt;X.tangentMass=pt>0?1/pt:0,X.velocityBias=0;var U=a.dot(this.v_normal,et)+a.dot(this.v_normal,a.cross(ct,X.rB))-a.dot(this.v_normal,Y)-a.dot(this.v_normal,a.cross(J,X.rA));U<-u.velocityThreshold&&(X.velocityBias=-this.v_restitution*U)}if(this.v_pointCount==2&&g.blockSolve){var N=this.v_points[0],rt=this.v_points[1],ht=a.cross(N.rA,this.v_normal),At=a.cross(N.rB,this.v_normal),ft=a.cross(rt.rA,this.v_normal),It=a.cross(rt.rB,this.v_normal),Ct=R+L+I*ht*ht+z*At*At,_t=R+L+I*ft*ft+z*It*It,H=R+L+I*ht*ft+z*At*It,gt=1e3;Ct*Ct<gt*(Ct*_t-H*H)?(this.v_K.ex.set(Ct,H),this.v_K.ey.set(H,_t),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}E.c.set(V),E.a=G,S.v.set(Y),S.w=J,T.c.set(Q),T.a=W,B.v.set(et),B.w=ct},f.prototype.warmStartConstraint=function(g){var x=this.m_fixtureA,A=this.m_fixtureB,b=x.getBody(),M=A.getBody(),S=b.c_velocity,B=M.c_velocity;b.c_position,M.c_position;for(var E=this.v_invMassA,T=this.v_invIA,w=this.v_invMassB,C=this.v_invIB,P=a.clone(S.v),R=S.w,L=a.clone(B.v),I=B.w,z=this.v_normal,F=a.cross(z,1),D=0;D<this.v_pointCount;++D){var V=this.v_points[D],G=a.combine(V.normalImpulse,z,V.tangentImpulse,F);R-=T*a.cross(V.rA,G),P.subMul(E,G),I+=C*a.cross(V.rB,G),L.addMul(w,G)}S.v.set(P),S.w=R,B.v.set(L),B.w=I},f.prototype.storeConstraintImpulses=function(g){for(var x=this.m_manifold,A=0;A<this.v_pointCount;++A)x.points[A].normalImpulse=this.v_points[A].normalImpulse,x.points[A].tangentImpulse=this.v_points[A].tangentImpulse},f.prototype.solveVelocityConstraint=function(g){var x=this.m_fixtureA.m_body,A=this.m_fixtureB.m_body,b=x.c_velocity;x.c_position;var M=A.c_velocity;A.c_position;for(var S=this.v_invMassA,B=this.v_invIA,E=this.v_invMassB,T=this.v_invIB,w=a.clone(b.v),C=b.w,P=a.clone(M.v),R=M.w,L=this.v_normal,I=a.cross(L,1),z=this.v_friction,F=0;F<this.v_pointCount;++F){var D=this.v_points[F],V=a.zero();V.addCombine(1,P,1,a.cross(R,D.rB)),V.subCombine(1,w,1,a.cross(C,D.rA));var G=a.dot(V,I)-this.v_tangentSpeed,Y=D.tangentMass*-G,J=z*D.normalImpulse,Q=r.clamp(D.tangentImpulse+Y,-J,J);Y=Q-D.tangentImpulse,D.tangentImpulse=Q;var W=a.mul(Y,I);w.subMul(S,W),C-=B*a.cross(D.rA,W),P.addMul(E,W),R+=T*a.cross(D.rB,W)}if(this.v_pointCount==1||g.blockSolve==!1)for(var et=0;et<this.v_pointCount;++et){var D=this.v_points[et],V=a.zero();V.addCombine(1,P,1,a.cross(R,D.rB)),V.subCombine(1,w,1,a.cross(C,D.rA));var ct=a.dot(V,L),Y=-D.normalMass*(ct-D.velocityBias),Q=r.max(D.normalImpulse+Y,0);Y=Q-D.normalImpulse,D.normalImpulse=Q;var W=a.mul(Y,L);w.subMul(S,W),C-=B*a.cross(D.rA,W),P.addMul(E,W),R+=T*a.cross(D.rB,W)}else{var Z=this.v_points[0],ot=this.v_points[1],xt=a.neo(Z.normalImpulse,ot.normalImpulse),q=a.zero().add(P).add(a.cross(R,Z.rB)).sub(w).sub(a.cross(C,Z.rA)),X=a.zero().add(P).add(a.cross(R,ot.rB)).sub(w).sub(a.cross(C,ot.rA)),at=a.dot(q,L),ut=a.dot(X,L),it=a.neo(at-Z.velocityBias,ut-ot.velocityBias);for(it.sub(o.mulVec2(this.v_K,xt));;){var st=o.mulVec2(this.v_normalMass,it).neg();if(st.x>=0&&st.y>=0){var dt=a.sub(st,xt),mt=a.mul(dt.x,L),pt=a.mul(dt.y,L);w.subCombine(S,mt,S,pt),C-=B*(a.cross(Z.rA,mt)+a.cross(ot.rA,pt)),P.addCombine(E,mt,E,pt),R+=T*(a.cross(Z.rB,mt)+a.cross(ot.rB,pt)),Z.normalImpulse=st.x,ot.normalImpulse=st.y;break}if(st.x=-Z.normalMass*it.x,st.y=0,at=0,ut=this.v_K.ex.y*st.x+it.y,st.x>=0&&ut>=0){var dt=a.sub(st,xt),mt=a.mul(dt.x,L),pt=a.mul(dt.y,L);w.subCombine(S,mt,S,pt),C-=B*(a.cross(Z.rA,mt)+a.cross(ot.rA,pt)),P.addCombine(E,mt,E,pt),R+=T*(a.cross(Z.rB,mt)+a.cross(ot.rB,pt)),Z.normalImpulse=st.x,ot.normalImpulse=st.y;var q;break}if(st.x=0,st.y=-ot.normalMass*it.y,at=this.v_K.ey.x*st.y+it.x,ut=0,st.y>=0&&at>=0){var dt=a.sub(st,xt),mt=a.mul(dt.x,L),pt=a.mul(dt.y,L);w.subCombine(S,mt,S,pt),C-=B*(a.cross(Z.rA,mt)+a.cross(ot.rA,pt)),P.addCombine(E,mt,E,pt),R+=T*(a.cross(Z.rB,mt)+a.cross(ot.rB,pt)),Z.normalImpulse=st.x,ot.normalImpulse=st.y;var q;break}if(st.x=0,st.y=0,at=it.x,ut=it.y,at>=0&&ut>=0){var dt=a.sub(st,xt),mt=a.mul(dt.x,L),pt=a.mul(dt.y,L);w.subCombine(S,mt,S,pt),C-=B*(a.cross(Z.rA,mt)+a.cross(ot.rA,pt)),P.addCombine(E,mt,E,pt),R+=T*(a.cross(Z.rB,mt)+a.cross(ot.rB,pt)),Z.normalImpulse=st.x,ot.normalImpulse=st.y;break}break}}b.v.set(w),b.w=C,M.v.set(P),M.w=R};function y(g,x){return r.sqrt(g*x)}function _(g,x){return g>x?g:x}var v=[];f.addType=function(g,x,A){v[g]=v[g]||{},v[g][x]=A},f.create=function(g,x,A,b){var M=g.getType(),S=A.getType(),B,E;if(E=v[M]&&v[M][S])B=new f(g,x,A,b,E);else if(E=v[S]&&v[S][M])B=new f(A,b,g,x,E);else return null;g=B.getFixtureA(),A=B.getFixtureB(),x=B.getChildIndexA(),b=B.getChildIndexB();var T=g.getBody(),w=A.getBody();return B.m_nodeA.contact=B,B.m_nodeA.other=w,B.m_nodeA.prev=null,B.m_nodeA.next=T.m_contactList,T.m_contactList!=null&&(T.m_contactList.prev=B.m_nodeA),T.m_contactList=B.m_nodeA,B.m_nodeB.contact=B,B.m_nodeB.other=T,B.m_nodeB.prev=null,B.m_nodeB.next=w.m_contactList,w.m_contactList!=null&&(w.m_contactList.prev=B.m_nodeB),w.m_contactList=B.m_nodeB,g.isSensor()==!1&&A.isSensor()==!1&&(T.setAwake(!0),w.setAwake(!0)),B},f.destroy=function(g,x){var A=g.m_fixtureA,b=g.m_fixtureB,M=A.getBody(),S=b.getBody();g.isTouching()&&x.endContact(g),g.m_nodeA.prev&&(g.m_nodeA.prev.next=g.m_nodeA.next),g.m_nodeA.next&&(g.m_nodeA.next.prev=g.m_nodeA.prev),g.m_nodeA==M.m_contactList&&(M.m_contactList=g.m_nodeA.next),g.m_nodeB.prev&&(g.m_nodeB.prev.next=g.m_nodeB.next),g.m_nodeB.next&&(g.m_nodeB.next.prev=g.m_nodeB.prev),g.m_nodeB==S.m_contactList&&(S.m_contactList=g.m_nodeB.next),g.m_manifold.pointCount>0&&A.isSensor()==!1&&b.isSensor()==!1&&(M.setAwake(!0),S.setAwake(!0));var B=A.getType(),E=b.getType(),T=v[B][E].destroyFcn;typeof T=="function"&&T(g)}},function(e,n,s){s(2);var r=s(0),a=s(5),h=s(1),o=s(3);e.exports=l,e.exports.clipSegmentToLine=_,e.exports.clipVertex=y,e.exports.getPointStates=d,e.exports.PointState=f,l.e_circles=0,l.e_faceA=1,l.e_faceB=2,l.e_vertex=0,l.e_face=1;function l(){this.type,this.localNormal=r.zero(),this.localPoint=r.zero(),this.points=[new u,new u],this.pointCount=0}function u(){this.localPoint=r.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new m}function m(){this.cf=new p}Object.defineProperty(m.prototype,"key",{get:function(){return this.cf.indexA+this.cf.indexB*4+this.cf.typeA*16+this.cf.typeB*64},enumerable:!0,configurable:!0}),m.prototype.set=function(v){this.cf.set(v.cf)};function p(){this.indexA,this.indexB,this.typeA,this.typeB}p.prototype.set=function(v){this.indexA=v.indexA,this.indexB=v.indexB,this.typeA=v.typeA,this.typeB=v.typeB};function c(){this.normal,this.points=[],this.separations=[]}l.prototype.getWorldManifold=function(v,g,x,A,b){if(this.pointCount!=0){v=v||new c;var M=v.normal,S=v.points,B=v.separations;switch(this.type){case l.e_circles:M=r.neo(1,0);var E=a.mulVec2(g,this.localPoint),T=a.mulVec2(A,this.points[0].localPoint),w=r.sub(T,E);r.lengthSquared(w)>h.EPSILON*h.EPSILON&&(M.set(w),M.normalize());var C=E.clone().addMul(x,M),P=T.clone().addMul(-b,M);S[0]=r.mid(C,P),B[0]=r.dot(r.sub(P,C),M),S.length=1,B.length=1;break;case l.e_faceA:M=o.mulVec2(g.q,this.localNormal);for(var R=a.mulVec2(g,this.localPoint),L=0;L<this.pointCount;++L){var I=a.mulVec2(A,this.points[L].localPoint),C=r.clone(I).addMul(x-r.dot(r.sub(I,R),M),M),P=r.clone(I).subMul(b,M);S[L]=r.mid(C,P),B[L]=r.dot(r.sub(P,C),M)}S.length=this.pointCount,B.length=this.pointCount;break;case l.e_faceB:M=o.mulVec2(A.q,this.localNormal);for(var R=a.mulVec2(A,this.localPoint),L=0;L<this.pointCount;++L){var I=a.mulVec2(g,this.points[L].localPoint),P=r.combine(1,I,b-r.dot(r.sub(I,R),M),M),C=r.combine(1,I,-x,M);S[L]=r.mid(C,P),B[L]=r.dot(r.sub(C,P),M)}S.length=this.pointCount,B.length=this.pointCount,M.mul(-1);break}return v.normal=M,v.points=S,v.separations=B,v}};var f={nullState:0,addState:1,persistState:2,removeState:3};function d(v,g,x,A){for(var b=0;b<x.pointCount;++b){var M=x.points[b].id;v[b]=f.removeState;for(var S=0;S<A.pointCount;++S)if(A.points[S].id.key==M.key){v[b]=f.persistState;break}}for(var b=0;b<A.pointCount;++b){var M=A.points[b].id;g[b]=f.addState;for(var S=0;S<x.pointCount;++S)if(x.points[S].id.key==M.key){g[b]=f.persistState;break}}}function y(){this.v=r.zero(),this.id=new m}y.prototype.set=function(v){this.v.set(v.v),this.id.set(v.id)};function _(v,g,x,A,b){var M=0,S=r.dot(x,g[0].v)-A,B=r.dot(x,g[1].v)-A;if(S<=0&&v[M++].set(g[0]),B<=0&&v[M++].set(g[1]),S*B<0){var E=S/(S-B);v[M].v.setCombine(1-E,g[0].v,E,g[1].v),v[M].id.cf.indexA=b,v[M].id.cf.indexB=g[0].id.cf.indexB,v[M].id.cf.typeA=l.e_vertex,v[M].id.cf.typeB=l.e_face,++M}return M}},function(e,n,s){var r=s(35),a=s(36),h=s(37),o=s(65);r.create=0;function l(g){if(!(this instanceof l))return h.fn(g)?l.app.apply(l,arguments):h.object(g)?l.atlas.apply(l,arguments):g;r.create++;for(var x=0;x<u.length;x++)u[x].call(this)}var u=[];l._init=function(g){u.push(g)};var m=[];l._load=function(g){m.push(g)};var p={};l.config=function(){if(arguments.length===1&&h.string(arguments[0]))return p[arguments[0]];arguments.length===1&&h.object(arguments[0])&&a(p,arguments[0]),arguments.length===2&&h.string(arguments[0])&&p[arguments[1]]};var c=[],f=[],d=!1,y=!1;l.app=function(g,x){if(!d){c.push(arguments);return}var A=l.config("app-loader");A(function(b,M){for(var S=0;S<m.length;S++)m[S].call(this,b,M);g(b,M),f.push(b),b.start()},x)};var _=o();l.preload=function(g){if(typeof g=="string"){var x=l.resolve(g);/\.js($|\?|\#)/.test(x)&&(g=function(A){v(x,A)})}typeof g=="function"&&g(_())},l.start=function(g){l.config(g),_.then(function(){for(d=!0;c.length;){var x=c.shift();l.app.apply(l,x)}})},l.pause=function(){if(!y){y=!0;for(var g=f.length-1;g>=0;g--)f[g].pause()}},l.resume=function(){if(y){y=!1;for(var g=f.length-1;g>=0;g--)f[g].resume()}},l.create=function(){return new l},l.resolve=function(){if(typeof window=="undefined"||typeof document=="undefined")return function(A){return A};var g=document.getElementsByTagName("script");function x(){if(document.currentScript)return document.currentScript.src;var A;try{var b=new Error;if(b.stack)A=b.stack;else throw b}catch(B){A=B.stack}if(typeof A=="string"){A=A.split(`
`);for(var M=A.length;M--;){var S=A[M].match(/(\w+\:\/\/[^/]*?\/.+?)(:\d+)(:\d+)?/);if(S)return S[1]}}if(g.length&&"readyState"in g[0]){for(var M=g.length;M--;)if(g[M].readyState==="interactive")return g[M].src}return location.href}return function(A){if(/^\.\//.test(A)){var b=x(),M=b.substring(0,b.lastIndexOf("/")+1);A=M+A.substring(2)}return A}}(),e.exports=l;function v(g,x){var A=document.createElement("script");A.addEventListener("load",function(){x()}),A.addEventListener("error",function(b){x(b||"Error loading script: "+g)}),A.src=g,A.id="preload-"+Date.now(),document.body.appendChild(A)}},function(e,n,s){e.exports=m,s(2),s(6);var r=s(1),a=s(5),h=s(3),o=s(0);s(16);var l=s(4),u=s(15);m._super=u,m.prototype=Object.create(m._super.prototype),m.TYPE="polygon",u.TYPES[m.TYPE]=m;function m(c){if(!(this instanceof m))return new m(c);m._super.call(this),this.m_type=m.TYPE,this.m_radius=l.polygonRadius,this.m_centroid=o.zero(),this.m_vertices=[],this.m_normals=[],this.m_count=0,c&&c.length&&this._set(c)}m.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},m._deserialize=function(c,f,d){var y=[];if(c.vertices)for(var _=0;_<c.vertices.length;_++)y.push(d(o,c.vertices[_]));var v=new m(y);return v},m.prototype.getVertex=function(c){return this.m_vertices[c]},m.prototype._clone=function(){var c=new m;c.m_type=this.m_type,c.m_radius=this.m_radius,c.m_count=this.m_count,c.m_centroid.set(this.m_centroid);for(var f=0;f<this.m_count;f++)c.m_vertices.push(this.m_vertices[f].clone());for(var f=0;f<this.m_normals.length;f++)c.m_normals.push(this.m_normals[f].clone());return c},m.prototype.getChildCount=function(){return 1};function p(c,f){for(var d=o.zero(),y=0,_=o.zero(),v,g=1/3,v=0;v<f;++v){var x=_,A=c[v],b=v+1<f?c[v+1]:c[0],M=o.sub(A,x),S=o.sub(b,x),B=o.cross(M,S),E=.5*B;y+=E,d.addMul(E*g,x),d.addMul(E*g,A),d.addMul(E*g,b)}return d.mul(1/y),d}m.prototype._reset=function(){this._set(this.m_vertices)},m.prototype._set=function(c){if(c.length<3){this._setAsBox(1,1);return}for(var f=r.min(c.length,l.maxPolygonVertices),d=[],y=0;y<f;++y){for(var _=c[y],v=!0,g=0;g<d.length;++g)if(o.distanceSquared(_,d[g])<.25*l.linearSlopSquared){v=!1;break}v&&d.push(_)}if(f=d.length,f<3){this._setAsBox(1,1);return}for(var x=0,A=d[0].x,y=1;y<f;++y){var b=d[y].x;(b>A||b===A&&d[y].y<d[x].y)&&(x=y,A=b)}for(var M=[],S=0,B=x;;){M[S]=B;for(var E=0,g=1;g<f;++g){if(E===B){E=g;continue}var T=o.sub(d[E],d[M[S]]),_=o.sub(d[g],d[M[S]]),w=o.cross(T,_);w<0&&(E=g),w===0&&_.lengthSquared()>T.lengthSquared()&&(E=g)}if(++S,B=E,E===x)break}if(S<3){this._setAsBox(1,1);return}this.m_count=S,this.m_vertices=[];for(var y=0;y<S;++y)this.m_vertices[y]=d[M[y]];for(var y=0;y<S;++y){var C=y,P=y+1<S?y+1:0,R=o.sub(this.m_vertices[P],this.m_vertices[C]);this.m_normals[y]=o.cross(R,1),this.m_normals[y].normalize()}this.m_centroid=p(this.m_vertices,S)},m.prototype._setAsBox=function(c,f,d,y){if(this.m_vertices[0]=o.neo(c,-f),this.m_vertices[1]=o.neo(c,f),this.m_vertices[2]=o.neo(-c,f),this.m_vertices[3]=o.neo(-c,-f),this.m_normals[0]=o.neo(1,0),this.m_normals[1]=o.neo(0,1),this.m_normals[2]=o.neo(-1,0),this.m_normals[3]=o.neo(0,-1),this.m_count=4,o.isValid(d)){y=y||0,this.m_centroid.set(d);var _=a.identity();_.p.set(d),_.q.set(y);for(var v=0;v<this.m_count;++v)this.m_vertices[v]=a.mulVec2(_,this.m_vertices[v]),this.m_normals[v]=h.mulVec2(_.q,this.m_normals[v])}},m.prototype.testPoint=function(c,f){for(var d=h.mulTVec2(c.q,o.sub(f,c.p)),y=0;y<this.m_count;++y){var _=o.dot(this.m_normals[y],o.sub(d,this.m_vertices[y]));if(_>0)return!1}return!0},m.prototype.rayCast=function(c,f,d,y){for(var _=h.mulTVec2(d.q,o.sub(f.p1,d.p)),v=h.mulTVec2(d.q,o.sub(f.p2,d.p)),g=o.sub(v,_),x=0,A=f.maxFraction,b=-1,M=0;M<this.m_count;++M){var S=o.dot(this.m_normals[M],o.sub(this.m_vertices[M],_)),B=o.dot(this.m_normals[M],g);if(B==0){if(S<0)return!1}else B<0&&S<x*B?(x=S/B,b=M):B>0&&S<A*B&&(A=S/B);if(A<x)return!1}return b>=0?(c.fraction=x,c.normal=h.mulVec2(d.q,this.m_normals[b]),!0):!1},m.prototype.computeAABB=function(c,f,d){for(var y=1/0,_=1/0,v=-1/0,g=-1/0,x=0;x<this.m_count;++x){var A=a.mulVec2(f,this.m_vertices[x]);y=r.min(y,A.x),v=r.max(v,A.x),_=r.min(_,A.y),g=r.max(g,A.y)}c.lowerBound.set(y,_),c.upperBound.set(v,g),c.extend(this.m_radius)},m.prototype.computeMass=function(c,f){for(var d=o.zero(),y=0,_=0,v=o.zero(),g=0;g<this.m_count;++g)v.add(this.m_vertices[g]);v.mul(1/this.m_count);for(var x=1/3,g=0;g<this.m_count;++g){var A=o.sub(this.m_vertices[g],v),b=g+1<this.m_count?o.sub(this.m_vertices[g+1],v):o.sub(this.m_vertices[0],v),M=o.cross(A,b),S=.5*M;y+=S,d.addCombine(S*x,A,S*x,b);var B=A.x,E=A.y,T=b.x,w=b.y,C=B*B+T*B+T*T,P=E*E+w*E+w*w;_+=.25*x*M*(C+P)}c.mass=f*y,d.mul(1/y),c.center.setCombine(1,d,1,v),c.I=f*_,c.I+=c.mass*(o.dot(c.center,c.center)-o.dot(d,d))},m.prototype.validate=function(){for(var c=0;c<this.m_count;++c)for(var f=c,d=c<this.m_count-1?f+1:0,y=this.m_vertices[f],_=o.sub(this.m_vertices[d],y),v=0;v<this.m_count;++v)if(!(v==f||v==d)){var g=o.sub(this.m_vertices[v],y),x=o.cross(_,g);if(x<0)return!1}return!0},m.prototype.computeDistanceProxy=function(c){c.m_vertices=this.m_vertices,c.m_count=this.m_count,c.m_radius=this.m_radius}},function(e,n,s){e.exports=f,e.exports.Input=m,e.exports.Output=p,e.exports.Proxy=d,e.exports.Cache=c;var r=s(4);s(2);var a=s(27),h=s(1),o=s(0);s(7),s(10),s(14);var l=s(3);s(9);var u=s(5);s(12),s(13),a.gjkCalls=0,a.gjkIters=0,a.gjkMaxIters=0;function m(){this.proxyA=new d,this.proxyB=new d,this.transformA=null,this.transformB=null,this.useRadii=!1}function p(){this.pointA=o.zero(),this.pointB=o.zero(),this.distance,this.iterations}function c(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}function f(v,g,x){++a.gjkCalls;var A=x.proxyA,b=x.proxyB,M=x.transformA,S=x.transformB,B=new _;B.readCache(g,A,M,b,S);for(var E=B.m_v,T=r.maxDistnceIterations,w=[],C=[],P=0,R=0;R<T;){P=B.m_count;for(var L=0;L<P;++L)w[L]=E[L].indexA,C[L]=E[L].indexB;if(B.solve(),B.m_count==3)break;var I=B.getClosestPoint();I.lengthSquared();var z=B.getSearchDirection();if(z.lengthSquared()<h.EPSILON*h.EPSILON)break;var F=E[B.m_count];F.indexA=A.getSupport(l.mulTVec2(M.q,o.neg(z))),F.wA=u.mulVec2(M,A.getVertex(F.indexA)),F.indexB=b.getSupport(l.mulTVec2(S.q,z)),F.wB=u.mulVec2(S,b.getVertex(F.indexB)),F.w=o.sub(F.wB,F.wA),++R,++a.gjkIters;for(var D=!1,L=0;L<P;++L)if(F.indexA==w[L]&&F.indexB==C[L]){D=!0;break}if(D)break;++B.m_count}if(a.gjkMaxIters=h.max(a.gjkMaxIters,R),B.getWitnessPoints(v.pointA,v.pointB),v.distance=o.distance(v.pointA,v.pointB),v.iterations=R,B.writeCache(g),x.useRadii){var V=A.m_radius,G=b.m_radius;if(v.distance>V+G&&v.distance>h.EPSILON){v.distance-=V+G;var Y=o.sub(v.pointB,v.pointA);Y.normalize(),v.pointA.addMul(V,Y),v.pointB.subMul(G,Y)}else{var I=o.mid(v.pointA,v.pointB);v.pointA.set(I),v.pointB.set(I),v.distance=0}}}function d(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}d.prototype.getVertexCount=function(){return this.m_count},d.prototype.getVertex=function(v){return this.m_vertices[v]},d.prototype.getSupport=function(v){for(var g=0,x=o.dot(this.m_vertices[0],v),A=0;A<this.m_count;++A){var b=o.dot(this.m_vertices[A],v);b>x&&(g=A,x=b)}return g},d.prototype.getSupportVertex=function(v){return this.m_vertices[this.getSupport(v)]},d.prototype.set=function(v,g){v.computeDistanceProxy(this,g)};function y(){this.indexA,this.indexB,this.wA=o.zero(),this.wB=o.zero(),this.w=o.zero(),this.a}y.prototype.set=function(v){this.indexA=v.indexA,this.indexB=v.indexB,this.wA=o.clone(v.wA),this.wB=o.clone(v.wB),this.w=o.clone(v.w),this.a=v.a};function _(){this.m_v1=new y,this.m_v2=new y,this.m_v3=new y,this.m_v=[this.m_v1,this.m_v2,this.m_v3],this.m_count}_.prototype.print=function(){return this.m_count==3?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():this.m_count==2?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():this.m_count==1?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},_.prototype.readCache=function(v,g,x,A,b){this.m_count=v.count;for(var M=0;M<this.m_count;++M){var S=this.m_v[M];S.indexA=v.indexA[M],S.indexB=v.indexB[M];var B=g.getVertex(S.indexA),E=A.getVertex(S.indexB);S.wA=u.mulVec2(x,B),S.wB=u.mulVec2(b,E),S.w=o.sub(S.wB,S.wA),S.a=0}if(this.m_count>1){var T=v.metric,w=this.getMetric();(w<.5*T||2*T<w||w<h.EPSILON)&&(this.m_count=0)}if(this.m_count==0){var S=this.m_v[0];S.indexA=0,S.indexB=0;var B=g.getVertex(0),E=A.getVertex(0);S.wA=u.mulVec2(x,B),S.wB=u.mulVec2(b,E),S.w=o.sub(S.wB,S.wA),S.a=1,this.m_count=1}},_.prototype.writeCache=function(v){v.metric=this.getMetric(),v.count=this.m_count;for(var g=0;g<this.m_count;++g)v.indexA[g]=this.m_v[g].indexA,v.indexB[g]=this.m_v[g].indexB},_.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return o.neg(this.m_v1.w);case 2:{var v=o.sub(this.m_v2.w,this.m_v1.w),g=o.cross(v,o.neg(this.m_v1.w));return g>0?o.cross(1,v):o.cross(v,1)}default:return o.zero()}},_.prototype.getClosestPoint=function(){switch(this.m_count){case 0:return o.zero();case 1:return o.clone(this.m_v1.w);case 2:return o.combine(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w);case 3:return o.zero();default:return o.zero()}},_.prototype.getWitnessPoints=function(v,g){switch(this.m_count){case 0:break;case 1:v.set(this.m_v1.wA),g.set(this.m_v1.wB);break;case 2:v.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),g.setCombine(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:v.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),v.addMul(this.m_v3.a,this.m_v3.wA),g.set(v);break}},_.prototype.getMetric=function(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return o.distance(this.m_v1.w,this.m_v2.w);case 3:return o.cross(o.sub(this.m_v2.w,this.m_v1.w),o.sub(this.m_v3.w,this.m_v1.w));default:return 0}},_.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3();break}},_.prototype.solve2=function(){var v=this.m_v1.w,g=this.m_v2.w,x=o.sub(g,v),A=-o.dot(v,x);if(A<=0){this.m_v1.a=1,this.m_count=1;return}var b=o.dot(g,x);if(b<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}var M=1/(b+A);this.m_v1.a=b*M,this.m_v2.a=A*M,this.m_count=2},_.prototype.solve3=function(){var v=this.m_v1.w,g=this.m_v2.w,x=this.m_v3.w,A=o.sub(g,v),b=o.dot(v,A),M=o.dot(g,A),S=M,B=-b,E=o.sub(x,v),T=o.dot(v,E),w=o.dot(x,E),C=w,P=-T,R=o.sub(x,g),L=o.dot(g,R),I=o.dot(x,R),z=I,F=-L,D=o.cross(A,E),V=D*o.cross(g,x),G=D*o.cross(x,v),Y=D*o.cross(v,g);if(B<=0&&P<=0){this.m_v1.a=1,this.m_count=1;return}if(S>0&&B>0&&Y<=0){var J=1/(S+B);this.m_v1.a=S*J,this.m_v2.a=B*J,this.m_count=2;return}if(C>0&&P>0&&G<=0){var Q=1/(C+P);this.m_v1.a=C*Q,this.m_v3.a=P*Q,this.m_count=2,this.m_v2.set(this.m_v3);return}if(S<=0&&F<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}if(C<=0&&z<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.set(this.m_v3);return}if(z>0&&F>0&&V<=0){var W=1/(z+F);this.m_v2.a=z*W,this.m_v3.a=F*W,this.m_count=2,this.m_v1.set(this.m_v3);return}var et=1/(V+G+Y);this.m_v1.a=V*et,this.m_v2.a=G*et,this.m_v3.a=Y*et,this.m_count=3},f.testOverlap=function(v,g,x,A,b,M){var S=new m;S.proxyA.set(v,g),S.proxyB.set(x,A),S.transformA=b,S.transformB=M,S.useRadii=!0;var B=new c,E=new p;return f(E,B,S),E.distance<10*h.EPSILON}},function(e,n,s){e.exports=l,s(2),s(6);var r=s(1);s(5);var a=s(3),h=s(0);s(16),s(4);var o=s(15);l._super=o,l.prototype=Object.create(l._super.prototype),l.TYPE="circle",o.TYPES[l.TYPE]=l;function l(u,m){if(!(this instanceof l))return new l(u,m);l._super.call(this),this.m_type=l.TYPE,this.m_p=h.zero(),this.m_radius=1,typeof u=="object"&&h.isValid(u)?(this.m_p.set(u),typeof m=="number"&&(this.m_radius=m)):typeof u=="number"&&(this.m_radius=u)}l.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},l._deserialize=function(u){return new l(u.p,u.radius)},l.prototype.getRadius=function(){return this.m_radius},l.prototype.getCenter=function(){return this.m_p},l.prototype.getVertex=function(u){return this.m_p},l.prototype.getVertexCount=function(u){return 1},l.prototype._clone=function(){var u=new l;return u.m_type=this.m_type,u.m_radius=this.m_radius,u.m_p=this.m_p.clone(),u},l.prototype.getChildCount=function(){return 1},l.prototype.testPoint=function(u,m){var p=h.add(u.p,a.mulVec2(u.q,this.m_p)),c=h.sub(m,p);return h.dot(c,c)<=this.m_radius*this.m_radius},l.prototype.rayCast=function(u,m,p,c){var f=h.add(p.p,a.mulVec2(p.q,this.m_p)),d=h.sub(m.p1,f),y=h.dot(d,d)-this.m_radius*this.m_radius,_=h.sub(m.p2,m.p1),v=h.dot(d,_),g=h.dot(_,_),x=v*v-g*y;if(x<0||g<r.EPSILON)return!1;var A=-(v+r.sqrt(x));return 0<=A&&A<=m.maxFraction*g?(A/=g,u.fraction=A,u.normal=h.add(d,h.mul(A,_)),u.normal.normalize(),!0):!1},l.prototype.computeAABB=function(u,m,p){var c=h.add(m.p,a.mulVec2(m.q,this.m_p));u.lowerBound.set(c.x-this.m_radius,c.y-this.m_radius),u.upperBound.set(c.x+this.m_radius,c.y+this.m_radius)},l.prototype.computeMass=function(u,m){u.mass=m*r.PI*this.m_radius*this.m_radius,u.center=this.m_p,u.I=u.mass*(.5*this.m_radius*this.m_radius+h.dot(this.m_p,this.m_p))},l.prototype.computeDistanceProxy=function(u){u.m_vertices.push(this.m_p),u.m_count=1,u.m_radius=this.m_radius}},function(e,n,s){e.exports=u,s(6);var r=s(4),a=s(15);s(1);var h=s(5),o=s(3),l=s(0);s(16),u._super=a,u.prototype=Object.create(u._super.prototype),u.TYPE="edge",a.TYPES[u.TYPE]=u;function u(m,p){if(!(this instanceof u))return new u(m,p);u._super.call(this),this.m_type=u.TYPE,this.m_radius=r.polygonRadius,this.m_vertex1=m?l.clone(m):l.zero(),this.m_vertex2=p?l.clone(p):l.zero(),this.m_vertex0=l.zero(),this.m_vertex3=l.zero(),this.m_hasVertex0=!1,this.m_hasVertex3=!1}u.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},u._deserialize=function(m){var p=new u(m.vertex1,m.vertex2);return p.hasVertex0&&p.setPrev(m.vertex0),p.hasVertex3&&p.setNext(m.vertex3),p},u.prototype.setNext=function(m){return m?(this.m_vertex3.set(m),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},u.prototype.setPrev=function(m){return m?(this.m_vertex0.set(m),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},u.prototype._set=function(m,p){return this.m_vertex1.set(m),this.m_vertex2.set(p),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},u.prototype._clone=function(){var m=new u;return m.m_type=this.m_type,m.m_radius=this.m_radius,m.m_vertex1.set(this.m_vertex1),m.m_vertex2.set(this.m_vertex2),m.m_vertex0.set(this.m_vertex0),m.m_vertex3.set(this.m_vertex3),m.m_hasVertex0=this.m_hasVertex0,m.m_hasVertex3=this.m_hasVertex3,m},u.prototype.getChildCount=function(){return 1},u.prototype.testPoint=function(m,p){return!1},u.prototype.rayCast=function(m,p,c,f){var d=o.mulTVec2(c.q,l.sub(p.p1,c.p)),y=o.mulTVec2(c.q,l.sub(p.p2,c.p)),_=l.sub(y,d),v=this.m_vertex1,g=this.m_vertex2,x=l.sub(g,v),A=l.neo(x.y,-x.x);A.normalize();var b=l.dot(A,l.sub(v,d)),M=l.dot(A,_);if(M==0)return!1;var S=b/M;if(S<0||p.maxFraction<S)return!1;var B=l.add(d,l.mul(S,_)),E=l.sub(g,v),T=l.dot(E,E);if(T==0)return!1;var w=l.dot(l.sub(B,v),E)/T;return w<0||1<w?!1:(m.fraction=S,b>0?m.normal=o.mulVec2(c.q,A).neg():m.normal=o.mulVec2(c.q,A),!0)},u.prototype.computeAABB=function(m,p,c){var f=h.mulVec2(p,this.m_vertex1),d=h.mulVec2(p,this.m_vertex2);m.combinePoints(f,d),m.extend(this.m_radius)},u.prototype.computeMass=function(m,p){m.mass=0,m.center.setCombine(.5,this.m_vertex1,.5,this.m_vertex2),m.I=0},u.prototype.computeDistanceProxy=function(m){m.m_vertices.push(this.m_vertex1),m.m_vertices.push(this.m_vertex2),m.m_count=2,m.m_radius=this.m_radius}},function(e,n){if(typeof Object.create=="function")e.exports=function(s,r){return Object.create.call(Object,s,r)};else{let s=function(){};e.exports=function(r,a){if(a)throw Error("Second argument is not supported!");if(typeof r!="object"||r===null)throw Error("Invalid prototype!");return s.prototype=r,new s}}},function(e,n,s){var r=s(19),a=s(61),h=0;r._init(function(){this._pin=new o(this)}),r.prototype.matrix=function(p){return p===!0?this._pin.relativeMatrix():this._pin.absoluteMatrix()},r.prototype.pin=function(p,c){if(typeof p=="object")return this._pin.set(p),this;if(typeof p=="string")return typeof c=="undefined"?this._pin.get(p):(this._pin.set(p,c),this);if(typeof p=="undefined")return this._pin};function o(p){this._owner=p,this._parent=null,this._relativeMatrix=new a,this._absoluteMatrix=new a,this.reset()}o.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._rotation=0,this._pivoted=!1,this._pivotX=null,this._pivotY=null,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height,this._ts_translate=++h,this._ts_transform=++h,this._ts_matrix=++h},o.prototype._update=function(){return this._parent=this._owner._parent&&this._owner._parent._pin,this._handled&&this._mo_handle!=this._ts_transform&&(this._mo_handle=this._ts_transform,this._ts_translate=++h),this._aligned&&this._parent&&this._mo_align!=this._parent._ts_transform&&(this._mo_align=this._parent._ts_transform,this._ts_translate=++h),this},o.prototype.toString=function(){return this._owner+" ("+(this._parent?this._parent._owner:null)+")"},o.prototype.absoluteMatrix=function(){this._update();var p=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_matrix:0);if(this._mo_abs==p)return this._absoluteMatrix;this._mo_abs=p;var c=this._absoluteMatrix;return c.reset(this.relativeMatrix()),this._parent&&c.concat(this._parent._absoluteMatrix),this._ts_matrix=++h,c},o.prototype.relativeMatrix=function(){this._update();var p=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_transform:0);if(this._mo_rel==p)return this._relativeMatrix;this._mo_rel=p;var c=this._relativeMatrix;if(c.identity(),this._pivoted&&c.translate(-this._pivotX*this._width,-this._pivotY*this._height),c.scale(this._scaleX,this._scaleY),c.skew(this._skewX,this._skewY),c.rotate(this._rotation),this._pivoted&&c.translate(this._pivotX*this._width,this._pivotY*this._height),this._pivoted)this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height;else{var f,d;c.a>0&&c.c>0||c.a<0&&c.c<0?(f=0,d=c.a*this._width+c.c*this._height):(f=c.a*this._width,d=c.c*this._height),f>d?(this._boxX=d,this._boxWidth=f-d):(this._boxX=f,this._boxWidth=d-f),c.b>0&&c.d>0||c.b<0&&c.d<0?(f=0,d=c.b*this._width+c.d*this._height):(f=c.b*this._width,d=c.d*this._height),f>d?(this._boxY=d,this._boxHeight=f-d):(this._boxY=f,this._boxHeight=d-f)}return this._x=this._offsetX,this._y=this._offsetY,this._x-=this._boxX+this._handleX*this._boxWidth,this._y-=this._boxY+this._handleY*this._boxHeight,this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),c.translate(this._x,this._y),this._relativeMatrix},o.prototype.get=function(p){if(typeof l[p]=="function")return l[p](this)},o.prototype.set=function(p,c){if(typeof p=="string")typeof u[p]=="function"&&typeof c!="undefined"&&u[p](this,c);else if(typeof p=="object")for(c in p)typeof u[c]=="function"&&typeof p[c]!="undefined"&&u[c](this,p[c],p);return this._owner&&(this._owner._ts_pin=++h,this._owner.touch()),this};var l={alpha:function(p){return p._alpha},textureAlpha:function(p){return p._textureAlpha},width:function(p){return p._width},height:function(p){return p._height},boxWidth:function(p){return p._boxWidth},boxHeight:function(p){return p._boxHeight},scaleX:function(p){return p._scaleX},scaleY:function(p){return p._scaleY},skewX:function(p){return p._skewX},skewY:function(p){return p._skewY},rotation:function(p){return p._rotation},pivotX:function(p){return p._pivotX},pivotY:function(p){return p._pivotY},offsetX:function(p){return p._offsetX},offsetY:function(p){return p._offsetY},alignX:function(p){return p._alignX},alignY:function(p){return p._alignY},handleX:function(p){return p._handleX},handleY:function(p){return p._handleY}},u={alpha:function(p,c){p._alpha=c},textureAlpha:function(p,c){p._textureAlpha=c},width:function(p,c){p._width_=c,p._width=c,p._ts_transform=++h},height:function(p,c){p._height_=c,p._height=c,p._ts_transform=++h},scale:function(p,c){p._scaleX=c,p._scaleY=c,p._ts_transform=++h},scaleX:function(p,c){p._scaleX=c,p._ts_transform=++h},scaleY:function(p,c){p._scaleY=c,p._ts_transform=++h},skew:function(p,c){p._skewX=c,p._skewY=c,p._ts_transform=++h},skewX:function(p,c){p._skewX=c,p._ts_transform=++h},skewY:function(p,c){p._skewY=c,p._ts_transform=++h},rotation:function(p,c){p._rotation=c,p._ts_transform=++h},pivot:function(p,c){p._pivotX=c,p._pivotY=c,p._pivoted=!0,p._ts_transform=++h},pivotX:function(p,c){p._pivotX=c,p._pivoted=!0,p._ts_transform=++h},pivotY:function(p,c){p._pivotY=c,p._pivoted=!0,p._ts_transform=++h},offset:function(p,c){p._offsetX=c,p._offsetY=c,p._ts_translate=++h},offsetX:function(p,c){p._offsetX=c,p._ts_translate=++h},offsetY:function(p,c){p._offsetY=c,p._ts_translate=++h},align:function(p,c){this.alignX(p,c),this.alignY(p,c)},alignX:function(p,c){p._alignX=c,p._aligned=!0,p._ts_translate=++h,this.handleX(p,c)},alignY:function(p,c){p._alignY=c,p._aligned=!0,p._ts_translate=++h,this.handleY(p,c)},handle:function(p,c){this.handleX(p,c),this.handleY(p,c)},handleX:function(p,c){p._handleX=c,p._handled=!0,p._ts_translate=++h},handleY:function(p,c){p._handleY=c,p._handled=!0,p._ts_translate=++h},resizeMode:function(p,c,f){f&&(c=="in"?c="in-pad":c=="out"&&(c="out-crop"),m(p,f.resizeWidth,f.resizeHeight,c))},resizeWidth:function(p,c,f){(!f||!f.resizeMode)&&m(p,c,null)},resizeHeight:function(p,c,f){(!f||!f.resizeMode)&&m(p,null,c)},scaleMode:function(p,c,f){f&&m(p,f.scaleWidth,f.scaleHeight,c)},scaleWidth:function(p,c,f){(!f||!f.scaleMode)&&m(p,c,null)},scaleHeight:function(p,c,f){(!f||!f.scaleMode)&&m(p,null,c)},matrix:function(p,c){this.scaleX(p,c.a),this.skewX(p,c.c/c.d),this.skewY(p,c.b/c.a),this.scaleY(p,c.d),this.offsetX(p,c.e),this.offsetY(p,c.f),this.rotation(p,0)}};function m(p,c,f,d){var y=typeof c=="number",_=typeof f=="number",v=typeof d=="string";p._ts_transform=++h,y&&(p._scaleX=c/p._width_,p._width=p._width_),_&&(p._scaleY=f/p._height_,p._height=p._height_),y&&_&&v&&(d=="out"||d=="out-crop"?p._scaleX=p._scaleY=Math.max(p._scaleX,p._scaleY):(d=="in"||d=="in-pad")&&(p._scaleX=p._scaleY=Math.min(p._scaleX,p._scaleY)),(d=="out-crop"||d=="in-pad")&&(p._width=c/p._scaleX,p._height=f/p._scaleY))}r.prototype.scaleTo=function(p,c,f){return typeof p=="object"&&(f=c,c=p.y,p=p.x),m(this._pin,p,c,f),this},o._add_shortcuts=function(p){p.prototype.size=function(c,f){return this.pin("width",c),this.pin("height",f),this},p.prototype.width=function(c){return typeof c=="undefined"?this.pin("width"):(this.pin("width",c),this)},p.prototype.height=function(c){return typeof c=="undefined"?this.pin("height"):(this.pin("height",c),this)},p.prototype.offset=function(c,f){return typeof c=="object"&&(f=c.y,c=c.x),this.pin("offsetX",c),this.pin("offsetY",f),this},p.prototype.rotate=function(c){return this.pin("rotation",c),this},p.prototype.skew=function(c,f){return typeof c=="object"?(f=c.y,c=c.x):typeof f=="undefined"&&(f=c),this.pin("skewX",c),this.pin("skewY",f),this},p.prototype.scale=function(c,f){return typeof c=="object"?(f=c.y,c=c.x):typeof f=="undefined"&&(f=c),this.pin("scaleX",c),this.pin("scaleY",f),this},p.prototype.alpha=function(c,f){return this.pin("alpha",c),typeof f!="undefined"&&this.pin("textureAlpha",f),this}},o._add_shortcuts(r),e.exports=o},function(e,n,s){e.exports=m,s(2);var r=s(6);s(1);var a=s(0),h=s(16),o=s(15),l={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535};function u(p,c){this.aabb=new h,this.fixture=p,this.childIndex=c,this.proxyId}function m(p,c,f){c.shape?(f=c,c=c.shape):typeof f=="number"&&(f={density:f}),f=r(f,l),this.m_body=p,this.m_friction=f.friction,this.m_restitution=f.restitution,this.m_density=f.density,this.m_isSensor=f.isSensor,this.m_filterGroupIndex=f.filterGroupIndex,this.m_filterCategoryBits=f.filterCategoryBits,this.m_filterMaskBits=f.filterMaskBits,this.m_shape=c,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var d=this.m_shape.getChildCount(),y=0;y<d;++y)this.m_proxies[y]=new u(this,y);this.m_userData=f.userData}m.prototype._reset=function(){var p=this.getBody(),c=p.m_world.m_broadPhase;this.destroyProxies(c),this.m_shape._reset&&this.m_shape._reset();for(var f=this.m_shape.getChildCount(),d=0;d<f;++d)this.m_proxies[d]=new u(this,d);this.createProxies(c,p.m_xf),p.resetMassData()},m.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},m._deserialize=function(p,c,f){var d=f(o,p.shape),y=d&&new m(c,d,p);return y},m.prototype.getType=function(){return this.m_shape.getType()},m.prototype.getShape=function(){return this.m_shape},m.prototype.isSensor=function(){return this.m_isSensor},m.prototype.setSensor=function(p){p!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=p)},m.prototype.getUserData=function(){return this.m_userData},m.prototype.setUserData=function(p){this.m_userData=p},m.prototype.getBody=function(){return this.m_body},m.prototype.getNext=function(){return this.m_next},m.prototype.getDensity=function(){return this.m_density},m.prototype.setDensity=function(p){this.m_density=p},m.prototype.getFriction=function(){return this.m_friction},m.prototype.setFriction=function(p){this.m_friction=p},m.prototype.getRestitution=function(){return this.m_restitution},m.prototype.setRestitution=function(p){this.m_restitution=p},m.prototype.testPoint=function(p){return this.m_shape.testPoint(this.m_body.getTransform(),p)},m.prototype.rayCast=function(p,c,f){return this.m_shape.rayCast(p,c,this.m_body.getTransform(),f)},m.prototype.getMassData=function(p){this.m_shape.computeMass(p,this.m_density)},m.prototype.getAABB=function(p){return this.m_proxies[p].aabb},m.prototype.createProxies=function(p,c){this.m_proxyCount=this.m_shape.getChildCount();for(var f=0;f<this.m_proxyCount;++f){var d=this.m_proxies[f];this.m_shape.computeAABB(d.aabb,c,f),d.proxyId=p.createProxy(d.aabb,d)}},m.prototype.destroyProxies=function(p){for(var c=0;c<this.m_proxyCount;++c){var f=this.m_proxies[c];p.destroyProxy(f.proxyId),f.proxyId=null}this.m_proxyCount=0},m.prototype.synchronize=function(p,c,f){for(var d=0;d<this.m_proxyCount;++d){var y=this.m_proxies[d],_=new h,v=new h;this.m_shape.computeAABB(_,c,y.childIndex),this.m_shape.computeAABB(v,f,y.childIndex),y.aabb.combine(_,v);var g=a.sub(f.p,c.p);p.moveProxy(y.proxyId,y.aabb,g)}},m.prototype.setFilterData=function(p){this.m_filterGroupIndex=p.groupIndex,this.m_filterCategoryBits=p.categoryBits,this.m_filterMaskBits=p.maskBits,this.refilter()},m.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},m.prototype.setFilterGroupIndex=function(p){return this.m_filterGroupIndex=p},m.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},m.prototype.setFilterCategoryBits=function(p){this.m_filterCategoryBits=p},m.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},m.prototype.setFilterMaskBits=function(p){this.m_filterMaskBits=p},m.prototype.refilter=function(){if(this.m_body!=null){for(var p=this.m_body.getContactList();p;){var c=p.contact,f=c.getFixtureA(),d=c.getFixtureB();(f==this||d==this)&&c.flagForFiltering(),p=p.next}var y=this.m_body.getWorld();if(y!=null)for(var _=y.m_broadPhase,v=0;v<this.m_proxyCount;++v)_.touchProxy(this.m_proxies[v].proxyId)}},m.prototype.shouldCollide=function(p){if(p.m_filterGroupIndex===this.m_filterGroupIndex&&p.m_filterGroupIndex!==0)return p.m_filterGroupIndex>0;var c=(p.m_filterMaskBits&this.m_filterCategoryBits)!=0,f=(p.m_filterCategoryBits&this.m_filterMaskBits)!=0,d=c&&f;return d}},function(e,n,s){n.toString=function(r){r=typeof r=="string"?r:`
`;var a="";for(var h in this)typeof this[h]!="function"&&typeof this[h]!="object"&&(a+=h+": "+this[h]+r);return a}},function(e,n,s){e.exports=u,s(2),s(6),s(1);var r=s(5);s(3);var a=s(0);s(16);var h=s(4),o=s(15),l=s(23);u._super=o,u.prototype=Object.create(u._super.prototype),u.TYPE="chain",o.TYPES[u.TYPE]=u;function u(m,p){if(!(this instanceof u))return new u(m,p);u._super.call(this),this.m_type=u.TYPE,this.m_radius=h.polygonRadius,this.m_vertices=[],this.m_count=0,this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_isLoop=p,m&&m.length&&(p?this._createLoop(m):this._createChain(m))}u.prototype._serialize=function(){const m={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex};return this.m_prevVertex&&(m.prevVertex=this.m_prevVertex),this.m_nextVertex&&(m.nextVertex=this.m_nextVertex),m},u._deserialize=function(m,p,c){var f=[];if(m.vertices)for(var d=0;d<m.vertices.length;d++)f.push(c(a,m.vertices[d]));var y=new u(f,m.isLoop);return m.prevVertex&&y.setPrevVertex(m.prevVertex),m.nextVertex&&y.setNextVertex(m.nextVertex),y},u.prototype._createLoop=function(m){for(var p=1;p<m.length;++p)m[p-1],m[p];this.m_vertices=[],this.m_count=m.length+1;for(var p=0;p<m.length;++p)this.m_vertices[p]=a.clone(m[p]);return this.m_vertices[m.length]=a.clone(m[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},u.prototype._createChain=function(m){for(var p=1;p<m.length;++p)m[p-1],m[p];this.m_count=m.length;for(var p=0;p<m.length;++p)this.m_vertices[p]=a.clone(m[p]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},u.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)},u.prototype.setPrevVertex=function(m){this.m_prevVertex=m,this.m_hasPrevVertex=!0},u.prototype.setNextVertex=function(m){this.m_nextVertex=m,this.m_hasNextVertex=!0},u.prototype._clone=function(){var m=new u;return m.createChain(this.m_vertices),m.m_type=this.m_type,m.m_radius=this.m_radius,m.m_prevVertex=this.m_prevVertex,m.m_nextVertex=this.m_nextVertex,m.m_hasPrevVertex=this.m_hasPrevVertex,m.m_hasNextVertex=this.m_hasNextVertex,m},u.prototype.getChildCount=function(){return this.m_count-1},u.prototype.getChildEdge=function(m,p){m.m_type=l.TYPE,m.m_radius=this.m_radius,m.m_vertex1=this.m_vertices[p],m.m_vertex2=this.m_vertices[p+1],p>0?(m.m_vertex0=this.m_vertices[p-1],m.m_hasVertex0=!0):(m.m_vertex0=this.m_prevVertex,m.m_hasVertex0=this.m_hasPrevVertex),p<this.m_count-2?(m.m_vertex3=this.m_vertices[p+2],m.m_hasVertex3=!0):(m.m_vertex3=this.m_nextVertex,m.m_hasVertex3=this.m_hasNextVertex)},u.prototype.getVertex=function(m){return m<this.m_count?this.m_vertices[m]:this.m_vertices[0]},u.prototype.testPoint=function(m,p){return!1},u.prototype.rayCast=function(m,p,c,f){var d=new l(this.getVertex(f),this.getVertex(f+1));return d.rayCast(m,p,c,0)},u.prototype.computeAABB=function(m,p,c){var f=r.mulVec2(p,this.getVertex(c)),d=r.mulVec2(p,this.getVertex(c+1));m.combinePoints(f,d)},u.prototype.computeMass=function(m,p){m.mass=0,m.center=a.neo(),m.I=0},u.prototype.computeDistanceProxy=function(m,p){m.m_buffer[0]=this.getVertex(p),m.m_buffer[1]=this.getVertex(p+1),m.m_vertices=m.m_buffer,m.m_count=2,m.m_radius=this.m_radius}},function(e,n,s){var r=s(19);s(25);var a=s(35);r.prototype._textures=null,r.prototype._alpha=1,r.prototype.render=function(h){if(!!this._visible){a.node++;var o=this.matrix();h.setTransform(o.a,o.b,o.c,o.d,o.e,o.f),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var l=this._pin._textureAlpha*this._alpha;if(h.globalAlpha!=l&&(h.globalAlpha=l),this._textures!==null)for(var u=0,m=this._textures.length;u<m;u++)this._textures[u].draw(h);h.globalAlpha!=this._alpha&&(h.globalAlpha=this._alpha);for(var p,c=this._first;p=c;)c=p._next,p.render(h)}},r.prototype._tickBefore=null,r.prototype._tickAfter=null,r.prototype.MAX_ELAPSE=1/0,r.prototype._tick=function(h,o,l){if(!!this._visible){h>this.MAX_ELAPSE&&(h=this.MAX_ELAPSE);var u=!1;if(this._tickBefore!==null)for(var m=0;m<this._tickBefore.length;m++){a.tick++;var p=this._tickBefore[m];u=p.call(this,h,o,l)===!0||u}for(var c,f=this._first;c=f;)f=c._next,c._flag("_tick")&&(u=c._tick(h,o,l)===!0?!0:u);if(this._tickAfter!==null)for(var m=0;m<this._tickAfter.length;m++){a.tick++;var p=this._tickAfter[m];u=p.call(this,h,o,l)===!0||u}return u}},r.prototype.tick=function(h,o){typeof h=="function"&&(o?(this._tickBefore===null&&(this._tickBefore=[]),this._tickBefore.push(h)):(this._tickAfter===null&&(this._tickAfter=[]),this._tickAfter.push(h)),this._flag("_tick",this._tickAfter!==null&&this._tickAfter.length>0||this._tickBefore!==null&&this._tickBefore.length>0))},r.prototype.untick=function(h){if(typeof h=="function"){var o;this._tickBefore!==null&&(o=this._tickBefore.indexOf(h))>=0&&this._tickBefore.splice(o,1),this._tickAfter!==null&&(o=this._tickAfter.indexOf(h))>=0&&this._tickAfter.splice(o,1)}},r.prototype.timeout=function(h,o){this.setTimeout(h,o)},r.prototype.setTimeout=function(h,o){function l(u){if((o-=u)<0)this.untick(l),h.call(this);else return!0}return this.tick(l),l},r.prototype.clearTimeout=function(h){this.untick(h)}},function(e,n,s){e.exports=c;var r=s(6);s(2);var a=s(0),h=s(40),o=s(42),l=s(8),u=s(11),m=s(17),p={gravity:a.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3};function c(d){if(!(this instanceof c))return new c(d);d&&a.isValid(d)&&(d={gravity:d}),d=r(d,p),this.m_solver=new o(this),this.m_broadPhase=new h,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=d.allowSleep,this.m_gravity=a.clone(d.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=d.warmStarting,this.m_continuousPhysics=d.continuousPhysics,this.m_subStepping=d.subStepping,this.m_blockSolve=d.blockSolve,this.m_velocityIterations=d.velocityIterations,this.m_positionIterations=d.positionIterations,this.m_t=0,this.addPair=this.createContact.bind(this)}c.prototype._serialize=function(){for(var d=[],y=[],_=this.getBodyList();_;_=_.getNext())d.push(_);for(var v=this.getJointList();v;v=v.getNext())typeof v._serialize=="function"&&y.push(v);return{gravity:this.m_gravity,bodies:d,joints:y}},c._deserialize=function(d,y,_){if(!d)return new c;var v=new c(d.gravity);if(d.bodies)for(var g=d.bodies.length-1;g>=0;g-=1)v._addBody(_(l,d.bodies[g],v));if(d.joints)for(var g=d.joints.length-1;g>=0;g--)v.createJoint(_(u,d.joints[g],v));return v},c.prototype.getBodyList=function(){return this.m_bodyList},c.prototype.getJointList=function(){return this.m_jointList},c.prototype.getContactList=function(){return this.m_contactList},c.prototype.getBodyCount=function(){return this.m_bodyCount},c.prototype.getJointCount=function(){return this.m_jointCount},c.prototype.getContactCount=function(){return this.m_contactCount},c.prototype.setGravity=function(d){this.m_gravity=d},c.prototype.getGravity=function(){return this.m_gravity},c.prototype.isLocked=function(){return this.m_locked},c.prototype.setAllowSleeping=function(d){if(d!=this.m_allowSleep&&(this.m_allowSleep=d,this.m_allowSleep==!1))for(var y=this.m_bodyList;y;y=y.m_next)y.setAwake(!0)},c.prototype.getAllowSleeping=function(){return this.m_allowSleep},c.prototype.setWarmStarting=function(d){this.m_warmStarting=d},c.prototype.getWarmStarting=function(){return this.m_warmStarting},c.prototype.setContinuousPhysics=function(d){this.m_continuousPhysics=d},c.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},c.prototype.setSubStepping=function(d){this.m_subStepping=d},c.prototype.getSubStepping=function(){return this.m_subStepping},c.prototype.setAutoClearForces=function(d){this.m_clearForces=d},c.prototype.getAutoClearForces=function(){return this.m_clearForces},c.prototype.clearForces=function(){for(var d=this.m_bodyList;d;d=d.getNext())d.m_force.setZero(),d.m_torque=0},c.prototype.queryAABB=function(d,y){var _=this.m_broadPhase;this.m_broadPhase.query(d,function(v){var g=_.getUserData(v);return y(g.fixture)})},c.prototype.rayCast=function(d,y,_){var v=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:d,p2:y},function(g,x){var A=v.getUserData(x),b=A.fixture,M=A.childIndex,S={},B=b.rayCast(S,g,M);if(B){var E=S.fraction,T=a.add(a.mul(1-E,g.p1),a.mul(E,g.p2));return _(b,T,S.normal,E)}return g.maxFraction})},c.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},c.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},c.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},c.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},c.prototype.shiftOrigin=function(d){if(!this.m_locked){for(var y=this.m_bodyList;y;y=y.m_next)y.m_xf.p.sub(d),y.m_sweep.c0.sub(d),y.m_sweep.c.sub(d);for(var _=this.m_jointList;_;_=_.m_next)_.shiftOrigin(d);this.m_broadPhase.shiftOrigin(d)}},c.prototype._addBody=function(d){this.isLocked()||(d.m_prev=null,d.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=d),this.m_bodyList=d,++this.m_bodyCount)},c.prototype.createBody=function(d,y){if(this.isLocked())return null;d&&a.isValid(d)&&(d={position:d,angle:y});var _=new l(this,d);return this._addBody(_),_},c.prototype.createDynamicBody=function(d,y){return d?a.isValid(d)&&(d={position:d,angle:y}):d={},d.type="dynamic",this.createBody(d)},c.prototype.createKinematicBody=function(d,y){return d?a.isValid(d)&&(d={position:d,angle:y}):d={},d.type="kinematic",this.createBody(d)},c.prototype.destroyBody=function(d){if(!this.isLocked()){if(d.m_destroyed)return!1;for(var y=d.m_jointList;y;){var _=y;y=y.next,this.publish("remove-joint",_.joint),this.destroyJoint(_.joint),d.m_jointList=y}d.m_jointList=null;for(var v=d.m_contactList;v;){var g=v;v=v.next,this.destroyContact(g.contact),d.m_contactList=v}d.m_contactList=null;for(var x=d.m_fixtureList;x;){var A=x;x=x.m_next,this.publish("remove-fixture",A),A.destroyProxies(this.m_broadPhase),d.m_fixtureList=x}return d.m_fixtureList=null,d.m_prev&&(d.m_prev.m_next=d.m_next),d.m_next&&(d.m_next.m_prev=d.m_prev),d==this.m_bodyList&&(this.m_bodyList=d.m_next),d.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",d),!0}},c.prototype.createJoint=function(d){if(this.isLocked())return null;if(d.m_prev=null,d.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=d),this.m_jointList=d,++this.m_jointCount,d.m_edgeA.joint=d,d.m_edgeA.other=d.m_bodyB,d.m_edgeA.prev=null,d.m_edgeA.next=d.m_bodyA.m_jointList,d.m_bodyA.m_jointList&&(d.m_bodyA.m_jointList.prev=d.m_edgeA),d.m_bodyA.m_jointList=d.m_edgeA,d.m_edgeB.joint=d,d.m_edgeB.other=d.m_bodyA,d.m_edgeB.prev=null,d.m_edgeB.next=d.m_bodyB.m_jointList,d.m_bodyB.m_jointList&&(d.m_bodyB.m_jointList.prev=d.m_edgeB),d.m_bodyB.m_jointList=d.m_edgeB,d.m_collideConnected==!1)for(var y=d.m_bodyB.getContactList();y;y=y.next)y.other==d.m_bodyA&&y.contact.flagForFiltering();return d},c.prototype.destroyJoint=function(d){if(!this.isLocked()){d.m_prev&&(d.m_prev.m_next=d.m_next),d.m_next&&(d.m_next.m_prev=d.m_prev),d==this.m_jointList&&(this.m_jointList=d.m_next);var y=d.m_bodyA,_=d.m_bodyB;if(y.setAwake(!0),_.setAwake(!0),d.m_edgeA.prev&&(d.m_edgeA.prev.next=d.m_edgeA.next),d.m_edgeA.next&&(d.m_edgeA.next.prev=d.m_edgeA.prev),d.m_edgeA==y.m_jointList&&(y.m_jointList=d.m_edgeA.next),d.m_edgeA.prev=null,d.m_edgeA.next=null,d.m_edgeB.prev&&(d.m_edgeB.prev.next=d.m_edgeB.next),d.m_edgeB.next&&(d.m_edgeB.next.prev=d.m_edgeB.prev),d.m_edgeB==_.m_jointList&&(_.m_jointList=d.m_edgeB.next),d.m_edgeB.prev=null,d.m_edgeB.next=null,--this.m_jointCount,d.m_collideConnected==!1)for(var v=_.getContactList();v;)v.other==y&&v.contact.flagForFiltering(),v=v.next;this.publish("remove-joint",d)}};var f=new o.TimeStep;c.prototype.step=function(d,y,_){if(this.publish("pre-step",d),(y|0)!==y&&(y=0),y=y||this.m_velocityIterations,_=_||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,f.reset(d),f.velocityIterations=y,f.positionIterations=_,f.warmStarting=this.m_warmStarting,f.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&d>0){this.m_solver.solveWorld(f);for(var v=this.m_bodyList;v;v=v.getNext())v.m_islandFlag!=!1&&(v.isStatic()||v.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&d>0&&this.m_solver.solveWorldTOI(f),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",d)},c.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.addPair)},c.prototype.createContact=function(d,y){var _=d.fixture,v=y.fixture,g=d.childIndex,x=y.childIndex,A=_.getBody(),b=v.getBody();if(A!=b){for(var M=b.getContactList();M;){if(M.other==A){var S=M.contact.getFixtureA(),B=M.contact.getFixtureB(),E=M.contact.getChildIndexA(),T=M.contact.getChildIndexB();if(S==_&&B==v&&E==g&&T==x||S==v&&B==_&&E==x&&T==g)return}M=M.next}if(b.shouldCollide(A)!=!1&&v.shouldCollide(_)!=!1){var w=m.create(_,g,v,x);w!=null&&(w.m_prev=null,this.m_contactList!=null&&(w.m_next=this.m_contactList,this.m_contactList.m_prev=w),this.m_contactList=w,++this.m_contactCount)}}},c.prototype.updateContacts=function(){for(var d,y=this.m_contactList;d=y;){y=d.getNext();var _=d.getFixtureA(),v=d.getFixtureB(),g=d.getChildIndexA(),x=d.getChildIndexB(),A=_.getBody(),b=v.getBody();if(d.m_filterFlag){if(b.shouldCollide(A)==!1){this.destroyContact(d);continue}if(v.shouldCollide(_)==!1){this.destroyContact(d);continue}d.m_filterFlag=!1}var M=A.isAwake()&&!A.isStatic(),S=b.isAwake()&&!b.isStatic();if(!(M==!1&&S==!1)){var B=_.m_proxies[g].proxyId,E=v.m_proxies[x].proxyId,T=this.m_broadPhase.testOverlap(B,E);if(T==!1){this.destroyContact(d);continue}d.update(this)}}},c.prototype.destroyContact=function(d){m.destroy(d,this),d.m_prev&&(d.m_prev.m_next=d.m_next),d.m_next&&(d.m_next.m_prev=d.m_prev),d==this.m_contactList&&(this.m_contactList=d.m_next),--this.m_contactCount},c.prototype._listeners=null,c.prototype.on=function(d,y){return typeof d!="string"||typeof y!="function"?this:(this._listeners||(this._listeners={}),this._listeners[d]||(this._listeners[d]=[]),this._listeners[d].push(y),this)},c.prototype.off=function(d,y){if(typeof d!="string"||typeof y!="function")return this;var _=this._listeners&&this._listeners[d];if(!_||!_.length)return this;var v=_.indexOf(y);return v>=0&&_.splice(v,1),this},c.prototype.publish=function(d,y,_,v){var g=this._listeners&&this._listeners[d];if(!g||!g.length)return 0;for(var x=0;x<g.length;x++)g[x].call(this,y,_,v);return g.length},c.prototype.beginContact=function(d){this.publish("begin-contact",d)},c.prototype.endContact=function(d){this.publish("end-contact",d)},c.prototype.preSolve=function(d,y){this.publish("pre-solve",d,y)},c.prototype.postSolve=function(d,y){this.publish("post-solve",d,y)}},function(e,n,s){var r=s(4);s(2);var a=s(41),h=s(0),o=s(1),l=s(16);e.exports=m;function u(y){this.id=y,this.aabb=new l,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.toString=function(){return this.id+": "+this.userData}}u.prototype.isLeaf=function(){return this.child1==null};function m(){this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new a({create:function(){return new u}})}m.prototype.getUserData=function(y){var _=this.m_nodes[y];return _.userData},m.prototype.getFatAABB=function(y){var _=this.m_nodes[y];return _.aabb},m.prototype.allocateNode=function(){var y=this.m_pool.allocate();return y.id=++this.m_lastProxyId,y.userData=null,y.parent=null,y.child1=null,y.child2=null,y.height=-1,this.m_nodes[y.id]=y,y},m.prototype.freeNode=function(y){this.m_pool.release(y),y.height=-1,delete this.m_nodes[y.id]},m.prototype.createProxy=function(y,_){var v=this.allocateNode();return v.aabb.set(y),l.extend(v.aabb,r.aabbExtension),v.userData=_,v.height=0,this.insertLeaf(v),v.id},m.prototype.destroyProxy=function(y){var _=this.m_nodes[y];this.removeLeaf(_),this.freeNode(_)},m.prototype.moveProxy=function(y,_,v){var g=this.m_nodes[y];return g.aabb.contains(_)?!1:(this.removeLeaf(g),g.aabb.set(_),_=g.aabb,l.extend(_,r.aabbExtension),v.x<0?_.lowerBound.x+=v.x*r.aabbMultiplier:_.upperBound.x+=v.x*r.aabbMultiplier,v.y<0?_.lowerBound.y+=v.y*r.aabbMultiplier:_.upperBound.y+=v.y*r.aabbMultiplier,this.insertLeaf(g),!0)},m.prototype.insertLeaf=function(y){if(this.m_root==null){this.m_root=y,this.m_root.parent=null;return}for(var _=y.aabb,v=this.m_root;v.isLeaf()==!1;){var g=v.child1,x=v.child2,A=v.aabb.getPerimeter(),b=new l;b.combine(v.aabb,_);var M=b.getPerimeter(),S=2*M,B=2*(M-A),E;if(g.isLeaf()){var T=new l;T.combine(_,g.aabb),E=T.getPerimeter()+B}else{var T=new l;T.combine(_,g.aabb);var w=g.aabb.getPerimeter(),C=T.getPerimeter();E=C-w+B}var P;if(x.isLeaf()){var T=new l;T.combine(_,x.aabb),P=T.getPerimeter()+B}else{var T=new l;T.combine(_,x.aabb);var w=x.aabb.getPerimeter(),C=T.getPerimeter();P=C-w+B}if(S<E&&S<P)break;E<P?v=g:v=x}var R=v,L=R.parent,I=this.allocateNode();for(I.parent=L,I.userData=null,I.aabb.combine(_,R.aabb),I.height=R.height+1,L!=null?(L.child1==R?L.child1=I:L.child2=I,I.child1=R,I.child2=y,R.parent=I,y.parent=I):(I.child1=R,I.child2=y,R.parent=I,y.parent=I,this.m_root=I),v=y.parent;v!=null;){v=this.balance(v);var g=v.child1,x=v.child2;v.height=1+o.max(g.height,x.height),v.aabb.combine(g.aabb,x.aabb),v=v.parent}},m.prototype.removeLeaf=function(y){if(y==this.m_root){this.m_root=null;return}var _=y.parent,v=_.parent,g;if(_.child1==y?g=_.child2:g=_.child1,v!=null){v.child1==_?v.child1=g:v.child2=g,g.parent=v,this.freeNode(_);for(var x=v;x!=null;){x=this.balance(x);var A=x.child1,b=x.child2;x.aabb.combine(A.aabb,b.aabb),x.height=1+o.max(A.height,b.height),x=x.parent}}else this.m_root=g,g.parent=null,this.freeNode(_)},m.prototype.balance=function(y){var _=y;if(_.isLeaf()||_.height<2)return y;var v=_.child1,g=_.child2,x=g.height-v.height;if(x>1){var A=g.child1,b=g.child2;return g.child1=_,g.parent=_.parent,_.parent=g,g.parent!=null?g.parent.child1==y?g.parent.child1=g:g.parent.child2=g:this.m_root=g,A.height>b.height?(g.child2=A,_.child2=b,b.parent=_,_.aabb.combine(v.aabb,b.aabb),g.aabb.combine(_.aabb,A.aabb),_.height=1+o.max(v.height,b.height),g.height=1+o.max(_.height,A.height)):(g.child2=b,_.child2=A,A.parent=_,_.aabb.combine(v.aabb,A.aabb),g.aabb.combine(_.aabb,b.aabb),_.height=1+o.max(v.height,A.height),g.height=1+o.max(_.height,b.height)),g}if(x<-1){var M=v.child1,S=v.child2;return v.child1=_,v.parent=_.parent,_.parent=v,v.parent!=null?v.parent.child1==_?v.parent.child1=v:v.parent.child2=v:this.m_root=v,M.height>S.height?(v.child2=M,_.child1=S,S.parent=_,_.aabb.combine(g.aabb,S.aabb),v.aabb.combine(_.aabb,M.aabb),_.height=1+o.max(g.height,S.height),v.height=1+o.max(_.height,M.height)):(v.child2=S,_.child1=M,M.parent=_,_.aabb.combine(g.aabb,M.aabb),v.aabb.combine(_.aabb,S.aabb),_.height=1+o.max(g.height,M.height),v.height=1+o.max(_.height,S.height)),v}return _},m.prototype.getHeight=function(){return this.m_root==null?0:this.m_root.height},m.prototype.getAreaRatio=function(){if(this.m_root==null)return 0;for(var y=this.m_root,_=y.aabb.getPerimeter(),v=0,g,x=f.allocate().preorder(this.m_root);g=x.next();)g.height<0||(v+=g.aabb.getPerimeter());return f.release(x),v/_},m.prototype.computeHeight=function(y){var _;if(typeof y!="undefined"?_=this.m_nodes[y]:_=this.m_root,_.isLeaf())return 0;var v=this.computeHeight(_.child1.id),g=this.computeHeight(_.child2.id);return 1+o.max(v,g)},m.prototype.validateStructure=function(y){if(y!=null){y==this.m_root;var _=y.child1,v=y.child2;y.isLeaf()||(this.validateStructure(_),this.validateStructure(v))}},m.prototype.validateMetrics=function(y){if(y!=null){var _=y.child1,v=y.child2;if(!y.isLeaf()){var g=_.height,x=v.height;1+o.max(g,x);var A=new l;A.combine(_.aabb,v.aabb),this.validateMetrics(_),this.validateMetrics(v)}}},m.prototype.validate=function(){this.validateStructure(this.m_root),this.validateMetrics(this.m_root)},m.prototype.getMaxBalance=function(){for(var y=0,_,v=f.allocate().preorder(this.m_root);_=v.next();)if(!(_.height<=1)){var g=o.abs(_.child2.height-_.child1.height);y=o.max(y,g)}return f.release(v),y},m.prototype.rebuildBottomUp=function(){for(var y=[],_=0,v,g=f.allocate().preorder(this.m_root);v=g.next();)v.height<0||(v.isLeaf()?(v.parent=null,y[_]=v,++_):this.freeNode(v));for(f.release(g);_>1;){for(var x=1/0,A=-1,b=-1,M=0;M<_;++M)for(var S=y[M].aabb,B=M+1;B<_;++B){var E=y[B].aabb,T=new l;T.combine(S,E);var w=T.getPerimeter();w<x&&(A=M,b=B,x=w)}var C=y[A],P=y[b],R=this.allocateNode();R.child1=C,R.child2=P,R.height=1+o.max(C.height,P.height),R.aabb.combine(C.aabb,P.aabb),R.parent=null,C.parent=R,P.parent=R,y[b]=y[_-1],y[A]=R,--_}this.m_root=y[0],this.validate()},m.prototype.shiftOrigin=function(y){for(var _,v=f.allocate().preorder(this.m_root);_=v.next();){var g=_.aabb;g.lowerBound.x-=y.x,g.lowerBound.y-=y.y,g.upperBound.x-=y.x,g.upperBound.y-=y.y}f.release(v)},m.prototype.query=function(y,_){var v=c.allocate();for(v.push(this.m_root);v.length>0;){var g=v.pop();if(g!=null&&l.testOverlap(g.aabb,y))if(g.isLeaf()){var x=_(g.id);if(x==!1)return}else v.push(g.child1),v.push(g.child2)}c.release(v)},m.prototype.rayCast=function(y,_){var v=y.p1,g=y.p2,x=h.sub(g,v);x.normalize();var A=h.cross(1,x),b=h.abs(A),M=y.maxFraction,S=new l,B=h.combine(1-M,v,M,g);S.combinePoints(v,B);var E=c.allocate(),T=p.allocate();for(E.push(this.m_root);E.length>0;){var w=E.pop();if(w!=null&&l.testOverlap(w.aabb,S)!=!1){var C=w.aabb.getCenter(),P=w.aabb.getExtents(),R=o.abs(h.dot(A,h.sub(v,C)))-h.dot(b,P);if(!(R>0))if(w.isLeaf()){T.p1=h.clone(y.p1),T.p2=h.clone(y.p2),T.maxFraction=M;var L=_(T,w.id);if(L==0)return;L>0&&(M=L,B=h.combine(1-M,v,M,g),S.combinePoints(v,B))}else E.push(w.child1),E.push(w.child2)}}c.release(E),p.release(T)};var p=new a({create:function(){return{}},release:function(y){}}),c=new a({create:function(){return[]},release:function(y){y.length=0}}),f=new a({create:function(){return new d},release:function(y){y.close()}});function d(){var y=[],_=[];return{preorder:function(v){return y.length=0,y.push(v),_.length=0,_.push(0),this},next:function(){for(;y.length>0;){var v=y.length-1,g=y[v];if(_[v]===0)return _[v]=1,g;if(_[v]===1&&(_[v]=2,g.child1))return y.push(g.child1),_.push(1),g.child1;if(_[v]===2&&(_[v]=3,g.child2))return y.push(g.child2),_.push(1),g.child2;y.pop(),_.pop()}},close:function(){y.length=0}}}},function(e,n,s){e.exports=x,e.exports.Input=v,e.exports.Output=g;var r=s(4);s(2);var a=s(43),h=s(27),o=s(1),l=s(0);s(7),s(10),s(14);var u=s(3),m=s(9),p=s(5);s(12),s(13);var c=s(21),f=c.Input,d=c.Output,y=c.Proxy,_=c.Cache;function v(){this.proxyA=new y,this.proxyB=new y,this.sweepA=new m,this.sweepB=new m,this.tMax}g.e_unknown=0,g.e_failed=1,g.e_overlapped=2,g.e_touching=3,g.e_separated=4;function g(){this.state,this.t}h.toiTime=0,h.toiMaxTime=0,h.toiCalls=0,h.toiIters=0,h.toiMaxIters=0,h.toiRootIters=0,h.toiMaxRootIters=0;function x(B,E){var T=a.now();++h.toiCalls,B.state=g.e_unknown,B.t=E.tMax;var w=E.proxyA,C=E.proxyB,P=E.sweepA,R=E.sweepB;P.normalize(),R.normalize();var L=E.tMax,I=w.m_radius+C.m_radius,z=o.max(r.linearSlop,I-3*r.linearSlop),F=.25*r.linearSlop,D=0,V=r.maxTOIIterations,G=0,Y=new _,J=new f;for(J.proxyA=E.proxyA,J.proxyB=E.proxyB,J.useRadii=!1;;){var Q=p.identity(),W=p.identity();P.getTransform(Q,D),R.getTransform(W,D),J.transformA=Q,J.transformB=W;var et=new d;if(c(et,Y,J),et.distance<=0){B.state=g.e_overlapped,B.t=0;break}if(et.distance<z+F){B.state=g.e_touching,B.t=D;break}var ct=new S;ct.initialize(Y,w,P,C,R,D);for(var Z=!1,ot=L,xt=0;;){var q=ct.findMinSeparation(ot);if(ct.indexA,ct.indexB,q>z+F){B.state=g.e_separated,B.t=L,Z=!0;break}if(q>z-F){D=ot;break}var X=ct.evaluate(D);if(ct.indexA,ct.indexB,X<z-F){B.state=g.e_failed,B.t=D,Z=!0;break}if(X<=z+F){B.state=g.e_touching,B.t=D,Z=!0;break}for(var at=0,ut=D,it=ot;;){var st;at&1?st=ut+(z-X)*(it-ut)/(q-X):st=.5*(ut+it),++at,++h.toiRootIters;var dt=ct.evaluate(st);if(ct.indexA,ct.indexB,o.abs(dt-z)<F){ot=st;break}if(dt>z?(ut=st,X=dt):(it=st,q=dt),at==50)break}if(h.toiMaxRootIters=o.max(h.toiMaxRootIters,at),++xt,xt==r.maxPolygonVertices)break}if(++G,++h.toiIters,Z)break;if(G==V){B.state=g.e_failed,B.t=D;break}}h.toiMaxIters=o.max(h.toiMaxIters,G);var mt=a.diff(T);h.toiMaxTime=o.max(h.toiMaxTime,mt),h.toiTime+=mt}var A=1,b=2,M=3;function S(){this.m_proxyA=new y,this.m_proxyB=new y,this.m_sweepA,this.m_sweepB,this.indexA,this.indexB,this.m_type,this.m_localPoint=l.zero(),this.m_axis=l.zero()}S.prototype.initialize=function(B,E,T,w,C,P){this.m_proxyA=E,this.m_proxyB=w;var R=B.count;this.m_sweepA=T,this.m_sweepB=C;var L=p.identity(),I=p.identity();if(this.m_sweepA.getTransform(L,P),this.m_sweepB.getTransform(I,P),R==1){this.m_type=A;var z=this.m_proxyA.getVertex(B.indexA[0]),F=this.m_proxyB.getVertex(B.indexB[0]),D=p.mulVec2(L,z),V=p.mulVec2(I,F);this.m_axis.setCombine(1,V,-1,D);var G=this.m_axis.normalize();return G}else if(B.indexA[0]==B.indexA[1]){this.m_type=M;var Y=w.getVertex(B.indexB[0]),J=w.getVertex(B.indexB[1]);this.m_axis=l.cross(l.sub(J,Y),1),this.m_axis.normalize();var Q=u.mulVec2(I.q,this.m_axis);this.m_localPoint=l.mid(Y,J);var V=p.mulVec2(I,this.m_localPoint),z=E.getVertex(B.indexA[0]),D=p.mulVec2(L,z),G=l.dot(D,Q)-l.dot(V,Q);return G<0&&(this.m_axis=l.neg(this.m_axis),G=-G),G}else{this.m_type=b;var W=this.m_proxyA.getVertex(B.indexA[0]),et=this.m_proxyA.getVertex(B.indexA[1]);this.m_axis=l.cross(l.sub(et,W),1),this.m_axis.normalize();var Q=u.mulVec2(L.q,this.m_axis);this.m_localPoint=l.mid(W,et);var D=p.mulVec2(L,this.m_localPoint),F=this.m_proxyB.getVertex(B.indexB[0]),V=p.mulVec2(I,F),G=l.dot(V,Q)-l.dot(D,Q);return G<0&&(this.m_axis=l.neg(this.m_axis),G=-G),G}},S.prototype.compute=function(B,E){var T=p.identity(),w=p.identity();switch(this.m_sweepA.getTransform(T,E),this.m_sweepB.getTransform(w,E),this.m_type){case A:{if(B){var C=u.mulTVec2(T.q,this.m_axis),P=u.mulTVec2(w.q,l.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(C),this.indexB=this.m_proxyB.getSupport(P)}var R=this.m_proxyA.getVertex(this.indexA),L=this.m_proxyB.getVertex(this.indexB),I=p.mulVec2(T,R),z=p.mulVec2(w,L),F=l.dot(z,this.m_axis)-l.dot(I,this.m_axis);return F}case b:{var D=u.mulVec2(T.q,this.m_axis),I=p.mulVec2(T,this.m_localPoint);if(B){var P=u.mulTVec2(w.q,l.neg(D));this.indexA=-1,this.indexB=this.m_proxyB.getSupport(P)}var L=this.m_proxyB.getVertex(this.indexB),z=p.mulVec2(w,L),F=l.dot(z,D)-l.dot(I,D);return F}case M:{var D=u.mulVec2(w.q,this.m_axis),z=p.mulVec2(w,this.m_localPoint);if(B){var C=u.mulTVec2(T.q,l.neg(D));this.indexB=-1,this.indexA=this.m_proxyA.getSupport(C)}var R=this.m_proxyA.getVertex(this.indexA),I=p.mulVec2(T,R),F=l.dot(I,D)-l.dot(z,D);return F}default:return B&&(this.indexA=-1,this.indexB=-1),0}},S.prototype.findMinSeparation=function(B){return this.compute(!0,B)},S.prototype.evaluate=function(B){return this.compute(!1,B)}},function(e,n,s){e.exports=x,s(2);var r=s(6),a=s(4),h=s(1),o=s(0),l=s(7),u=s(10),m=s(14),p=s(3);s(9),s(5),s(12),s(13);var c=s(11),f=s(8),d=0,y=1,_=2,v=3;x.TYPE="revolute-joint",c.TYPES[x.TYPE]=x,x._super=c,x.prototype=Object.create(x._super.prototype);var g={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1};function x(A,b,M,S){if(!(this instanceof x))return new x(A,b,M,S);A=r(A,g),c.call(this,A,b,M),b=this.m_bodyA,M=this.m_bodyB,this.m_type=x.TYPE,this.m_localAnchorA=o.clone(S?b.getLocalPoint(S):A.localAnchorA||o.zero()),this.m_localAnchorB=o.clone(S?M.getLocalPoint(S):A.localAnchorB||o.zero()),this.m_referenceAngle=h.isFinite(A.referenceAngle)?A.referenceAngle:M.getAngle()-b.getAngle(),this.m_impulse=l(),this.m_motorImpulse=0,this.m_lowerAngle=A.lowerAngle,this.m_upperAngle=A.upperAngle,this.m_maxMotorTorque=A.maxMotorTorque,this.m_motorSpeed=A.motorSpeed,this.m_enableLimit=A.enableLimit,this.m_enableMotor=A.enableMotor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new m,this.m_motorMass,this.m_limitState=d}x.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},x._deserialize=function(A,b,M){A=Object.assign({},A),A.bodyA=M(f,A.bodyA,b),A.bodyB=M(f,A.bodyB,b);var S=new x(A);return S},x.prototype._setAnchors=function(A){A.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(A.anchorA)):A.localAnchorA&&this.m_localAnchorA.set(A.localAnchorA),A.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(A.anchorB)):A.localAnchorB&&this.m_localAnchorB.set(A.localAnchorB)},x.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},x.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},x.prototype.getReferenceAngle=function(){return this.m_referenceAngle},x.prototype.getJointAngle=function(){var A=this.m_bodyA,b=this.m_bodyB;return b.m_sweep.a-A.m_sweep.a-this.m_referenceAngle},x.prototype.getJointSpeed=function(){var A=this.m_bodyA,b=this.m_bodyB;return b.m_angularVelocity-A.m_angularVelocity},x.prototype.isMotorEnabled=function(){return this.m_enableMotor},x.prototype.enableMotor=function(A){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=A},x.prototype.getMotorTorque=function(A){return A*this.m_motorImpulse},x.prototype.setMotorSpeed=function(A){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=A},x.prototype.getMotorSpeed=function(){return this.m_motorSpeed},x.prototype.setMaxMotorTorque=function(A){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=A},x.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},x.prototype.isLimitEnabled=function(){return this.m_enableLimit},x.prototype.enableLimit=function(A){A!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=A,this.m_impulse.z=0)},x.prototype.getLowerLimit=function(){return this.m_lowerAngle},x.prototype.getUpperLimit=function(){return this.m_upperAngle},x.prototype.setLimits=function(A,b){(A!=this.m_lowerAngle||b!=this.m_upperAngle)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=A,this.m_upperAngle=b)},x.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},x.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},x.prototype.getReactionForce=function(A){return o.neo(this.m_impulse.x,this.m_impulse.y).mul(A)},x.prototype.getReactionTorque=function(A){return A*this.m_impulse.z},x.prototype.initVelocityConstraints=function(A){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var b=this.m_bodyA.c_position.a,M=this.m_bodyA.c_velocity.v,S=this.m_bodyA.c_velocity.w,B=this.m_bodyB.c_position.a,E=this.m_bodyB.c_velocity.v,T=this.m_bodyB.c_velocity.w,w=p.neo(b),C=p.neo(B);this.m_rA=p.mulVec2(w,o.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=p.mulVec2(C,o.sub(this.m_localAnchorB,this.m_localCenterB));var P=this.m_invMassA,R=this.m_invMassB,L=this.m_invIA,I=this.m_invIB,z=L+I===0;if(this.m_mass.ex.x=P+R+this.m_rA.y*this.m_rA.y*L+this.m_rB.y*this.m_rB.y*I,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*L-this.m_rB.y*this.m_rB.x*I,this.m_mass.ez.x=-this.m_rA.y*L-this.m_rB.y*I,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=P+R+this.m_rA.x*this.m_rA.x*L+this.m_rB.x*this.m_rB.x*I,this.m_mass.ez.y=this.m_rA.x*L+this.m_rB.x*I,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=L+I,this.m_motorMass=L+I,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(this.m_enableMotor==!1||z)&&(this.m_motorImpulse=0),this.m_enableLimit&&z==!1){var F=B-b-this.m_referenceAngle;h.abs(this.m_upperAngle-this.m_lowerAngle)<2*a.angularSlop?this.m_limitState=v:F<=this.m_lowerAngle?(this.m_limitState!=y&&(this.m_impulse.z=0),this.m_limitState=y):F>=this.m_upperAngle?(this.m_limitState!=_&&(this.m_impulse.z=0),this.m_limitState=_):(this.m_limitState=d,this.m_impulse.z=0)}else this.m_limitState=d;if(A.warmStarting){this.m_impulse.mul(A.dtRatio),this.m_motorImpulse*=A.dtRatio;var D=o.neo(this.m_impulse.x,this.m_impulse.y);M.subMul(P,D),S-=L*(o.cross(this.m_rA,D)+this.m_motorImpulse+this.m_impulse.z),E.addMul(R,D),T+=I*(o.cross(this.m_rB,D)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=M,this.m_bodyA.c_velocity.w=S,this.m_bodyB.c_velocity.v=E,this.m_bodyB.c_velocity.w=T},x.prototype.solveVelocityConstraints=function(A){var b=this.m_bodyA.c_velocity.v,M=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,B=this.m_bodyB.c_velocity.w,E=this.m_invMassA,T=this.m_invMassB,w=this.m_invIA,C=this.m_invIB,P=w+C===0;if(this.m_enableMotor&&this.m_limitState!=v&&P==!1){var R=B-M-this.m_motorSpeed,L=-this.m_motorMass*R,I=this.m_motorImpulse,z=A.dt*this.m_maxMotorTorque;this.m_motorImpulse=h.clamp(this.m_motorImpulse+L,-z,z),L=this.m_motorImpulse-I,M-=w*L,B+=C*L}if(this.m_enableLimit&&this.m_limitState!=d&&P==!1){var F=o.zero();F.addCombine(1,S,1,o.cross(B,this.m_rB)),F.subCombine(1,b,1,o.cross(M,this.m_rA));var D=B-M,R=l(F.x,F.y,D),L=l.neg(this.m_mass.solve33(R));if(this.m_limitState==v)this.m_impulse.add(L);else if(this.m_limitState==y){var V=this.m_impulse.z+L.z;if(V<0){var G=o.combine(-1,F,this.m_impulse.z,o.neo(this.m_mass.ez.x,this.m_mass.ez.y)),Y=this.m_mass.solve22(G);L.x=Y.x,L.y=Y.y,L.z=-this.m_impulse.z,this.m_impulse.x+=Y.x,this.m_impulse.y+=Y.y,this.m_impulse.z=0}else this.m_impulse.add(L)}else if(this.m_limitState==_){var V=this.m_impulse.z+L.z;if(V>0){var G=o.combine(-1,F,this.m_impulse.z,o.neo(this.m_mass.ez.x,this.m_mass.ez.y)),Y=this.m_mass.solve22(G);L.x=Y.x,L.y=Y.y,L.z=-this.m_impulse.z,this.m_impulse.x+=Y.x,this.m_impulse.y+=Y.y,this.m_impulse.z=0}else this.m_impulse.add(L)}var J=o.neo(L.x,L.y);b.subMul(E,J),M-=w*(o.cross(this.m_rA,J)+L.z),S.addMul(T,J),B+=C*(o.cross(this.m_rB,J)+L.z)}else{var R=o.zero();R.addCombine(1,S,1,o.cross(B,this.m_rB)),R.subCombine(1,b,1,o.cross(M,this.m_rA));var L=this.m_mass.solve22(o.neg(R));this.m_impulse.x+=L.x,this.m_impulse.y+=L.y,b.subMul(E,L),M-=w*o.cross(this.m_rA,L),S.addMul(T,L),B+=C*o.cross(this.m_rB,L)}this.m_bodyA.c_velocity.v=b,this.m_bodyA.c_velocity.w=M,this.m_bodyB.c_velocity.v=S,this.m_bodyB.c_velocity.w=B},x.prototype.solvePositionConstraints=function(A){var b=this.m_bodyA.c_position.c,M=this.m_bodyA.c_position.a,S=this.m_bodyB.c_position.c,B=this.m_bodyB.c_position.a,E=p.neo(M),T=p.neo(B),w=0,C=0,P=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=d&&P==!1){var R=B-M-this.m_referenceAngle,L=0;if(this.m_limitState==v){var I=h.clamp(R-this.m_lowerAngle,-a.maxAngularCorrection,a.maxAngularCorrection);L=-this.m_motorMass*I,w=h.abs(I)}else if(this.m_limitState==y){var I=R-this.m_lowerAngle;w=-I,I=h.clamp(I+a.angularSlop,-a.maxAngularCorrection,0),L=-this.m_motorMass*I}else if(this.m_limitState==_){var I=R-this.m_upperAngle;w=I,I=h.clamp(I-a.angularSlop,0,a.maxAngularCorrection),L=-this.m_motorMass*I}M-=this.m_invIA*L,B+=this.m_invIB*L}{E.set(M),T.set(B);var z=p.mulVec2(E,o.sub(this.m_localAnchorA,this.m_localCenterA)),F=p.mulVec2(T,o.sub(this.m_localAnchorB,this.m_localCenterB)),I=o.zero();I.addCombine(1,S,1,F),I.subCombine(1,b,1,z),C=I.length();var D=this.m_invMassA,V=this.m_invMassB,G=this.m_invIA,Y=this.m_invIB,J=new u;J.ex.x=D+V+G*z.y*z.y+Y*F.y*F.y,J.ex.y=-G*z.x*z.y-Y*F.x*F.y,J.ey.x=J.ex.y,J.ey.y=D+V+G*z.x*z.x+Y*F.x*F.x;var Q=o.neg(J.solve(I));b.subMul(D,Q),M-=G*o.cross(z,Q),S.addMul(V,Q),B+=Y*o.cross(F,Q)}return this.m_bodyA.c_position.c.set(b),this.m_bodyA.c_position.a=M,this.m_bodyB.c_position.c.set(S),this.m_bodyB.c_position.a=B,C<=a.linearSlop&&w<=a.angularSlop}},function(e,n,s){e.exports=x,s(2);var r=s(6),a=s(4),h=s(1),o=s(0),l=s(7),u=s(10),m=s(14),p=s(3);s(9),s(5),s(12),s(13);var c=s(11),f=s(8),d=0,y=1,_=2,v=3;x.TYPE="prismatic-joint",c.TYPES[x.TYPE]=x,x._super=c,x.prototype=Object.create(x._super.prototype);var g={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0};function x(A,b,M,S,B){if(!(this instanceof x))return new x(A,b,M,S,B);A=r(A,g),c.call(this,A,b,M),b=this.m_bodyA,M=this.m_bodyB,this.m_type=x.TYPE,this.m_localAnchorA=o.clone(S?b.getLocalPoint(S):A.localAnchorA||o.zero()),this.m_localAnchorB=o.clone(S?M.getLocalPoint(S):A.localAnchorB||o.zero()),this.m_localXAxisA=o.clone(B?b.getLocalVector(B):A.localAxisA||o.neo(1,0)),this.m_localXAxisA.normalize(),this.m_localYAxisA=o.cross(1,this.m_localXAxisA),this.m_referenceAngle=h.isFinite(A.referenceAngle)?A.referenceAngle:M.getAngle()-b.getAngle(),this.m_impulse=l(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=A.lowerTranslation,this.m_upperTranslation=A.upperTranslation,this.m_maxMotorForce=A.maxMotorForce,this.m_motorSpeed=A.motorSpeed,this.m_enableLimit=A.enableLimit,this.m_enableMotor=A.enableMotor,this.m_limitState=d,this.m_axis=o.zero(),this.m_perp=o.zero(),this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_axis,this.m_perp,this.m_s1,this.m_s2,this.m_a1,this.m_a2,this.m_K=new m,this.m_motorMass}x.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},x._deserialize=function(A,b,M){A=Object.assign({},A),A.bodyA=M(f,A.bodyA,b),A.bodyB=M(f,A.bodyB,b),A.localAxisA=o(A.localAxisA);var S=new x(A);return S},x.prototype._setAnchors=function(A){A.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(A.anchorA)):A.localAnchorA&&this.m_localAnchorA.set(A.localAnchorA),A.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(A.anchorB)):A.localAnchorB&&this.m_localAnchorB.set(A.localAnchorB),A.localAxisA&&(this.m_localXAxisA.set(A.localAxisA),this.m_localYAxisA.set(o.cross(1,A.localAxisA)))},x.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},x.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},x.prototype.getLocalAxisA=function(){return this.m_localXAxisA},x.prototype.getReferenceAngle=function(){return this.m_referenceAngle},x.prototype.getJointTranslation=function(){var A=this.m_bodyA.getWorldPoint(this.m_localAnchorA),b=this.m_bodyB.getWorldPoint(this.m_localAnchorB),M=o.sub(b,A),S=this.m_bodyA.getWorldVector(this.m_localXAxisA),B=o.dot(M,S);return B},x.prototype.getJointSpeed=function(){var A=this.m_bodyA,b=this.m_bodyB,M=p.mulVec2(A.m_xf.q,o.sub(this.m_localAnchorA,A.m_sweep.localCenter)),S=p.mulVec2(b.m_xf.q,o.sub(this.m_localAnchorB,b.m_sweep.localCenter)),B=o.add(A.m_sweep.c,M),E=o.add(b.m_sweep.c,S),T=o.sub(E,B),w=p.mulVec2(A.m_xf.q,this.m_localXAxisA),C=A.m_linearVelocity,P=b.m_linearVelocity,R=A.m_angularVelocity,L=b.m_angularVelocity,I=o.dot(T,o.cross(R,w))+o.dot(w,o.sub(o.addCross(P,L,S),o.addCross(C,R,M)));return I},x.prototype.isLimitEnabled=function(){return this.m_enableLimit},x.prototype.enableLimit=function(A){A!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=A,this.m_impulse.z=0)},x.prototype.getLowerLimit=function(){return this.m_lowerTranslation},x.prototype.getUpperLimit=function(){return this.m_upperTranslation},x.prototype.setLimits=function(A,b){(A!=this.m_lowerTranslation||b!=this.m_upperTranslation)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=A,this.m_upperTranslation=b,this.m_impulse.z=0)},x.prototype.isMotorEnabled=function(){return this.m_enableMotor},x.prototype.enableMotor=function(A){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=A},x.prototype.setMotorSpeed=function(A){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=A},x.prototype.setMaxMotorForce=function(A){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=A},x.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},x.prototype.getMotorSpeed=function(){return this.m_motorSpeed},x.prototype.getMotorForce=function(A){return A*this.m_motorImpulse},x.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},x.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},x.prototype.getReactionForce=function(A){return o.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(A)},x.prototype.getReactionTorque=function(A){return A*this.m_impulse.y},x.prototype.initVelocityConstraints=function(A){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var b=this.m_bodyA.c_position.c,M=this.m_bodyA.c_position.a,S=this.m_bodyA.c_velocity.v,B=this.m_bodyA.c_velocity.w,E=this.m_bodyB.c_position.c,T=this.m_bodyB.c_position.a,w=this.m_bodyB.c_velocity.v,C=this.m_bodyB.c_velocity.w,P=p.neo(M),R=p.neo(T),L=p.mulVec2(P,o.sub(this.m_localAnchorA,this.m_localCenterA)),I=p.mulVec2(R,o.sub(this.m_localAnchorB,this.m_localCenterB)),z=o.zero();z.addCombine(1,E,1,I),z.subCombine(1,b,1,L);var F=this.m_invMassA,D=this.m_invMassB,V=this.m_invIA,G=this.m_invIB;this.m_axis=p.mulVec2(P,this.m_localXAxisA),this.m_a1=o.cross(o.add(z,L),this.m_axis),this.m_a2=o.cross(I,this.m_axis),this.m_motorMass=F+D+V*this.m_a1*this.m_a1+G*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass);{this.m_perp=p.mulVec2(P,this.m_localYAxisA),this.m_s1=o.cross(o.add(z,L),this.m_perp),this.m_s2=o.cross(I,this.m_perp),o.cross(L,this.m_perp);var Y=F+D+V*this.m_s1*this.m_s1+G*this.m_s2*this.m_s2,J=V*this.m_s1+G*this.m_s2,Q=V*this.m_s1*this.m_a1+G*this.m_s2*this.m_a2,W=V+G;W==0&&(W=1);var et=V*this.m_a1+G*this.m_a2,ct=F+D+V*this.m_a1*this.m_a1+G*this.m_a2*this.m_a2;this.m_K.ex.set(Y,J,Q),this.m_K.ey.set(J,W,et),this.m_K.ez.set(Q,et,ct)}if(this.m_enableLimit){var Z=o.dot(this.m_axis,z);h.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.linearSlop?this.m_limitState=v:Z<=this.m_lowerTranslation?this.m_limitState!=y&&(this.m_limitState=y,this.m_impulse.z=0):Z>=this.m_upperTranslation?this.m_limitState!=_&&(this.m_limitState=_,this.m_impulse.z=0):(this.m_limitState=d,this.m_impulse.z=0)}else this.m_limitState=d,this.m_impulse.z=0;if(this.m_enableMotor==!1&&(this.m_motorImpulse=0),A.warmStarting){this.m_impulse.mul(A.dtRatio),this.m_motorImpulse*=A.dtRatio;var ot=o.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),xt=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,q=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;S.subMul(F,ot),B-=V*xt,w.addMul(D,ot),C+=G*q}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(S),this.m_bodyA.c_velocity.w=B,this.m_bodyB.c_velocity.v.set(w),this.m_bodyB.c_velocity.w=C},x.prototype.solveVelocityConstraints=function(A){var b=this.m_bodyA.c_velocity.v,M=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,B=this.m_bodyB.c_velocity.w,E=this.m_invMassA,T=this.m_invMassB,w=this.m_invIA,C=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=v){var P=o.dot(this.m_axis,o.sub(S,b))+this.m_a2*B-this.m_a1*M,R=this.m_motorMass*(this.m_motorSpeed-P),L=this.m_motorImpulse,I=A.dt*this.m_maxMotorForce;this.m_motorImpulse=h.clamp(this.m_motorImpulse+R,-I,I),R=this.m_motorImpulse-L;var z=o.mul(R,this.m_axis),F=R*this.m_a1,D=R*this.m_a2;b.subMul(E,z),M-=w*F,S.addMul(T,z),B+=C*D}var V=o.zero();if(V.x+=o.dot(this.m_perp,S)+this.m_s2*B,V.x-=o.dot(this.m_perp,b)+this.m_s1*M,V.y=B-M,this.m_enableLimit&&this.m_limitState!=d){var G=0;G+=o.dot(this.m_axis,S)+this.m_a2*B,G-=o.dot(this.m_axis,b)+this.m_a1*M;var P=l(V.x,V.y,G),Y=l(this.m_impulse),J=this.m_K.solve33(l.neg(P));this.m_impulse.add(J),this.m_limitState==y?this.m_impulse.z=h.max(this.m_impulse.z,0):this.m_limitState==_&&(this.m_impulse.z=h.min(this.m_impulse.z,0));var Q=o.combine(-1,V,-(this.m_impulse.z-Y.z),o.neo(this.m_K.ez.x,this.m_K.ez.y)),W=o.add(this.m_K.solve22(Q),o.neo(Y.x,Y.y));this.m_impulse.x=W.x,this.m_impulse.y=W.y,J=l.sub(this.m_impulse,Y);var z=o.combine(J.x,this.m_perp,J.z,this.m_axis),F=J.x*this.m_s1+J.y+J.z*this.m_a1,D=J.x*this.m_s2+J.y+J.z*this.m_a2;b.subMul(E,z),M-=w*F,S.addMul(T,z),B+=C*D}else{var J=this.m_K.solve22(o.neg(V));this.m_impulse.x+=J.x,this.m_impulse.y+=J.y;var z=o.mul(J.x,this.m_perp),F=J.x*this.m_s1+J.y,D=J.x*this.m_s2+J.y;b.subMul(E,z),M-=w*F,S.addMul(T,z),B+=C*D}this.m_bodyA.c_velocity.v=b,this.m_bodyA.c_velocity.w=M,this.m_bodyB.c_velocity.v=S,this.m_bodyB.c_velocity.w=B},x.prototype.solvePositionConstraints=function(A){var b=this.m_bodyA.c_position.c,M=this.m_bodyA.c_position.a,S=this.m_bodyB.c_position.c,B=this.m_bodyB.c_position.a,E=p.neo(M),T=p.neo(B),w=this.m_invMassA,C=this.m_invMassB,P=this.m_invIA,R=this.m_invIB,L=p.mulVec2(E,o.sub(this.m_localAnchorA,this.m_localCenterA)),I=p.mulVec2(T,o.sub(this.m_localAnchorB,this.m_localCenterB)),z=o.sub(o.add(S,I),o.add(b,L)),F=p.mulVec2(E,this.m_localXAxisA),D=o.cross(o.add(z,L),F),V=o.cross(I,F),G=p.mulVec2(E,this.m_localYAxisA),Y=o.cross(o.add(z,L),G),J=o.cross(I,G),Q=l(),W=o.zero();W.x=o.dot(G,z),W.y=B-M-this.m_referenceAngle;var et=h.abs(W.x),ct=h.abs(W.y),Z=a.linearSlop,ot=a.maxLinearCorrection,xt=!1,q=0;if(this.m_enableLimit){var X=o.dot(F,z);h.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Z?(q=h.clamp(X,-ot,ot),et=h.max(et,h.abs(X)),xt=!0):X<=this.m_lowerTranslation?(q=h.clamp(X-this.m_lowerTranslation+Z,-ot,0),et=h.max(et,this.m_lowerTranslation-X),xt=!0):X>=this.m_upperTranslation&&(q=h.clamp(X-this.m_upperTranslation-Z,0,ot),et=h.max(et,X-this.m_upperTranslation),xt=!0)}if(xt){var at=w+C+P*Y*Y+R*J*J,ut=P*Y+R*J,it=P*Y*D+R*J*V,st=P+R;st==0&&(st=1);var dt=P*D+R*V,mt=w+C+P*D*D+R*V*V,pt=new m;pt.ex.set(at,ut,it),pt.ey.set(ut,st,dt),pt.ez.set(it,dt,mt);var U=l();U.x=W.x,U.y=W.y,U.z=q,Q=pt.solve33(l.neg(U))}else{var at=w+C+P*Y*Y+R*J*J,ut=P*Y+R*J,st=P+R;st==0&&(st=1);var pt=new u;pt.ex.set(at,ut),pt.ey.set(ut,st);var N=pt.solve(o.neg(W));Q.x=N.x,Q.y=N.y,Q.z=0}var rt=o.combine(Q.x,G,Q.z,F),ht=Q.x*Y+Q.y+Q.z*D,At=Q.x*J+Q.y+Q.z*V;return b.subMul(w,rt),M-=P*ht,S.addMul(C,rt),B+=R*At,this.m_bodyA.c_position.c=b,this.m_bodyA.c_position.a=M,this.m_bodyB.c_position.c=S,this.m_bodyB.c_position.a=B,et<=a.linearSlop&&ct<=a.angularSlop}},function(e,n){e.exports={}},function(e,n){e.exports=function(s){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var h in a)a.hasOwnProperty(h)&&(s[h]=a[h])}return s}},function(e,n){/**
 * ! is the definitive JavaScript type testing library
 * 
 * @copyright 2013-2014 Enrico Marino / Jordan Harband
 * @license MIT
 */var s=Object.prototype,r=s.hasOwnProperty,a=s.toString,h=/^[A-Fa-f0-9]+$/,o=e.exports={};o.a=o.an=o.type=function(l,u){return typeof l===u},o.defined=function(l){return typeof l!="undefined"},o.empty=function(l){var u=a.call(l),m;if(u==="[object Array]"||u==="[object Arguments]"||u==="[object String]")return l.length===0;if(u==="[object Object]"){for(m in l)if(r.call(l,m))return!1;return!0}return!l},o.equal=function(l,u){if(l===u)return!0;var m=a.call(l),p;if(m!==a.call(u))return!1;if(m==="[object Object]"){for(p in l)if(!o.equal(l[p],u[p])||!(p in u))return!1;for(p in u)if(!o.equal(l[p],u[p])||!(p in l))return!1;return!0}if(m==="[object Array]"){if(p=l.length,p!==u.length)return!1;for(;--p;)if(!o.equal(l[p],u[p]))return!1;return!0}return m==="[object Function]"?l.prototype===u.prototype:m==="[object Date]"?l.getTime()===u.getTime():!1},o.instance=function(l,u){return l instanceof u},o.nil=function(l){return l===null},o.undef=function(l){return typeof l=="undefined"},o.array=function(l){return a.call(l)==="[object Array]"},o.emptyarray=function(l){return o.array(l)&&l.length===0},o.arraylike=function(l){return!!l&&!o.boolean(l)&&r.call(l,"length")&&isFinite(l.length)&&o.number(l.length)&&l.length>=0},o.boolean=function(l){return a.call(l)==="[object Boolean]"},o.element=function(l){return l!==void 0&&typeof HTMLElement!="undefined"&&l instanceof HTMLElement&&l.nodeType===1},o.fn=function(l){return a.call(l)==="[object Function]"},o.number=function(l){return a.call(l)==="[object Number]"},o.nan=function(l){return!o.number(l)||l!==l},o.object=function(l){return a.call(l)==="[object Object]"},o.hash=function(l){return o.object(l)&&l.constructor===Object&&!l.nodeType&&!l.setInterval},o.regexp=function(l){return a.call(l)==="[object RegExp]"},o.string=function(l){return a.call(l)==="[object String]"},o.hex=function(l){return o.string(l)&&(!l.length||h.test(l))}},function(e,n,s){n.internal={},n.Serializer=s(39),n.Math=s(1),n.Vec2=s(0),n.Vec3=s(7),n.Mat22=s(10),n.Mat33=s(14),n.Transform=s(5),n.Rot=s(3),n.AABB=s(16),n.Shape=s(15),n.Fixture=s(26),n.Body=s(8),n.Contact=s(17),n.Joint=s(11),n.World=s(30),n.Circle=s(22),n.Edge=s(23),n.Polygon=s(20),n.Chain=s(28),n.Box=s(44),s(45),s(46),n.internal.CollidePolygons=s(47),s(48),s(49),n.DistanceJoint=s(50),n.FrictionJoint=s(51),n.GearJoint=s(52),n.MotorJoint=s(53),n.MouseJoint=s(54),n.PrismaticJoint=s(34),n.PulleyJoint=s(55),n.RevoluteJoint=s(33),n.RopeJoint=s(56),n.WeldJoint=s(57),n.WheelJoint=s(58),n.Settings=s(4),n.internal.Sweep=s(9),n.internal.stats=s(27),n.internal.Manifold=s(18),n.internal.Distance=s(21),n.internal.TimeOfImpact=s(32),n.internal.DynamicTree=s(31),n.internal.Settings=n.Settings},function(e,n,s){var r=s(30),a=s(8),h=s(11),o=s(26),l=s(15),u=s(0),m=s(7),p=0;function c(d){d=d||{};var y=d.rootClass||r,_=d.preSerialize||function(M){return M},v=d.postSerialize||function(M,S){return M},g=d.preDeserialize||function(M){return M},x=d.postDeserialize||function(M,S){return M},A={World:r,Body:a,Joint:h,Fixture:o,Shape:l},b=Object.assign({Vec2:u,Vec3:m},A);this.toJson=function(M){var S=[],B=[M],E={};function T(L,I){if(L.__sid=L.__sid||++p,!E[L.__sid]){B.push(L);var z=S.length+B.length,F={refIndex:z,refType:I};E[L.__sid]=F}return E[L.__sid]}function w(L){L=_(L);var I=L._serialize();return I=v(I,L),I}function C(L,I){if(typeof L!="object"||L===null)return L;if(typeof L._serialize=="function"){if(L!==I){for(var z in A)if(L instanceof A[z])return T(L,z)}L=w(L)}if(Array.isArray(L)){for(var F=[],D=0;D<L.length;D++)F[D]=C(L[D]);L=F}else{var F={};for(var D in L)L.hasOwnProperty(D)&&(F[D]=C(L[D]));L=F}return L}for(;B.length;){var P=B.shift(),R=C(P,P);S.push(R)}return S},this.fromJson=function(M){var S={};function B(w,C,P){C=g(C);var R=w._deserialize(C,P,E);return R=x(R,C),R}function E(w,C,P){if(!C.refIndex)return w&&w._deserialize&&B(w,C,P);w=b[C.refType]||w;var R=C.refIndex;if(!S[R]){var L=M[R],I=B(w,L,P);S[R]=I}return S[R]}var T=y._deserialize(M[0],null,E);return T}}e.exports=c;var f=new c;e.exports.toJson=f.toJson,e.exports.fromJson=f.fromJson},function(e,n,s){s(4),s(2);var r=s(1),a=s(16),h=s(31);e.exports=o;function o(){this.m_tree=new h,this.m_proxyCount=0,this.m_moveBuffer=[],this.queryCallback=this.queryCallback.bind(this)}o.prototype.getUserData=function(l){return this.m_tree.getUserData(l)},o.prototype.testOverlap=function(l,u){var m=this.m_tree.getFatAABB(l),p=this.m_tree.getFatAABB(u);return a.testOverlap(m,p)},o.prototype.getFatAABB=function(l){return this.m_tree.getFatAABB(l)},o.prototype.getProxyCount=function(){return this.m_proxyCount},o.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},o.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},o.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},o.prototype.query=function(l,u){this.m_tree.query(l,u)},o.prototype.rayCast=function(l,u){this.m_tree.rayCast(l,u)},o.prototype.shiftOrigin=function(l){this.m_tree.shiftOrigin(l)},o.prototype.createProxy=function(l,u){var m=this.m_tree.createProxy(l,u);return this.m_proxyCount++,this.bufferMove(m),m},o.prototype.destroyProxy=function(l){this.unbufferMove(l),this.m_proxyCount--,this.m_tree.destroyProxy(l)},o.prototype.moveProxy=function(l,u,m){var p=this.m_tree.moveProxy(l,u,m);p&&this.bufferMove(l)},o.prototype.touchProxy=function(l){this.bufferMove(l)},o.prototype.bufferMove=function(l){this.m_moveBuffer.push(l)},o.prototype.unbufferMove=function(l){for(var u=0;u<this.m_moveBuffer.length;++u)this.m_moveBuffer[u]==l&&(this.m_moveBuffer[u]=null)},o.prototype.updatePairs=function(l){for(this.m_callback=l;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),this.m_queryProxyId!==null){var u=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(u,this.queryCallback)}},o.prototype.queryCallback=function(l){if(l==this.m_queryProxyId)return!0;var u=r.min(l,this.m_queryProxyId),m=r.max(l,this.m_queryProxyId),p=this.m_tree.getUserData(u),c=this.m_tree.getUserData(m);return this.m_callback(p,c),!0}},function(e,n,s){e.exports=r;function r(a){var h=[],o=a.max||1/0,l=a.create,u=a.allocate,m=a.release,p=a.discard,c=0,f=0,d=0,y=0;this.max=function(_){return typeof _=="number"?(o=_,this):o},this.size=function(){return h.length},this.allocate=function(){var _;return h.length>0?_=h.shift():(c++,typeof l=="function"?_=l():_={}),f++,typeof u=="function"&&u(_),_},this.release=function(_){h.length<o?(d++,typeof m=="function"&&m(_),h.push(_)):(y++,typeof p=="function"&&(_=p(_)))},this.toString=function(){return" +"+c+" >"+f+" <"+d+" -"+y+" ="+h.length+"/"+o}}},function(e,n,s){e.exports=f,e.exports.TimeStep=c;var r=s(4),a=s(2),h=s(0),o=s(1);s(8),s(17),s(11);var l=s(32),u=l.Input,m=l.Output,p=s(21);p.Input,p.Output,p.Proxy,p.Cache;function c(_){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}c.prototype.reset=function(_){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=_,this.inv_dt=_==0?0:1/_,this.dtRatio=_*this.inv_dt0};function f(_){this.m_world=_,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}f.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},f.prototype.addBody=function(_){this.m_bodies.push(_)},f.prototype.addContact=function(_){this.m_contacts.push(_)},f.prototype.addJoint=function(_){this.m_joints.push(_)},f.prototype.solveWorld=function(_){for(var v=this.m_world,g=v.m_bodyList;g;g=g.m_next)g.m_islandFlag=!1;for(var x=v.m_contactList;x;x=x.m_next)x.m_islandFlag=!1;for(var A=v.m_jointList;A;A=A.m_next)A.m_islandFlag=!1;for(var b=this.m_stack,M=v.m_bodyList;M;M=M.m_next)if(!M.m_islandFlag&&!(M.isAwake()==!1||M.isActive()==!1)&&!M.isStatic()){for(this.clear(),b.push(M),M.m_islandFlag=!0;b.length>0;){var g=b.pop();if(this.addBody(g),g.setAwake(!0),!g.isStatic()){for(var S=g.m_contactList;S;S=S.next){var B=S.contact;if(!B.m_islandFlag&&!(B.isEnabled()==!1||B.isTouching()==!1)){var E=B.m_fixtureA.m_isSensor,T=B.m_fixtureB.m_isSensor;if(!(E||T)){this.addContact(B),B.m_islandFlag=!0;var w=S.other;w.m_islandFlag||(b.push(w),w.m_islandFlag=!0)}}}for(var C=g.m_jointList;C;C=C.next)if(C.joint.m_islandFlag!=!0){var w=C.other;w.isActive()!=!1&&(this.addJoint(C.joint),C.joint.m_islandFlag=!0,!w.m_islandFlag&&(b.push(w),w.m_islandFlag=!0))}}}this.solveIsland(_);for(var P=0;P<this.m_bodies.length;++P){var g=this.m_bodies[P];g.isStatic()&&(g.m_islandFlag=!1)}}},f.prototype.solveIsland=function(_){for(var v=this.m_world,g=v.m_gravity,x=v.m_allowSleep,A=_.dt,b=0;b<this.m_bodies.length;++b){var M=this.m_bodies[b],S=h.clone(M.m_sweep.c),B=M.m_sweep.a,E=h.clone(M.m_linearVelocity),T=M.m_angularVelocity;M.m_sweep.c0.set(M.m_sweep.c),M.m_sweep.a0=M.m_sweep.a,M.isDynamic()&&(E.addMul(A*M.m_gravityScale,g),E.addMul(A*M.m_invMass,M.m_force),T+=A*M.m_invI*M.m_torque,E.mul(1/(1+A*M.m_linearDamping)),T*=1/(1+A*M.m_angularDamping)),M.c_position.c=S,M.c_position.a=B,M.c_velocity.v=E,M.c_velocity.w=T}for(var b=0;b<this.m_contacts.length;++b){var w=this.m_contacts[b];w.initConstraint(_)}for(var b=0;b<this.m_contacts.length;++b){var w=this.m_contacts[b];w.initVelocityConstraint(_)}if(_.warmStarting)for(var b=0;b<this.m_contacts.length;++b){var w=this.m_contacts[b];w.warmStartConstraint(_)}for(var b=0;b<this.m_joints.length;++b){var C=this.m_joints[b];C.initVelocityConstraints(_)}for(var b=0;b<_.velocityIterations;++b){for(var P=0;P<this.m_joints.length;++P){var C=this.m_joints[P];C.solveVelocityConstraints(_)}for(var P=0;P<this.m_contacts.length;++P){var w=this.m_contacts[P];w.solveVelocityConstraint(_)}}for(var b=0;b<this.m_contacts.length;++b){var w=this.m_contacts[b];w.storeConstraintImpulses(_)}for(var b=0;b<this.m_bodies.length;++b){var M=this.m_bodies[b],S=h.clone(M.c_position.c),B=M.c_position.a,E=h.clone(M.c_velocity.v),T=M.c_velocity.w,R=h.mul(A,E);if(h.lengthSquared(R)>r.maxTranslationSquared){var L=r.maxTranslation/R.length();E.mul(L)}var I=A*T;if(I*I>r.maxRotationSquared){var L=r.maxRotation/o.abs(I);T*=L}S.addMul(A,E),B+=A*T,M.c_position.c.set(S),M.c_position.a=B,M.c_velocity.v.set(E),M.c_velocity.w=T}for(var z=!1,b=0;b<_.positionIterations;++b){for(var F=0,P=0;P<this.m_contacts.length;++P){var w=this.m_contacts[P],D=w.solvePositionConstraint(_);F=o.min(F,D)}for(var V=F>=-3*r.linearSlop,G=!0,P=0;P<this.m_joints.length;++P){var C=this.m_joints[P],Y=C.solvePositionConstraints(_);G=G&&Y}if(V&&G){z=!0;break}}for(var b=0;b<this.m_bodies.length;++b){var M=this.m_bodies[b];M.m_sweep.c.set(M.c_position.c),M.m_sweep.a=M.c_position.a,M.m_linearVelocity.set(M.c_velocity.v),M.m_angularVelocity=M.c_velocity.w,M.synchronizeTransform()}if(this.postSolveIsland(),x){for(var J=1/0,Q=r.linearSleepToleranceSqr,W=r.angularSleepToleranceSqr,b=0;b<this.m_bodies.length;++b){var M=this.m_bodies[b];M.isStatic()||(M.m_autoSleepFlag==!1||M.m_angularVelocity*M.m_angularVelocity>W||h.lengthSquared(M.m_linearVelocity)>Q?(M.m_sleepTime=0,J=0):(M.m_sleepTime+=A,J=o.min(J,M.m_sleepTime)))}if(J>=r.timeToSleep&&z)for(var b=0;b<this.m_bodies.length;++b){var M=this.m_bodies[b];M.setAwake(!1)}}},f.prototype.printBodies=function(_){for(var v=0;v<this.m_bodies.length;++v){var g=this.m_bodies[v];a.debug(_,g.c_position.a,g.c_position.c.x,g.c_position.c.y,g.c_velocity.w,g.c_velocity.v.x,g.c_velocity.v.y)}};var d=new c;f.prototype.solveWorldTOI=function(_){var v=this.m_world;if(v.m_stepComplete){for(var xt=v.m_bodyList;xt;xt=xt.m_next)xt.m_islandFlag=!1,xt.m_sweep.alpha0=0;for(var q=v.m_contactList;q;q=q.m_next)q.m_toiFlag=!1,q.m_islandFlag=!1,q.m_toiCount=0,q.m_toi=1}for(;;){for(var g=null,x=1,q=v.m_contactList;q;q=q.m_next)if(q.isEnabled()!=!1&&!(q.m_toiCount>r.maxSubSteps)){var A=1;if(q.m_toiFlag)A=q.m_toi;else{var L=q.getFixtureA(),I=q.getFixtureB();if(L.isSensor()||I.isSensor())continue;var z=L.getBody(),F=I.getBody(),b=z.isAwake()&&!z.isStatic(),M=F.isAwake()&&!F.isStatic();if(b==!1&&M==!1)continue;var S=z.isBullet()||!z.isDynamic(),B=F.isBullet()||!F.isDynamic();if(S==!1&&B==!1)continue;var E=z.m_sweep.alpha0;z.m_sweep.alpha0<F.m_sweep.alpha0?(E=F.m_sweep.alpha0,z.m_sweep.advance(E)):F.m_sweep.alpha0<z.m_sweep.alpha0&&(E=z.m_sweep.alpha0,F.m_sweep.advance(E));var T=q.getChildIndexA(),w=q.getChildIndexB();z.m_sweep,F.m_sweep;var C=new u;C.proxyA.set(L.getShape(),T),C.proxyB.set(I.getShape(),w),C.sweepA.set(z.m_sweep),C.sweepB.set(F.m_sweep),C.tMax=1;var P=new m;l(P,C);var R=P.t;P.state==m.e_touching?A=o.min(E+(1-E)*R,1):A=1,q.m_toi=A,q.m_toiFlag=!0}A<x&&(g=q,x=A)}if(g==null||1-10*o.EPSILON<x){v.m_stepComplete=!0;break}var L=g.getFixtureA(),I=g.getFixtureB(),z=L.getBody(),F=I.getBody(),D=z.m_sweep.clone(),V=F.m_sweep.clone();if(z.advance(x),F.advance(x),g.update(v),g.m_toiFlag=!1,++g.m_toiCount,g.isEnabled()==!1||g.isTouching()==!1){g.setEnabled(!1),z.m_sweep.set(D),F.m_sweep.set(V),z.synchronizeTransform(),F.synchronizeTransform();continue}z.setAwake(!0),F.setAwake(!0),this.clear(),this.addBody(z),this.addBody(F),this.addContact(g),z.m_islandFlag=!0,F.m_islandFlag=!0,g.m_islandFlag=!0;for(var G=[z,F],Y=0;Y<G.length;++Y){var J=G[Y];if(J.isDynamic())for(var Q=J.m_contactList;Q;Q=Q.next){var W=Q.contact;if(!W.m_islandFlag){var et=Q.other;if(!(et.isDynamic()&&!J.isBullet()&&!et.isBullet())){var ct=W.m_fixtureA.m_isSensor,Z=W.m_fixtureB.m_isSensor;if(!(ct||Z)){var ot=et.m_sweep.clone();if(et.m_islandFlag==!1&&et.advance(x),W.update(v),W.isEnabled()==!1||W.isTouching()==!1){et.m_sweep.set(ot),et.synchronizeTransform();continue}W.m_islandFlag=!0,this.addContact(W),!et.m_islandFlag&&(et.m_islandFlag=!0,et.isStatic()||et.setAwake(!0),this.addBody(et))}}}}}d.reset((1-x)*_.dt),d.dtRatio=1,d.positionIterations=20,d.velocityIterations=_.velocityIterations,d.warmStarting=!1,this.solveIslandTOI(d,z,F);for(var Y=0;Y<this.m_bodies.length;++Y){var J=this.m_bodies[Y];if(J.m_islandFlag=!1,!!J.isDynamic()){J.synchronizeFixtures();for(var Q=J.m_contactList;Q;Q=Q.next)Q.contact.m_toiFlag=!1,Q.contact.m_islandFlag=!1}}if(v.findNewContacts(),v.m_subStepping){v.m_stepComplete=!1;break}}var xt,q},f.prototype.solveIslandTOI=function(_,v,g){this.m_world;for(var T=0;T<this.m_bodies.length;++T){var x=this.m_bodies[T];x.c_position.c.set(x.m_sweep.c),x.c_position.a=x.m_sweep.a,x.c_velocity.v.set(x.m_linearVelocity),x.c_velocity.w=x.m_angularVelocity}for(var T=0;T<this.m_contacts.length;++T){var A=this.m_contacts[T];A.initConstraint(_)}for(var T=0;T<_.positionIterations;++T){for(var b=0,M=0;M<this.m_contacts.length;++M){var A=this.m_contacts[M],S=A.solvePositionConstraintTOI(_,v,g);b=o.min(b,S)}var B=b>=-1.5*r.linearSlop;if(B)break}var E,T;v.m_sweep.c0.set(v.c_position.c),v.m_sweep.a0=v.c_position.a,g.m_sweep.c0.set(g.c_position.c),g.m_sweep.a0=g.c_position.a;for(var T=0;T<this.m_contacts.length;++T){var A=this.m_contacts[T];A.initVelocityConstraint(_)}for(var T=0;T<_.velocityIterations;++T)for(var M=0;M<this.m_contacts.length;++M){var A=this.m_contacts[M];A.solveVelocityConstraint(_)}for(var w=_.dt,T=0;T<this.m_bodies.length;++T){var x=this.m_bodies[T],E=h.clone(x.c_position.c),C=x.c_position.a,P=h.clone(x.c_velocity.v),R=x.c_velocity.w,L=h.mul(w,P);if(h.dot(L,L)>r.maxTranslationSquared){var I=r.maxTranslation/L.length();P.mul(I)}var z=w*R;if(z*z>r.maxRotationSquared){var I=r.maxRotation/o.abs(z);R*=I}E.addMul(w,P),C+=w*R,x.c_position.c=E,x.c_position.a=C,x.c_velocity.v=P,x.c_velocity.w=R,x.m_sweep.c=E,x.m_sweep.a=C,x.m_linearVelocity=P,x.m_angularVelocity=R,x.synchronizeTransform()}this.postSolveIsland()};function y(){this.normalImpulses=[],this.tangentImpulses=[]}f.prototype.postSolveIsland=function(){for(var _=new y,v=0;v<this.m_contacts.length;++v){for(var g=this.m_contacts[v],x=0;x<g.v_points.length;++x)_.normalImpulses.push(g.v_points[x].normalImpulse),_.tangentImpulses.push(g.v_points[x].tangentImpulse);this.m_world.postSolve(g,_)}}},function(e,n,s){e.exports.now=function(){return Date.now()},e.exports.diff=function(r){return Date.now()-r}},function(e,n,s){e.exports=a,s(2);var r=s(20);a._super=r,a.prototype=Object.create(a._super.prototype),a.TYPE="polygon";function a(h,o,l,u){if(!(this instanceof a))return new a(h,o,l,u);a._super.call(this),this._setAsBox(h,o,l,u)}},function(e,n,s){s(2),s(1);var r=s(5),a=s(0);s(4),s(15);var h=s(17),o=s(18),l=s(22);h.addType(l.TYPE,l.TYPE,u);function u(p,c,f,d,y,_,v){m(p,f.getShape(),c,_.getShape(),y)}function m(p,c,f,d,y){p.pointCount=0;var _=r.mulVec2(f,c.m_p),v=r.mulVec2(y,d.m_p),g=a.distanceSquared(v,_),x=c.m_radius,A=d.m_radius,b=x+A;g>b*b||(p.type=o.e_circles,p.localPoint.set(c.m_p),p.localNormal.setZero(),p.pointCount=1,p.points[0].localPoint.set(d.m_p),p.points[0].id.cf.indexA=0,p.points[0].id.cf.typeA=o.e_vertex,p.points[0].id.cf.indexB=0,p.points[0].id.cf.typeB=o.e_vertex)}n.CollideCircles=m},function(e,n,s){s(2),s(1);var r=s(5),a=s(0);s(3),s(4),s(15);var h=s(17),o=s(18),l=s(23),u=s(28),m=s(22);h.addType(l.TYPE,m.TYPE,p),h.addType(u.TYPE,m.TYPE,c);function p(d,y,_,v,g,x,A){var b=_.getShape(),M=x.getShape();f(d,b,y,M,g)}function c(d,y,_,v,g,x,A){var b=_.getShape(),M=new l;b.getChildEdge(M,v);var S=M,B=x.getShape();f(d,S,y,B,g)}function f(d,y,_,v,g){d.pointCount=0;var x=r.mulTVec2(_,r.mulVec2(g,v.m_p)),A=y.m_vertex1,b=y.m_vertex2,M=a.sub(b,A),S=a.dot(M,a.sub(b,x)),B=a.dot(M,a.sub(x,A)),E=y.m_radius+v.m_radius;if(B<=0){var D=a.clone(A),V=a.sub(x,D),G=a.dot(V,V);if(G>E*E)return;if(y.m_hasVertex0){var T=y.m_vertex0,w=A,C=a.sub(w,T),P=a.dot(C,a.sub(w,x));if(P>0)return}d.type=o.e_circles,d.localNormal.setZero(),d.localPoint.set(D),d.pointCount=1,d.points[0].localPoint.set(v.m_p),d.points[0].id.cf.indexA=0,d.points[0].id.cf.typeA=o.e_vertex,d.points[0].id.cf.indexB=0,d.points[0].id.cf.typeB=o.e_vertex;return}if(S<=0){var D=a.clone(b),V=a.sub(x,D),G=a.dot(V,V);if(G>E*E)return;if(y.m_hasVertex3){var R=y.m_vertex3,L=b,I=a.sub(R,L),z=a.dot(I,a.sub(x,L));if(z>0)return}d.type=o.e_circles,d.localNormal.setZero(),d.localPoint.set(D),d.pointCount=1,d.points[0].localPoint.set(v.m_p),d.points[0].id.cf.indexA=1,d.points[0].id.cf.typeA=o.e_vertex,d.points[0].id.cf.indexB=0,d.points[0].id.cf.typeB=o.e_vertex;return}var F=a.dot(M,M),D=a.combine(S/F,A,B/F,b),V=a.sub(x,D),G=a.dot(V,V);if(!(G>E*E)){var Y=a.neo(-M.y,M.x);a.dot(Y,a.sub(x,A))<0&&Y.set(-Y.x,-Y.y),Y.normalize(),d.type=o.e_faceA,d.localNormal=Y,d.localPoint.set(A),d.pointCount=1,d.points[0].localPoint.set(v.m_p),d.points[0].id.cf.indexA=0,d.points[0].id.cf.typeA=o.e_face,d.points[0].id.cf.indexB=0,d.points[0].id.cf.typeB=o.e_vertex}}},function(e,n,s){s(2),s(1);var r=s(5),a=s(3),h=s(0);s(16);var o=s(4),l=s(18),u=s(17);s(15);var m=s(20);e.exports=d,u.addType(m.TYPE,m.TYPE,p);function p(y,_,v,g,x,A,b){d(y,v.getShape(),_,A.getShape(),x)}function c(y,_,v,g){for(var x=y.m_count,A=v.m_count,b=y.m_normals,M=y.m_vertices,S=v.m_vertices,B=r.mulTXf(g,_),E=0,T=-1/0,w=0;w<x;++w){for(var C=a.mulVec2(B.q,b[w]),P=r.mulVec2(B,M[w]),R=1/0,L=0;L<A;++L){var I=h.dot(C,S[L])-h.dot(C,P);I<R&&(R=I)}R>T&&(T=R,E=w)}c._maxSeparation=T,c._bestIndex=E}function f(y,_,v,g,x,A){for(var b=_.m_normals,M=x.m_count,S=x.m_vertices,B=x.m_normals,E=a.mulT(A.q,a.mulVec2(v.q,b[g])),T=0,w=1/0,C=0;C<M;++C){var P=h.dot(E,B[C]);P<w&&(w=P,T=C)}var R=T,L=R+1<M?R+1:0;y[0].v=r.mulVec2(A,S[R]),y[0].id.cf.indexA=g,y[0].id.cf.indexB=R,y[0].id.cf.typeA=l.e_face,y[0].id.cf.typeB=l.e_vertex,y[1].v=r.mulVec2(A,S[L]),y[1].id.cf.indexA=g,y[1].id.cf.indexB=L,y[1].id.cf.typeA=l.e_face,y[1].id.cf.typeB=l.e_vertex}function d(y,_,v,g,x){y.pointCount=0;var A=_.m_radius+g.m_radius;c(_,v,g,x);var b=c._bestIndex,M=c._maxSeparation;if(!(M>A)){c(g,x,_,v);var S=c._bestIndex,B=c._maxSeparation;if(!(B>A)){var E,T,w,C,P,R,L=.1*o.linearSlop;B>M+L?(E=g,T=_,w=x,C=v,P=S,y.type=l.e_faceB,R=1):(E=_,T=g,w=v,C=x,P=b,y.type=l.e_faceA,R=0);var I=[new l.clipVertex,new l.clipVertex];f(I,E,w,P,T,C);var z=E.m_count,F=E.m_vertices,D=P,V=P+1<z?P+1:0,G=F[D],Y=F[V],J=h.sub(Y,G);J.normalize();var Q=h.cross(J,1),W=h.combine(.5,G,.5,Y),et=a.mulVec2(w.q,J),ct=h.cross(et,1);G=r.mulVec2(w,G),Y=r.mulVec2(w,Y);var Z=h.dot(ct,G),ot=-h.dot(et,G)+A,xt=h.dot(et,Y)+A,q=[new l.clipVertex,new l.clipVertex],X=[new l.clipVertex,new l.clipVertex],at;if(at=l.clipSegmentToLine(q,I,h.neg(et),ot,D),!(at<2)&&(at=l.clipSegmentToLine(X,q,et,xt,V),!(at<2))){y.localNormal=Q,y.localPoint=W;for(var ut=0,it=0;it<X.length;++it){var st=h.dot(ct,X[it].v)-Z;if(st<=A){var dt=y.points[ut];if(dt.localPoint.set(r.mulTVec2(C,X[it].v)),dt.id=X[it].id,R){var mt=dt.id.cf,pt=mt.indexA,U=mt.indexB,N=mt.typeA,rt=mt.typeB;mt.indexA=U,mt.indexB=pt,mt.typeA=rt,mt.typeB=N}++ut}}y.pointCount=ut}}}}},function(e,n,s){s(2);var r=s(1),a=s(5);s(3);var h=s(0);s(16),s(4);var o=s(18),l=s(17);s(15);var u=s(22),m=s(20);l.addType(m.TYPE,u.TYPE,p);function p(f,d,y,_,v,g,x){c(f,y.getShape(),d,g.getShape(),v)}function c(f,d,y,_,v){f.pointCount=0;for(var g=a.mulVec2(v,_.m_p),x=a.mulTVec2(y,g),A=0,b=-1/0,M=d.m_radius+_.m_radius,S=d.m_count,B=d.m_vertices,E=d.m_normals,T=0;T<S;++T){var w=h.dot(E[T],h.sub(x,B[T]));if(w>M)return;w>b&&(b=w,A=T)}var C=A,P=C+1<S?C+1:0,R=B[C],L=B[P];if(b<r.EPSILON){f.pointCount=1,f.type=o.e_faceA,f.localNormal.set(E[A]),f.localPoint.setCombine(.5,R,.5,L),f.points[0].localPoint=_.m_p,f.points[0].id.cf.indexA=0,f.points[0].id.cf.typeA=o.e_vertex,f.points[0].id.cf.indexB=0,f.points[0].id.cf.typeB=o.e_vertex;return}var I=h.dot(h.sub(x,R),h.sub(L,R)),z=h.dot(h.sub(x,L),h.sub(R,L));if(I<=0){if(h.distanceSquared(x,R)>M*M)return;f.pointCount=1,f.type=o.e_faceA,f.localNormal.setCombine(1,x,-1,R),f.localNormal.normalize(),f.localPoint=R,f.points[0].localPoint.set(_.m_p),f.points[0].id.cf.indexA=0,f.points[0].id.cf.typeA=o.e_vertex,f.points[0].id.cf.indexB=0,f.points[0].id.cf.typeB=o.e_vertex}else if(z<=0){if(h.distanceSquared(x,L)>M*M)return;f.pointCount=1,f.type=o.e_faceA,f.localNormal.setCombine(1,x,-1,L),f.localNormal.normalize(),f.localPoint.set(L),f.points[0].localPoint.set(_.m_p),f.points[0].id.cf.indexA=0,f.points[0].id.cf.typeA=o.e_vertex,f.points[0].id.cf.indexB=0,f.points[0].id.cf.typeB=o.e_vertex}else{var F=h.mid(R,L),b=h.dot(x,E[C])-h.dot(F,E[C]);if(b>M)return;f.pointCount=1,f.type=o.e_faceA,f.localNormal.set(E[C]),f.localPoint.set(F),f.points[0].localPoint.set(_.m_p),f.points[0].id.cf.indexA=0,f.points[0].id.cf.typeA=o.e_vertex,f.points[0].id.cf.indexB=0,f.points[0].id.cf.typeB=o.e_vertex}}},function(e,n,s){s(2);var r=s(1),a=s(5),h=s(0),o=s(3),l=s(4);s(15);var u=s(17),m=s(18),p=s(23),c=s(28),f=s(20);u.addType(p.TYPE,f.TYPE,d),u.addType(c.TYPE,f.TYPE,y);function d(w,C,P,R,L,I,z){T(w,P.getShape(),C,I.getShape(),L)}function y(w,C,P,R,L,I,z){var F=P.getShape(),D=new p;F.getChildEdge(D,R),T(w,D,C,I.getShape(),L)}var _=-1,v=1,g=2;function x(){this.type,this.index,this.separation}function A(){this.vertices=[],this.normals=[],this.count=0}function b(){this.i1,this.i2,this.v1,this.v2,this.normal=h.zero(),this.sideNormal1=h.zero(),this.sideOffset1,this.sideNormal2=h.zero(),this.sideOffset2}var M=new x,S=new x,B=new A,E=new b;function T(w,C,P,R,L){var I=a.mulTXf(P,L),z=a.mulVec2(I,R.m_centroid),F=C.m_vertex0,D=C.m_vertex1,V=C.m_vertex2,G=C.m_vertex3,Y=C.m_hasVertex0,J=C.m_hasVertex3,Q=h.sub(V,D);Q.normalize();var W=h.neo(Q.y,-Q.x),et=h.dot(W,h.sub(z,D)),ct=0,Z=0,ot=!1,xt=!1;if(Y){var q=h.sub(D,F);q.normalize();var X=h.neo(q.y,-q.x);ot=h.cross(q,Q)>=0,ct=h.dot(X,z)-h.dot(X,F)}if(J){var at=h.sub(G,V);at.normalize();var ut=h.neo(at.y,-at.x);xt=h.cross(Q,at)>0,Z=h.dot(ut,z)-h.dot(ut,V)}var it,st=h.zero(),dt=h.zero(),mt=h.zero();Y&&J?ot&&xt?(it=ct>=0||et>=0||Z>=0,it?(st.set(W),dt.set(X),mt.set(ut)):(st.setMul(-1,W),dt.setMul(-1,W),mt.setMul(-1,W))):ot?(it=ct>=0||et>=0&&Z>=0,it?(st.set(W),dt.set(X),mt.set(W)):(st.setMul(-1,W),dt.setMul(-1,ut),mt.setMul(-1,W))):xt?(it=Z>=0||ct>=0&&et>=0,it?(st.set(W),dt.set(W),mt.set(ut)):(st.setMul(-1,W),dt.setMul(-1,W),mt.setMul(-1,X))):(it=ct>=0&&et>=0&&Z>=0,it?(st.set(W),dt.set(W),mt.set(W)):(st.setMul(-1,W),dt.setMul(-1,ut),mt.setMul(-1,X))):Y?ot?(it=ct>=0||et>=0,it?(st.set(W),dt.set(X),mt.setMul(-1,W)):(st.setMul(-1,W),dt.set(W),mt.setMul(-1,W))):(it=ct>=0&&et>=0,it?(st.set(W),dt.set(W),mt.setMul(-1,W)):(st.setMul(-1,W),dt.set(W),mt.setMul(-1,X))):J?xt?(it=et>=0||Z>=0,it?(st.set(W),dt.setMul(-1,W),mt.set(ut)):(st.setMul(-1,W),dt.setMul(-1,W),mt.set(W))):(it=et>=0&&Z>=0,it?(st.set(W),dt.setMul(-1,W),mt.set(W)):(st.setMul(-1,W),dt.setMul(-1,ut),mt.set(W))):(it=et>=0,it?(st.set(W),dt.setMul(-1,W),mt.setMul(-1,W)):(st.setMul(-1,W),dt.set(W),mt.set(W))),B.count=R.m_count;for(var pt=0;pt<R.m_count;++pt)B.vertices[pt]=a.mulVec2(I,R.m_vertices[pt]),B.normals[pt]=o.mulVec2(I.q,R.m_normals[pt]);var U=2*l.polygonRadius;w.pointCount=0;{M.type=v,M.index=it?0:1,M.separation=1/0;for(var pt=0;pt<B.count;++pt){var N=h.dot(st,h.sub(B.vertices[pt],D));N<M.separation&&(M.separation=N)}}if(M.type!=_&&!(M.separation>U)){{S.type=_,S.index=-1,S.separation=-1/0;for(var rt=h.neo(-st.y,st.x),pt=0;pt<B.count;++pt){var ht=h.neg(B.normals[pt]),At=h.dot(ht,h.sub(B.vertices[pt],D)),ft=h.dot(ht,h.sub(B.vertices[pt],V)),N=r.min(At,ft);if(N>U){S.type=g,S.index=pt,S.separation=N;break}if(h.dot(ht,rt)>=0){if(h.dot(h.sub(ht,mt),st)<-l.angularSlop)continue}else if(h.dot(h.sub(ht,dt),st)<-l.angularSlop)continue;N>S.separation&&(S.type=g,S.index=pt,S.separation=N)}}if(!(S.type!=_&&S.separation>U)){var It=.98,Ct=.001,_t;S.type==_?_t=M:S.separation>It*M.separation+Ct?_t=S:_t=M;var H=[new m.clipVertex,new m.clipVertex];if(_t.type==v){w.type=m.e_faceA;for(var gt=0,yt=h.dot(st,B.normals[0]),pt=1;pt<B.count;++pt){var zt=h.dot(st,B.normals[pt]);zt<yt&&(yt=zt,gt=pt)}var Tt=gt,Gt=Tt+1<B.count?Tt+1:0;H[0].v=B.vertices[Tt],H[0].id.cf.indexA=0,H[0].id.cf.indexB=Tt,H[0].id.cf.typeA=m.e_face,H[0].id.cf.typeB=m.e_vertex,H[1].v=B.vertices[Gt],H[1].id.cf.indexA=0,H[1].id.cf.indexB=Gt,H[1].id.cf.typeA=m.e_face,H[1].id.cf.typeB=m.e_vertex,it?(E.i1=0,E.i2=1,E.v1=D,E.v2=V,E.normal.set(W)):(E.i1=1,E.i2=0,E.v1=V,E.v2=D,E.normal.setMul(-1,W))}else w.type=m.e_faceB,H[0].v=D,H[0].id.cf.indexA=0,H[0].id.cf.indexB=_t.index,H[0].id.cf.typeA=m.e_vertex,H[0].id.cf.typeB=m.e_face,H[1].v=V,H[1].id.cf.indexA=0,H[1].id.cf.indexB=_t.index,H[1].id.cf.typeA=m.e_vertex,H[1].id.cf.typeB=m.e_face,E.i1=_t.index,E.i2=E.i1+1<B.count?E.i1+1:0,E.v1=B.vertices[E.i1],E.v2=B.vertices[E.i2],E.normal.set(B.normals[E.i1]);E.sideNormal1.set(E.normal.y,-E.normal.x),E.sideNormal2.setMul(-1,E.sideNormal1),E.sideOffset1=h.dot(E.sideNormal1,E.v1),E.sideOffset2=h.dot(E.sideNormal2,E.v2);var bt=[new m.clipVertex,new m.clipVertex],Pt=[new m.clipVertex,new m.clipVertex],pe;if(pe=m.clipSegmentToLine(bt,H,E.sideNormal1,E.sideOffset1,E.i1),!(pe<l.maxManifoldPoints)&&(pe=m.clipSegmentToLine(Pt,bt,E.sideNormal2,E.sideOffset2,E.i2),!(pe<l.maxManifoldPoints))){_t.type==v?(w.localNormal=h.clone(E.normal),w.localPoint=h.clone(E.v1)):(w.localNormal=h.clone(R.m_normals[E.i1]),w.localPoint=h.clone(R.m_vertices[E.i1]));for(var ce=0,pt=0;pt<l.maxManifoldPoints;++pt){var sn=h.dot(E.normal,h.sub(Pt[pt].v,E.v1));if(sn<=U){var mi=w.points[ce];_t.type==v?(mi.localPoint=a.mulT(I,Pt[pt].v),mi.id=Pt[pt].id):(mi.localPoint=Pt[pt].v,mi.id.cf.typeA=Pt[pt].id.cf.typeB,mi.id.cf.typeB=Pt[pt].id.cf.typeA,mi.id.cf.indexA=Pt[pt].id.cf.indexB,mi.id.cf.indexB=Pt[pt].id.cf.indexA),++ce}}w.pointCount=ce}}}}},function(e,n,s){e.exports=c;var r=s(6),a=s(4),h=s(1),o=s(0);s(7),s(10),s(14);var l=s(3);s(9),s(5),s(12),s(13);var u=s(11),m=s(8);c.TYPE="distance-joint",u.TYPES[c.TYPE]=c,c._super=u,c.prototype=Object.create(c._super.prototype);var p={frequencyHz:0,dampingRatio:0};function c(f,d,y,_,v){if(!(this instanceof c))return new c(f,d,y,_,v);if(y&&_&&"m_type"in _&&"x"in y&&"y"in y){var g=y;y=_,_=g}f=r(f,p),u.call(this,f,d,y),d=this.m_bodyA,y=this.m_bodyB,this.m_type=c.TYPE,this.m_localAnchorA=o.clone(_?d.getLocalPoint(_):f.localAnchorA||o.zero()),this.m_localAnchorB=o.clone(v?y.getLocalPoint(v):f.localAnchorB||o.zero()),this.m_length=h.isFinite(f.length)?f.length:o.distance(d.getWorldPoint(this.m_localAnchorA),y.getWorldPoint(this.m_localAnchorB)),this.m_frequencyHz=f.frequencyHz,this.m_dampingRatio=f.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},c._deserialize=function(f,d,y){f=Object.assign({},f),f.bodyA=y(m,f.bodyA,d),f.bodyB=y(m,f.bodyB,d);var _=new c(f);return _},c.prototype._setAnchors=function(f){f.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(f.anchorA)):f.localAnchorA&&this.m_localAnchorA.set(f.localAnchorA),f.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(f.anchorB)):f.localAnchorB&&this.m_localAnchorB.set(f.localAnchorB),f.length>0?this.m_length=+f.length:f.length<0||(f.anchorA||f.anchorA||f.anchorA||f.anchorA)&&(this.m_length=o.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB)))},c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.setLength=function(f){this.m_length=f},c.prototype.getLength=function(){return this.m_length},c.prototype.setFrequency=function(f){this.m_frequencyHz=f},c.prototype.getFrequency=function(){return this.m_frequencyHz},c.prototype.setDampingRatio=function(f){this.m_dampingRatio=f},c.prototype.getDampingRatio=function(){return this.m_dampingRatio},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(f){return o.mul(this.m_impulse,this.m_u).mul(f)},c.prototype.getReactionTorque=function(f){return 0},c.prototype.initVelocityConstraints=function(f){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var d=this.m_bodyA.c_position.c,y=this.m_bodyA.c_position.a,_=this.m_bodyA.c_velocity.v,v=this.m_bodyA.c_velocity.w,g=this.m_bodyB.c_position.c,x=this.m_bodyB.c_position.a,A=this.m_bodyB.c_velocity.v,b=this.m_bodyB.c_velocity.w,M=l.neo(y),S=l.neo(x);this.m_rA=l.mulVec2(M,o.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=l.mulVec2(S,o.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=o.sub(o.add(g,this.m_rB),o.add(d,this.m_rA));var B=this.m_u.length();B>a.linearSlop?this.m_u.mul(1/B):this.m_u.set(0,0);var E=o.cross(this.m_rA,this.m_u),T=o.cross(this.m_rB,this.m_u),w=this.m_invMassA+this.m_invIA*E*E+this.m_invMassB+this.m_invIB*T*T;if(this.m_mass=w!=0?1/w:0,this.m_frequencyHz>0){var C=B-this.m_length,P=2*h.PI*this.m_frequencyHz,R=2*this.m_mass*this.m_dampingRatio*P,L=this.m_mass*P*P,I=f.dt;this.m_gamma=I*(R+I*L),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=C*I*L*this.m_gamma,w+=this.m_gamma,this.m_mass=w!=0?1/w:0}else this.m_gamma=0,this.m_bias=0;if(f.warmStarting){this.m_impulse*=f.dtRatio;var z=o.mul(this.m_impulse,this.m_u);_.subMul(this.m_invMassA,z),v-=this.m_invIA*o.cross(this.m_rA,z),A.addMul(this.m_invMassB,z),b+=this.m_invIB*o.cross(this.m_rB,z)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(_),this.m_bodyA.c_velocity.w=v,this.m_bodyB.c_velocity.v.set(A),this.m_bodyB.c_velocity.w=b},c.prototype.solveVelocityConstraints=function(f){var d=this.m_bodyA.c_velocity.v,y=this.m_bodyA.c_velocity.w,_=this.m_bodyB.c_velocity.v,v=this.m_bodyB.c_velocity.w,g=o.add(d,o.cross(y,this.m_rA)),x=o.add(_,o.cross(v,this.m_rB)),A=o.dot(this.m_u,x)-o.dot(this.m_u,g),b=-this.m_mass*(A+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=b;var M=o.mul(b,this.m_u);d.subMul(this.m_invMassA,M),y-=this.m_invIA*o.cross(this.m_rA,M),_.addMul(this.m_invMassB,M),v+=this.m_invIB*o.cross(this.m_rB,M),this.m_bodyA.c_velocity.v.set(d),this.m_bodyA.c_velocity.w=y,this.m_bodyB.c_velocity.v.set(_),this.m_bodyB.c_velocity.w=v},c.prototype.solvePositionConstraints=function(f){if(this.m_frequencyHz>0)return!0;var d=this.m_bodyA.c_position.c,y=this.m_bodyA.c_position.a,_=this.m_bodyB.c_position.c,v=this.m_bodyB.c_position.a,g=l.neo(y),x=l.neo(v),A=l.mulSub(g,this.m_localAnchorA,this.m_localCenterA),b=l.mulSub(x,this.m_localAnchorB,this.m_localCenterB),M=o.sub(o.add(_,b),o.add(d,A)),S=M.normalize(),B=S-this.m_length;B=h.clamp(B,-a.maxLinearCorrection,a.maxLinearCorrection);var E=-this.m_mass*B,T=o.mul(E,M);return d.subMul(this.m_invMassA,T),y-=this.m_invIA*o.cross(A,T),_.addMul(this.m_invMassB,T),v+=this.m_invIB*o.cross(b,T),this.m_bodyA.c_position.c.set(d),this.m_bodyA.c_position.a=y,this.m_bodyB.c_position.c.set(_),this.m_bodyB.c_position.a=v,h.abs(B)<a.linearSlop}},function(e,n,s){e.exports=c,s(2);var r=s(6);s(4);var a=s(1),h=s(0);s(7);var o=s(10);s(14);var l=s(3);s(9),s(5),s(12),s(13);var u=s(11),m=s(8);c.TYPE="friction-joint",u.TYPES[c.TYPE]=c,c._super=u,c.prototype=Object.create(c._super.prototype);var p={maxForce:0,maxTorque:0};function c(f,d,y,_){if(!(this instanceof c))return new c(f,d,y,_);f=r(f,p),u.call(this,f,d,y),d=this.m_bodyA,y=this.m_bodyB,this.m_type=c.TYPE,this.m_localAnchorA=h.clone(_?d.getLocalPoint(_):f.localAnchorA||h.zero()),this.m_localAnchorB=h.clone(_?y.getLocalPoint(_):f.localAnchorB||h.zero()),this.m_linearImpulse=h.zero(),this.m_angularImpulse=0,this.m_maxForce=f.maxForce,this.m_maxTorque=f.maxTorque,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},c._deserialize=function(f,d,y){f=Object.assign({},f),f.bodyA=y(m,f.bodyA,d),f.bodyB=y(m,f.bodyB,d);var _=new c(f);return _},c.prototype._setAnchors=function(f){f.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(f.anchorA)):f.localAnchorA&&this.m_localAnchorA.set(f.localAnchorA),f.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(f.anchorB)):f.localAnchorB&&this.m_localAnchorB.set(f.localAnchorB)},c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.setMaxForce=function(f){this.m_maxForce=f},c.prototype.getMaxForce=function(){return this.m_maxForce},c.prototype.setMaxTorque=function(f){this.m_maxTorque=f},c.prototype.getMaxTorque=function(){return this.m_maxTorque},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(f){return h.mul(f,this.m_linearImpulse)},c.prototype.getReactionTorque=function(f){return f*this.m_angularImpulse},c.prototype.initVelocityConstraints=function(f){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var d=this.m_bodyA.c_position.a,y=this.m_bodyA.c_velocity.v,_=this.m_bodyA.c_velocity.w,v=this.m_bodyB.c_position.a,g=this.m_bodyB.c_velocity.v,x=this.m_bodyB.c_velocity.w,A=l.neo(d),b=l.neo(v);this.m_rA=l.mulVec2(A,h.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=l.mulVec2(b,h.sub(this.m_localAnchorB,this.m_localCenterB));var M=this.m_invMassA,S=this.m_invMassB,B=this.m_invIA,E=this.m_invIB,T=new o;if(T.ex.x=M+S+B*this.m_rA.y*this.m_rA.y+E*this.m_rB.y*this.m_rB.y,T.ex.y=-B*this.m_rA.x*this.m_rA.y-E*this.m_rB.x*this.m_rB.y,T.ey.x=T.ex.y,T.ey.y=M+S+B*this.m_rA.x*this.m_rA.x+E*this.m_rB.x*this.m_rB.x,this.m_linearMass=T.getInverse(),this.m_angularMass=B+E,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),f.warmStarting){this.m_linearImpulse.mul(f.dtRatio),this.m_angularImpulse*=f.dtRatio;var w=h.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);y.subMul(M,w),_-=B*(h.cross(this.m_rA,w)+this.m_angularImpulse),g.addMul(S,w),x+=E*(h.cross(this.m_rB,w)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=y,this.m_bodyA.c_velocity.w=_,this.m_bodyB.c_velocity.v=g,this.m_bodyB.c_velocity.w=x},c.prototype.solveVelocityConstraints=function(f){var d=this.m_bodyA.c_velocity.v,y=this.m_bodyA.c_velocity.w,_=this.m_bodyB.c_velocity.v,v=this.m_bodyB.c_velocity.w,g=this.m_invMassA,x=this.m_invMassB,A=this.m_invIA,b=this.m_invIB,M=f.dt;{var S=v-y,B=-this.m_angularMass*S,E=this.m_angularImpulse,T=M*this.m_maxTorque;this.m_angularImpulse=a.clamp(this.m_angularImpulse+B,-T,T),B=this.m_angularImpulse-E,y-=A*B,v+=b*B}{var S=h.sub(h.add(_,h.cross(v,this.m_rB)),h.add(d,h.cross(y,this.m_rA))),B=h.neg(o.mulVec2(this.m_linearMass,S)),E=this.m_linearImpulse;this.m_linearImpulse.add(B);var T=M*this.m_maxForce;this.m_linearImpulse.lengthSquared()>T*T&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(T)),B=h.sub(this.m_linearImpulse,E),d.subMul(g,B),y-=A*h.cross(this.m_rA,B),_.addMul(x,B),v+=b*h.cross(this.m_rB,B)}this.m_bodyA.c_velocity.v=d,this.m_bodyA.c_velocity.w=y,this.m_bodyB.c_velocity.v=_,this.m_bodyB.c_velocity.w=v},c.prototype.solvePositionConstraints=function(f){return!0}},function(e,n,s){e.exports=f,s(2);var r=s(6),a=s(4),h=s(1),o=s(0);s(7),s(10),s(14);var l=s(3);s(9),s(5),s(12),s(13);var u=s(11),m=s(8),p=s(33);s(34),f.TYPE="gear-joint",u.TYPES[f.TYPE]=f,f._super=u,f.prototype=Object.create(f._super.prototype);var c={ratio:1};function f(d,y,_,v,g,x){if(!(this instanceof f))return new f(d,y,_,v,g,x);d=r(d,c),u.call(this,d,y,_),y=this.m_bodyA,_=this.m_bodyB,this.m_type=f.TYPE,this.m_joint1=v||d.joint1,this.m_joint2=g||d.joint2,this.m_ratio=h.isFinite(x)?x:d.ratio,this.m_type1=this.m_joint1.getType(),this.m_type2=this.m_joint2.getType();var A,b;this.m_bodyC=this.m_joint1.getBodyA(),this.m_bodyA=this.m_joint1.getBodyB();var M=this.m_bodyA.m_xf,S=this.m_bodyA.m_sweep.a,B=this.m_bodyC.m_xf,E=this.m_bodyC.m_sweep.a;if(this.m_type1===p.TYPE){var T=this.m_joint1;this.m_localAnchorC=T.m_localAnchorA,this.m_localAnchorA=T.m_localAnchorB,this.m_referenceAngleA=T.m_referenceAngle,this.m_localAxisC=o.zero(),A=S-E-this.m_referenceAngleA}else{var w=this.m_joint1;this.m_localAnchorC=w.m_localAnchorA,this.m_localAnchorA=w.m_localAnchorB,this.m_referenceAngleA=w.m_referenceAngle,this.m_localAxisC=w.m_localXAxisA;var C=this.m_localAnchorC,P=l.mulTVec2(B.q,o.add(l.mul(M.q,this.m_localAnchorA),o.sub(M.p,B.p)));A=o.dot(P,this.m_localAxisC)-o.dot(C,this.m_localAxisC)}this.m_bodyD=this.m_joint2.getBodyA(),this.m_bodyB=this.m_joint2.getBodyB();var R=this.m_bodyB.m_xf,L=this.m_bodyB.m_sweep.a,I=this.m_bodyD.m_xf,z=this.m_bodyD.m_sweep.a;if(this.m_type2===p.TYPE){var T=this.m_joint2;this.m_localAnchorD=T.m_localAnchorA,this.m_localAnchorB=T.m_localAnchorB,this.m_referenceAngleB=T.m_referenceAngle,this.m_localAxisD=o.zero(),b=L-z-this.m_referenceAngleB}else{var w=this.m_joint2;this.m_localAnchorD=w.m_localAnchorA,this.m_localAnchorB=w.m_localAnchorB,this.m_referenceAngleB=w.m_referenceAngle,this.m_localAxisD=w.m_localXAxisA;var F=this.m_localAnchorD,D=l.mulTVec2(I.q,o.add(l.mul(R.q,this.m_localAnchorB),o.sub(R.p,I.p)));b=o.dot(D,this.m_localAxisD)-o.dot(F,this.m_localAxisD)}this.m_constant=A+this.m_ratio*b,this.m_impulse=0,this.m_lcA,this.m_lcB,this.m_lcC,this.m_lcD,this.m_mA,this.m_mB,this.m_mC,this.m_mD,this.m_iA,this.m_iB,this.m_iC,this.m_iD,this.m_JvAC,this.m_JvBD,this.m_JwA,this.m_JwB,this.m_JwC,this.m_JwD,this.m_mass}f.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},f._deserialize=function(d,y,_){d=Object.assign({},d),d.bodyA=_(m,d.bodyA,y),d.bodyB=_(m,d.bodyB,y),d.joint1=_(u,d.joint1,y),d.joint2=_(u,d.joint2,y);var v=new f(d);return v},f.prototype.getJoint1=function(){return this.m_joint1},f.prototype.getJoint2=function(){return this.m_joint2},f.prototype.setRatio=function(d){this.m_ratio=d},f.prototype.getRatio=function(){return this.m_ratio},f.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},f.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},f.prototype.getReactionForce=function(d){return o.mul(this.m_impulse,this.m_JvAC).mul(d)},f.prototype.getReactionTorque=function(d){var y=this.m_impulse*this.m_JwA;return d*y},f.prototype.initVelocityConstraints=function(d){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var y=this.m_bodyA.c_position.a,_=this.m_bodyA.c_velocity.v,v=this.m_bodyA.c_velocity.w,g=this.m_bodyB.c_position.a,x=this.m_bodyB.c_velocity.v,A=this.m_bodyB.c_velocity.w,b=this.m_bodyC.c_position.a,M=this.m_bodyC.c_velocity.v,S=this.m_bodyC.c_velocity.w,B=this.m_bodyD.c_position.a,E=this.m_bodyD.c_velocity.v,T=this.m_bodyD.c_velocity.w,w=l.neo(y),C=l.neo(g),P=l.neo(b),R=l.neo(B);if(this.m_mass=0,this.m_type1==p.TYPE)this.m_JvAC=o.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var L=l.mulVec2(P,this.m_localAxisC),I=l.mulSub(P,this.m_localAnchorC,this.m_lcC),z=l.mulSub(w,this.m_localAnchorA,this.m_lcA);this.m_JvAC=L,this.m_JwC=o.cross(I,L),this.m_JwA=o.cross(z,L),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==p.TYPE)this.m_JvBD=o.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var L=l.mulVec2(R,this.m_localAxisD),F=l.mulSub(R,this.m_localAnchorD,this.m_lcD),D=l.mulSub(C,this.m_localAnchorB,this.m_lcB);this.m_JvBD=o.mul(this.m_ratio,L),this.m_JwD=this.m_ratio*o.cross(F,L),this.m_JwB=this.m_ratio*o.cross(D,L),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,d.warmStarting?(_.addMul(this.m_mA*this.m_impulse,this.m_JvAC),v+=this.m_iA*this.m_impulse*this.m_JwA,x.addMul(this.m_mB*this.m_impulse,this.m_JvBD),A+=this.m_iB*this.m_impulse*this.m_JwB,M.subMul(this.m_mC*this.m_impulse,this.m_JvAC),S-=this.m_iC*this.m_impulse*this.m_JwC,E.subMul(this.m_mD*this.m_impulse,this.m_JvBD),T-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.set(_),this.m_bodyA.c_velocity.w=v,this.m_bodyB.c_velocity.v.set(x),this.m_bodyB.c_velocity.w=A,this.m_bodyC.c_velocity.v.set(M),this.m_bodyC.c_velocity.w=S,this.m_bodyD.c_velocity.v.set(E),this.m_bodyD.c_velocity.w=T},f.prototype.solveVelocityConstraints=function(d){var y=this.m_bodyA.c_velocity.v,_=this.m_bodyA.c_velocity.w,v=this.m_bodyB.c_velocity.v,g=this.m_bodyB.c_velocity.w,x=this.m_bodyC.c_velocity.v,A=this.m_bodyC.c_velocity.w,b=this.m_bodyD.c_velocity.v,M=this.m_bodyD.c_velocity.w,S=o.dot(this.m_JvAC,y)-o.dot(this.m_JvAC,x)+o.dot(this.m_JvBD,v)-o.dot(this.m_JvBD,b);S+=this.m_JwA*_-this.m_JwC*A+(this.m_JwB*g-this.m_JwD*M);var B=-this.m_mass*S;this.m_impulse+=B,y.addMul(this.m_mA*B,this.m_JvAC),_+=this.m_iA*B*this.m_JwA,v.addMul(this.m_mB*B,this.m_JvBD),g+=this.m_iB*B*this.m_JwB,x.subMul(this.m_mC*B,this.m_JvAC),A-=this.m_iC*B*this.m_JwC,b.subMul(this.m_mD*B,this.m_JvBD),M-=this.m_iD*B*this.m_JwD,this.m_bodyA.c_velocity.v.set(y),this.m_bodyA.c_velocity.w=_,this.m_bodyB.c_velocity.v.set(v),this.m_bodyB.c_velocity.w=g,this.m_bodyC.c_velocity.v.set(x),this.m_bodyC.c_velocity.w=A,this.m_bodyD.c_velocity.v.set(b),this.m_bodyD.c_velocity.w=M},f.prototype.solvePositionConstraints=function(d){var y=this.m_bodyA.c_position.c,_=this.m_bodyA.c_position.a,v=this.m_bodyB.c_position.c,g=this.m_bodyB.c_position.a,x=this.m_bodyC.c_position.c,A=this.m_bodyC.c_position.a,b=this.m_bodyD.c_position.c,M=this.m_bodyD.c_position.a,S=l.neo(_),B=l.neo(g),E=l.neo(A),T=l.neo(M),w=0,C,P,R,L,I,z,F,D,V=0;if(this.m_type1==p.TYPE)R=o.zero(),I=1,F=1,V+=this.m_iA+this.m_iC,C=_-A-this.m_referenceAngleA;else{var G=l.mulVec2(E,this.m_localAxisC),Y=l.mulSub(E,this.m_localAnchorC,this.m_lcC),J=l.mulSub(S,this.m_localAnchorA,this.m_lcA);R=G,F=o.cross(Y,G),I=o.cross(J,G),V+=this.m_mC+this.m_mA+this.m_iC*F*F+this.m_iA*I*I;var Q=o.sub(this.m_localAnchorC,this.m_lcC),W=l.mulTVec2(E,o.add(J,o.sub(y,x)));C=o.dot(o.sub(W,Q),this.m_localAxisC)}if(this.m_type2==p.TYPE)L=o.zero(),z=this.m_ratio,D=this.m_ratio,V+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),P=g-M-this.m_referenceAngleB;else{var G=l.mulVec2(T,this.m_localAxisD),et=l.mulSub(T,this.m_localAnchorD,this.m_lcD),ct=l.mulSub(B,this.m_localAnchorB,this.m_lcB);L=o.mul(this.m_ratio,G),D=this.m_ratio*o.cross(et,G),z=this.m_ratio*o.cross(ct,G),V+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*D*D+this.m_iB*z*z;var Z=o.sub(this.m_localAnchorD,this.m_lcD),ot=l.mulTVec2(T,o.add(ct,o.sub(v,b)));P=o.dot(ot,this.m_localAxisD)-o.dot(Z,this.m_localAxisD)}var xt=C+this.m_ratio*P-this.m_constant,q=0;return V>0&&(q=-xt/V),y.addMul(this.m_mA*q,R),_+=this.m_iA*q*I,v.addMul(this.m_mB*q,L),g+=this.m_iB*q*z,x.subMul(this.m_mC*q,R),A-=this.m_iC*q*F,b.subMul(this.m_mD*q,L),M-=this.m_iD*q*D,this.m_bodyA.c_position.c.set(y),this.m_bodyA.c_position.a=_,this.m_bodyB.c_position.c.set(v),this.m_bodyB.c_position.a=g,this.m_bodyC.c_position.c.set(x),this.m_bodyC.c_position.a=A,this.m_bodyD.c_position.c.set(b),this.m_bodyD.c_position.a=M,w<a.linearSlop}},function(e,n,s){e.exports=c,s(2);var r=s(6);s(4);var a=s(1),h=s(0);s(7);var o=s(10);s(14);var l=s(3);s(9),s(5),s(12),s(13);var u=s(11),m=s(8);c.TYPE="motor-joint",u.TYPES[c.TYPE]=c,c._super=u,c.prototype=Object.create(c._super.prototype);var p={maxForce:1,maxTorque:1,correctionFactor:.3};function c(f,d,y){if(!(this instanceof c))return new c(f,d,y);f=r(f,p),u.call(this,f,d,y),d=this.m_bodyA,y=this.m_bodyB,this.m_type=c.TYPE,this.m_linearOffset=a.isFinite(f.linearOffset)?f.linearOffset:d.getLocalPoint(y.getPosition()),this.m_angularOffset=a.isFinite(f.angularOffset)?f.angularOffset:y.getAngle()-d.getAngle(),this.m_linearImpulse=h.zero(),this.m_angularImpulse=0,this.m_maxForce=f.maxForce,this.m_maxTorque=f.maxTorque,this.m_correctionFactor=f.correctionFactor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_linearError,this.m_angularError,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},c._deserialize=function(f,d,y){f=Object.assign({},f),f.bodyA=y(m,f.bodyA,d),f.bodyB=y(m,f.bodyB,d);var _=new c(f);return _},c.prototype._setAnchors=function(f){f.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(f.anchorA)):f.localAnchorA&&this.m_localAnchorA.set(f.localAnchorA),f.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(f.anchorB)):f.localAnchorB&&this.m_localAnchorB.set(f.localAnchorB)},c.prototype.setMaxForce=function(f){this.m_maxForce=f},c.prototype.getMaxForce=function(){return this.m_maxForce},c.prototype.setMaxTorque=function(f){this.m_maxTorque=f},c.prototype.getMaxTorque=function(){return this.m_maxTorque},c.prototype.setCorrectionFactor=function(f){this.m_correctionFactor=f},c.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},c.prototype.setLinearOffset=function(f){(f.x!=this.m_linearOffset.x||f.y!=this.m_linearOffset.y)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=f)},c.prototype.getLinearOffset=function(){return this.m_linearOffset},c.prototype.setAngularOffset=function(f){f!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=f)},c.prototype.getAngularOffset=function(){return this.m_angularOffset},c.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},c.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},c.prototype.getReactionForce=function(f){return h.mul(f,this.m_linearImpulse)},c.prototype.getReactionTorque=function(f){return f*this.m_angularImpulse},c.prototype.initVelocityConstraints=function(f){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var d=this.m_bodyA.c_position.c,y=this.m_bodyA.c_position.a,_=this.m_bodyA.c_velocity.v,v=this.m_bodyA.c_velocity.w,g=this.m_bodyB.c_position.c,x=this.m_bodyB.c_position.a,A=this.m_bodyB.c_velocity.v,b=this.m_bodyB.c_velocity.w,M=l.neo(y),S=l.neo(x);this.m_rA=l.mulVec2(M,h.neg(this.m_localCenterA)),this.m_rB=l.mulVec2(S,h.neg(this.m_localCenterB));var B=this.m_invMassA,E=this.m_invMassB,T=this.m_invIA,w=this.m_invIB,C=new o;if(C.ex.x=B+E+T*this.m_rA.y*this.m_rA.y+w*this.m_rB.y*this.m_rB.y,C.ex.y=-T*this.m_rA.x*this.m_rA.y-w*this.m_rB.x*this.m_rB.y,C.ey.x=C.ex.y,C.ey.y=B+E+T*this.m_rA.x*this.m_rA.x+w*this.m_rB.x*this.m_rB.x,this.m_linearMass=C.getInverse(),this.m_angularMass=T+w,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=h.zero(),this.m_linearError.addCombine(1,g,1,this.m_rB),this.m_linearError.subCombine(1,d,1,this.m_rA),this.m_linearError.sub(l.mulVec2(M,this.m_linearOffset)),this.m_angularError=x-y-this.m_angularOffset,f.warmStarting){this.m_linearImpulse.mul(f.dtRatio),this.m_angularImpulse*=f.dtRatio;var P=h.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);_.subMul(B,P),v-=T*(h.cross(this.m_rA,P)+this.m_angularImpulse),A.addMul(E,P),b+=w*(h.cross(this.m_rB,P)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=_,this.m_bodyA.c_velocity.w=v,this.m_bodyB.c_velocity.v=A,this.m_bodyB.c_velocity.w=b},c.prototype.solveVelocityConstraints=function(f){var d=this.m_bodyA.c_velocity.v,y=this.m_bodyA.c_velocity.w,_=this.m_bodyB.c_velocity.v,v=this.m_bodyB.c_velocity.w,g=this.m_invMassA,x=this.m_invMassB,A=this.m_invIA,b=this.m_invIB,M=f.dt,S=f.inv_dt;{var B=v-y+S*this.m_correctionFactor*this.m_angularError,E=-this.m_angularMass*B,T=this.m_angularImpulse,w=M*this.m_maxTorque;this.m_angularImpulse=a.clamp(this.m_angularImpulse+E,-w,w),E=this.m_angularImpulse-T,y-=A*E,v+=b*E}{var B=h.zero();B.addCombine(1,_,1,h.cross(v,this.m_rB)),B.subCombine(1,d,1,h.cross(y,this.m_rA)),B.addMul(S*this.m_correctionFactor,this.m_linearError);var E=h.neg(o.mulVec2(this.m_linearMass,B)),T=h.clone(this.m_linearImpulse);this.m_linearImpulse.add(E);var w=M*this.m_maxForce;this.m_linearImpulse.clamp(w),E=h.sub(this.m_linearImpulse,T),d.subMul(g,E),y-=A*h.cross(this.m_rA,E),_.addMul(x,E),v+=b*h.cross(this.m_rB,E)}this.m_bodyA.c_velocity.v=d,this.m_bodyA.c_velocity.w=y,this.m_bodyB.c_velocity.v=_,this.m_bodyB.c_velocity.w=v},c.prototype.solvePositionConstraints=function(f){return!0}},function(e,n,s){e.exports=f,s(2);var r=s(6),a=s(1),h=s(0);s(7);var o=s(10);s(14);var l=s(3);s(9);var u=s(5);s(12),s(13);var m=s(11),p=s(8);f.TYPE="mouse-joint",m.TYPES[f.TYPE]=f,f._super=m,f.prototype=Object.create(f._super.prototype);var c={maxForce:0,frequencyHz:5,dampingRatio:.7};function f(d,y,_,v){if(!(this instanceof f))return new f(d,y,_,v);d=r(d,c),m.call(this,d,y,_),y=this.m_bodyA,_=this.m_bodyB,this.m_type=f.TYPE,this.m_targetA=v?h.clone(v):d.target||h.zero(),this.m_localAnchorB=u.mulTVec2(_.getTransform(),this.m_targetA),this.m_maxForce=d.maxForce,this.m_impulse=h.zero(),this.m_frequencyHz=d.frequencyHz,this.m_dampingRatio=d.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_rB=h.zero(),this.m_localCenterB=h.zero(),this.m_invMassB=0,this.m_invIB=0,this.mass=new o,this.m_C=h.zero()}f.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},f._deserialize=function(d,y,_){d=Object.assign({},d),d.bodyA=_(p,d.bodyA,y),d.bodyB=_(p,d.bodyB,y),d.target=h(d.target);var v=new f(d);return d._localAnchorB&&(v.m_localAnchorB=d._localAnchorB),v},f.prototype.setTarget=function(d){this.m_bodyB.isAwake()==!1&&this.m_bodyB.setAwake(!0),this.m_targetA=h.clone(d)},f.prototype.getTarget=function(){return this.m_targetA},f.prototype.setMaxForce=function(d){this.m_maxForce=d},f.getMaxForce=function(){return this.m_maxForce},f.prototype.setFrequency=function(d){this.m_frequencyHz=d},f.prototype.getFrequency=function(){return this.m_frequencyHz},f.prototype.setDampingRatio=function(d){this.m_dampingRatio=d},f.prototype.getDampingRatio=function(){return this.m_dampingRatio},f.prototype.getAnchorA=function(){return h.clone(this.m_targetA)},f.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},f.prototype.getReactionForce=function(d){return h.mul(d,this.m_impulse)},f.prototype.getReactionTorque=function(d){return d*0},f.prototype.shiftOrigin=function(d){this.m_targetA.sub(d)},f.prototype.initVelocityConstraints=function(d){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var y=this.m_bodyB.c_position,_=this.m_bodyB.c_velocity,v=y.c,g=y.a,x=_.v,A=_.w,b=l.neo(g),M=this.m_bodyB.getMass(),S=2*a.PI*this.m_frequencyHz,B=2*M*this.m_dampingRatio*S,E=M*(S*S),T=d.dt;this.m_gamma=T*(B+T*E),this.m_gamma!=0&&(this.m_gamma=1/this.m_gamma),this.m_beta=T*E*this.m_gamma,this.m_rB=l.mulVec2(b,h.sub(this.m_localAnchorB,this.m_localCenterB));var w=new o;w.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,w.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,w.ey.x=w.ex.y,w.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=w.getInverse(),this.m_C.set(v),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),A*=.98,d.warmStarting?(this.m_impulse.mul(d.dtRatio),x.addMul(this.m_invMassB,this.m_impulse),A+=this.m_invIB*h.cross(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),_.v.set(x),_.w=A},f.prototype.solveVelocityConstraints=function(d){var y=this.m_bodyB.c_velocity,_=h.clone(y.v),v=y.w,g=h.cross(v,this.m_rB);g.add(_),g.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),g.neg();var x=o.mulVec2(this.m_mass,g),A=h.clone(this.m_impulse);this.m_impulse.add(x);var b=d.dt*this.m_maxForce;this.m_impulse.clamp(b),x=h.sub(this.m_impulse,A),_.addMul(this.m_invMassB,x),v+=this.m_invIB*h.cross(this.m_rB,x),y.v.set(_),y.w=v},f.prototype.solvePositionConstraints=function(d){return!0}},function(e,n,s){e.exports=c,s(2);var r=s(6),a=s(4),h=s(1),o=s(0);s(7),s(10),s(14);var l=s(3);s(9),s(5),s(12),s(13);var u=s(11),m=s(8);c.TYPE="pulley-joint",c.MIN_PULLEY_LENGTH=2,u.TYPES[c.TYPE]=c,c._super=u,c.prototype=Object.create(c._super.prototype);var p={collideConnected:!0};function c(f,d,y,_,v,g,x,A){if(!(this instanceof c))return new c(f,d,y,_,v,g,x,A);f=r(f,p),u.call(this,f,d,y),d=this.m_bodyA,y=this.m_bodyB,this.m_type=c.TYPE,this.m_groundAnchorA=_||f.groundAnchorA||o.neo(-1,1),this.m_groundAnchorB=v||f.groundAnchorB||o.neo(1,1),this.m_localAnchorA=g?d.getLocalPoint(g):f.localAnchorA||o.neo(-1,0),this.m_localAnchorB=x?y.getLocalPoint(x):f.localAnchorB||o.neo(1,0),this.m_lengthA=h.isFinite(f.lengthA)?f.lengthA:o.distance(g,_),this.m_lengthB=h.isFinite(f.lengthB)?f.lengthB:o.distance(x,v),this.m_ratio=h.isFinite(A)?A:f.ratio,this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0,this.m_uA,this.m_uB,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},c._deserialize=function(f,d,y){f=Object.assign({},f),f.bodyA=y(m,f.bodyA,d),f.bodyB=y(m,f.bodyB,d);var _=new c(f);return _},c.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},c.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},c.prototype.getLengthA=function(){return this.m_lengthA},c.prototype.getLengthB=function(){return this.m_lengthB},c.prototype.getRatio=function(){return this.m_ratio},c.prototype.getCurrentLengthA=function(){var f=this.m_bodyA.getWorldPoint(this.m_localAnchorA),d=this.m_groundAnchorA;return o.distance(f,d)},c.prototype.getCurrentLengthB=function(){var f=this.m_bodyB.getWorldPoint(this.m_localAnchorB),d=this.m_groundAnchorB;return o.distance(f,d)},c.prototype.shiftOrigin=function(f){this.m_groundAnchorA.sub(f),this.m_groundAnchorB.sub(f)},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(f){return o.mul(this.m_impulse,this.m_uB).mul(f)},c.prototype.getReactionTorque=function(f){return 0},c.prototype.initVelocityConstraints=function(f){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var d=this.m_bodyA.c_position.c,y=this.m_bodyA.c_position.a,_=this.m_bodyA.c_velocity.v,v=this.m_bodyA.c_velocity.w,g=this.m_bodyB.c_position.c,x=this.m_bodyB.c_position.a,A=this.m_bodyB.c_velocity.v,b=this.m_bodyB.c_velocity.w,M=l.neo(y),S=l.neo(x);this.m_rA=l.mulVec2(M,o.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=l.mulVec2(S,o.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=o.sub(o.add(d,this.m_rA),this.m_groundAnchorA),this.m_uB=o.sub(o.add(g,this.m_rB),this.m_groundAnchorB);var B=this.m_uA.length(),E=this.m_uB.length();B>10*a.linearSlop?this.m_uA.mul(1/B):this.m_uA.setZero(),E>10*a.linearSlop?this.m_uB.mul(1/E):this.m_uB.setZero();var T=o.cross(this.m_rA,this.m_uA),w=o.cross(this.m_rB,this.m_uB),C=this.m_invMassA+this.m_invIA*T*T,P=this.m_invMassB+this.m_invIB*w*w;if(this.m_mass=C+this.m_ratio*this.m_ratio*P,this.m_mass>0&&(this.m_mass=1/this.m_mass),f.warmStarting){this.m_impulse*=f.dtRatio;var R=o.mul(-this.m_impulse,this.m_uA),L=o.mul(-this.m_ratio*this.m_impulse,this.m_uB);_.addMul(this.m_invMassA,R),v+=this.m_invIA*o.cross(this.m_rA,R),A.addMul(this.m_invMassB,L),b+=this.m_invIB*o.cross(this.m_rB,L)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=_,this.m_bodyA.c_velocity.w=v,this.m_bodyB.c_velocity.v=A,this.m_bodyB.c_velocity.w=b},c.prototype.solveVelocityConstraints=function(f){var d=this.m_bodyA.c_velocity.v,y=this.m_bodyA.c_velocity.w,_=this.m_bodyB.c_velocity.v,v=this.m_bodyB.c_velocity.w,g=o.add(d,o.cross(y,this.m_rA)),x=o.add(_,o.cross(v,this.m_rB)),A=-o.dot(this.m_uA,g)-this.m_ratio*o.dot(this.m_uB,x),b=-this.m_mass*A;this.m_impulse+=b;var M=o.mul(-b,this.m_uA),S=o.mul(-this.m_ratio*b,this.m_uB);d.addMul(this.m_invMassA,M),y+=this.m_invIA*o.cross(this.m_rA,M),_.addMul(this.m_invMassB,S),v+=this.m_invIB*o.cross(this.m_rB,S),this.m_bodyA.c_velocity.v=d,this.m_bodyA.c_velocity.w=y,this.m_bodyB.c_velocity.v=_,this.m_bodyB.c_velocity.w=v},c.prototype.solvePositionConstraints=function(f){var d=this.m_bodyA.c_position.c,y=this.m_bodyA.c_position.a,_=this.m_bodyB.c_position.c,v=this.m_bodyB.c_position.a,g=l.neo(y),x=l.neo(v),A=l.mulVec2(g,o.sub(this.m_localAnchorA,this.m_localCenterA)),b=l.mulVec2(x,o.sub(this.m_localAnchorB,this.m_localCenterB)),M=o.sub(o.add(d,this.m_rA),this.m_groundAnchorA),S=o.sub(o.add(_,this.m_rB),this.m_groundAnchorB),B=M.length(),E=S.length();B>10*a.linearSlop?M.mul(1/B):M.setZero(),E>10*a.linearSlop?S.mul(1/E):S.setZero();var T=o.cross(A,M),w=o.cross(b,S),C=this.m_invMassA+this.m_invIA*T*T,P=this.m_invMassB+this.m_invIB*w*w,R=C+this.m_ratio*this.m_ratio*P;R>0&&(R=1/R);var L=this.m_constant-B-this.m_ratio*E,I=h.abs(L),z=-R*L,F=o.mul(-z,M),D=o.mul(-this.m_ratio*z,S);return d.addMul(this.m_invMassA,F),y+=this.m_invIA*o.cross(A,F),_.addMul(this.m_invMassB,D),v+=this.m_invIB*o.cross(b,D),this.m_bodyA.c_position.c=d,this.m_bodyA.c_position.a=y,this.m_bodyB.c_position.c=_,this.m_bodyB.c_position.a=v,I<a.linearSlop}},function(e,n,s){e.exports=d;var r=s(6),a=s(4),h=s(1),o=s(0);s(7),s(10),s(14);var l=s(3);s(9),s(5),s(12),s(13);var u=s(11),m=s(8),p=0,c=2;d.TYPE="rope-joint",u.TYPES[d.TYPE]=d,d._super=u,d.prototype=Object.create(d._super.prototype);var f={maxLength:0};function d(y,_,v,g){if(!(this instanceof d))return new d(y,_,v,g);y=r(y,f),u.call(this,y,_,v),_=this.m_bodyA,v=this.m_bodyB,this.m_type=d.TYPE,this.m_localAnchorA=g?_.getLocalPoint(g):y.localAnchorA||o.neo(-1,0),this.m_localAnchorB=g?v.getLocalPoint(g):y.localAnchorB||o.neo(1,0),this.m_maxLength=y.maxLength,this.m_mass=0,this.m_impulse=0,this.m_length=0,this.m_state=p,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}d.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},d._deserialize=function(y,_,v){y=Object.assign({},y),y.bodyA=v(m,y.bodyA,_),y.bodyB=v(m,y.bodyB,_);var g=new d(y);return g},d.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},d.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},d.prototype.setMaxLength=function(y){this.m_maxLength=y},d.prototype.getMaxLength=function(){return this.m_maxLength},d.prototype.getLimitState=function(){return this.m_state},d.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},d.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},d.prototype.getReactionForce=function(y){return o.mul(this.m_impulse,this.m_u).mul(y)},d.prototype.getReactionTorque=function(y){return 0},d.prototype.initVelocityConstraints=function(y){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var _=this.m_bodyA.c_position.c,v=this.m_bodyA.c_position.a,g=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,A=this.m_bodyB.c_position.c,b=this.m_bodyB.c_position.a,M=this.m_bodyB.c_velocity.v,S=this.m_bodyB.c_velocity.w,B=l.neo(v),E=l.neo(b);this.m_rA=l.mulSub(B,this.m_localAnchorA,this.m_localCenterA),this.m_rB=l.mulSub(E,this.m_localAnchorB,this.m_localCenterB),this.m_u=o.zero(),this.m_u.addCombine(1,A,1,this.m_rB),this.m_u.subCombine(1,_,1,this.m_rA),this.m_length=this.m_u.length();var T=this.m_length-this.m_maxLength;if(T>0?this.m_state=c:this.m_state=p,this.m_length>a.linearSlop)this.m_u.mul(1/this.m_length);else{this.m_u.setZero(),this.m_mass=0,this.m_impulse=0;return}var w=o.cross(this.m_rA,this.m_u),C=o.cross(this.m_rB,this.m_u),P=this.m_invMassA+this.m_invIA*w*w+this.m_invMassB+this.m_invIB*C*C;if(this.m_mass=P!=0?1/P:0,y.warmStarting){this.m_impulse*=y.dtRatio;var R=o.mul(this.m_impulse,this.m_u);g.subMul(this.m_invMassA,R),x-=this.m_invIA*o.cross(this.m_rA,R),M.addMul(this.m_invMassB,R),S+=this.m_invIB*o.cross(this.m_rB,R)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(g),this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v.set(M),this.m_bodyB.c_velocity.w=S},d.prototype.solveVelocityConstraints=function(y){var _=this.m_bodyA.c_velocity.v,v=this.m_bodyA.c_velocity.w,g=this.m_bodyB.c_velocity.v,x=this.m_bodyB.c_velocity.w,A=o.addCross(_,v,this.m_rA),b=o.addCross(g,x,this.m_rB),M=this.m_length-this.m_maxLength,S=o.dot(this.m_u,o.sub(b,A));M<0&&(S+=y.inv_dt*M);var B=-this.m_mass*S,E=this.m_impulse;this.m_impulse=h.min(0,this.m_impulse+B),B=this.m_impulse-E;var T=o.mul(B,this.m_u);_.subMul(this.m_invMassA,T),v-=this.m_invIA*o.cross(this.m_rA,T),g.addMul(this.m_invMassB,T),x+=this.m_invIB*o.cross(this.m_rB,T),this.m_bodyA.c_velocity.v=_,this.m_bodyA.c_velocity.w=v,this.m_bodyB.c_velocity.v=g,this.m_bodyB.c_velocity.w=x},d.prototype.solvePositionConstraints=function(y){var _=this.m_bodyA.c_position.c,v=this.m_bodyA.c_position.a,g=this.m_bodyB.c_position.c,x=this.m_bodyB.c_position.a,A=l.neo(v),b=l.neo(x),M=l.mulSub(A,this.m_localAnchorA,this.m_localCenterA),S=l.mulSub(b,this.m_localAnchorB,this.m_localCenterB),B=o.zero();B.addCombine(1,g,1,S),B.subCombine(1,_,1,M);var E=B.normalize(),T=E-this.m_maxLength;T=h.clamp(T,0,a.maxLinearCorrection);var w=-this.m_mass*T,C=o.mul(w,B);return _.subMul(this.m_invMassA,C),v-=this.m_invIA*o.cross(M,C),g.addMul(this.m_invMassB,C),x+=this.m_invIB*o.cross(S,C),this.m_bodyA.c_position.c.set(_),this.m_bodyA.c_position.a=v,this.m_bodyB.c_position.c.set(g),this.m_bodyB.c_position.a=x,E-this.m_maxLength<a.linearSlop}},function(e,n,s){e.exports=d;var r=s(6),a=s(4),h=s(1),o=s(0),l=s(7);s(10);var u=s(14),m=s(3);s(9),s(5),s(12),s(13);var p=s(11),c=s(8);d.TYPE="weld-joint",p.TYPES[d.TYPE]=d,d._super=p,d.prototype=Object.create(d._super.prototype);var f={frequencyHz:0,dampingRatio:0};function d(y,_,v,g){if(!(this instanceof d))return new d(y,_,v,g);y=r(y,f),p.call(this,y,_,v),_=this.m_bodyA,v=this.m_bodyB,this.m_type=d.TYPE,this.m_localAnchorA=o.clone(g?_.getLocalPoint(g):y.localAnchorA||o.zero()),this.m_localAnchorB=o.clone(g?v.getLocalPoint(g):y.localAnchorB||o.zero()),this.m_referenceAngle=h.isFinite(y.referenceAngle)?y.referenceAngle:v.getAngle()-_.getAngle(),this.m_frequencyHz=y.frequencyHz,this.m_dampingRatio=y.dampingRatio,this.m_impulse=l(),this.m_bias=0,this.m_gamma=0,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new u}d.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},d._deserialize=function(y,_,v){y=Object.assign({},y),y.bodyA=v(c,y.bodyA,_),y.bodyB=v(c,y.bodyB,_);var g=new d(y);return g},d.prototype._setAnchors=function(y){y.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(y.anchorA)):y.localAnchorA&&this.m_localAnchorA.set(y.localAnchorA),y.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(y.anchorB)):y.localAnchorB&&this.m_localAnchorB.set(y.localAnchorB)},d.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},d.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},d.prototype.getReferenceAngle=function(){return this.m_referenceAngle},d.prototype.setFrequency=function(y){this.m_frequencyHz=y},d.prototype.getFrequency=function(){return this.m_frequencyHz},d.prototype.setDampingRatio=function(y){this.m_dampingRatio=y},d.prototype.getDampingRatio=function(){return this.m_dampingRatio},d.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},d.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},d.prototype.getReactionForce=function(y){return o.neo(this.m_impulse.x,this.m_impulse.y).mul(y)},d.prototype.getReactionTorque=function(y){return y*this.m_impulse.z},d.prototype.initVelocityConstraints=function(y){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var _=this.m_bodyA.c_position.a,v=this.m_bodyA.c_velocity.v,g=this.m_bodyA.c_velocity.w,x=this.m_bodyB.c_position.a,A=this.m_bodyB.c_velocity.v,b=this.m_bodyB.c_velocity.w,M=m.neo(_),S=m.neo(x);this.m_rA=m.mulVec2(M,o.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=m.mulVec2(S,o.sub(this.m_localAnchorB,this.m_localCenterB));var B=this.m_invMassA,E=this.m_invMassB,T=this.m_invIA,w=this.m_invIB,C=new u;if(C.ex.x=B+E+this.m_rA.y*this.m_rA.y*T+this.m_rB.y*this.m_rB.y*w,C.ey.x=-this.m_rA.y*this.m_rA.x*T-this.m_rB.y*this.m_rB.x*w,C.ez.x=-this.m_rA.y*T-this.m_rB.y*w,C.ex.y=C.ey.x,C.ey.y=B+E+this.m_rA.x*this.m_rA.x*T+this.m_rB.x*this.m_rB.x*w,C.ez.y=this.m_rA.x*T+this.m_rB.x*w,C.ex.z=C.ez.x,C.ey.z=C.ez.y,C.ez.z=T+w,this.m_frequencyHz>0){C.getInverse22(this.m_mass);var P=T+w,R=P>0?1/P:0,L=x-_-this.m_referenceAngle,I=2*h.PI*this.m_frequencyHz,z=2*R*this.m_dampingRatio*I,F=R*I*I,D=y.dt;this.m_gamma=D*(z+D*F),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=L*D*F*this.m_gamma,P+=this.m_gamma,this.m_mass.ez.z=P!=0?1/P:0}else C.ez.z==0?(C.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(C.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(y.warmStarting){this.m_impulse.mul(y.dtRatio);var V=o.neo(this.m_impulse.x,this.m_impulse.y);v.subMul(B,V),g-=T*(o.cross(this.m_rA,V)+this.m_impulse.z),A.addMul(E,V),b+=w*(o.cross(this.m_rB,V)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=v,this.m_bodyA.c_velocity.w=g,this.m_bodyB.c_velocity.v=A,this.m_bodyB.c_velocity.w=b},d.prototype.solveVelocityConstraints=function(y){var _=this.m_bodyA.c_velocity.v,v=this.m_bodyA.c_velocity.w,g=this.m_bodyB.c_velocity.v,x=this.m_bodyB.c_velocity.w,A=this.m_invMassA,b=this.m_invMassB,M=this.m_invIA,S=this.m_invIB;if(this.m_frequencyHz>0){var B=x-v,E=-this.m_mass.ez.z*(B+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=E,v-=M*E,x+=S*E;var T=o.zero();T.addCombine(1,g,1,o.cross(x,this.m_rB)),T.subCombine(1,_,1,o.cross(v,this.m_rA));var w=o.neg(u.mulVec2(this.m_mass,T));this.m_impulse.x+=w.x,this.m_impulse.y+=w.y;var C=o.clone(w);_.subMul(A,C),v-=M*o.cross(this.m_rA,C),g.addMul(b,C),x+=S*o.cross(this.m_rB,C)}else{var T=o.zero();T.addCombine(1,g,1,o.cross(x,this.m_rB)),T.subCombine(1,_,1,o.cross(v,this.m_rA));var B=x-v,P=l(T.x,T.y,B),R=l.neg(u.mulVec3(this.m_mass,P));this.m_impulse.add(R);var C=o.neo(R.x,R.y);_.subMul(A,C),v-=M*(o.cross(this.m_rA,C)+R.z),g.addMul(b,C),x+=S*(o.cross(this.m_rB,C)+R.z)}this.m_bodyA.c_velocity.v=_,this.m_bodyA.c_velocity.w=v,this.m_bodyB.c_velocity.v=g,this.m_bodyB.c_velocity.w=x},d.prototype.solvePositionConstraints=function(y){var _=this.m_bodyA.c_position.c,v=this.m_bodyA.c_position.a,g=this.m_bodyB.c_position.c,x=this.m_bodyB.c_position.a,A=m.neo(v),b=m.neo(x),M=this.m_invMassA,S=this.m_invMassB,B=this.m_invIA,E=this.m_invIB,T=m.mulVec2(A,o.sub(this.m_localAnchorA,this.m_localCenterA)),w=m.mulVec2(b,o.sub(this.m_localAnchorB,this.m_localCenterB)),C,P,R=new u;if(R.ex.x=M+S+T.y*T.y*B+w.y*w.y*E,R.ey.x=-T.y*T.x*B-w.y*w.x*E,R.ez.x=-T.y*B-w.y*E,R.ex.y=R.ey.x,R.ey.y=M+S+T.x*T.x*B+w.x*w.x*E,R.ez.y=T.x*B+w.x*E,R.ex.z=R.ez.x,R.ey.z=R.ez.y,R.ez.z=B+E,this.m_frequencyHz>0){var L=o.zero();L.addCombine(1,g,1,w),L.subCombine(1,_,1,T),C=L.length(),P=0;var I=o.neg(R.solve22(L));_.subMul(M,I),v-=B*o.cross(T,I),g.addMul(S,I),x+=E*o.cross(w,I)}else{var L=o.zero();L.addCombine(1,g,1,w),L.subCombine(1,_,1,T);var z=x-v-this.m_referenceAngle;C=L.length(),P=h.abs(z);var F=l(L.x,L.y,z),D=l();if(R.ez.z>0)D=l.neg(R.solve33(F));else{var V=o.neg(R.solve22(L));D.set(V.x,V.y,0)}var I=o.neo(D.x,D.y);_.subMul(M,I),v-=B*(o.cross(T,I)+D.z),g.addMul(S,I),x+=E*(o.cross(w,I)+D.z)}return this.m_bodyA.c_position.c=_,this.m_bodyA.c_position.a=v,this.m_bodyB.c_position.c=g,this.m_bodyB.c_position.a=x,C<=a.linearSlop&&P<=a.angularSlop}},function(e,n,s){e.exports=c;var r=s(6),a=s(4),h=s(1),o=s(0);s(7),s(10),s(14);var l=s(3);s(9),s(5),s(12),s(13);var u=s(11),m=s(8);c.TYPE="wheel-joint",u.TYPES[c.TYPE]=c,c._super=u,c.prototype=Object.create(c._super.prototype);var p={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7};function c(f,d,y,_,v){if(!(this instanceof c))return new c(f,d,y,_,v);f=r(f,p),u.call(this,f,d,y),d=this.m_bodyA,y=this.m_bodyB,this.m_type=c.TYPE,this.m_localAnchorA=o.clone(_?d.getLocalPoint(_):f.localAnchorA||o.zero()),this.m_localAnchorB=o.clone(_?y.getLocalPoint(_):f.localAnchorB||o.zero()),this.m_localXAxisA=o.clone(v?d.getLocalVector(v):f.localAxisA||f.localAxis||o.neo(1,0)),this.m_localYAxisA=o.cross(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=f.maxMotorTorque,this.m_motorSpeed=f.motorSpeed,this.m_enableMotor=f.enableMotor,this.m_frequencyHz=f.frequencyHz,this.m_dampingRatio=f.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_ax=o.zero(),this.m_ay=o.zero(),this.m_sAx,this.m_sBx,this.m_sAy,this.m_sBy}c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},c._deserialize=function(f,d,y){f=Object.assign({},f),f.bodyA=y(m,f.bodyA,d),f.bodyB=y(m,f.bodyB,d);var _=new c(f);return _},c.prototype._setAnchors=function(f){f.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(f.anchorA)):f.localAnchorA&&this.m_localAnchorA.set(f.localAnchorA),f.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(f.anchorB)):f.localAnchorB&&this.m_localAnchorB.set(f.localAnchorB),f.localAxisA&&(this.m_localXAxisA.set(f.localAxisA),this.m_localYAxisA.set(o.cross(1,f.localAxisA)))},c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.getLocalAxisA=function(){return this.m_localXAxisA},c.prototype.getJointTranslation=function(){var f=this.m_bodyA,d=this.m_bodyB,y=f.getWorldPoint(this.m_localAnchorA),_=d.getWorldPoint(this.m_localAnchorB),v=o.sub(_,y),g=f.getWorldVector(this.m_localXAxisA),x=o.dot(v,g);return x},c.prototype.getJointSpeed=function(){var f=this.m_bodyA.m_angularVelocity,d=this.m_bodyB.m_angularVelocity;return d-f},c.prototype.isMotorEnabled=function(){return this.m_enableMotor},c.prototype.enableMotor=function(f){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=f},c.prototype.setMotorSpeed=function(f){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=f},c.prototype.getMotorSpeed=function(){return this.m_motorSpeed},c.prototype.setMaxMotorTorque=function(f){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=f},c.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},c.prototype.getMotorTorque=function(f){return f*this.m_motorImpulse},c.prototype.setSpringFrequencyHz=function(f){this.m_frequencyHz=f},c.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},c.prototype.setSpringDampingRatio=function(f){this.m_dampingRatio=f},c.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(f){return o.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(f)},c.prototype.getReactionTorque=function(f){return f*this.m_motorImpulse},c.prototype.initVelocityConstraints=function(f){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var d=this.m_invMassA,y=this.m_invMassB,_=this.m_invIA,v=this.m_invIB,g=this.m_bodyA.c_position.c,x=this.m_bodyA.c_position.a,A=this.m_bodyA.c_velocity.v,b=this.m_bodyA.c_velocity.w,M=this.m_bodyB.c_position.c,S=this.m_bodyB.c_position.a,B=this.m_bodyB.c_velocity.v,E=this.m_bodyB.c_velocity.w,T=l.neo(x),w=l.neo(S),C=l.mulVec2(T,o.sub(this.m_localAnchorA,this.m_localCenterA)),P=l.mulVec2(w,o.sub(this.m_localAnchorB,this.m_localCenterB)),R=o.zero();if(R.addCombine(1,M,1,P),R.subCombine(1,g,1,C),this.m_ay=l.mulVec2(T,this.m_localYAxisA),this.m_sAy=o.cross(o.add(R,C),this.m_ay),this.m_sBy=o.cross(P,this.m_ay),this.m_mass=d+y+_*this.m_sAy*this.m_sAy+v*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=l.mulVec2(T,this.m_localXAxisA),this.m_sAx=o.cross(o.add(R,C),this.m_ax),this.m_sBx=o.cross(P,this.m_ax);var L=d+y+_*this.m_sAx*this.m_sAx+v*this.m_sBx*this.m_sBx;if(L>0){this.m_springMass=1/L;var I=o.dot(R,this.m_ax),z=2*h.PI*this.m_frequencyHz,R=2*this.m_springMass*this.m_dampingRatio*z,F=this.m_springMass*z*z,D=f.dt;this.m_gamma=D*(R+D*F),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=I*D*F*this.m_gamma,this.m_springMass=L+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=_+v,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),f.warmStarting){this.m_impulse*=f.dtRatio,this.m_springImpulse*=f.dtRatio,this.m_motorImpulse*=f.dtRatio;var V=o.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),G=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,Y=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;A.subMul(this.m_invMassA,V),b-=this.m_invIA*G,B.addMul(this.m_invMassB,V),E+=this.m_invIB*Y}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(A),this.m_bodyA.c_velocity.w=b,this.m_bodyB.c_velocity.v.set(B),this.m_bodyB.c_velocity.w=E},c.prototype.solveVelocityConstraints=function(f){var d=this.m_invMassA,y=this.m_invMassB,_=this.m_invIA,v=this.m_invIB,g=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,A=this.m_bodyB.c_velocity.v,b=this.m_bodyB.c_velocity.w;{var M=o.dot(this.m_ax,A)-o.dot(this.m_ax,g)+this.m_sBx*b-this.m_sAx*x,S=-this.m_springMass*(M+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=S;var B=o.mul(S,this.m_ax),E=S*this.m_sAx,T=S*this.m_sBx;g.subMul(d,B),x-=_*E,A.addMul(y,B),b+=v*T}{var M=b-x-this.m_motorSpeed,S=-this.m_motorMass*M,w=this.m_motorImpulse,C=f.dt*this.m_maxMotorTorque;this.m_motorImpulse=h.clamp(this.m_motorImpulse+S,-C,C),S=this.m_motorImpulse-w,x-=_*S,b+=v*S}{var M=o.dot(this.m_ay,A)-o.dot(this.m_ay,g)+this.m_sBy*b-this.m_sAy*x,S=-this.m_mass*M;this.m_impulse+=S;var B=o.mul(S,this.m_ay),E=S*this.m_sAy,T=S*this.m_sBy;g.subMul(d,B),x-=_*E,A.addMul(y,B),b+=v*T}this.m_bodyA.c_velocity.v.set(g),this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v.set(A),this.m_bodyB.c_velocity.w=b},c.prototype.solvePositionConstraints=function(f){var d=this.m_bodyA.c_position.c,y=this.m_bodyA.c_position.a,_=this.m_bodyB.c_position.c,v=this.m_bodyB.c_position.a,g=l.neo(y),x=l.neo(v),A=l.mulVec2(g,o.sub(this.m_localAnchorA,this.m_localCenterA)),b=l.mulVec2(x,o.sub(this.m_localAnchorB,this.m_localCenterB)),M=o.zero();M.addCombine(1,_,1,b),M.subCombine(1,d,1,A);var S=l.mulVec2(g,this.m_localYAxisA),B=o.cross(o.add(M,A),S),E=o.cross(b,S),T=o.dot(M,S),w=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,C;w!=0?C=-T/w:C=0;var P=o.mul(C,S),R=C*B,L=C*E;return d.subMul(this.m_invMassA,P),y-=this.m_invIA*R,_.addMul(this.m_invMassB,P),v+=this.m_invIB*L,this.m_bodyA.c_position.c.set(d),this.m_bodyA.c_position.a=y,this.m_bodyB.c_position.c.set(_),this.m_bodyB.c_position.a=v,h.abs(T)<=a.linearSlop}},function(e,n,s){var r=s(35),a=s(60);function h(o,l){typeof o=="object"&&this.src(o,l)}h.prototype.pipe=function(){return new h(this)},h.prototype.src=function(o,l,u,m){if(typeof o=="object"){var p=o,c=l||1;this._image=p,this._sx=this._dx=0,this._sy=this._dy=0,this._sw=this._dw=p.width/c,this._sh=this._dh=p.height/c,this.width=p.width/c,this.height=p.height/c,this.ratio=c}else typeof u=="undefined"?(u=o,m=l):(this._sx=o,this._sy=l),this._sw=this._dw=u,this._sh=this._dh=m,this.width=u,this.height=m;return this},h.prototype.dest=function(o,l,u,m){return this._dx=o,this._dy=l,this._dx=o,this._dy=l,typeof u!="undefined"&&(this._dw=u,this._dh=m,this.width=u,this.height=m),this},h.prototype.draw=function(o,l,u,m,p,c,f,d,y){var _=this._image;if(!(_===null||typeof _!="object")){var v=this._sx,g=this._sy,x=this._sw,A=this._sh,b=this._dx,M=this._dy,S=this._dw,B=this._dh;typeof c!="undefined"?(l=a.limit(l,0,this._sw),m=a.limit(m,0,this._sw-l),u=a.limit(u,0,this._sh),p=a.limit(p,0,this._sh-u),v+=l,g+=u,x=m,A=p,b=c,M=f,S=d,B=y):typeof m!="undefined"?(b=l,M=u,S=m,B=p):typeof l!="undefined"&&(S=l,B=u);var E=this.ratio||1;v*=E,g*=E,x*=E,A*=E;try{typeof _.draw=="function"?_.draw(o,v,g,x,A,b,M,S,B):(r.draw++,o.drawImage(_,v,g,x,A,b,M,S,B))}catch(T){_._draw_failed||(console.log("Unable to draw: ",_),console.log(T),_._draw_failed=!0)}}},e.exports=h},function(e,n,s){var r=s(24),a=Math;e.exports=r(Math),e.exports.random=function(h,o){return typeof h=="undefined"?(o=1,h=0):typeof o=="undefined"&&(o=h,h=0),h==o?h:a.random()*(o-h)+h},e.exports.rotate=function(h,o,l){return typeof o=="undefined"?(l=1,o=0):typeof l=="undefined"&&(l=o,o=0),l>o?(h=(h-o)%(l-o),h+(h<0?l:o)):(h=(h-l)%(o-l),h+(h<=0?o:l))},e.exports.limit=function(h,o,l){return h<o?o:h>l?l:h},e.exports.length=function(h,o){return a.sqrt(h*h+o*o)}},function(e,n){function s(r,a,h,o,l,u){this.reset(r,a,h,o,l,u)}s.prototype.toString=function(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.e+", "+this.f+"]"},s.prototype.clone=function(){return new s(this.a,this.b,this.c,this.d,this.e,this.f)},s.prototype.reset=function(r,a,h,o,l,u){return this._dirty=!0,typeof r=="object"?(this.a=r.a,this.d=r.d,this.b=r.b,this.c=r.c,this.e=r.e,this.f=r.f):(this.a=r||1,this.d=o||1,this.b=a||0,this.c=h||0,this.e=l||0,this.f=u||0),this},s.prototype.identity=function(){return this._dirty=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},s.prototype.rotate=function(r){if(!r)return this;this._dirty=!0;var a=r?Math.cos(r):1,h=r?Math.sin(r):0,o=a*this.a-h*this.b,l=a*this.b+h*this.a,u=a*this.c-h*this.d,m=a*this.d+h*this.c,p=a*this.e-h*this.f,c=a*this.f+h*this.e;return this.a=o,this.b=l,this.c=u,this.d=m,this.e=p,this.f=c,this},s.prototype.translate=function(r,a){return!r&&!a?this:(this._dirty=!0,this.e+=r,this.f+=a,this)},s.prototype.scale=function(r,a){return!(r-1)&&!(a-1)?this:(this._dirty=!0,this.a*=r,this.b*=a,this.c*=r,this.d*=a,this.e*=r,this.f*=a,this)},s.prototype.skew=function(r,a){if(!r&&!a)return this;this._dirty=!0;var h=this.a+this.b*r,o=this.b+this.a*a,l=this.c+this.d*r,u=this.d+this.c*a,m=this.e+this.f*r,p=this.f+this.e*a;return this.a=h,this.b=o,this.c=l,this.d=u,this.e=m,this.f=p,this},s.prototype.concat=function(r){this._dirty=!0;var a=this,h=a.a*r.a+a.b*r.c,o=a.b*r.d+a.a*r.b,l=a.c*r.a+a.d*r.c,u=a.d*r.d+a.c*r.b,m=a.e*r.a+r.e+a.f*r.c,p=a.f*r.d+r.f+a.e*r.b;return this.a=h,this.b=o,this.c=l,this.d=u,this.e=m,this.f=p,this},s.prototype.inverse=s.prototype.reverse=function(){if(this._dirty){this._dirty=!1,this.inversed=this.inversed||new s;var r=this.a*this.d-this.b*this.c;this.inversed.a=this.d/r,this.inversed.b=-this.b/r,this.inversed.c=-this.c/r,this.inversed.d=this.a/r,this.inversed.e=(this.c*this.f-this.e*this.d)/r,this.inversed.f=(this.e*this.b-this.a*this.f)/r}return this.inversed},s.prototype.map=function(r,a){return a=a||{},a.x=this.a*r.x+this.c*r.y+this.e,a.y=this.b*r.x+this.d*r.y+this.f,a},s.prototype.mapX=function(r,a){return typeof r=="object"&&(a=r.y,r=r.x),this.a*r+this.c*a+this.e},s.prototype.mapY=function(r,a){return typeof r=="object"&&(a=r.y,r=r.x),this.b*r+this.d*a+this.f},e.exports=s},function(e,n,s){var r=s(38),a=s(63);e.exports=r,r.testbed=function(o,l){typeof o=="function"&&(l=o,o=null),a(function(u,m){u.on(a.Mouse.START,function(){window.focus(),document.activeElement&&document.activeElement.blur(),m.focus()}),u.MAX_ELAPSE=1e3/30;var p=r.Vec2,c={};c.canvas=m;var f=!1;u.on("resume",function(){f=!1,c._resume&&c._resume()}),u.on("pause",function(){f=!0,c._pause&&c._pause()}),c.isPaused=function(){return f},c.togglePause=function(){f?c.resume():c.pause()},c.pause=function(){u.pause()},c.resume=function(){u.resume(),c.focus()},c.focus=function(){document.activeElement&&document.activeElement.blur(),m.focus()},c.debug=!1,c.width=80,c.height=60,c.x=0,c.y=-10,c.scaleY=-1,c.ratio=16,c.hz=60,c.speed=1,c.activeKeys={},c.background="#222222",c.findOne=function(){return null},c.findAll=function(){return[]};var d="",y={};function _(I,z){typeof z!="function"&&typeof z!="object"&&(y[I]=z)}function v(I){for(var z in I)_(z,I[z])}c.status=function(I,z){typeof z!="undefined"?_(I,z):I&&typeof I=="object"?v(I):typeof I=="string"&&(d=I),c._status&&c._status(d,y)},c.info=function(I){c._info&&c._info(I)};var g="",x="";(function(){var I=new a.Texture;u.append(a.image(I));var z=[];u.tick(function(){z.length=0},!0),I.draw=function(F){F.save(),F.transform(1,0,0,c.scaleY,-c.x,-c.y),F.lineWidth=2/c.ratio,F.lineCap="round";for(var D=z.shift();D;D=z.shift())D(F,c.ratio);F.restore()},c.drawPoint=function(F,D,V){z.push(function(G,Y){G.beginPath(),G.arc(F.x,F.y,5/Y,0,2*Math.PI),G.strokeStyle=V,G.stroke()}),x+="point"+F.x+","+F.y+","+D+","+V},c.drawCircle=function(F,D,V){z.push(function(G){G.beginPath(),G.arc(F.x,F.y,D,0,2*Math.PI),G.strokeStyle=V,G.stroke()}),x+="circle"+F.x+","+F.y+","+D+","+V},c.drawSegment=function(F,D,V){z.push(function(G){G.beginPath(),G.moveTo(F.x,F.y),G.lineTo(D.x,D.y),G.strokeStyle=V,G.stroke()}),x+="segment"+F.x+","+F.y+","+D.x+","+D.y+","+V},c.drawPolygon=function(F,D){if(!(!F||!F.length)){z.push(function(G){G.beginPath(),G.moveTo(F[0].x,F[0].y);for(var Y=1;Y<F.length;Y++)G.lineTo(F[Y].x,F[Y].y);G.strokeStyle=D,G.closePath(),G.stroke()}),x+="segment";for(var V=1;V<F.length;V++)x+=F[V].x+","+F[V].y+",";x+=D}},c.drawAABB=function(F,D){z.push(function(V){V.beginPath(),V.moveTo(F.lowerBound.x,F.lowerBound.y),V.lineTo(F.upperBound.x,F.lowerBound.y),V.lineTo(F.upperBound.x,F.upperBound.y),V.lineTo(F.lowerBound.x,F.upperBound.y),V.strokeStyle=D,V.closePath(),V.stroke()}),x+="aabb",x+=F.lowerBound.x+","+F.lowerBound.y+",",x+=F.upperBound.x+","+F.upperBound.y+",",x+=D},c.color=function(F,D,V){return F=F*256|0,D=D*256|0,V=V*256|0,"rgb("+F+", "+D+", "+V+")"}})();var A=l(c),b=new h(A,c),M=0,S=0;u.tick(function(I,z){(M!==c.x||S!==c.y)&&(b.offset(-c.x,-c.y),M=c.x,S=c.y)}),b.tick(function(I,z){return typeof c.step=="function"&&c.step(I,z),w&&c.drawSegment(w.getPosition(),C,"rgba(255,255,255,0.2)"),g!==x&&(g=x,u.touch()),x="",!0}),u.background(c.background),u.viewbox(c.width,c.height),u.pin("alignX",-.5),u.pin("alignY",-.5),u.prepend(b);function B(I){var z,F=r.AABB(I,I);return A.queryAABB(F,function(D){if(!z&&!(!D.getBody().isDynamic()||!D.testPoint(I)))return z=D.getBody(),!0}),z}var E=A.createBody(),T,w,C={x:0,y:0};b.attr("spy",!0).on(a.Mouse.START,function(I){if(I={x:I.x,y:c.scaleY*I.y},!w){var z=B(I);!z||(c.mouseForce?w=z:(T=r.MouseJoint({maxForce:1e3},E,z,p(I)),A.createJoint(T)))}}).on(a.Mouse.MOVE,function(I){I={x:I.x,y:c.scaleY*I.y},T&&T.setTarget(I),C.x=I.x,C.y=I.y}).on(a.Mouse.END,function(I){if(I={x:I.x,y:c.scaleY*I.y},T&&(A.destroyJoint(T),T=null),w){var z=p.sub(I,w.getPosition());w.applyForceToCenter(z.mul(c.mouseForce),!0),w=null}}).on(a.Mouse.CANCEL,function(I){I={x:I.x,y:c.scaleY*I.y},T&&(A.destroyJoint(T),T=null),w&&(w=null)}),window.addEventListener("keydown",function(I){switch(I.keyCode){case"P".charCodeAt(0):c.togglePause();break}},!1);var P={};window.addEventListener("keydown",function(I){var z=I.keyCode;P[z]=!0,L(z,!0),c.keydown&&c.keydown(z,String.fromCharCode(z))}),window.addEventListener("keyup",function(I){var z=I.keyCode;P[z]=!1,L(z,!1),c.keyup&&c.keyup(z,String.fromCharCode(z))});var R=c.activeKeys;function L(I,z){var F=String.fromCharCode(I);/\w/.test(F)&&(R[F]=z),R.right=P[39]||R.D,R.left=P[37]||R.A,R.up=P[38]||R.W,R.down=P[40]||R.S,R.fire=P[32]||P[13]}})},h._super=a,h.prototype=a._create(h._super.prototype);function h(o,l){h._super.call(this),this.label("Planck"),l=l||{};var u=this._options={};this._options.speed=l.speed||1,this._options.hz=l.hz||60,Math.abs(this._options.hz)<1&&(this._options.hz=1/this._options.hz),this._options.scaleY=l.scaleY||-1,this._options.ratio=l.ratio||16,this._options.lineWidth=2/this._options.ratio,this._world=o;var m=1/this._options.hz,p=0;this.tick(function(c){for(c=c*.001*u.speed,p+=c;p>m;)o.step(m),p-=m;return this.renderWorld(),!0},!0),o.on("remove-fixture",function(c){c.ui&&c.ui.remove()}),o.on("remove-joint",function(c){c.ui&&c.ui.remove()})}h.prototype.renderWorld=function(o){for(var o=this._world,l=this._options,u=this,m=o.getBodyList();m;m=m.getNext())for(var p=m.getFixtureList();p;p=p.getNext()){if(!p.ui){p.render&&p.render.stroke?l.strokeStyle=p.render.stroke:m.render&&m.render.stroke?l.strokeStyle=m.render.stroke:m.isDynamic()?l.strokeStyle="rgba(255,255,255,0.9)":m.isKinematic()?l.strokeStyle="rgba(255,255,255,0.7)":m.isStatic()&&(l.strokeStyle="rgba(255,255,255,0.5)"),p.render&&p.render.fill?l.fillStyle=p.render.fill:m.render&&m.render.fill?l.fillStyle=m.render.fill:l.fillStyle="";var c=p.getType(),f=p.getShape();c=="circle"&&(p.ui=u.drawCircle(f,l)),c=="edge"&&(p.ui=u.drawEdge(f,l)),c=="polygon"&&(p.ui=u.drawPolygon(f,l)),c=="chain"&&(p.ui=u.drawChain(f,l)),p.ui&&p.ui.appendTo(u)}if(p.ui){var d=m.getPosition(),y=m.getAngle();(p.ui.__lastX!==d.x||p.ui.__lastY!==d.y||p.ui.__lastR!==y)&&(p.ui.__lastX=d.x,p.ui.__lastY=d.y,p.ui.__lastR=y,p.ui.offset(d.x,l.scaleY*d.y),p.ui.rotate(l.scaleY*y))}}for(var _=o.getJointList();_;_=_.getNext()){var c=_.getType(),v=_.getAnchorA(),m=_.getAnchorB();if(_.ui||(l.strokeStyle="rgba(255,255,255,0.2)",_.ui=u.drawJoint(_,l),_.ui.pin("handle",.5),_.ui&&_.ui.appendTo(u)),_.ui){var g=(v.x+m.x)*.5,x=l.scaleY*(v.y+m.y)*.5,A=v.x-m.x,b=l.scaleY*(v.y-m.y),M=Math.sqrt(A*A+b*b);_.ui.width(M),_.ui.rotate(Math.atan2(b,A)),_.ui.offset(g,x)}}},h.prototype.drawJoint=function(o,l){var u=l.lineWidth,m=l.ratio,p=10,c=a.canvas(function(d){this.size(p+2*u,2*u,m),d.scale(m,m),d.beginPath(),d.moveTo(u,u),d.lineTo(u+p,u),d.lineCap="round",d.lineWidth=l.lineWidth,d.strokeStyle=l.strokeStyle,d.stroke()}),f=a.image(c).stretch();return f},h.prototype.drawCircle=function(o,l){var u=l.lineWidth,m=l.ratio,p=o.m_radius,c=p+u,f=p+u,d=p*2+u*2,y=p*2+u*2,_=a.canvas(function(x){this.size(d,y,m),x.scale(m,m),x.arc(c,f,p,0,2*Math.PI),l.fillStyle&&(x.fillStyle=l.fillStyle,x.fill()),x.lineTo(c,f),x.lineWidth=l.lineWidth,x.strokeStyle=l.strokeStyle,x.stroke()}),v=a.image(_).offset(o.m_p.x-c,l.scaleY*o.m_p.y-f),g=a.create().append(v);return g},h.prototype.drawEdge=function(o,l){var u=l.lineWidth,m=l.ratio,p=o.m_vertex1,c=o.m_vertex2,f=c.x-p.x,d=c.y-p.y,y=Math.sqrt(f*f+d*d),_=a.canvas(function(b){this.size(y+2*u,2*u,m),b.scale(m,m),b.beginPath(),b.moveTo(u,u),b.lineTo(u+y,u),b.lineCap="round",b.lineWidth=l.lineWidth,b.strokeStyle=l.strokeStyle,b.stroke()}),v=Math.min(p.x,c.x),g=Math.min(l.scaleY*p.y,l.scaleY*c.y),x=a.image(_);x.rotate(l.scaleY*Math.atan2(d,f)),x.offset(v-u,g-u);var A=a.create().append(x);return A},h.prototype.drawPolygon=function(o,l){var u=l.lineWidth,m=l.ratio,p=o.m_vertices;if(!!p.length){for(var c=1/0,f=1/0,d=-1/0,y=-1/0,_=0;_<p.length;++_){var v=p[_];c=Math.min(c,v.x),d=Math.max(d,v.x),f=Math.min(f,l.scaleY*v.y),y=Math.max(y,l.scaleY*v.y)}var g=d-c,x=y-f,A=a.canvas(function(S){this.size(g+2*u,x+2*u,m),S.scale(m,m),S.beginPath();for(var B=0;B<p.length;++B){var E=p[B],T=E.x-c+u,w=l.scaleY*E.y-f+u;B==0?S.moveTo(T,w):S.lineTo(T,w)}p.length>2&&S.closePath(),l.fillStyle&&(S.fillStyle=l.fillStyle,S.fill(),S.closePath()),S.lineCap="round",S.lineWidth=l.lineWidth,S.strokeStyle=l.strokeStyle,S.stroke()}),b=a.image(A);b.offset(c-u,f-u);var M=a.create().append(b);return M}},h.prototype.drawChain=function(o,l){var u=l.lineWidth,m=l.ratio,p=o.m_vertices;if(!!p.length){for(var c=1/0,f=1/0,d=-1/0,y=-1/0,_=0;_<p.length;++_){var v=p[_];c=Math.min(c,v.x),d=Math.max(d,v.x),f=Math.min(f,l.scaleY*v.y),y=Math.max(y,l.scaleY*v.y)}var g=d-c,x=y-f,A=a.canvas(function(S){this.size(g+2*u,x+2*u,m),S.scale(m,m),S.beginPath();for(var B=0;B<p.length;++B){var E=p[B],T=E.x-c+u,w=l.scaleY*E.y-f+u;B==0?S.moveTo(T,w):S.lineTo(T,w)}p.length>2,l.fillStyle&&(S.fillStyle=l.fillStyle,S.fill(),S.closePath()),S.lineCap="round",S.lineWidth=l.lineWidth,S.strokeStyle=l.strokeStyle,S.stroke()}),b=a.image(A);b.offset(c-u,f-u);var M=a.create().append(b);return M}}},function(e,n,s){e.exports=s(64),e.exports.internal={},s(72),e.exports.internal.Image=s(73),s(75),s(76),s(77),s(78),e.exports.Mouse=s(80),e.exports.Math=s(60),e.exports._extend=s(36),e.exports._create=s(24),s(81)},function(e,n,s){e.exports=s(19),e.exports.Matrix=s(61),e.exports.Texture=s(59),s(66),s(68),s(69),s(25),s(29),s(71)},function(e,n){e.exports=function(){var s=0;function r(o,l){return s+=l=typeof l=="number"&&l>=1?l:1,function(){o&&o.apply(this,arguments),l>0&&(l--,s--,h())}}var a=[];function h(){if(s===0)for(;a.length;)setTimeout(a.shift(),0)}return r.then=function(o){s===0?setTimeout(o,0):a.push(o)},r}},function(e,n,s){var r=s(19),a=s(59),h=s(36),o=s(24),l=s(37),u=s(67),m={},p=[];r.atlas=function(v){var g=l.fn(v.draw)?v:new c(v);v.name&&(m[v.name]=g),p.push(g),_(v,"imagePath"),_(v,"imageRatio");var x=v.imagePath,A=v.imageRatio||1;return l.string(v.image)?x=v.image:l.hash(v.image)&&(x=v.image.src||v.image.url,A=v.image.ratio||A),x&&r.preload(function(b){x=r.resolve(x);var M=r.config("image-loader");M(x,function(S){g.src(S,A),b()},function(S){b()})}),g},c._super=a,c.prototype=o(c._super.prototype);function c(v){c._super.call(this);var g=this;_(v,"filter"),_(v,"cutouts"),_(v,"sprites"),_(v,"factory");var x=v.map||v.filter,A=v.ppu||v.ratio||1,b=v.trim||0,M=v.textures,S=v.factory,B=v.cutouts||v.sprites;function E(w){if(!w||l.fn(w.draw))return w;w=h({},w),l.fn(x)&&(w=x(w)),A!=1&&(w.x*=A,w.y*=A,w.width*=A,w.height*=A,w.top*=A,w.bottom*=A,w.left*=A,w.right*=A),b!=0&&(w.x+=b,w.y+=b,w.width-=2*b,w.height-=2*b,w.top-=b,w.bottom-=b,w.left-=b,w.right-=b);var C=g.pipe();return C.top=w.top,C.bottom=w.bottom,C.left=w.left,C.right=w.right,C.src(w.x,w.y,w.width,w.height),C}function T(w){if(M){if(l.fn(M))return M(w);if(l.hash(M))return M[w]}if(B){for(var C=null,P=0,R=0;R<B.length;R++)u.startsWith(B[R].name,w)&&(P===0?C=B[R]:P===1?C=[C,B[R]]:C.push(B[R]),P++);return P===0&&l.fn(S)&&(C=function(L){return S(w+(L||""))}),C}}this.select=function(w){if(!w)return new y(this.pipe());var C=T(w);if(C)return new y(C,T,E)}}var f=new a;f.x=f.y=f.width=f.height=0,f.pipe=f.src=f.dest=function(){return this},f.draw=function(){};var d=new y(f);function y(v,g,x){function A(b,M){if(b){if(l.fn(b.draw))return b;if(l.hash(b)&&l.number(b.width)&&l.number(b.height)&&l.fn(x))return x(b);if(l.hash(b)&&l.defined(M))return A(b[M]);if(l.fn(b))return A(b(M));if(l.array(b))return A(b[0]);if(l.string(b)&&l.fn(g))return A(g(b))}else return f}this.one=function(b){return A(v,b)},this.array=function(b){var M=l.array(b)?b:[];if(l.array(v))for(var S=0;S<v.length;S++)M[S]=A(v[S]);else M[0]=A(v);return M}}r.texture=function(v){if(!l.string(v))return new y(v);var g=null,x,A;for((A=v.indexOf(":"))>0&&v.length>A+1&&(x=m[v.slice(0,A)],g=x&&x.select(v.slice(A+1))),!g&&(x=m[v])&&(g=x.select()),A=0;!g&&A<p.length;A++)g=p[A].select(v);return g||(console.error("Texture not found: "+v),g=d),g};function _(v,g,x){g in v&&console.log(x?x.replace("%name",g):"'"+g+"' field of texture atlas is deprecated.")}e.exports=c},function(e,n){e.exports.startsWith=function(s,r){return typeof s=="string"&&typeof r=="string"&&s.substring(0,r.length)==r}},function(e,n,s){var r=s(19),a=s(37),h=0;r.prototype._label="",r.prototype._visible=!0,r.prototype._parent=null,r.prototype._next=null,r.prototype._prev=null,r.prototype._first=null,r.prototype._last=null,r.prototype._attrs=null,r.prototype._flags=null,r.prototype.toString=function(){return"["+this._label+"]"},r.prototype.id=function(c){return this.label(c)},r.prototype.label=function(c){return typeof c=="undefined"?this._label:(this._label=c,this)},r.prototype.attr=function(c,f){return typeof f=="undefined"?this._attrs!==null?this._attrs[c]:void 0:((this._attrs!==null?this._attrs:this._attrs={})[c]=f,this)},r.prototype.visible=function(c){return typeof c=="undefined"?this._visible:(this._visible=c,this._parent&&(this._parent._ts_children=++h),this._ts_pin=++h,this.touch(),this)},r.prototype.hide=function(){return this.visible(!1)},r.prototype.show=function(){return this.visible(!0)},r.prototype.parent=function(){return this._parent},r.prototype.next=function(c){for(var f=this._next;f&&c&&!f._visible;)f=f._next;return f},r.prototype.prev=function(c){for(var f=this._prev;f&&c&&!f._visible;)f=f._prev;return f},r.prototype.first=function(c){for(var f=this._first;f&&c&&!f._visible;)f=f._next;return f},r.prototype.last=function(c){for(var f=this._last;f&&c&&!f._visible;)f=f._prev;return f},r.prototype.visit=function(c,f){var d=c.reverse,y=c.visible;if(!(c.start&&c.start(this,f))){for(var _,v=d?this.last(y):this.first(y);_=v;)if(v=d?_.prev(y):_.next(y),_.visit(c,f))return!0;return c.end&&c.end(this,f)}},r.prototype.append=function(c,f){if(a.array(c))for(var d=0;d<c.length;d++)o(this,c[d]);else if(typeof f!="undefined")for(var d=0;d<arguments.length;d++)o(this,arguments[d]);else typeof c!="undefined"&&o(this,c);return this},r.prototype.prepend=function(c,f){if(a.array(c))for(var d=c.length-1;d>=0;d--)l(this,c[d]);else if(typeof f!="undefined")for(var d=arguments.length-1;d>=0;d--)l(this,arguments[d]);else typeof c!="undefined"&&l(this,c);return this},r.prototype.appendTo=function(c){return o(c,this),this},r.prototype.prependTo=function(c){return l(c,this),this},r.prototype.insertNext=function(c,f){if(a.array(c))for(var d=0;d<c.length;d++)m(c[d],this);else if(typeof f!="undefined")for(var d=0;d<arguments.length;d++)m(arguments[d],this);else typeof c!="undefined"&&m(c,this);return this},r.prototype.insertPrev=function(c,f){if(a.array(c))for(var d=c.length-1;d>=0;d--)u(c[d],this);else if(typeof f!="undefined")for(var d=arguments.length-1;d>=0;d--)u(arguments[d],this);else typeof c!="undefined"&&u(c,this);return this},r.prototype.insertAfter=function(c){return m(this,c),this},r.prototype.insertBefore=function(c){return u(this,c),this};function o(c,f){p(f),p(c),f.remove(),c._last&&(c._last._next=f,f._prev=c._last),f._parent=c,c._last=f,c._first||(c._first=f),f._parent._flag(f,!0),f._ts_parent=++h,c._ts_children=++h,c.touch()}function l(c,f){p(f),p(c),f.remove(),c._first&&(c._first._prev=f,f._next=c._first),f._parent=c,c._first=f,c._last||(c._last=f),f._parent._flag(f,!0),f._ts_parent=++h,c._ts_children=++h,c.touch()}function u(c,f){p(c),p(f),c.remove();var d=f._parent,y=f._prev;f._prev=c,y&&(y._next=c)||d&&(d._first=c),c._parent=d,c._prev=y,c._next=f,c._parent._flag(c,!0),c._ts_parent=++h,c.touch()}function m(c,f){p(c),p(f),c.remove();var d=f._parent,y=f._next;f._next=c,y&&(y._prev=c)||d&&(d._last=c),c._parent=d,c._prev=f,c._next=y,c._parent._flag(c,!0),c._ts_parent=++h,c.touch()}r.prototype.remove=function(c,f){if(typeof c!="undefined"){if(a.array(c))for(var d=0;d<c.length;d++)p(c[d]).remove();else if(typeof f!="undefined")for(var d=0;d<arguments.length;d++)p(arguments[d]).remove();else p(c).remove();return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev),this._parent._flag(this,!1),this._parent._ts_children=++h,this._parent.touch()),this._prev=this._next=this._parent=null,this._ts_parent=++h,this},r.prototype.empty=function(){for(var c,f=this._first;c=f;)f=c._next,c._prev=c._next=c._parent=null,this._flag(c,!1);return this._first=this._last=null,this._ts_children=++h,this.touch(),this},r.prototype.touch=function(){return this._ts_touch=++h,this._parent&&this._parent.touch(),this},r.prototype._flag=function(c,f){if(typeof f=="undefined")return this._flags!==null&&this._flags[c]||0;if(typeof c=="string"&&(f?(this._flags=this._flags||{},!this._flags[c]&&this._parent&&this._parent._flag(c,!0),this._flags[c]=(this._flags[c]||0)+1):this._flags&&this._flags[c]>0&&(this._flags[c]==1&&this._parent&&this._parent._flag(c,!1),this._flags[c]=this._flags[c]-1)),typeof c=="object"&&c._flags)for(var d in c._flags)c._flags[d]>0&&this._flag(d,f);return this},r.prototype.hitTest=function(c){return this.attr("spy")?!0:c.x>=0&&c.x<=this._pin._width&&c.y>=0&&c.y<=this._pin._height};function p(c){if(c&&c instanceof r)return c;throw"Invalid node: "+c}e.exports=r},function(e,n,s){s(70)(s(19).prototype,function(r,a,h){r._flag(a,h)})},function(e,n){e.exports=function(s,r){s._listeners=null,s.on=s.listen=function(a,h){if(!a||!a.length||typeof h!="function")return this;this._listeners===null&&(this._listeners={});var o=typeof a!="string"&&typeof a.join=="function";if(a=(o?a.join(" "):a).match(/\S+/g))for(var l=0;l<a.length;l++){var u=a[l];this._listeners[u]=this._listeners[u]||[],this._listeners[u].push(h),typeof r=="function"&&r(this,u,!0)}return this},s.off=function(a,h){if(!a||!a.length||typeof h!="function")return this;if(this._listeners===null)return this;var o=typeof a!="string"&&typeof a.join=="function";if(a=(o?a.join(" "):a).match(/\S+/g))for(var l=0;l<a.length;l++){var u=a[l],m=this._listeners[u],p;m&&(p=m.indexOf(h))>=0&&(m.splice(p,1),m.length||delete this._listeners[u],typeof r=="function"&&r(this,u,!1))}return this},s.listeners=function(a){return this._listeners&&this._listeners[a]},s.publish=function(a,h){var o=this.listeners(a);if(!o||!o.length)return 0;for(var l=0;l<o.length;l++)o[l].apply(this,h);return o.length},s.trigger=function(a,h){return this.publish(a,h),this}}},function(e,n,s){var r=s(19);s(25),s(29);var a=s(35),h=s(24),o=s(36);l._super=r,l.prototype=h(l._super.prototype),r.root=function(u,m){return new l(u,m)};function l(u,m){l._super.call(this),this.label("Root");var p=!0,c=this,f=0,d=function(y){if(p!==!0){a.tick=a.node=a.draw=0;var _=f||y,v=y-_;f=y;var g=c._tick(v,y,_);c._mo_touch!=c._ts_touch?(c._mo_touch=c._ts_touch,m(c),u(d)):g?u(d):p=!0,a.fps=v?1e3/v:0}};this.start=function(){return this.resume()},this.resume=function(){return p&&(this.publish("resume"),p=!1,u(d)),this},this.pause=function(){return p||this.publish("pause"),p=!0,this},this.touch_root=this.touch,this.touch=function(){return this.resume(),this.touch_root()}}l.prototype.background=function(u){return this},l.prototype.viewport=function(u,m,p){if(typeof u=="undefined")return o({},this._viewport);this._viewport={width:u,height:m,ratio:p||1},this.viewbox();var c=o({},this._viewport);return this.visit({start:function(f){if(!f._flag("viewport"))return!0;f.publish("viewport",[c])}}),this},l.prototype.viewbox=function(u,m,p){typeof u=="number"&&typeof m=="number"&&(this._viewbox={width:u,height:m,mode:/^(in|out|in-pad|out-crop)$/.test(p)?p:"in-pad"});var c=this._viewbox,f=this._viewport;return f&&c?(this.pin({width:c.width,height:c.height}),this.scaleTo(f.width,f.height,c.mode)):f&&this.pin({width:f.width,height:f.height}),this}},function(e,n,s){var r=s(19),a=s(59);r.canvas=function(h,o,l){typeof h=="string"?typeof o=="object"||(typeof o=="function"&&(l=o),o={}):(typeof h=="function"&&(l=h),o={},h="2d");var u=document.createElement("canvas"),m=u.getContext(h,o),p=new a(u);return p.context=function(){return m},p.size=function(c,f,d){return d=d||1,u.width=c*d,u.height=f*d,this.src(u,d),this},p.canvas=function(c){return typeof c=="function"?c.call(this,m):typeof c=="undefined"&&typeof l=="function"&&l.call(this,m),this},typeof l=="function"&&l.call(p,m),p}},function(e,n,s){var r=s(19);s(25),s(29);var a=s(74),h=s(24);e.exports=o,r.image=function(l){var u=new o;return l&&u.image(l),u},o._super=r,o.prototype=h(o._super.prototype);function o(){o._super.call(this),this.label("Image"),this._textures=[],this._image=null}o.prototype.setImage=function(l,u,m){return this.image(l,u,m)},o.prototype.image=function(l){return this._image=r.texture(l).one(),this.pin("width",this._image?this._image.width:0),this.pin("height",this._image?this._image.height:0),this._textures[0]=this._image.pipe(),this._textures.length=1,this},o.prototype.tile=function(l){return this._repeat(!1,l),this},o.prototype.stretch=function(l){return this._repeat(!0,l),this},o.prototype._repeat=function(l,u){var m=this;this.untick(this._repeatTicker),this.tick(this._repeatTicker=function(){if(this._mo_stretch!=this._pin._ts_transform){this._mo_stretch=this._pin._ts_transform;var c=this.pin("width"),f=this.pin("height");this._textures.length=a(this._image,c,f,l,u,p)}});function p(c,f,d,y,_,v,g,x,A){var b=m._textures.length>c?m._textures[c]:m._textures[c]=m._image.pipe();b.src(f,d,y,_),b.dest(v,g,x,A)}}},function(e,n){e.exports=function(s,r,a,h,o,l){var u=s.width,m=s.height,p=s.left,c=s.right,f=s.top,d=s.bottom;p=typeof p=="number"&&p===p?p:0,c=typeof c=="number"&&c===c?c:0,f=typeof f=="number"&&f===f?f:0,d=typeof d=="number"&&d===d?d:0,u=u-p-c,m=m-f-d,o||(r=Math.max(r-p-c,0),a=Math.max(a-f-d,0));var y=0;if(f>0&&p>0&&l(y++,0,0,p,f,0,0,p,f),d>0&&p>0&&l(y++,0,m+f,p,d,0,a+f,p,d),f>0&&c>0&&l(y++,u+p,0,c,f,r+p,0,c,f),d>0&&c>0&&l(y++,u+p,m+f,c,d,r+p,a+f,c,d),h)f>0&&l(y++,p,0,u,f,p,0,r,f),d>0&&l(y++,p,m+f,u,d,p,a+f,r,d),p>0&&l(y++,0,f,p,m,0,f,p,a),c>0&&l(y++,u+p,f,c,m,r+p,f,c,a),l(y++,p,f,u,m,p,f,r,a);else for(var _=p,v=r,g;v>0;){g=Math.min(u,v),v-=u;for(var x=f,A=a,b;A>0;)b=Math.min(m,A),A-=m,l(y++,p,f,g,b,_,x,g,b),v<=0&&(p&&l(y++,0,f,p,b,0,x,p,b),c&&l(y++,u+p,f,c,b,_+g,x,c,b)),x+=b;f&&l(y++,p,0,g,f,_,0,g,f),d&&l(y++,p,m+f,g,d,_,x,g,d),_+=g}return y}},function(e,n,s){var r=s(19);s(25),s(29);var a=s(24),h=s(60);r.anim=function(l,u){var m=new o;return m.frames(l).gotoFrame(0),u&&m.fps(u),m},o._super=r,o.prototype=a(o._super.prototype),r.Anim={FPS:15};function o(){o._super.call(this),this.label("Anim"),this._textures=[],this._fps=r.Anim.FPS,this._ft=1e3/this._fps,this._time=-1,this._repeat=0,this._index=0,this._frames=[];var l=0;this.tick(function(u,m,p){if(!(this._time<0||this._frames.length<=1)){var c=l!=p;if(l=m,c||(this._time+=u,this._time<this._ft))return!0;var f=this._time/this._ft|0;return this._time-=f*this._ft,this.moveFrame(f),this._repeat>0&&(this._repeat-=f)<=0?(this.stop(),this._callback&&this._callback(),!1):!0}},!1)}o.prototype.fps=function(l){return typeof l=="undefined"?this._fps:(this._fps=l>0?l:r.Anim.FPS,this._ft=1e3/this._fps,this)},o.prototype.setFrames=function(l,u,m){return this.frames(l,u,m)},o.prototype.frames=function(l){return this._index=0,this._frames=r.texture(l).array(),this.touch(),this},o.prototype.length=function(){return this._frames?this._frames.length:0},o.prototype.gotoFrame=function(l,u){return this._index=h.rotate(l,this._frames.length)|0,u=u||!this._textures[0],this._textures[0]=this._frames[this._index],u&&(this.pin("width",this._textures[0].width),this.pin("height",this._textures[0].height)),this.touch(),this},o.prototype.moveFrame=function(l){return this.gotoFrame(this._index+l)},o.prototype.repeat=function(l,u){return this._repeat=l*this._frames.length-1,this._callback=u,this.play(),this},o.prototype.play=function(l){return typeof l!="undefined"?(this.gotoFrame(l),this._time=0):this._time<0&&(this._time=0),this.touch(),this},o.prototype.stop=function(l){return this._time=-1,typeof l!="undefined"&&this.gotoFrame(l),this}},function(e,n,s){var r=s(19);s(25),s(29);var a=s(24),h=s(37);r.string=function(l){return new o().frames(l)},o._super=r,o.prototype=a(o._super.prototype);function o(){o._super.call(this),this.label("String"),this._textures=[]}o.prototype.setFont=function(l,u,m){return this.frames(l,u,m)},o.prototype.frames=function(l){return this._textures=[],typeof l=="string"?(l=r.texture(l),this._item=function(u){return l.one(u)}):typeof l=="object"?this._item=function(u){return l[u]}:typeof l=="function"&&(this._item=l),this},o.prototype.setValue=function(l,u,m){return this.value(l,u,m)},o.prototype.value=function(l){if(typeof l=="undefined")return this._value;if(this._value===l)return this;this._value=l,l===null?l="":typeof l!="string"&&!h.array(l)&&(l=l.toString()),this._spacing=this._spacing||0;for(var u=0,m=0,p=0;p<l.length;p++){var c=this._textures[p]=this._item(l[p]);u+=p>0?this._spacing:0,c.dest(u,0),u=u+c.width,m=Math.max(m,c.height)}return this.pin("width",u),this.pin("height",m),this._textures.length=l.length,this}},function(e,n,s){var r=s(19);s(25),s(29),s(24),r.row=function(a){return r.create().row(a).label("Row")},r.prototype.row=function(a){return this.sequence("row",a),this},r.column=function(a){return r.create().column(a).label("Row")},r.prototype.column=function(a){return this.sequence("column",a),this},r.sequence=function(a,h){return r.create().sequence(a,h).label("Sequence")},r.prototype.sequence=function(a,h){return this._padding=this._padding||0,this._spacing=this._spacing||0,this.untick(this._layoutTiker),this.tick(this._layoutTiker=function(){if(this._mo_seq!=this._ts_touch){this._mo_seq=this._ts_touch;var o=this._mo_seqAlign!=this._ts_children;this._mo_seqAlign=this._ts_children;for(var l=0,u=0,m,p=this.first(!0),c=!0;m=p;){p=m.next(!0),m.matrix(!0);var f=m.pin("boxWidth"),d=m.pin("boxHeight");a=="column"?(!c&&(u+=this._spacing),m.pin("offsetY")!=u&&m.pin("offsetY",u),l=Math.max(l,f),u=u+d,o&&m.pin("alignX",h)):a=="row"&&(!c&&(l+=this._spacing),m.pin("offsetX")!=l&&m.pin("offsetX",l),l=l+f,u=Math.max(u,d),o&&m.pin("alignY",h)),c=!1}l+=2*this._padding,u+=2*this._padding,this.pin("width")!=l&&this.pin("width",l),this.pin("height")!=u&&this.pin("height",u)}}),this},r.box=function(){return r.create().box().label("Box")},r.prototype.box=function(){return this._padding=this._padding||0,this.untick(this._layoutTiker),this.tick(this._layoutTiker=function(){if(this._mo_box!=this._ts_touch){this._mo_box=this._ts_touch;for(var a=0,h=0,o,l=this.first(!0);o=l;){l=o.next(!0),o.matrix(!0);var u=o.pin("boxWidth"),m=o.pin("boxHeight");a=Math.max(a,u),h=Math.max(h,m)}a+=2*this._padding,h+=2*this._padding,this.pin("width")!=a&&this.pin("width",a),this.pin("height")!=h&&this.pin("height",h)}}),this},r.layer=function(){return r.create().layer().label("Layer")},r.prototype.layer=function(){return this.untick(this._layoutTiker),this.tick(this._layoutTiker=function(){var a=this.parent();if(a){var h=a.pin("width");this.pin("width")!=h&&this.pin("width",h);var o=a.pin("height");this.pin("height")!=o&&this.pin("height",o)}},!0),this},r.prototype.padding=function(a){return this._padding=a,this},r.prototype.spacing=function(a){return this._spacing=a,this}},function(e,n,s){var r=s(79),a=s(19),h=s(25);a.prototype.tween=function(u,m,p){if(typeof u!="number"?(p=u,m=0,u=0):typeof m!="number"&&(p=m,m=0),!this._tweens){this._tweens=[];var c=0;this.tick(function(d,y,_){if(!!this._tweens.length){var v=c!=_;if(c=y,v)return!0;var g=this._tweens[0],x=g.tick(this,d,y,_);if(x&&g===this._tweens[0]&&this._tweens.shift(),typeof x=="function")try{x.call(this)}catch(A){console.log(A)}return typeof x=="object"&&this._tweens.unshift(x),!0}},!0)}this.touch(),p||(this._tweens.length=0);var f=new o(this,u,m);return this._tweens.push(f),f};function o(u,m,p){this._end={},this._duration=m||400,this._delay=p||0,this._owner=u,this._time=0}o.prototype.tick=function(u,m,p,c){if(this._time+=m,!(this._time<this._delay)){var f=this._time-this._delay;if(!this._start){this._start={};for(var d in this._end)this._start[d]=this._owner.pin(d)}var y,_;f<this._duration?(y=f/this._duration,_=!1):(y=1,_=!0),typeof this._easing=="function"&&(y=this._easing(y));var v=1-y;for(var d in this._end)this._owner.pin(d,this._start[d]*v+this._end[d]*y);if(_)return this._next||this._done||!0}},o.prototype.tween=function(u,m){return this._next=new o(this._owner,u,m)},o.prototype.duration=function(u){return this._duration=u,this},o.prototype.delay=function(u){return this._delay=u,this},o.prototype.ease=function(u){return this._easing=r(u),this},o.prototype.done=function(u){return this._done=u,this},o.prototype.hide=function(){return this.done(function(){this.hide()}),this},o.prototype.remove=function(){return this.done(function(){this.remove()}),this},o.prototype.pin=function(u,m){if(typeof u=="object")for(var p in u)l(this._owner,this._end,p,u[p]);else typeof m!="undefined"&&l(this._owner,this._end,u,m);return this};function l(u,m,p,c){typeof u.pin(p)=="number"?m[p]=c:typeof u.pin(p+"X")=="number"&&typeof u.pin(p+"Y")=="number"&&(m[p+"X"]=c,m[p+"Y"]=c)}h._add_shortcuts(o),o.prototype.then=function(u){return this.done(u),this},o.prototype.clear=function(u){return this},e.exports=o},function(e,n){function s(l){return l}var r={},a={},h={};function o(l){if(typeof l=="function")return l;if(typeof l!="string")return s;var u=r[l];if(u)return u;var m=/^(\w+)(-(in|out|in-out|out-in))?(\((.*)\))?$/i.exec(l);if(!m||!m.length)return s;var p=h[m[1]],c=a[m[3]],f=m[5];return p&&p.fn?u=p.fn:p&&p.fc?u=p.fc.apply(p.fc,f&&f.replace(/\s+/,"").split(",")):u=s,c&&(u=c.fn(u)),r[l]=u,u}o.add=function(l){for(var u=(l.name||l.mode).split(/\s+/),m=0;m<u.length;m++){var p=u[m];p&&((l.name?h:a)[p]=l)}},o.add({mode:"in",fn:function(l){return l}}),o.add({mode:"out",fn:function(l){return function(u){return 1-l(1-u)}}}),o.add({mode:"in-out",fn:function(l){return function(u){return u<.5?l(2*u)/2:1-l(2*(1-u))/2}}}),o.add({mode:"out-in",fn:function(l){return function(u){return u<.5?1-l(2*(1-u))/2:l(2*u)/2}}}),o.add({name:"linear",fn:function(l){return l}}),o.add({name:"quad",fn:function(l){return l*l}}),o.add({name:"cubic",fn:function(l){return l*l*l}}),o.add({name:"quart",fn:function(l){return l*l*l*l}}),o.add({name:"quint",fn:function(l){return l*l*l*l*l}}),o.add({name:"sin sine",fn:function(l){return 1-Math.cos(l*Math.PI/2)}}),o.add({name:"exp expo",fn:function(l){return l==0?0:Math.pow(2,10*(l-1))}}),o.add({name:"circle circ",fn:function(l){return 1-Math.sqrt(1-l*l)}}),o.add({name:"bounce",fn:function(l){return l<1/2.75?7.5625*l*l:l<2/2.75?7.5625*(l-=1.5/2.75)*l+.75:l<2.5/2.75?7.5625*(l-=2.25/2.75)*l+.9375:7.5625*(l-=2.625/2.75)*l+.984375}}),o.add({name:"poly",fc:function(l){return function(u){return Math.pow(u,l)}}}),o.add({name:"elastic",fc:function(l,u){u=u||.45,l=l||1;var m=u/(2*Math.PI)*Math.asin(1/l);return function(p){return 1+l*Math.pow(2,-10*p)*Math.sin((p-m)*(2*Math.PI)/u)}}}),o.add({name:"back",fc:function(l){return l=typeof l!="undefined"?l:1.70158,function(u){return u*u*((l+1)*u-l)}}}),e.exports=o},function(e,n,s){s(19)._load(function(u,m){r.subscribe(u,m)}),r.CLICK="click",r.START="touchstart mousedown",r.MOVE="touchmove mousemove",r.END="touchend mouseup",r.CANCEL="touchcancel mousecancel",r.subscribe=function(u,m){if(u.mouse)return;u.mouse=new r(u,m),m.addEventListener("touchstart",f),m.addEventListener("touchend",y),m.addEventListener("touchmove",d),m.addEventListener("touchcancel",_),m.addEventListener("mousedown",f),m.addEventListener("mouseup",y),m.addEventListener("mousemove",d),document.addEventListener("mouseup",_),window.addEventListener("blur",_);var p=[],c=[];function f(v){v.preventDefault(),u.mouse.locate(v),u.mouse.publish(v.type,v),u.mouse.lookup("click",p),u.mouse.lookup("mousecancel",c)}function d(v){v.preventDefault(),u.mouse.locate(v),u.mouse.publish(v.type,v)}function y(v){v.preventDefault(),u.mouse.publish(v.type,v),p.length&&u.mouse.publish("click",v,p),c.length=0}function _(v){c.length&&u.mouse.publish("mousecancel",v,c),p.length=0}};function r(u,m){if(this instanceof r){var p=u.viewport().ratio||1;u.on("viewport",function(c){p=c.ratio||p}),this.x=0,this.y=0,this.toString=function(){return(this.x|0)+"x"+(this.y|0)},this.locate=function(c){l(m,c,this),this.x*=p,this.y*=p},this.lookup=function(c,f){this.type=c,this.root=u,this.event=null,f.length=0,this.collect=f,this.root.visit(this.visitor,this)},this.publish=function(c,f,d){if(this.type=c,this.root=u,this.event=f,this.collect=!1,this.timeStamp=Date.now(),d){for(;d.length&&!this.visitor.end(d.shift(),this););d.length=0}else this.root.visit(this.visitor,this)},this.visitor={reverse:!0,visible:!0,start:function(c,f){return!c._flag(f.type)},end:function(c,f){a.raw=f.event,a.type=f.type,a.timeStamp=f.timeStamp,a.abs.x=f.x,a.abs.y=f.y;var d=c.listeners(f.type);if(!!d&&(c.matrix().inverse().map(f,a),!!(c===f.root||c.hitTest(a))&&(f.collect&&f.collect.push(c),f.event))){for(var y=!1,_=0;_<d.length;_++)y=d[_].call(c,a)?!0:y;return y}}}}}var a={},h={};o(a,"clone",function(u){return u=u||{},u.x=this.x,u.y=this.y,u}),o(a,"toString",function(){return(this.x|0)+"x"+(this.y|0)+" ("+this.abs+")"}),o(a,"abs",h),o(h,"clone",function(u){return u=u||{},u.x=this.x,u.y=this.y,u}),o(h,"toString",function(){return(this.x|0)+"x"+(this.y|0)});function o(u,m,p){Object.defineProperty(u,m,{value:p})}function l(u,m,p){m.touches&&m.touches.length?(p.x=m.touches[0].clientX,p.y=m.touches[0].clientY):(p.x=m.clientX,p.y=m.clientY);var c=u.getBoundingClientRect();return p.x-=c.left,p.y-=c.top,p.x-=u.clientLeft|0,p.y-=u.clientTop|0,p}e.exports=r},function(e,n,s){var r=s(19);r._supported=function(){var o=document.createElement("canvas");return!!(o.getContext&&o.getContext("2d"))}(),window.addEventListener("load",function(){r._supported&&r.start()},!1),r.config({"app-loader":a,"image-loader":h});function a(o,l){l=l||{};var u=l.canvas,m=null,p=!1,c=0,f=0,d=1;if(typeof u=="string"&&(u=document.getElementById(u)),u||(u=document.getElementById("cutjs")||document.getElementById("stage")),!u){p=!0,u=document.createElement("canvas"),u.style.position="absolute",u.style.top="0",u.style.left="0";var y=document.body;y.insertBefore(u,y.firstChild)}m=u.getContext("2d");var _=window.devicePixelRatio||1,v=m.webkitBackingStorePixelRatio||m.mozBackingStorePixelRatio||m.msBackingStorePixelRatio||m.oBackingStorePixelRatio||m.backingStorePixelRatio||1;d=_/v;var g=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(M){return window.setTimeout(M,1e3/60)},x=r.root(g,A);function A(){m.setTransform(1,0,0,1,0,0),m.clearRect(0,0,c,f),x.render(m)}x.background=function(M){return u.style.backgroundColor=M,this},o(x,u),b(),window.addEventListener("resize",b,!1),window.addEventListener("orientationchange",b,!1);function b(){p?(c=window.innerWidth>0?window.innerWidth:screen.width,f=window.innerHeight>0?window.innerHeight:screen.height,u.style.width=c+"px",u.style.height=f+"px"):(c=u.clientWidth,f=u.clientHeight),c*=d,f*=d,!(u.width===c&&u.height===f)&&(u.width=c,u.height=f,x.viewport(c,f,d),A())}}function h(o,l,u){var m=new Image;m.onload=function(){l(m)},m.onerror=u,m.src=o}}])})})(Zm);var eS=Bd(Zm.exports);class ny{constructor(t,e,n={}){const s={scale:16,lineWidth:1/16,strokeStyle:{dynamic:"black",static:"black",kinematic:"black"}};this.options=Object.assign(s,n),n.lineWidth||(this.options.lineWidth=1/this.options.scale),this.world=t,this.ctx=e,this.canvas=e.canvas,this.draw=null,this.clear=(r,a)=>{a.clearRect(0,0,r.width,r.height)}}renderWorld(){const{ctx:t,canvas:e,options:n}=this;this.clear(e,t),typeof this.draw=="function"&&this.draw(t);for(let s=this.world.getBodyList();s;s=s.getNext())for(let r=s.getFixtureList();r;r=r.getNext()){if(s.render&&s.render.hidden)continue;s.render&&s.render.stroke?t.strokeStyle=s.render.stroke:s.isDynamic()?t.strokeStyle=n.strokeStyle.dynamic:s.isKinematic()?t.strokeStyle=n.strokeStyle.kinematic:s.isStatic()&&(t.strokeStyle=n.strokeStyle.static);const a=r.getType(),h=r.getShape();t.save(),t.scale(this.options.scale,this.options.scale),t.lineWidth=n.lineWidth,a==="circle"&&this.drawCircle(s,h),a==="edge"&&this.drawEdge(s,h),a==="polygon"&&this.drawPolygon(s,h),a==="chain"&&this.drawPolygon(s,h),t.restore()}for(let s=this.world.getJointList();s;s=s.getNext())t.save(),t.scale(this.options.scale,this.options.scale),this.drawJoint(s),t.restore()}drawCircle(t,e){const n=this.ctx,s=this.options.lineWidth,r=e.m_radius,a=t.getPosition(),h=t.getAngle(),o=2*r+2*s;if(n.translate(a.x+s,a.y+s),n.rotate(h),t.render&&t.render.custom){const l={x:-r-2*s,y:-r-2*s};if(t.render.custom(n,l,o+s)!==!0)return}n.beginPath(),n.arc(0,0,r,0,2*Math.PI),n.stroke(),n.restore()}drawEdge(t,e){const n=this.ctx,s=this.options.lineWidth,r=e.m_vertex1,a=e.m_vertex2,h=a.x-r.x,o=a.y-r.y,l=Math.sqrt(h*h+o*o);n.translate(r.x+s,r.y+s),n.beginPath(),n.moveTo(s,s),n.lineTo(s+l,s),n.lineCap="round",n.stroke()}drawPolygon(t,e){const n=this.ctx,s=this.options.lineWidth,r=e.m_vertices;if(!r.length)return;let a=1/0,h=1/0,o=-1/0,l=-1/0;for(const f of r)a=Math.min(a,f.x),o=Math.max(o,f.x),h=Math.min(h,f.y),l=Math.max(l,f.y);const u=o-a,m=l-h,p=t.getPosition(),c=t.getAngle();if(n.translate(p.x+2*s,p.y+2*s),n.rotate(c),t.render&&t.render.custom){const f={width:u+s,height:m+s},d={x:a-s,y:h-s};if(t.render.custom(n,d,f)!==!0)return}n.beginPath();for(let f=0;f<r.length;++f){const d=r[f],y=d.x-s,_=d.y-s;f===0?n.moveTo(y,_):n.lineTo(y,_)}r.length>2&&n.closePath(),n.stroke()}drawJoint(t){const e=this.ctx,n=t.getAnchorA(),s=t.getAnchorB();e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(s.x,s.y),e.stroke()}}class iS{constructor(t,e={}){this.options=Object.assign({fps:60,speed:1},e),this.world=t,this.fps=0,this.runId=null,this.render=null,this.update=null}start(t=!1,e=!1){if(this.runId)return;t&&(this.render=t),e&&(this.update=t);const n=1/this.options.fps,s=1/this.options.speed*n;let r,a,h=performance.now(),o=0;const l=()=>{for(r=performance.now(),o+=Math.min(1,(r-h)/1e3);o>s;)this.world.step(n),typeof e=="function"&&this.update(n),o-=s;a=(r-h)/1e3,this.fps=1/a,h=r,this.render(),this.runId=requestAnimationFrame(l)};this.runId=requestAnimationFrame(l)}stop(){this.runId&&(cancelAnimationFrame(this.runId),this.runId=null)}}class sy{constructor(){throw new Error("Your browser does not support the canvas element")}}const ry=()=>!!document.createElement("canvas").getContext("2d");ry();/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ql="136",oy=0,Km=1,ay=2,Qm=1,hy=2,Eo=3,Lo=0,li=1,gr=2,tp=1,Ms=0,Po=1,ep=2,ip=3,np=4,ly=5,xr=100,cy=101,uy=102,sp=103,rp=104,my=200,py=201,fy=202,dy=203,op=204,ap=205,_y=206,vy=207,yy=208,gy=209,xy=210,Ay=0,by=1,My=2,Jl=3,wy=4,Sy=5,By=6,Ty=7,qa=0,Cy=1,Ey=2,ws=0,Ly=1,Py=2,Iy=3,Ry=4,Dy=5,hp=300,Io=301,Ro=302,$l=303,Xl=304,Ja=306,jl=307,Zl=1e3,Qi=1001,Kl=1002,ci=1003,lp=1004,cp=1005,Gi=1006,zy=1007,$a=1008,es=1009,Fy=1010,Vy=1011,Do=1012,Ny=1013,Xa=1014,Ss=1015,Ks=1016,Oy=1017,Uy=1018,Hy=1019,Ar=1020,Gy=1021,Qs=1022,di=1023,ky=1024,Wy=1025,tr=1026,br=1027,Yy=1028,qy=1029,Jy=1030,$y=1031,Xy=1032,jy=1033,up=33776,mp=33777,pp=33778,fp=33779,dp=35840,_p=35841,vp=35842,yp=35843,Zy=36196,gp=37492,xp=37496,Ky=37808,Qy=37809,tg=37810,eg=37811,ig=37812,ng=37813,sg=37814,rg=37815,og=37816,ag=37817,hg=37818,lg=37819,cg=37820,ug=37821,mg=36492,pg=37840,fg=37841,dg=37842,_g=37843,vg=37844,yg=37845,gg=37846,xg=37847,Ag=37848,bg=37849,Mg=37850,wg=37851,Sg=37852,Bg=37853,Tg=2200,Cg=2201,Eg=2202,ja=2300,Za=2301,Ql=2302,Mr=2400,wr=2401,Ka=2402,tc=2500,Ap=2501,Lg=0,Cn=3e3,Sr=3001,Pg=3200,Ig=3201,Br=0,Rg=1,ec=7680,Dg=519,zo=35044,Qa=35048,bp="300 es";class er{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const s=this._listeners[t];if(s!==void 0){const r=s.indexOf(e);r!==-1&&s.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const n=this._listeners[t.type];if(n!==void 0){t.target=this;const s=n.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,t);t.target=null}}}const wi=[];for(let i=0;i<256;i++)wi[i]=(i<16?"0":"")+i.toString(16);const ic=Math.PI/180,nc=180/Math.PI;function Gn(){const i=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(wi[i&255]+wi[i>>8&255]+wi[i>>16&255]+wi[i>>24&255]+"-"+wi[t&255]+wi[t>>8&255]+"-"+wi[t>>16&15|64]+wi[t>>24&255]+"-"+wi[e&63|128]+wi[e>>8&255]+"-"+wi[e>>16&255]+wi[e>>24&255]+wi[n&255]+wi[n>>8&255]+wi[n>>16&255]+wi[n>>24&255]).toUpperCase()}function tn(i,t,e){return Math.max(t,Math.min(e,i))}function zg(i,t){return(i%t+t)%t}function sc(i,t,e){return(1-e)*i+e*t}function Mp(i){return(i&i-1)==0&&i!==0}function Fg(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}class vt{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6],this.y=s[1]*e+s[4]*n+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),s=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*n-a*s+t.x,this.y=r*s+a*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}vt.prototype.isVector2=!0;class Si{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,s,r,a,h,o,l){const u=this.elements;return u[0]=t,u[1]=s,u[2]=h,u[3]=e,u[4]=r,u[5]=o,u[6]=n,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,s=e.elements,r=this.elements,a=n[0],h=n[3],o=n[6],l=n[1],u=n[4],m=n[7],p=n[2],c=n[5],f=n[8],d=s[0],y=s[3],_=s[6],v=s[1],g=s[4],x=s[7],A=s[2],b=s[5],M=s[8];return r[0]=a*d+h*v+o*A,r[3]=a*y+h*g+o*b,r[6]=a*_+h*x+o*M,r[1]=l*d+u*v+m*A,r[4]=l*y+u*g+m*b,r[7]=l*_+u*x+m*M,r[2]=p*d+c*v+f*A,r[5]=p*y+c*g+f*b,r[8]=p*_+c*x+f*M,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],s=t[2],r=t[3],a=t[4],h=t[5],o=t[6],l=t[7],u=t[8];return e*a*u-e*h*l-n*r*u+n*h*o+s*r*l-s*a*o}invert(){const t=this.elements,e=t[0],n=t[1],s=t[2],r=t[3],a=t[4],h=t[5],o=t[6],l=t[7],u=t[8],m=u*a-h*l,p=h*o-u*r,c=l*r-a*o,f=e*m+n*p+s*c;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const d=1/f;return t[0]=m*d,t[1]=(s*l-u*n)*d,t[2]=(h*n-s*a)*d,t[3]=p*d,t[4]=(u*e-s*o)*d,t[5]=(s*r-h*e)*d,t[6]=c*d,t[7]=(n*o-l*e)*d,t[8]=(a*e-n*r)*d,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,s,r,a,h){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*a+l*h)+a+t,-s*l,s*o,-s*(-l*a+o*h)+h+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),s=this.elements,r=s[0],a=s[3],h=s[6],o=s[1],l=s[4],u=s[7];return s[0]=e*r+n*o,s[3]=e*a+n*l,s[6]=e*h+n*u,s[1]=-n*r+e*o,s[4]=-n*a+e*l,s[7]=-n*h+e*u,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let s=0;s<9;s++)if(e[s]!==n[s])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}Si.prototype.isMatrix3=!0;function wp(i){if(i.length===0)return-1/0;let t=i[0];for(let e=1,n=i.length;e<n;++e)i[e]>t&&(t=i[e]);return t}function th(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}let Tr;class Cr{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement=="undefined")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Tr===void 0&&(Tr=th("canvas")),Tr.width=t.width,Tr.height=t.height;const n=Tr.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Tr}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let Vg=0;class _i extends er{constructor(t=_i.DEFAULT_IMAGE,e=_i.DEFAULT_MAPPING,n=Qi,s=Qi,r=Gi,a=$a,h=di,o=es,l=1,u=Cn){super();Object.defineProperty(this,"id",{value:Vg++}),this.uuid=Gn(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=h,this.internalFormat=null,this.type=o,this.offset=new vt(0,0),this.repeat=new vt(1,1),this.center=new vt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Si,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const s=this.image;if(s.uuid===void 0&&(s.uuid=Gn()),!e&&t.images[s.uuid]===void 0){let r;if(Array.isArray(s)){r=[];for(let a=0,h=s.length;a<h;a++)s[a].isDataTexture?r.push(rc(s[a].image)):r.push(rc(s[a]))}else r=rc(s);t.images[s.uuid]={uuid:s.uuid,url:r}}n.image=s.uuid}return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==hp)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Zl:t.x=t.x-Math.floor(t.x);break;case Qi:t.x=t.x<0?0:1;break;case Kl:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Zl:t.y=t.y-Math.floor(t.y);break;case Qi:t.y=t.y<0?0:1;break;case Kl:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&this.version++}}_i.DEFAULT_IMAGE=void 0;_i.DEFAULT_MAPPING=hp;_i.prototype.isTexture=!0;function rc(i){return typeof HTMLImageElement!="undefined"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&i instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap?Cr.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Pe{constructor(t=0,e=0,n=0,s=1){this.x=t,this.y=e,this.z=n,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,s){return this.x=t,this.y=e,this.z=n,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*s+a[12]*r,this.y=a[1]*e+a[5]*n+a[9]*s+a[13]*r,this.z=a[2]*e+a[6]*n+a[10]*s+a[14]*r,this.w=a[3]*e+a[7]*n+a[11]*s+a[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,s,r;const a=.01,h=.1,o=t.elements,l=o[0],u=o[4],m=o[8],p=o[1],c=o[5],f=o[9],d=o[2],y=o[6],_=o[10];if(Math.abs(u-p)<a&&Math.abs(m-d)<a&&Math.abs(f-y)<a){if(Math.abs(u+p)<h&&Math.abs(m+d)<h&&Math.abs(f+y)<h&&Math.abs(l+c+_-3)<h)return this.set(1,0,0,0),this;e=Math.PI;const g=(l+1)/2,x=(c+1)/2,A=(_+1)/2,b=(u+p)/4,M=(m+d)/4,S=(f+y)/4;return g>x&&g>A?g<a?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(g),s=b/n,r=M/n):x>A?x<a?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(x),n=b/s,r=S/s):A<a?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(A),n=M/r,s=S/r),this.set(n,s,r,e),this}let v=Math.sqrt((y-f)*(y-f)+(m-d)*(m-d)+(p-u)*(p-u));return Math.abs(v)<.001&&(v=1),this.x=(y-f)/v,this.y=(m-d)/v,this.z=(p-u)/v,this.w=Math.acos((l+c+_-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Pe.prototype.isVector4=!0;class pn extends er{constructor(t,e,n={}){super();this.width=t,this.height=e,this.depth=1,this.scissor=new Pe(0,0,t,e),this.scissorTest=!1,this.viewport=new Pe(0,0,t,e),this.texture=new _i(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Gi,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,n=1){(this.width!==t||this.height!==e||this.depth!==n)&&(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image=_u({},this.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}pn.prototype.isWebGLRenderTarget=!0;class Ng extends pn{constructor(t,e,n){super(t,e);const s=this.texture;this.texture=[];for(let r=0;r<n;r++)this.texture[r]=s.clone()}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let s=0,r=this.texture.length;s<r;s++)this.texture[s].image.width=t,this.texture[s].image.height=e,this.texture[s].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone();return this}}Ng.prototype.isWebGLMultipleRenderTargets=!0;class oc extends pn{constructor(t,e,n={}){super(t,e,n);this.samples=4,this.ignoreDepthForMultisampleCopy=n.ignoreDepth!==void 0?n.ignoreDepth:!0,this.useRenderToTexture=n.useRenderToTexture!==void 0?n.useRenderToTexture:!1,this.useRenderbuffer=this.useRenderToTexture===!1}copy(t){return super.copy.call(this,t),this.samples=t.samples,this.useRenderToTexture=t.useRenderToTexture,this.useRenderbuffer=t.useRenderbuffer,this}}oc.prototype.isWebGLMultisampleRenderTarget=!0;class Ji{constructor(t=0,e=0,n=0,s=1){this._x=t,this._y=e,this._z=n,this._w=s}static slerp(t,e,n,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,s)}static slerpFlat(t,e,n,s,r,a,h){let o=n[s+0],l=n[s+1],u=n[s+2],m=n[s+3];const p=r[a+0],c=r[a+1],f=r[a+2],d=r[a+3];if(h===0){t[e+0]=o,t[e+1]=l,t[e+2]=u,t[e+3]=m;return}if(h===1){t[e+0]=p,t[e+1]=c,t[e+2]=f,t[e+3]=d;return}if(m!==d||o!==p||l!==c||u!==f){let y=1-h;const _=o*p+l*c+u*f+m*d,v=_>=0?1:-1,g=1-_*_;if(g>Number.EPSILON){const A=Math.sqrt(g),b=Math.atan2(A,_*v);y=Math.sin(y*b)/A,h=Math.sin(h*b)/A}const x=h*v;if(o=o*y+p*x,l=l*y+c*x,u=u*y+f*x,m=m*y+d*x,y===1-h){const A=1/Math.sqrt(o*o+l*l+u*u+m*m);o*=A,l*=A,u*=A,m*=A}}t[e]=o,t[e+1]=l,t[e+2]=u,t[e+3]=m}static multiplyQuaternionsFlat(t,e,n,s,r,a){const h=n[s],o=n[s+1],l=n[s+2],u=n[s+3],m=r[a],p=r[a+1],c=r[a+2],f=r[a+3];return t[e]=h*f+u*m+o*c-l*p,t[e+1]=o*f+u*p+l*m-h*c,t[e+2]=l*f+u*c+h*p-o*m,t[e+3]=u*f-h*m-o*p-l*c,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,s=t._y,r=t._z,a=t._order,h=Math.cos,o=Math.sin,l=h(n/2),u=h(s/2),m=h(r/2),p=o(n/2),c=o(s/2),f=o(r/2);switch(a){case"XYZ":this._x=p*u*m+l*c*f,this._y=l*c*m-p*u*f,this._z=l*u*f+p*c*m,this._w=l*u*m-p*c*f;break;case"YXZ":this._x=p*u*m+l*c*f,this._y=l*c*m-p*u*f,this._z=l*u*f-p*c*m,this._w=l*u*m+p*c*f;break;case"ZXY":this._x=p*u*m-l*c*f,this._y=l*c*m+p*u*f,this._z=l*u*f+p*c*m,this._w=l*u*m-p*c*f;break;case"ZYX":this._x=p*u*m-l*c*f,this._y=l*c*m+p*u*f,this._z=l*u*f-p*c*m,this._w=l*u*m+p*c*f;break;case"YZX":this._x=p*u*m+l*c*f,this._y=l*c*m+p*u*f,this._z=l*u*f-p*c*m,this._w=l*u*m-p*c*f;break;case"XZY":this._x=p*u*m-l*c*f,this._y=l*c*m-p*u*f,this._z=l*u*f+p*c*m,this._w=l*u*m+p*c*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],s=e[4],r=e[8],a=e[1],h=e[5],o=e[9],l=e[2],u=e[6],m=e[10],p=n+h+m;if(p>0){const c=.5/Math.sqrt(p+1);this._w=.25/c,this._x=(u-o)*c,this._y=(r-l)*c,this._z=(a-s)*c}else if(n>h&&n>m){const c=2*Math.sqrt(1+n-h-m);this._w=(u-o)/c,this._x=.25*c,this._y=(s+a)/c,this._z=(r+l)/c}else if(h>m){const c=2*Math.sqrt(1+h-n-m);this._w=(r-l)/c,this._x=(s+a)/c,this._y=.25*c,this._z=(o+u)/c}else{const c=2*Math.sqrt(1+m-n-h);this._w=(a-s)/c,this._x=(r+l)/c,this._y=(o+u)/c,this._z=.25*c}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(tn(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const s=Math.min(1,e/n);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,s=t._y,r=t._z,a=t._w,h=e._x,o=e._y,l=e._z,u=e._w;return this._x=n*u+a*h+s*l-r*o,this._y=s*u+a*o+r*h-n*l,this._z=r*u+a*l+n*o-s*h,this._w=a*u-n*h-s*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,s=this._y,r=this._z,a=this._w;let h=a*t._w+n*t._x+s*t._y+r*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=a,this._x=n,this._y=s,this._z=r,this;const o=1-h*h;if(o<=Number.EPSILON){const c=1-e;return this._w=c*a+e*this._w,this._x=c*n+e*this._x,this._y=c*s+e*this._y,this._z=c*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),u=Math.atan2(l,h),m=Math.sin((1-e)*u)/l,p=Math.sin(e*u)/l;return this._w=a*m+this._w*p,this._x=n*m+this._x*p,this._y=s*m+this._y*p,this._z=r*m+this._z*p,this._onChangeCallback(),this}slerpQuaternions(t,e,n){this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),n*Math.sin(r),n*Math.cos(r),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Ji.prototype.isQuaternion=!0;class k{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Sp.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Sp.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*s,this.y=r[1]*e+r[4]*n+r[7]*s,this.z=r[2]*e+r[5]*n+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,r=t.elements,a=1/(r[3]*e+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*s+r[12])*a,this.y=(r[1]*e+r[5]*n+r[9]*s+r[13])*a,this.z=(r[2]*e+r[6]*n+r[10]*s+r[14])*a,this}applyQuaternion(t){const e=this.x,n=this.y,s=this.z,r=t.x,a=t.y,h=t.z,o=t.w,l=o*e+a*s-h*n,u=o*n+h*e-r*s,m=o*s+r*n-a*e,p=-r*e-a*n-h*s;return this.x=l*o+p*-r+u*-h-m*-a,this.y=u*o+p*-a+m*-r-l*-h,this.z=m*o+p*-h+l*-a-u*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*s,this.y=r[1]*e+r[5]*n+r[9]*s,this.z=r[2]*e+r[6]*n+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,s=t.y,r=t.z,a=e.x,h=e.y,o=e.z;return this.x=s*o-r*h,this.y=r*a-n*o,this.z=n*h-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return ac.copy(this).projectOnVector(t),this.sub(ac)}reflect(t){return this.sub(ac.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(tn(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return e*e+n*n+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const s=Math.sin(e)*t;return this.x=s*Math.sin(n),this.y=Math.cos(e)*t,this.z=s*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}k.prototype.isVector3=!0;const ac=new k,Sp=new Ji;class En{constructor(t=new k(1/0,1/0,1/0),e=new k(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,s=1/0,r=-1/0,a=-1/0,h=-1/0;for(let o=0,l=t.length;o<l;o+=3){const u=t[o],m=t[o+1],p=t[o+2];u<e&&(e=u),m<n&&(n=m),p<s&&(s=p),u>r&&(r=u),m>a&&(a=m),p>h&&(h=p)}return this.min.set(e,n,s),this.max.set(r,a,h),this}setFromBufferAttribute(t){let e=1/0,n=1/0,s=1/0,r=-1/0,a=-1/0,h=-1/0;for(let o=0,l=t.count;o<l;o++){const u=t.getX(o),m=t.getY(o),p=t.getZ(o);u<e&&(e=u),m<n&&(n=m),p<s&&(s=p),u>r&&(r=u),m>a&&(a=m),p>h&&(h=p)}return this.min.set(e,n,s),this.max.set(r,a,h),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Fo.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;e!==void 0&&(e.boundingBox===null&&e.computeBoundingBox(),hc.copy(e.boundingBox),hc.applyMatrix4(t.matrixWorld),this.union(hc));const n=t.children;for(let s=0,r=n.length;s<r;s++)this.expandByObject(n[s]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Fo),Fo.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Vo),eh.subVectors(this.max,Vo),Er.subVectors(t.a,Vo),Lr.subVectors(t.b,Vo),Pr.subVectors(t.c,Vo),Bs.subVectors(Lr,Er),Ts.subVectors(Pr,Lr),ir.subVectors(Er,Pr);let e=[0,-Bs.z,Bs.y,0,-Ts.z,Ts.y,0,-ir.z,ir.y,Bs.z,0,-Bs.x,Ts.z,0,-Ts.x,ir.z,0,-ir.x,-Bs.y,Bs.x,0,-Ts.y,Ts.x,0,-ir.y,ir.x,0];return!lc(e,Er,Lr,Pr,eh)||(e=[1,0,0,0,1,0,0,0,1],!lc(e,Er,Lr,Pr,eh))?!1:(ih.crossVectors(Bs,Ts),e=[ih.x,ih.y,ih.z],lc(e,Er,Lr,Pr,eh))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Fo.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(Fo).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(is[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),is[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),is[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),is[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),is[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),is[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),is[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),is[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(is),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}En.prototype.isBox3=!0;const is=[new k,new k,new k,new k,new k,new k,new k,new k],Fo=new k,hc=new En,Er=new k,Lr=new k,Pr=new k,Bs=new k,Ts=new k,ir=new k,Vo=new k,eh=new k,ih=new k,nr=new k;function lc(i,t,e,n,s){for(let r=0,a=i.length-3;r<=a;r+=3){nr.fromArray(i,r);const h=s.x*Math.abs(nr.x)+s.y*Math.abs(nr.y)+s.z*Math.abs(nr.z),o=t.dot(nr),l=e.dot(nr),u=n.dot(nr);if(Math.max(-Math.max(o,l,u),Math.min(o,l,u))>h)return!1}return!0}const Og=new En,Bp=new k,nh=new k,cc=new k;class Ir{constructor(t=new k,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;e!==void 0?n.copy(e):Og.setFromPoints(t).getCenter(n);let s=0;for(let r=0,a=t.length;r<a;r++)s=Math.max(s,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){cc.subVectors(t,this.center);const e=cc.lengthSq();if(e>this.radius*this.radius){const n=Math.sqrt(e),s=(n-this.radius)*.5;this.center.add(cc.multiplyScalar(s/n)),this.radius+=s}return this}union(t){return this.center.equals(t.center)===!0?nh.set(0,0,1).multiplyScalar(t.radius):nh.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Bp.copy(t.center).add(nh)),this.expandByPoint(Bp.copy(t.center).sub(nh)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ns=new k,uc=new k,sh=new k,Cs=new k,mc=new k,rh=new k,pc=new k;class Rr{constructor(t=new k,e=new k(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ns)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ns.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ns.copy(this.direction).multiplyScalar(e).add(this.origin),ns.distanceToSquared(t))}distanceSqToSegment(t,e,n,s){uc.copy(t).add(e).multiplyScalar(.5),sh.copy(e).sub(t).normalize(),Cs.copy(this.origin).sub(uc);const r=t.distanceTo(e)*.5,a=-this.direction.dot(sh),h=Cs.dot(this.direction),o=-Cs.dot(sh),l=Cs.lengthSq(),u=Math.abs(1-a*a);let m,p,c,f;if(u>0)if(m=a*o-h,p=a*h-o,f=r*u,m>=0)if(p>=-f)if(p<=f){const d=1/u;m*=d,p*=d,c=m*(m+a*p+2*h)+p*(a*m+p+2*o)+l}else p=r,m=Math.max(0,-(a*p+h)),c=-m*m+p*(p+2*o)+l;else p=-r,m=Math.max(0,-(a*p+h)),c=-m*m+p*(p+2*o)+l;else p<=-f?(m=Math.max(0,-(-a*r+h)),p=m>0?-r:Math.min(Math.max(-r,-o),r),c=-m*m+p*(p+2*o)+l):p<=f?(m=0,p=Math.min(Math.max(-r,-o),r),c=p*(p+2*o)+l):(m=Math.max(0,-(a*r+h)),p=m>0?r:Math.min(Math.max(-r,-o),r),c=-m*m+p*(p+2*o)+l);else p=a>0?-r:r,m=Math.max(0,-(a*p+h)),c=-m*m+p*(p+2*o)+l;return n&&n.copy(this.direction).multiplyScalar(m).add(this.origin),s&&s.copy(sh).multiplyScalar(p).add(uc),c}intersectSphere(t,e){ns.subVectors(t.center,this.origin);const n=ns.dot(this.direction),s=ns.dot(ns)-n*n,r=t.radius*t.radius;if(s>r)return null;const a=Math.sqrt(r-s),h=n-a,o=n+a;return h<0&&o<0?null:h<0?this.at(o,e):this.at(h,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return n===null?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,s,r,a,h,o;const l=1/this.direction.x,u=1/this.direction.y,m=1/this.direction.z,p=this.origin;return l>=0?(n=(t.min.x-p.x)*l,s=(t.max.x-p.x)*l):(n=(t.max.x-p.x)*l,s=(t.min.x-p.x)*l),u>=0?(r=(t.min.y-p.y)*u,a=(t.max.y-p.y)*u):(r=(t.max.y-p.y)*u,a=(t.min.y-p.y)*u),n>a||r>s||((r>n||n!==n)&&(n=r),(a<s||s!==s)&&(s=a),m>=0?(h=(t.min.z-p.z)*m,o=(t.max.z-p.z)*m):(h=(t.max.z-p.z)*m,o=(t.min.z-p.z)*m),n>o||h>s)||((h>n||n!==n)&&(n=h),(o<s||s!==s)&&(s=o),s<0)?null:this.at(n>=0?n:s,e)}intersectsBox(t){return this.intersectBox(t,ns)!==null}intersectTriangle(t,e,n,s,r){mc.subVectors(e,t),rh.subVectors(n,t),pc.crossVectors(mc,rh);let a=this.direction.dot(pc),h;if(a>0){if(s)return null;h=1}else if(a<0)h=-1,a=-a;else return null;Cs.subVectors(this.origin,t);const o=h*this.direction.dot(rh.crossVectors(Cs,rh));if(o<0)return null;const l=h*this.direction.dot(mc.cross(Cs));if(l<0||o+l>a)return null;const u=-h*Cs.dot(pc);return u<0?null:this.at(u/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Rt{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,s,r,a,h,o,l,u,m,p,c,f,d,y){const _=this.elements;return _[0]=t,_[4]=e,_[8]=n,_[12]=s,_[1]=r,_[5]=a,_[9]=h,_[13]=o,_[2]=l,_[6]=u,_[10]=m,_[14]=p,_[3]=c,_[7]=f,_[11]=d,_[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Rt().fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,s=1/Dr.setFromMatrixColumn(t,0).length(),r=1/Dr.setFromMatrixColumn(t,1).length(),a=1/Dr.setFromMatrixColumn(t,2).length();return e[0]=n[0]*s,e[1]=n[1]*s,e[2]=n[2]*s,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,s=t.y,r=t.z,a=Math.cos(n),h=Math.sin(n),o=Math.cos(s),l=Math.sin(s),u=Math.cos(r),m=Math.sin(r);if(t.order==="XYZ"){const p=a*u,c=a*m,f=h*u,d=h*m;e[0]=o*u,e[4]=-o*m,e[8]=l,e[1]=c+f*l,e[5]=p-d*l,e[9]=-h*o,e[2]=d-p*l,e[6]=f+c*l,e[10]=a*o}else if(t.order==="YXZ"){const p=o*u,c=o*m,f=l*u,d=l*m;e[0]=p+d*h,e[4]=f*h-c,e[8]=a*l,e[1]=a*m,e[5]=a*u,e[9]=-h,e[2]=c*h-f,e[6]=d+p*h,e[10]=a*o}else if(t.order==="ZXY"){const p=o*u,c=o*m,f=l*u,d=l*m;e[0]=p-d*h,e[4]=-a*m,e[8]=f+c*h,e[1]=c+f*h,e[5]=a*u,e[9]=d-p*h,e[2]=-a*l,e[6]=h,e[10]=a*o}else if(t.order==="ZYX"){const p=a*u,c=a*m,f=h*u,d=h*m;e[0]=o*u,e[4]=f*l-c,e[8]=p*l+d,e[1]=o*m,e[5]=d*l+p,e[9]=c*l-f,e[2]=-l,e[6]=h*o,e[10]=a*o}else if(t.order==="YZX"){const p=a*o,c=a*l,f=h*o,d=h*l;e[0]=o*u,e[4]=d-p*m,e[8]=f*m+c,e[1]=m,e[5]=a*u,e[9]=-h*u,e[2]=-l*u,e[6]=c*m+f,e[10]=p-d*m}else if(t.order==="XZY"){const p=a*o,c=a*l,f=h*o,d=h*l;e[0]=o*u,e[4]=-m,e[8]=l*u,e[1]=p*m+d,e[5]=a*u,e[9]=c*m-f,e[2]=f*m-c,e[6]=h*u,e[10]=d*m+p}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ug,t,Hg)}lookAt(t,e,n){const s=this.elements;return en.subVectors(t,e),en.lengthSq()===0&&(en.z=1),en.normalize(),Es.crossVectors(n,en),Es.lengthSq()===0&&(Math.abs(n.z)===1?en.x+=1e-4:en.z+=1e-4,en.normalize(),Es.crossVectors(n,en)),Es.normalize(),oh.crossVectors(en,Es),s[0]=Es.x,s[4]=oh.x,s[8]=en.x,s[1]=Es.y,s[5]=oh.y,s[9]=en.y,s[2]=Es.z,s[6]=oh.z,s[10]=en.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,s=e.elements,r=this.elements,a=n[0],h=n[4],o=n[8],l=n[12],u=n[1],m=n[5],p=n[9],c=n[13],f=n[2],d=n[6],y=n[10],_=n[14],v=n[3],g=n[7],x=n[11],A=n[15],b=s[0],M=s[4],S=s[8],B=s[12],E=s[1],T=s[5],w=s[9],C=s[13],P=s[2],R=s[6],L=s[10],I=s[14],z=s[3],F=s[7],D=s[11],V=s[15];return r[0]=a*b+h*E+o*P+l*z,r[4]=a*M+h*T+o*R+l*F,r[8]=a*S+h*w+o*L+l*D,r[12]=a*B+h*C+o*I+l*V,r[1]=u*b+m*E+p*P+c*z,r[5]=u*M+m*T+p*R+c*F,r[9]=u*S+m*w+p*L+c*D,r[13]=u*B+m*C+p*I+c*V,r[2]=f*b+d*E+y*P+_*z,r[6]=f*M+d*T+y*R+_*F,r[10]=f*S+d*w+y*L+_*D,r[14]=f*B+d*C+y*I+_*V,r[3]=v*b+g*E+x*P+A*z,r[7]=v*M+g*T+x*R+A*F,r[11]=v*S+g*w+x*L+A*D,r[15]=v*B+g*C+x*I+A*V,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],s=t[8],r=t[12],a=t[1],h=t[5],o=t[9],l=t[13],u=t[2],m=t[6],p=t[10],c=t[14],f=t[3],d=t[7],y=t[11],_=t[15];return f*(+r*o*m-s*l*m-r*h*p+n*l*p+s*h*c-n*o*c)+d*(+e*o*c-e*l*p+r*a*p-s*a*c+s*l*u-r*o*u)+y*(+e*l*m-e*h*c-r*a*m+n*a*c+r*h*u-n*l*u)+_*(-s*h*u-e*o*m+e*h*p+s*a*m-n*a*p+n*o*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],s=t[2],r=t[3],a=t[4],h=t[5],o=t[6],l=t[7],u=t[8],m=t[9],p=t[10],c=t[11],f=t[12],d=t[13],y=t[14],_=t[15],v=m*y*l-d*p*l+d*o*c-h*y*c-m*o*_+h*p*_,g=f*p*l-u*y*l-f*o*c+a*y*c+u*o*_-a*p*_,x=u*d*l-f*m*l+f*h*c-a*d*c-u*h*_+a*m*_,A=f*m*o-u*d*o-f*h*p+a*d*p+u*h*y-a*m*y,b=e*v+n*g+s*x+r*A;if(b===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/b;return t[0]=v*M,t[1]=(d*p*r-m*y*r-d*s*c+n*y*c+m*s*_-n*p*_)*M,t[2]=(h*y*r-d*o*r+d*s*l-n*y*l-h*s*_+n*o*_)*M,t[3]=(m*o*r-h*p*r-m*s*l+n*p*l+h*s*c-n*o*c)*M,t[4]=g*M,t[5]=(u*y*r-f*p*r+f*s*c-e*y*c-u*s*_+e*p*_)*M,t[6]=(f*o*r-a*y*r-f*s*l+e*y*l+a*s*_-e*o*_)*M,t[7]=(a*p*r-u*o*r+u*s*l-e*p*l-a*s*c+e*o*c)*M,t[8]=x*M,t[9]=(f*m*r-u*d*r-f*n*c+e*d*c+u*n*_-e*m*_)*M,t[10]=(a*d*r-f*h*r+f*n*l-e*d*l-a*n*_+e*h*_)*M,t[11]=(u*h*r-a*m*r-u*n*l+e*m*l+a*n*c-e*h*c)*M,t[12]=A*M,t[13]=(u*d*s-f*m*s+f*n*p-e*d*p-u*n*y+e*m*y)*M,t[14]=(f*h*s-a*d*s-f*n*o+e*d*o+a*n*y-e*h*y)*M,t[15]=(a*m*s-u*h*s+u*n*o-e*m*o-a*n*p+e*h*p)*M,this}scale(t){const e=this.elements,n=t.x,s=t.y,r=t.z;return e[0]*=n,e[4]*=s,e[8]*=r,e[1]*=n,e[5]*=s,e[9]*=r,e[2]*=n,e[6]*=s,e[10]*=r,e[3]*=n,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,s))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),s=Math.sin(e),r=1-n,a=t.x,h=t.y,o=t.z,l=r*a,u=r*h;return this.set(l*a+n,l*h-s*o,l*o+s*h,0,l*h+s*o,u*h+n,u*o-s*a,0,l*o-s*h,u*o+s*a,r*o*o+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,s,r,a){return this.set(1,n,r,0,t,1,a,0,e,s,1,0,0,0,0,1),this}compose(t,e,n){const s=this.elements,r=e._x,a=e._y,h=e._z,o=e._w,l=r+r,u=a+a,m=h+h,p=r*l,c=r*u,f=r*m,d=a*u,y=a*m,_=h*m,v=o*l,g=o*u,x=o*m,A=n.x,b=n.y,M=n.z;return s[0]=(1-(d+_))*A,s[1]=(c+x)*A,s[2]=(f-g)*A,s[3]=0,s[4]=(c-x)*b,s[5]=(1-(p+_))*b,s[6]=(y+v)*b,s[7]=0,s[8]=(f+g)*M,s[9]=(y-v)*M,s[10]=(1-(p+d))*M,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,n){const s=this.elements;let r=Dr.set(s[0],s[1],s[2]).length();const a=Dr.set(s[4],s[5],s[6]).length(),h=Dr.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],Ln.copy(this);const l=1/r,u=1/a,m=1/h;return Ln.elements[0]*=l,Ln.elements[1]*=l,Ln.elements[2]*=l,Ln.elements[4]*=u,Ln.elements[5]*=u,Ln.elements[6]*=u,Ln.elements[8]*=m,Ln.elements[9]*=m,Ln.elements[10]*=m,e.setFromRotationMatrix(Ln),n.x=r,n.y=a,n.z=h,this}makePerspective(t,e,n,s,r,a){a===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const h=this.elements,o=2*r/(e-t),l=2*r/(n-s),u=(e+t)/(e-t),m=(n+s)/(n-s),p=-(a+r)/(a-r),c=-2*a*r/(a-r);return h[0]=o,h[4]=0,h[8]=u,h[12]=0,h[1]=0,h[5]=l,h[9]=m,h[13]=0,h[2]=0,h[6]=0,h[10]=p,h[14]=c,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,n,s,r,a){const h=this.elements,o=1/(e-t),l=1/(n-s),u=1/(a-r),m=(e+t)*o,p=(n+s)*l,c=(a+r)*u;return h[0]=2*o,h[4]=0,h[8]=0,h[12]=-m,h[1]=0,h[5]=2*l,h[9]=0,h[13]=-p,h[2]=0,h[6]=0,h[10]=-2*u,h[14]=-c,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let s=0;s<16;s++)if(e[s]!==n[s])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}Rt.prototype.isMatrix4=!0;const Dr=new k,Ln=new Rt,Ug=new k(0,0,0),Hg=new k(1,1,1),Es=new k,oh=new k,en=new k,Tp=new Rt,Cp=new Ji;class zr{constructor(t=0,e=0,n=0,s=zr.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,s=this._order){return this._x=t,this._y=e,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const s=t.elements,r=s[0],a=s[4],h=s[8],o=s[1],l=s[5],u=s[9],m=s[2],p=s[6],c=s[10];switch(e){case"XYZ":this._y=Math.asin(tn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-u,c),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(p,l),this._z=0);break;case"YXZ":this._x=Math.asin(-tn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(h,c),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-m,r),this._z=0);break;case"ZXY":this._x=Math.asin(tn(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-m,c),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-tn(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(p,c),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(tn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-m,r)):(this._x=0,this._y=Math.atan2(h,c));break;case"XZY":this._z=Math.asin(-tn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,l),this._y=Math.atan2(h,r)):(this._x=Math.atan2(-u,c),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Tp.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Tp,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Cp.setFromEuler(this),this.setFromQuaternion(Cp,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new k(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}zr.prototype.isEuler=!0;zr.DefaultOrder="XYZ";zr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Ep{constructor(){this.mask=1|0}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=4294967295|0}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!=0}isEnabled(t){return(this.mask&(1<<t|0))!=0}}let Gg=0;const Lp=new k,Fr=new Ji,ss=new Rt,ah=new k,No=new k,kg=new k,Wg=new Ji,Pp=new k(1,0,0),Ip=new k(0,1,0),Rp=new k(0,0,1),Yg={type:"added"},Dp={type:"removed"};class we extends er{constructor(){super();Object.defineProperty(this,"id",{value:Gg++}),this.uuid=Gn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=we.DefaultUp.clone();const t=new k,e=new zr,n=new Ji,s=new k(1,1,1);function r(){n.setFromEuler(e,!1)}function a(){e.setFromQuaternion(n,void 0,!1)}e._onChange(r),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Rt},normalMatrix:{value:new Si}}),this.matrix=new Rt,this.matrixWorld=new Rt,this.matrixAutoUpdate=we.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ep,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Fr.setFromAxisAngle(t,e),this.quaternion.multiply(Fr),this}rotateOnWorldAxis(t,e){return Fr.setFromAxisAngle(t,e),this.quaternion.premultiply(Fr),this}rotateX(t){return this.rotateOnAxis(Pp,t)}rotateY(t){return this.rotateOnAxis(Ip,t)}rotateZ(t){return this.rotateOnAxis(Rp,t)}translateOnAxis(t,e){return Lp.copy(t).applyQuaternion(this.quaternion),this.position.add(Lp.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Pp,t)}translateY(t){return this.translateOnAxis(Ip,t)}translateZ(t){return this.translateOnAxis(Rp,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(ss.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?ah.copy(t):ah.set(t,e,n);const s=this.parent;this.updateWorldMatrix(!0,!1),No.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ss.lookAt(No,ah,this.up):ss.lookAt(ah,No,this.up),this.quaternion.setFromRotationMatrix(ss),s&&(ss.extractRotation(s.matrixWorld),Fr.setFromRotationMatrix(ss),this.quaternion.premultiply(Fr.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Yg)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Dp)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Dp)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ss.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),ss.multiply(t.parent.matrixWorld)),t.applyMatrix4(ss),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectByProperty(t,e);if(a!==void 0)return a}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(No,t,kg),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(No,Wg,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function r(h,o){return h[o.uuid]===void 0&&(h[o.uuid]=o.toJSON(t)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(t.geometries,this.geometry);const h=this.geometry.parameters;if(h!==void 0&&h.shapes!==void 0){const o=h.shapes;if(Array.isArray(o))for(let l=0,u=o.length;l<u;l++){const m=o[l];r(t.shapes,m)}else r(t.shapes,o)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const h=[];for(let o=0,l=this.material.length;o<l;o++)h.push(r(t.materials,this.material[o]));s.material=h}else s.material=r(t.materials,this.material);if(this.children.length>0){s.children=[];for(let h=0;h<this.children.length;h++)s.children.push(this.children[h].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let h=0;h<this.animations.length;h++){const o=this.animations[h];s.animations.push(r(t.animations,o))}}if(e){const h=a(t.geometries),o=a(t.materials),l=a(t.textures),u=a(t.images),m=a(t.shapes),p=a(t.skeletons),c=a(t.animations);h.length>0&&(n.geometries=h),o.length>0&&(n.materials=o),l.length>0&&(n.textures=l),u.length>0&&(n.images=u),m.length>0&&(n.shapes=m),p.length>0&&(n.skeletons=p),c.length>0&&(n.animations=c)}return n.object=s,n;function a(h){const o=[];for(const l in h){const u=h[l];delete u.metadata,o.push(u)}return o}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let n=0;n<t.children.length;n++){const s=t.children[n];this.add(s.clone())}return this}}we.DefaultUp=new k(0,1,0);we.DefaultMatrixAutoUpdate=!0;we.prototype.isObject3D=!0;const Pn=new k,rs=new k,fc=new k,os=new k,Vr=new k,Nr=new k,zp=new k,dc=new k,_c=new k,vc=new k;class ii{constructor(t=new k,e=new k,n=new k){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,s){s.subVectors(n,e),Pn.subVectors(t,e),s.cross(Pn);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(t,e,n,s,r){Pn.subVectors(s,e),rs.subVectors(n,e),fc.subVectors(t,e);const a=Pn.dot(Pn),h=Pn.dot(rs),o=Pn.dot(fc),l=rs.dot(rs),u=rs.dot(fc),m=a*l-h*h;if(m===0)return r.set(-2,-1,-1);const p=1/m,c=(l*o-h*u)*p,f=(a*u-h*o)*p;return r.set(1-c-f,f,c)}static containsPoint(t,e,n,s){return this.getBarycoord(t,e,n,s,os),os.x>=0&&os.y>=0&&os.x+os.y<=1}static getUV(t,e,n,s,r,a,h,o){return this.getBarycoord(t,e,n,s,os),o.set(0,0),o.addScaledVector(r,os.x),o.addScaledVector(a,os.y),o.addScaledVector(h,os.z),o}static isFrontFacing(t,e,n,s){return Pn.subVectors(n,e),rs.subVectors(t,e),Pn.cross(rs).dot(s)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,s){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,n,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Pn.subVectors(this.c,this.b),rs.subVectors(this.a,this.b),Pn.cross(rs).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ii.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ii.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,s,r){return ii.getUV(t,this.a,this.b,this.c,e,n,s,r)}containsPoint(t){return ii.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ii.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,s=this.b,r=this.c;let a,h;Vr.subVectors(s,n),Nr.subVectors(r,n),dc.subVectors(t,n);const o=Vr.dot(dc),l=Nr.dot(dc);if(o<=0&&l<=0)return e.copy(n);_c.subVectors(t,s);const u=Vr.dot(_c),m=Nr.dot(_c);if(u>=0&&m<=u)return e.copy(s);const p=o*m-u*l;if(p<=0&&o>=0&&u<=0)return a=o/(o-u),e.copy(n).addScaledVector(Vr,a);vc.subVectors(t,r);const c=Vr.dot(vc),f=Nr.dot(vc);if(f>=0&&c<=f)return e.copy(r);const d=c*l-o*f;if(d<=0&&l>=0&&f<=0)return h=l/(l-f),e.copy(n).addScaledVector(Nr,h);const y=u*f-c*m;if(y<=0&&m-u>=0&&c-f>=0)return zp.subVectors(r,s),h=(m-u)/(m-u+(c-f)),e.copy(s).addScaledVector(zp,h);const _=1/(y+d+p);return a=d*_,h=p*_,e.copy(n).addScaledVector(Vr,a).addScaledVector(Nr,h)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let qg=0;class Ri extends er{constructor(){super();Object.defineProperty(this,"id",{value:qg++}),this.uuid=Gn(),this.name="",this.type="Material",this.fog=!0,this.blending=Po,this.side=Lo,this.vertexColors=!1,this.opacity=1,this.format=di,this.transparent=!1,this.blendSrc=op,this.blendDst=ap,this.blendEquation=xr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Jl,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Dg,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ec,this.stencilZFail=ec,this.stencilZPass=ec,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const n=t[e];if(n===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===tp;continue}const s=this[e];if(s===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Po&&(n.blending=this.blending),this.side!==Lo&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==di&&(n.format=this.format),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function s(r){const a=[];for(const h in r){const o=r[h];delete o.metadata,a.push(o)}return a}if(e){const r=s(t.textures),a=s(t.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.format=t.format,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(e!==null){const s=e.length;n=new Array(s);for(let r=0;r!==s;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}Ri.prototype.isMaterial=!0;const Fp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},In={h:0,s:0,l:0},hh={h:0,s:0,l:0};function yc(i,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+(t-i)*6*e:e<1/2?t:e<2/3?i+(t-i)*6*(2/3-e):i}function gc(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function xc(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}class Et{constructor(t,e,n){return e===void 0&&n===void 0?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=zg(t,1),e=tn(e,0,1),n=tn(n,0,1),e===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+e):n+e-n*e,r=2*n-s;this.r=yc(r,s,t+1/3),this.g=yc(r,s,t),this.b=yc(r,s,t-1/3)}return this}setStyle(t){function e(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let s;const r=n[1],a=n[2];switch(r){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,e(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,e(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const h=parseFloat(s[1])/360,o=parseInt(s[2],10)/100,l=parseInt(s[3],10)/100;return e(s[4]),this.setHSL(h,o,l)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],r=s.length;if(r===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,this;if(r===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Fp[t.toLowerCase()];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=gc(t.r),this.g=gc(t.g),this.b=gc(t.b),this}copyLinearToSRGB(t){return this.r=xc(t.r),this.g=xc(t.g),this.b=xc(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,n=this.g,s=this.b,r=Math.max(e,n,s),a=Math.min(e,n,s);let h,o;const l=(a+r)/2;if(a===r)h=0,o=0;else{const u=r-a;switch(o=l<=.5?u/(r+a):u/(2-r-a),r){case e:h=(n-s)/u+(n<s?6:0);break;case n:h=(s-e)/u+2;break;case s:h=(e-n)/u+4;break}h/=6}return t.h=h,t.s=o,t.l=l,t}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(t,e,n){return this.getHSL(In),In.h+=t,In.s+=e,In.l+=n,this.setHSL(In.h,In.s,In.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(In),t.getHSL(hh);const n=sc(In.h,hh.h,e),s=sc(In.s,hh.s,e),r=sc(In.l,hh.l,e);return this.setHSL(n,s,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Et.NAMES=Fp;Et.prototype.isColor=!0;Et.prototype.r=1;Et.prototype.g=1;Et.prototype.b=1;class Ac extends Ri{constructor(t){super();this.type="MeshBasicMaterial",this.color=new Et(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=qa,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Ac.prototype.isMeshBasicMaterial=!0;const Fe=new k,lh=new vt;class ui{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n===!0,this.usage=zo,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[t+s]=e.array[n+s];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let n=0;for(let s=0,r=t.length;s<r;s++){let a=t[s];a===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",s),a=new Et),e[n++]=a.r,e[n++]=a.g,e[n++]=a.b}return this}copyVector2sArray(t){const e=this.array;let n=0;for(let s=0,r=t.length;s<r;s++){let a=t[s];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",s),a=new vt),e[n++]=a.x,e[n++]=a.y}return this}copyVector3sArray(t){const e=this.array;let n=0;for(let s=0,r=t.length;s<r;s++){let a=t[s];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",s),a=new k),e[n++]=a.x,e[n++]=a.y,e[n++]=a.z}return this}copyVector4sArray(t){const e=this.array;let n=0;for(let s=0,r=t.length;s<r;s++){let a=t[s];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",s),a=new Pe),e[n++]=a.x,e[n++]=a.y,e[n++]=a.z,e[n++]=a.w}return this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)lh.fromBufferAttribute(this,e),lh.applyMatrix3(t),this.setXY(e,lh.x,lh.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)Fe.fromBufferAttribute(this,e),Fe.applyMatrix3(t),this.setXYZ(e,Fe.x,Fe.y,Fe.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Fe.x=this.getX(e),Fe.y=this.getY(e),Fe.z=this.getZ(e),Fe.applyMatrix4(t),this.setXYZ(e,Fe.x,Fe.y,Fe.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Fe.x=this.getX(e),Fe.y=this.getY(e),Fe.z=this.getZ(e),Fe.applyNormalMatrix(t),this.setXYZ(e,Fe.x,Fe.y,Fe.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Fe.x=this.getX(e),Fe.y=this.getY(e),Fe.z=this.getZ(e),Fe.transformDirection(t),this.setXYZ(e,Fe.x,Fe.y,Fe.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,s){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=s,this}setXYZW(t,e,n,s,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=s,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==zo&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}}ui.prototype.isBufferAttribute=!0;class Vp extends ui{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class Np extends ui{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class Jg extends ui{constructor(t,e,n){super(new Uint16Array(t),e,n)}}Jg.prototype.isFloat16BufferAttribute=!0;class vi extends ui{constructor(t,e,n){super(new Float32Array(t),e,n)}}let $g=0;const fn=new Rt,bc=new we,Or=new k,nn=new En,Oo=new En,yi=new k;class Ge extends er{constructor(){super();Object.defineProperty(this,"id",{value:$g++}),this.uuid=Gn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(wp(t)>65535?Np:Vp)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new Si().getNormalMatrix(t);n.applyNormalMatrix(r),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return fn.makeRotationFromQuaternion(t),this.applyMatrix4(fn),this}rotateX(t){return fn.makeRotationX(t),this.applyMatrix4(fn),this}rotateY(t){return fn.makeRotationY(t),this.applyMatrix4(fn),this}rotateZ(t){return fn.makeRotationZ(t),this.applyMatrix4(fn),this}translate(t,e,n){return fn.makeTranslation(t,e,n),this.applyMatrix4(fn),this}scale(t,e,n){return fn.makeScale(t,e,n),this.applyMatrix4(fn),this}lookAt(t){return bc.lookAt(t),bc.updateMatrix(),this.applyMatrix4(bc.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Or).negate(),this.translate(Or.x,Or.y,Or.z),this}setFromPoints(t){const e=[];for(let n=0,s=t.length;n<s;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new vi(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new En);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new k(-1/0,-1/0,-1/0),new k(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,s=e.length;n<s;n++){const r=e[n];nn.setFromBufferAttribute(r),this.morphTargetsRelative?(yi.addVectors(this.boundingBox.min,nn.min),this.boundingBox.expandByPoint(yi),yi.addVectors(this.boundingBox.max,nn.max),this.boundingBox.expandByPoint(yi)):(this.boundingBox.expandByPoint(nn.min),this.boundingBox.expandByPoint(nn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ir);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new k,1/0);return}if(t){const n=this.boundingSphere.center;if(nn.setFromBufferAttribute(t),e)for(let r=0,a=e.length;r<a;r++){const h=e[r];Oo.setFromBufferAttribute(h),this.morphTargetsRelative?(yi.addVectors(nn.min,Oo.min),nn.expandByPoint(yi),yi.addVectors(nn.max,Oo.max),nn.expandByPoint(yi)):(nn.expandByPoint(Oo.min),nn.expandByPoint(Oo.max))}nn.getCenter(n);let s=0;for(let r=0,a=t.count;r<a;r++)yi.fromBufferAttribute(t,r),s=Math.max(s,n.distanceToSquared(yi));if(e)for(let r=0,a=e.length;r<a;r++){const h=e[r],o=this.morphTargetsRelative;for(let l=0,u=h.count;l<u;l++)yi.fromBufferAttribute(h,l),o&&(Or.fromBufferAttribute(t,l),yi.add(Or)),s=Math.max(s,n.distanceToSquared(yi))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.array,s=e.position.array,r=e.normal.array,a=e.uv.array,h=s.length/3;e.tangent===void 0&&this.setAttribute("tangent",new ui(new Float32Array(4*h),4));const o=e.tangent.array,l=[],u=[];for(let E=0;E<h;E++)l[E]=new k,u[E]=new k;const m=new k,p=new k,c=new k,f=new vt,d=new vt,y=new vt,_=new k,v=new k;function g(E,T,w){m.fromArray(s,E*3),p.fromArray(s,T*3),c.fromArray(s,w*3),f.fromArray(a,E*2),d.fromArray(a,T*2),y.fromArray(a,w*2),p.sub(m),c.sub(m),d.sub(f),y.sub(f);const C=1/(d.x*y.y-y.x*d.y);!isFinite(C)||(_.copy(p).multiplyScalar(y.y).addScaledVector(c,-d.y).multiplyScalar(C),v.copy(c).multiplyScalar(d.x).addScaledVector(p,-y.x).multiplyScalar(C),l[E].add(_),l[T].add(_),l[w].add(_),u[E].add(v),u[T].add(v),u[w].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:n.length}]);for(let E=0,T=x.length;E<T;++E){const w=x[E],C=w.start,P=w.count;for(let R=C,L=C+P;R<L;R+=3)g(n[R+0],n[R+1],n[R+2])}const A=new k,b=new k,M=new k,S=new k;function B(E){M.fromArray(r,E*3),S.copy(M);const T=l[E];A.copy(T),A.sub(M.multiplyScalar(M.dot(T))).normalize(),b.crossVectors(S,T);const C=b.dot(u[E])<0?-1:1;o[E*4]=A.x,o[E*4+1]=A.y,o[E*4+2]=A.z,o[E*4+3]=C}for(let E=0,T=x.length;E<T;++E){const w=x[E],C=w.start,P=w.count;for(let R=C,L=C+P;R<L;R+=3)B(n[R+0]),B(n[R+1]),B(n[R+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new ui(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let p=0,c=n.count;p<c;p++)n.setXYZ(p,0,0,0);const s=new k,r=new k,a=new k,h=new k,o=new k,l=new k,u=new k,m=new k;if(t)for(let p=0,c=t.count;p<c;p+=3){const f=t.getX(p+0),d=t.getX(p+1),y=t.getX(p+2);s.fromBufferAttribute(e,f),r.fromBufferAttribute(e,d),a.fromBufferAttribute(e,y),u.subVectors(a,r),m.subVectors(s,r),u.cross(m),h.fromBufferAttribute(n,f),o.fromBufferAttribute(n,d),l.fromBufferAttribute(n,y),h.add(u),o.add(u),l.add(u),n.setXYZ(f,h.x,h.y,h.z),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(y,l.x,l.y,l.z)}else for(let p=0,c=e.count;p<c;p+=3)s.fromBufferAttribute(e,p+0),r.fromBufferAttribute(e,p+1),a.fromBufferAttribute(e,p+2),u.subVectors(a,r),m.subVectors(s,r),u.cross(m),n.setXYZ(p+0,u.x,u.y,u.z),n.setXYZ(p+1,u.x,u.y,u.z),n.setXYZ(p+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!(t&&t.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const s in n){if(t.attributes[s]===void 0)continue;const a=n[s].array,h=t.attributes[s],o=h.array,l=h.itemSize*e,u=Math.min(o.length,a.length-l);for(let m=0,p=l;m<u;m++,p++)a[p]=o[m]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)yi.fromBufferAttribute(t,e),yi.normalize(),t.setXYZ(e,yi.x,yi.y,yi.z)}toNonIndexed(){function t(h,o){const l=h.array,u=h.itemSize,m=h.normalized,p=new l.constructor(o.length*u);let c=0,f=0;for(let d=0,y=o.length;d<y;d++){h.isInterleavedBufferAttribute?c=o[d]*h.data.stride+h.offset:c=o[d]*u;for(let _=0;_<u;_++)p[f++]=l[c++]}return new ui(p,u,m)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Ge,n=this.index.array,s=this.attributes;for(const h in s){const o=s[h],l=t(o,n);e.setAttribute(h,l)}const r=this.morphAttributes;for(const h in r){const o=[],l=r[h];for(let u=0,m=l.length;u<m;u++){const p=l[u],c=t(p,n);o.push(c)}e.morphAttributes[h]=o}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let h=0,o=a.length;h<o;h++){const l=a[h];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const o=this.parameters;for(const l in o)o[l]!==void 0&&(t[l]=o[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const o in n){const l=n[o];t.data.attributes[o]=l.toJSON(t.data)}const s={};let r=!1;for(const o in this.morphAttributes){const l=this.morphAttributes[o],u=[];for(let m=0,p=l.length;m<p;m++){const c=l[m];u.push(c.toJSON(t.data))}u.length>0&&(s[o]=u,r=!0)}r&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const h=this.boundingSphere;return h!==null&&(t.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;n!==null&&this.setIndex(n.clone(e));const s=t.attributes;for(const l in s){const u=s[l];this.setAttribute(l,u.clone(e))}const r=t.morphAttributes;for(const l in r){const u=[],m=r[l];for(let p=0,c=m.length;p<c;p++)u.push(m[p].clone(e));this.morphAttributes[l]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,u=a.length;l<u;l++){const m=a[l];this.addGroup(m.start,m.count,m.materialIndex)}const h=t.boundingBox;h!==null&&(this.boundingBox=h.clone());const o=t.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Ge.prototype.isBufferGeometry=!0;const Op=new Rt,Ur=new Rr,Mc=new Ir,Ls=new k,Ps=new k,Is=new k,wc=new k,Sc=new k,Bc=new k,ch=new k,uh=new k,mh=new k,ph=new vt,fh=new vt,dh=new vt,Tc=new k,_h=new k;class $i extends we{constructor(t=new Ge,e=new Ac){super();this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const h=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[h]=r}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const n=this.geometry,s=this.material,r=this.matrixWorld;if(s===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),Mc.copy(n.boundingSphere),Mc.applyMatrix4(r),t.ray.intersectsSphere(Mc)===!1)||(Op.copy(r).invert(),Ur.copy(t.ray).applyMatrix4(Op),n.boundingBox!==null&&Ur.intersectsBox(n.boundingBox)===!1))return;let a;if(n.isBufferGeometry){const h=n.index,o=n.attributes.position,l=n.morphAttributes.position,u=n.morphTargetsRelative,m=n.attributes.uv,p=n.attributes.uv2,c=n.groups,f=n.drawRange;if(h!==null)if(Array.isArray(s))for(let d=0,y=c.length;d<y;d++){const _=c[d],v=s[_.materialIndex],g=Math.max(_.start,f.start),x=Math.min(h.count,Math.min(_.start+_.count,f.start+f.count));for(let A=g,b=x;A<b;A+=3){const M=h.getX(A),S=h.getX(A+1),B=h.getX(A+2);a=vh(this,v,t,Ur,o,l,u,m,p,M,S,B),a&&(a.faceIndex=Math.floor(A/3),a.face.materialIndex=_.materialIndex,e.push(a))}}else{const d=Math.max(0,f.start),y=Math.min(h.count,f.start+f.count);for(let _=d,v=y;_<v;_+=3){const g=h.getX(_),x=h.getX(_+1),A=h.getX(_+2);a=vh(this,s,t,Ur,o,l,u,m,p,g,x,A),a&&(a.faceIndex=Math.floor(_/3),e.push(a))}}else if(o!==void 0)if(Array.isArray(s))for(let d=0,y=c.length;d<y;d++){const _=c[d],v=s[_.materialIndex],g=Math.max(_.start,f.start),x=Math.min(o.count,Math.min(_.start+_.count,f.start+f.count));for(let A=g,b=x;A<b;A+=3){const M=A,S=A+1,B=A+2;a=vh(this,v,t,Ur,o,l,u,m,p,M,S,B),a&&(a.faceIndex=Math.floor(A/3),a.face.materialIndex=_.materialIndex,e.push(a))}}else{const d=Math.max(0,f.start),y=Math.min(o.count,f.start+f.count);for(let _=d,v=y;_<v;_+=3){const g=_,x=_+1,A=_+2;a=vh(this,s,t,Ur,o,l,u,m,p,g,x,A),a&&(a.faceIndex=Math.floor(_/3),e.push(a))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}$i.prototype.isMesh=!0;function Xg(i,t,e,n,s,r,a,h){let o;if(t.side===li?o=n.intersectTriangle(a,r,s,!0,h):o=n.intersectTriangle(s,r,a,t.side!==gr,h),o===null)return null;_h.copy(h),_h.applyMatrix4(i.matrixWorld);const l=e.ray.origin.distanceTo(_h);return l<e.near||l>e.far?null:{distance:l,point:_h.clone(),object:i}}function vh(i,t,e,n,s,r,a,h,o,l,u,m){Ls.fromBufferAttribute(s,l),Ps.fromBufferAttribute(s,u),Is.fromBufferAttribute(s,m);const p=i.morphTargetInfluences;if(r&&p){ch.set(0,0,0),uh.set(0,0,0),mh.set(0,0,0);for(let f=0,d=r.length;f<d;f++){const y=p[f],_=r[f];y!==0&&(wc.fromBufferAttribute(_,l),Sc.fromBufferAttribute(_,u),Bc.fromBufferAttribute(_,m),a?(ch.addScaledVector(wc,y),uh.addScaledVector(Sc,y),mh.addScaledVector(Bc,y)):(ch.addScaledVector(wc.sub(Ls),y),uh.addScaledVector(Sc.sub(Ps),y),mh.addScaledVector(Bc.sub(Is),y)))}Ls.add(ch),Ps.add(uh),Is.add(mh)}i.isSkinnedMesh&&(i.boneTransform(l,Ls),i.boneTransform(u,Ps),i.boneTransform(m,Is));const c=Xg(i,t,e,n,Ls,Ps,Is,Tc);if(c){h&&(ph.fromBufferAttribute(h,l),fh.fromBufferAttribute(h,u),dh.fromBufferAttribute(h,m),c.uv=ii.getUV(Tc,Ls,Ps,Is,ph,fh,dh,new vt)),o&&(ph.fromBufferAttribute(o,l),fh.fromBufferAttribute(o,u),dh.fromBufferAttribute(o,m),c.uv2=ii.getUV(Tc,Ls,Ps,Is,ph,fh,dh,new vt));const f={a:l,b:u,c:m,normal:new k,materialIndex:0};ii.getNormal(Ls,Ps,Is,f.normal),c.face=f}return c}class Uo extends Ge{constructor(t=1,e=1,n=1,s=1,r=1,a=1){super();this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:s,heightSegments:r,depthSegments:a};const h=this;s=Math.floor(s),r=Math.floor(r),a=Math.floor(a);const o=[],l=[],u=[],m=[];let p=0,c=0;f("z","y","x",-1,-1,n,e,t,a,r,0),f("z","y","x",1,-1,n,e,-t,a,r,1),f("x","z","y",1,1,t,n,e,s,a,2),f("x","z","y",1,-1,t,n,-e,s,a,3),f("x","y","z",1,-1,t,e,n,s,r,4),f("x","y","z",-1,-1,t,e,-n,s,r,5),this.setIndex(o),this.setAttribute("position",new vi(l,3)),this.setAttribute("normal",new vi(u,3)),this.setAttribute("uv",new vi(m,2));function f(d,y,_,v,g,x,A,b,M,S,B){const E=x/M,T=A/S,w=x/2,C=A/2,P=b/2,R=M+1,L=S+1;let I=0,z=0;const F=new k;for(let D=0;D<L;D++){const V=D*T-C;for(let G=0;G<R;G++){const Y=G*E-w;F[d]=Y*v,F[y]=V*g,F[_]=P,l.push(F.x,F.y,F.z),F[d]=0,F[y]=0,F[_]=b>0?1:-1,u.push(F.x,F.y,F.z),m.push(G/M),m.push(1-D/S),I+=1}}for(let D=0;D<S;D++)for(let V=0;V<M;V++){const G=p+V+R*D,Y=p+V+R*(D+1),J=p+(V+1)+R*(D+1),Q=p+(V+1)+R*D;o.push(G,Y,Q),o.push(Y,J,Q),z+=6}h.addGroup(c,z,B),c+=z,p+=I}}static fromJSON(t){return new Uo(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Hr(i){const t={};for(const e in i){t[e]={};for(const n in i[e]){const s=i[e][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?t[e][n]=s.clone():Array.isArray(s)?t[e][n]=s.slice():t[e][n]=s}}return t}function Di(i){const t={};for(let e=0;e<i.length;e++){const n=Hr(i[e]);for(const s in n)t[s]=n[s]}return t}const jg={clone:Hr,merge:Di};var Zg=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Kg=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class sr extends Ri{constructor(t){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Zg,this.fragmentShader=Kg,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&(t.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Hr(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?e.uniforms[s]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?e.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?e.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?e.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?e.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?e.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?e.uniforms[s]={type:"m4",value:a.toArray()}:e.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}sr.prototype.isShaderMaterial=!0;class Cc extends we{constructor(){super();this.type="Camera",this.matrixWorldInverse=new Rt,this.projectionMatrix=new Rt,this.projectionMatrixInverse=new Rt}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}Cc.prototype.isCamera=!0;class Xi extends Cc{constructor(t=50,e=1,n=.1,s=2e3){super();this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=nc*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(ic*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return nc*2*Math.atan(Math.tan(ic*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,s,r,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(ic*.5*this.fov)/this.zoom,n=2*e,s=this.aspect*n,r=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const o=a.fullWidth,l=a.fullHeight;r+=a.offsetX*s/o,e-=a.offsetY*n/l,s*=a.width/o,n*=a.height/l}const h=this.filmOffset;h!==0&&(r+=t*h/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}Xi.prototype.isPerspectiveCamera=!0;const Gr=90,kr=1;class Ec extends we{constructor(t,e,n){super();if(this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;const s=new Xi(Gr,kr,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new k(1,0,0)),this.add(s);const r=new Xi(Gr,kr,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new k(-1,0,0)),this.add(r);const a=new Xi(Gr,kr,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new k(0,1,0)),this.add(a);const h=new Xi(Gr,kr,t,e);h.layers=this.layers,h.up.set(0,0,-1),h.lookAt(new k(0,-1,0)),this.add(h);const o=new Xi(Gr,kr,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new k(0,0,1)),this.add(o);const l=new Xi(Gr,kr,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new k(0,0,-1)),this.add(l)}update(t,e){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[s,r,a,h,o,l]=this.children,u=t.xr.enabled,m=t.getRenderTarget();t.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,s),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,a),t.setRenderTarget(n,3),t.render(e,h),t.setRenderTarget(n,4),t.render(e,o),n.texture.generateMipmaps=p,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(m),t.xr.enabled=u}}class yh extends _i{constructor(t,e,n,s,r,a,h,o,l,u){t=t!==void 0?t:[],e=e!==void 0?e:Io;super(t,e,n,s,r,a,h,o,l,u);this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}yh.prototype.isCubeTexture=!0;class Up extends pn{constructor(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n);super(t,t,e);e=e||{},this.texture=new yh(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:Gi,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=di,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Uo(5,5,5),r=new sr({name:"CubemapFromEquirect",uniforms:Hr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:li,blending:Ms});r.uniforms.tEquirect.value=e;const a=new $i(s,r),h=e.minFilter;return e.minFilter===$a&&(e.minFilter=Gi),new Ec(1,10,this).update(t,a),e.minFilter=h,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,n,s){const r=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,n,s);t.setRenderTarget(r)}}Up.prototype.isWebGLCubeRenderTarget=!0;const Lc=new k,Qg=new k,tx=new Si;class as{constructor(t=new k(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,s){return this.normal.set(t,e,n),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const s=Lc.subVectors(n,e).cross(Qg.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(Lc),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:e.copy(n).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||tx.getNormalMatrix(t),s=this.coplanarPoint(Lc).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}as.prototype.isPlane=!0;const Wr=new Ir,gh=new k;class xh{constructor(t=new as,e=new as,n=new as,s=new as,r=new as,a=new as){this.planes=[t,e,n,s,r,a]}set(t,e,n,s,r,a){const h=this.planes;return h[0].copy(t),h[1].copy(e),h[2].copy(n),h[3].copy(s),h[4].copy(r),h[5].copy(a),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,s=n[0],r=n[1],a=n[2],h=n[3],o=n[4],l=n[5],u=n[6],m=n[7],p=n[8],c=n[9],f=n[10],d=n[11],y=n[12],_=n[13],v=n[14],g=n[15];return e[0].setComponents(h-s,m-o,d-p,g-y).normalize(),e[1].setComponents(h+s,m+o,d+p,g+y).normalize(),e[2].setComponents(h+r,m+l,d+c,g+_).normalize(),e[3].setComponents(h-r,m-l,d-c,g-_).normalize(),e[4].setComponents(h-a,m-u,d-f,g-v).normalize(),e[5].setComponents(h+a,m+u,d+f,g+v).normalize(),this}intersectsObject(t){const e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),Wr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Wr)}intersectsSprite(t){return Wr.center.set(0,0,0),Wr.radius=.7071067811865476,Wr.applyMatrix4(t.matrixWorld),this.intersectsSphere(Wr)}intersectsSphere(t){const e=this.planes,n=t.center,s=-t.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const s=e[n];if(gh.x=s.normal.x>0?t.max.x:t.min.x,gh.y=s.normal.y>0?t.max.y:t.min.y,gh.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(gh)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Hp(){let i=null,t=!1,e=null,n=null;function s(r,a){e(r,a),n=i.requestAnimationFrame(s)}return{start:function(){t!==!0&&e!==null&&(n=i.requestAnimationFrame(s),t=!0)},stop:function(){i.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(r){e=r},setContext:function(r){i=r}}}function ex(i,t){const e=t.isWebGL2,n=new WeakMap;function s(l,u){const m=l.array,p=l.usage,c=i.createBuffer();i.bindBuffer(u,c),i.bufferData(u,m,p),l.onUploadCallback();let f=5126;return m instanceof Float32Array?f=5126:m instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):m instanceof Uint16Array?l.isFloat16BufferAttribute?e?f=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):f=5123:m instanceof Int16Array?f=5122:m instanceof Uint32Array?f=5125:m instanceof Int32Array?f=5124:m instanceof Int8Array?f=5120:(m instanceof Uint8Array||m instanceof Uint8ClampedArray)&&(f=5121),{buffer:c,type:f,bytesPerElement:m.BYTES_PER_ELEMENT,version:l.version}}function r(l,u,m){const p=u.array,c=u.updateRange;i.bindBuffer(m,l),c.count===-1?i.bufferSubData(m,0,p):(e?i.bufferSubData(m,c.offset*p.BYTES_PER_ELEMENT,p,c.offset,c.count):i.bufferSubData(m,c.offset*p.BYTES_PER_ELEMENT,p.subarray(c.offset,c.offset+c.count)),c.count=-1)}function a(l){return l.isInterleavedBufferAttribute&&(l=l.data),n.get(l)}function h(l){l.isInterleavedBufferAttribute&&(l=l.data);const u=n.get(l);u&&(i.deleteBuffer(u.buffer),n.delete(l))}function o(l,u){if(l.isGLBufferAttribute){const p=n.get(l);(!p||p.version<l.version)&&n.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const m=n.get(l);m===void 0?n.set(l,s(l,u)):m.version<l.version&&(r(m.buffer,l,u),m.version=l.version)}return{get:a,remove:h,update:o}}class Pc extends Ge{constructor(t=1,e=1,n=1,s=1){super();this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:s};const r=t/2,a=e/2,h=Math.floor(n),o=Math.floor(s),l=h+1,u=o+1,m=t/h,p=e/o,c=[],f=[],d=[],y=[];for(let _=0;_<u;_++){const v=_*p-a;for(let g=0;g<l;g++){const x=g*m-r;f.push(x,-v,0),d.push(0,0,1),y.push(g/h),y.push(1-_/o)}}for(let _=0;_<o;_++)for(let v=0;v<h;v++){const g=v+l*_,x=v+l*(_+1),A=v+1+l*(_+1),b=v+1+l*_;c.push(g,x,b),c.push(x,A,b)}this.setIndex(c),this.setAttribute("position",new vi(f,3)),this.setAttribute("normal",new vi(d,3)),this.setAttribute("uv",new vi(y,2))}static fromJSON(t){return new Pc(t.width,t.height,t.widthSegments,t.heightSegments)}}var ix=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,nx=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,sx=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,rx=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,ox=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ax=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,hx="vec3 transformed = vec3( position );",lx=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,cx=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,ux=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,mx=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,px=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,fx=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,dx=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,_x=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,vx=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,yx=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,gx=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,xx=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Ax=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		return texture2D( envMap, uv ).rgb;
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,bx=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Mx=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,wx=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Sx=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Bx=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Tx="gl_FragColor = linearToOutputTexel( gl_FragColor );",Cx=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Ex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Lx=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Px=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Ix=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Rx=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Dx=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,zx=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Fx=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Vx=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Nx=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,Ox=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Ux=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Hx=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,Gx=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,kx=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Wx=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Yx=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,qx=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Jx=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,$x=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Xx=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,jx=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Zx=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Kx=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Qx=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,t0=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,e0=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,i0=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,n0=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,s0=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,r0=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,o0=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,a0=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,h0=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,l0=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,c0=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {
			float texelIndex = float( vertexIndex * stride + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV ).xyz;
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,u0=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			#ifndef USE_MORPHNORMALS
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];
			#else
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];
			#endif
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,m0=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,p0=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,f0=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,d0=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,_0=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,v0=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,y0=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,g0=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,x0=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,A0=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,b0=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,M0=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,w0=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,S0=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,B0=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,T0=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,C0=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,E0=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,L0=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,P0=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,I0=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,R0=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,D0=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,z0=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,F0=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,V0=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,N0=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,O0=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,U0=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,H0=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,G0=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,k0=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,W0=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Y0=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,q0=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,J0=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,$0=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,X0=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const j0=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Z0=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,K0=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Q0=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,tA=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,eA=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,iA=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,nA=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,sA=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,rA=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,oA=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,aA=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,hA=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,lA=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cA=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,uA=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mA=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,pA=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fA=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,dA=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,_A=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vA=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yA=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,gA=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xA=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,AA=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bA=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,MA=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,wA=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,SA=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,BA=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,TA=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ee={alphamap_fragment:ix,alphamap_pars_fragment:nx,alphatest_fragment:sx,alphatest_pars_fragment:rx,aomap_fragment:ox,aomap_pars_fragment:ax,begin_vertex:hx,beginnormal_vertex:lx,bsdfs:cx,bumpmap_pars_fragment:ux,clipping_planes_fragment:mx,clipping_planes_pars_fragment:px,clipping_planes_pars_vertex:fx,clipping_planes_vertex:dx,color_fragment:_x,color_pars_fragment:vx,color_pars_vertex:yx,color_vertex:gx,common:xx,cube_uv_reflection_fragment:Ax,defaultnormal_vertex:bx,displacementmap_pars_vertex:Mx,displacementmap_vertex:wx,emissivemap_fragment:Sx,emissivemap_pars_fragment:Bx,encodings_fragment:Tx,encodings_pars_fragment:Cx,envmap_fragment:Ex,envmap_common_pars_fragment:Lx,envmap_pars_fragment:Px,envmap_pars_vertex:Ix,envmap_physical_pars_fragment:kx,envmap_vertex:Rx,fog_vertex:Dx,fog_pars_vertex:zx,fog_fragment:Fx,fog_pars_fragment:Vx,gradientmap_pars_fragment:Nx,lightmap_fragment:Ox,lightmap_pars_fragment:Ux,lights_lambert_vertex:Hx,lights_pars_begin:Gx,lights_toon_fragment:Wx,lights_toon_pars_fragment:Yx,lights_phong_fragment:qx,lights_phong_pars_fragment:Jx,lights_physical_fragment:$x,lights_physical_pars_fragment:Xx,lights_fragment_begin:jx,lights_fragment_maps:Zx,lights_fragment_end:Kx,logdepthbuf_fragment:Qx,logdepthbuf_pars_fragment:t0,logdepthbuf_pars_vertex:e0,logdepthbuf_vertex:i0,map_fragment:n0,map_pars_fragment:s0,map_particle_fragment:r0,map_particle_pars_fragment:o0,metalnessmap_fragment:a0,metalnessmap_pars_fragment:h0,morphnormal_vertex:l0,morphtarget_pars_vertex:c0,morphtarget_vertex:u0,normal_fragment_begin:m0,normal_fragment_maps:p0,normal_pars_fragment:f0,normal_pars_vertex:d0,normal_vertex:_0,normalmap_pars_fragment:v0,clearcoat_normal_fragment_begin:y0,clearcoat_normal_fragment_maps:g0,clearcoat_pars_fragment:x0,output_fragment:A0,packing:b0,premultiplied_alpha_fragment:M0,project_vertex:w0,dithering_fragment:S0,dithering_pars_fragment:B0,roughnessmap_fragment:T0,roughnessmap_pars_fragment:C0,shadowmap_pars_fragment:E0,shadowmap_pars_vertex:L0,shadowmap_vertex:P0,shadowmask_pars_fragment:I0,skinbase_vertex:R0,skinning_pars_vertex:D0,skinning_vertex:z0,skinnormal_vertex:F0,specularmap_fragment:V0,specularmap_pars_fragment:N0,tonemapping_fragment:O0,tonemapping_pars_fragment:U0,transmission_fragment:H0,transmission_pars_fragment:G0,uv_pars_fragment:k0,uv_pars_vertex:W0,uv_vertex:Y0,uv2_pars_fragment:q0,uv2_pars_vertex:J0,uv2_vertex:$0,worldpos_vertex:X0,background_vert:j0,background_frag:Z0,cube_vert:K0,cube_frag:Q0,depth_vert:tA,depth_frag:eA,distanceRGBA_vert:iA,distanceRGBA_frag:nA,equirect_vert:sA,equirect_frag:rA,linedashed_vert:oA,linedashed_frag:aA,meshbasic_vert:hA,meshbasic_frag:lA,meshlambert_vert:cA,meshlambert_frag:uA,meshmatcap_vert:mA,meshmatcap_frag:pA,meshnormal_vert:fA,meshnormal_frag:dA,meshphong_vert:_A,meshphong_frag:vA,meshphysical_vert:yA,meshphysical_frag:gA,meshtoon_vert:xA,meshtoon_frag:AA,points_vert:bA,points_frag:MA,shadow_vert:wA,shadow_frag:SA,sprite_vert:BA,sprite_frag:TA},Mt={common:{diffuse:{value:new Et(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Si},uv2Transform:{value:new Si},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new vt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Et(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Et(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Si}},sprite:{diffuse:{value:new Et(16777215)},opacity:{value:1},center:{value:new vt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Si}}},kn={basic:{uniforms:Di([Mt.common,Mt.specularmap,Mt.envmap,Mt.aomap,Mt.lightmap,Mt.fog]),vertexShader:ee.meshbasic_vert,fragmentShader:ee.meshbasic_frag},lambert:{uniforms:Di([Mt.common,Mt.specularmap,Mt.envmap,Mt.aomap,Mt.lightmap,Mt.emissivemap,Mt.fog,Mt.lights,{emissive:{value:new Et(0)}}]),vertexShader:ee.meshlambert_vert,fragmentShader:ee.meshlambert_frag},phong:{uniforms:Di([Mt.common,Mt.specularmap,Mt.envmap,Mt.aomap,Mt.lightmap,Mt.emissivemap,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,Mt.fog,Mt.lights,{emissive:{value:new Et(0)},specular:{value:new Et(1118481)},shininess:{value:30}}]),vertexShader:ee.meshphong_vert,fragmentShader:ee.meshphong_frag},standard:{uniforms:Di([Mt.common,Mt.envmap,Mt.aomap,Mt.lightmap,Mt.emissivemap,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,Mt.roughnessmap,Mt.metalnessmap,Mt.fog,Mt.lights,{emissive:{value:new Et(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ee.meshphysical_vert,fragmentShader:ee.meshphysical_frag},toon:{uniforms:Di([Mt.common,Mt.aomap,Mt.lightmap,Mt.emissivemap,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,Mt.gradientmap,Mt.fog,Mt.lights,{emissive:{value:new Et(0)}}]),vertexShader:ee.meshtoon_vert,fragmentShader:ee.meshtoon_frag},matcap:{uniforms:Di([Mt.common,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,Mt.fog,{matcap:{value:null}}]),vertexShader:ee.meshmatcap_vert,fragmentShader:ee.meshmatcap_frag},points:{uniforms:Di([Mt.points,Mt.fog]),vertexShader:ee.points_vert,fragmentShader:ee.points_frag},dashed:{uniforms:Di([Mt.common,Mt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ee.linedashed_vert,fragmentShader:ee.linedashed_frag},depth:{uniforms:Di([Mt.common,Mt.displacementmap]),vertexShader:ee.depth_vert,fragmentShader:ee.depth_frag},normal:{uniforms:Di([Mt.common,Mt.bumpmap,Mt.normalmap,Mt.displacementmap,{opacity:{value:1}}]),vertexShader:ee.meshnormal_vert,fragmentShader:ee.meshnormal_frag},sprite:{uniforms:Di([Mt.sprite,Mt.fog]),vertexShader:ee.sprite_vert,fragmentShader:ee.sprite_frag},background:{uniforms:{uvTransform:{value:new Si},t2D:{value:null}},vertexShader:ee.background_vert,fragmentShader:ee.background_frag},cube:{uniforms:Di([Mt.envmap,{opacity:{value:1}}]),vertexShader:ee.cube_vert,fragmentShader:ee.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ee.equirect_vert,fragmentShader:ee.equirect_frag},distanceRGBA:{uniforms:Di([Mt.common,Mt.displacementmap,{referencePosition:{value:new k},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ee.distanceRGBA_vert,fragmentShader:ee.distanceRGBA_frag},shadow:{uniforms:Di([Mt.lights,Mt.fog,{color:{value:new Et(0)},opacity:{value:1}}]),vertexShader:ee.shadow_vert,fragmentShader:ee.shadow_frag}};kn.physical={uniforms:Di([kn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new vt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Et(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new vt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Et(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new Et(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ee.meshphysical_vert,fragmentShader:ee.meshphysical_frag};function CA(i,t,e,n,s){const r=new Et(0);let a=0,h,o,l=null,u=0,m=null;function p(f,d){let y=!1,_=d.isScene===!0?d.background:null;_&&_.isTexture&&(_=t.get(_));const v=i.xr,g=v.getSession&&v.getSession();g&&g.environmentBlendMode==="additive"&&(_=null),_===null?c(r,a):_&&_.isColor&&(c(_,1),y=!0),(i.autoClear||y)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),_&&(_.isCubeTexture||_.mapping===Ja)?(o===void 0&&(o=new $i(new Uo(1,1,1),new sr({name:"BackgroundCubeMaterial",uniforms:Hr(kn.cube.uniforms),vertexShader:kn.cube.vertexShader,fragmentShader:kn.cube.fragmentShader,side:li,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(x,A,b){this.matrixWorld.copyPosition(b.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(o)),o.material.uniforms.envMap.value=_,o.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,(l!==_||u!==_.version||m!==i.toneMapping)&&(o.material.needsUpdate=!0,l=_,u=_.version,m=i.toneMapping),f.unshift(o,o.geometry,o.material,0,0,null)):_&&_.isTexture&&(h===void 0&&(h=new $i(new Pc(2,2),new sr({name:"BackgroundMaterial",uniforms:Hr(kn.background.uniforms),vertexShader:kn.background.vertexShader,fragmentShader:kn.background.fragmentShader,side:Lo,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(h)),h.material.uniforms.t2D.value=_,_.matrixAutoUpdate===!0&&_.updateMatrix(),h.material.uniforms.uvTransform.value.copy(_.matrix),(l!==_||u!==_.version||m!==i.toneMapping)&&(h.material.needsUpdate=!0,l=_,u=_.version,m=i.toneMapping),f.unshift(h,h.geometry,h.material,0,0,null))}function c(f,d){e.buffers.color.setClear(f.r,f.g,f.b,d,s)}return{getClearColor:function(){return r},setClearColor:function(f,d=1){r.set(f),a=d,c(r,a)},getClearAlpha:function(){return a},setClearAlpha:function(f){a=f,c(r,a)},render:p}}function EA(i,t,e,n){const s=i.getParameter(34921),r=n.isWebGL2?null:t.get("OES_vertex_array_object"),a=n.isWebGL2||r!==null,h={},o=d(null);let l=o;function u(C,P,R,L,I){let z=!1;if(a){const F=f(L,R,P);l!==F&&(l=F,p(l.object)),z=y(L,I),z&&_(L,I)}else{const F=P.wireframe===!0;(l.geometry!==L.id||l.program!==R.id||l.wireframe!==F)&&(l.geometry=L.id,l.program=R.id,l.wireframe=F,z=!0)}C.isInstancedMesh===!0&&(z=!0),I!==null&&e.update(I,34963),z&&(M(C,P,R,L),I!==null&&i.bindBuffer(34963,e.get(I).buffer))}function m(){return n.isWebGL2?i.createVertexArray():r.createVertexArrayOES()}function p(C){return n.isWebGL2?i.bindVertexArray(C):r.bindVertexArrayOES(C)}function c(C){return n.isWebGL2?i.deleteVertexArray(C):r.deleteVertexArrayOES(C)}function f(C,P,R){const L=R.wireframe===!0;let I=h[C.id];I===void 0&&(I={},h[C.id]=I);let z=I[P.id];z===void 0&&(z={},I[P.id]=z);let F=z[L];return F===void 0&&(F=d(m()),z[L]=F),F}function d(C){const P=[],R=[],L=[];for(let I=0;I<s;I++)P[I]=0,R[I]=0,L[I]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:R,attributeDivisors:L,object:C,attributes:{},index:null}}function y(C,P){const R=l.attributes,L=C.attributes;let I=0;for(const z in L){const F=R[z],D=L[z];if(F===void 0||F.attribute!==D||F.data!==D.data)return!0;I++}return l.attributesNum!==I||l.index!==P}function _(C,P){const R={},L=C.attributes;let I=0;for(const z in L){const F=L[z],D={};D.attribute=F,F.data&&(D.data=F.data),R[z]=D,I++}l.attributes=R,l.attributesNum=I,l.index=P}function v(){const C=l.newAttributes;for(let P=0,R=C.length;P<R;P++)C[P]=0}function g(C){x(C,0)}function x(C,P){const R=l.newAttributes,L=l.enabledAttributes,I=l.attributeDivisors;R[C]=1,L[C]===0&&(i.enableVertexAttribArray(C),L[C]=1),I[C]!==P&&((n.isWebGL2?i:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](C,P),I[C]=P)}function A(){const C=l.newAttributes,P=l.enabledAttributes;for(let R=0,L=P.length;R<L;R++)P[R]!==C[R]&&(i.disableVertexAttribArray(R),P[R]=0)}function b(C,P,R,L,I,z){n.isWebGL2===!0&&(R===5124||R===5125)?i.vertexAttribIPointer(C,P,R,I,z):i.vertexAttribPointer(C,P,R,L,I,z)}function M(C,P,R,L){if(n.isWebGL2===!1&&(C.isInstancedMesh||L.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;v();const I=L.attributes,z=R.getAttributes(),F=P.defaultAttributeValues;for(const D in z){const V=z[D];if(V.location>=0){let G=I[D];if(G===void 0&&(D==="instanceMatrix"&&C.instanceMatrix&&(G=C.instanceMatrix),D==="instanceColor"&&C.instanceColor&&(G=C.instanceColor)),G!==void 0){const Y=G.normalized,J=G.itemSize,Q=e.get(G);if(Q===void 0)continue;const W=Q.buffer,et=Q.type,ct=Q.bytesPerElement;if(G.isInterleavedBufferAttribute){const Z=G.data,ot=Z.stride,xt=G.offset;if(Z&&Z.isInstancedInterleavedBuffer){for(let q=0;q<V.locationSize;q++)x(V.location+q,Z.meshPerAttribute);C.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=Z.meshPerAttribute*Z.count)}else for(let q=0;q<V.locationSize;q++)g(V.location+q);i.bindBuffer(34962,W);for(let q=0;q<V.locationSize;q++)b(V.location+q,J/V.locationSize,et,Y,ot*ct,(xt+J/V.locationSize*q)*ct)}else{if(G.isInstancedBufferAttribute){for(let Z=0;Z<V.locationSize;Z++)x(V.location+Z,G.meshPerAttribute);C.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=G.meshPerAttribute*G.count)}else for(let Z=0;Z<V.locationSize;Z++)g(V.location+Z);i.bindBuffer(34962,W);for(let Z=0;Z<V.locationSize;Z++)b(V.location+Z,J/V.locationSize,et,Y,J*ct,J/V.locationSize*Z*ct)}}else if(F!==void 0){const Y=F[D];if(Y!==void 0)switch(Y.length){case 2:i.vertexAttrib2fv(V.location,Y);break;case 3:i.vertexAttrib3fv(V.location,Y);break;case 4:i.vertexAttrib4fv(V.location,Y);break;default:i.vertexAttrib1fv(V.location,Y)}}}}A()}function S(){T();for(const C in h){const P=h[C];for(const R in P){const L=P[R];for(const I in L)c(L[I].object),delete L[I];delete P[R]}delete h[C]}}function B(C){if(h[C.id]===void 0)return;const P=h[C.id];for(const R in P){const L=P[R];for(const I in L)c(L[I].object),delete L[I];delete P[R]}delete h[C.id]}function E(C){for(const P in h){const R=h[P];if(R[C.id]===void 0)continue;const L=R[C.id];for(const I in L)c(L[I].object),delete L[I];delete R[C.id]}}function T(){w(),l!==o&&(l=o,p(l.object))}function w(){o.geometry=null,o.program=null,o.wireframe=!1}return{setup:u,reset:T,resetDefaultState:w,dispose:S,releaseStatesOfGeometry:B,releaseStatesOfProgram:E,initAttributes:v,enableAttribute:g,disableUnusedAttributes:A}}function LA(i,t,e,n){const s=n.isWebGL2;let r;function a(l){r=l}function h(l,u){i.drawArrays(r,l,u),e.update(u,r,1)}function o(l,u,m){if(m===0)return;let p,c;if(s)p=i,c="drawArraysInstanced";else if(p=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[c](r,l,u,m),e.update(u,r,m)}this.setMode=a,this.render=h,this.renderInstances=o}function PA(i,t,e){let n;function s(){if(n!==void 0)return n;if(t.has("EXT_texture_filter_anisotropic")===!0){const M=t.get("EXT_texture_filter_anisotropic");n=i.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(M){if(M==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";M="mediump"}return M==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext!="undefined"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&i instanceof WebGL2ComputeRenderingContext;let h=e.precision!==void 0?e.precision:"highp";const o=r(h);o!==h&&(console.warn("THREE.WebGLRenderer:",h,"not supported, using",o,"instead."),h=o);const l=a||t.has("WEBGL_draw_buffers"),u=e.logarithmicDepthBuffer===!0,m=i.getParameter(34930),p=i.getParameter(35660),c=i.getParameter(3379),f=i.getParameter(34076),d=i.getParameter(34921),y=i.getParameter(36347),_=i.getParameter(36348),v=i.getParameter(36349),g=p>0,x=a||t.has("OES_texture_float"),A=g&&x,b=a?i.getParameter(36183):0;return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:s,getMaxPrecision:r,precision:h,logarithmicDepthBuffer:u,maxTextures:m,maxVertexTextures:p,maxTextureSize:c,maxCubemapSize:f,maxAttributes:d,maxVertexUniforms:y,maxVaryings:_,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:x,floatVertexTextures:A,maxSamples:b}}function IA(i){const t=this;let e=null,n=0,s=!1,r=!1;const a=new as,h=new Si,o={value:null,needsUpdate:!1};this.uniform=o,this.numPlanes=0,this.numIntersection=0,this.init=function(m,p,c){const f=m.length!==0||p||n!==0||s;return s=p,e=u(m,c,0),n=m.length,f},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1,l()},this.setState=function(m,p,c){const f=m.clippingPlanes,d=m.clipIntersection,y=m.clipShadows,_=i.get(m);if(!s||f===null||f.length===0||r&&!y)r?u(null):l();else{const v=r?0:n,g=v*4;let x=_.clippingState||null;o.value=x,x=u(f,p,g,c);for(let A=0;A!==g;++A)x[A]=e[A];_.clippingState=x,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=v}};function l(){o.value!==e&&(o.value=e,o.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function u(m,p,c,f){const d=m!==null?m.length:0;let y=null;if(d!==0){if(y=o.value,f!==!0||y===null){const _=c+d*4,v=p.matrixWorldInverse;h.getNormalMatrix(v),(y===null||y.length<_)&&(y=new Float32Array(_));for(let g=0,x=c;g!==d;++g,x+=4)a.copy(m[g]).applyMatrix4(v,h),a.normal.toArray(y,x),y[x+3]=a.constant}o.value=y,o.needsUpdate=!0}return t.numPlanes=d,t.numIntersection=0,y}}function RA(i){let t=new WeakMap;function e(a,h){return h===$l?a.mapping=Io:h===Xl&&(a.mapping=Ro),a}function n(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){const h=a.mapping;if(h===$l||h===Xl)if(t.has(a)){const o=t.get(a).texture;return e(o,a.mapping)}else{const o=a.image;if(o&&o.height>0){const l=i.getRenderTarget(),u=new Up(o.height/2);return u.fromEquirectangularTexture(i,a),t.set(a,u),i.setRenderTarget(l),a.addEventListener("dispose",s),e(u.texture,a.mapping)}else return null}}return a}function s(a){const h=a.target;h.removeEventListener("dispose",s);const o=t.get(h);o!==void 0&&(t.delete(h),o.dispose())}function r(){t=new WeakMap}return{get:n,dispose:r}}class Ic extends Cc{constructor(t=-1,e=1,n=1,s=-1,r=.1,a=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,n,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=n-t,a=n+t,h=s+e,o=s-e;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,a=r+l*this.view.width,h-=u*this.view.offsetY,o=h-u*this.view.height}this.projectionMatrix.makeOrthographic(r,a,h,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}Ic.prototype.isOrthographicCamera=!0;class Ah extends sr{constructor(t){super(t);this.type="RawShaderMaterial"}}Ah.prototype.isRawShaderMaterial=!0;const Yr=4,Rs=8,Wn=Math.pow(2,Rs),Gp=[.125,.215,.35,.446,.526,.582],kp=Rs-Yr+1+Gp.length,qr=20,bh={[Cn]:0,[Sr]:1},Rc=new Ic,{_lodPlanes:Ho,_sizeLods:Wp,_sigmas:Mh}=zA(),Yp=new Et;let Dc=null;const rr=(1+Math.sqrt(5))/2,Jr=1/rr,qp=[new k(1,1,1),new k(-1,1,1),new k(1,1,-1),new k(-1,1,-1),new k(0,rr,Jr),new k(0,rr,-Jr),new k(Jr,0,rr),new k(-Jr,0,rr),new k(rr,Jr,0),new k(-rr,Jr,0)];class DA{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=FA(qr),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,s=100){Dc=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,n,s,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=Xp(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=$p(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let t=0;t<Ho.length;t++)Ho[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Dc),t.scissorTest=!1,wh(t,0,0,t.width,t.height)}_fromTexture(t){Dc=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:Gi,minFilter:Gi,generateMipmaps:!1,type:Ks,format:di,encoding:Cn,depthBuffer:!1},n=Jp(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Jp(e),n}_compileMaterial(t){const e=new $i(Ho[0],t);this._renderer.compile(e,Rc)}_sceneToCubeUV(t,e,n,s){const r=90,a=1,h=new Xi(r,a,e,n),o=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,m=u.autoClear,p=u.toneMapping;u.getClearColor(Yp),u.toneMapping=ws,u.autoClear=!1;const c=new Ac({name:"PMREM.Background",side:li,depthWrite:!1,depthTest:!1}),f=new $i(new Uo,c);let d=!1;const y=t.background;y?y.isColor&&(c.color.copy(y),t.background=null,d=!0):(c.color.copy(Yp),d=!0);for(let _=0;_<6;_++){const v=_%3;v==0?(h.up.set(0,o[_],0),h.lookAt(l[_],0,0)):v==1?(h.up.set(0,0,o[_]),h.lookAt(0,l[_],0)):(h.up.set(0,o[_],0),h.lookAt(0,0,l[_])),wh(s,v*Wn,_>2?Wn:0,Wn,Wn),u.setRenderTarget(s),d&&u.render(f,h),u.render(t,h)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=p,u.autoClear=m,t.background=y}_setEncoding(t,e){this._renderer.capabilities.isWebGL2===!0&&e.format===di&&e.type===es&&e.encoding===Sr?t.value=bh[Cn]:t.value=bh[e.encoding]}_textureToCubeUV(t,e){const n=this._renderer,s=t.mapping===Io||t.mapping===Ro;s?this._cubemapShader==null&&(this._cubemapShader=Xp()):this._equirectShader==null&&(this._equirectShader=$p());const r=s?this._cubemapShader:this._equirectShader,a=new $i(Ho[0],r),h=r.uniforms;h.envMap.value=t,s||h.texelSize.value.set(1/t.image.width,1/t.image.height),this._setEncoding(h.inputEncoding,t),wh(e,0,0,3*Wn,2*Wn),n.setRenderTarget(e),n.render(a,Rc)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let s=1;s<kp;s++){const r=Math.sqrt(Mh[s]*Mh[s]-Mh[s-1]*Mh[s-1]),a=qp[(s-1)%qp.length];this._blur(t,s-1,s,r,a)}e.autoClear=n}_blur(t,e,n,s,r){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,n,s,"latitudinal",r),this._halfBlur(a,t,n,n,s,"longitudinal",r)}_halfBlur(t,e,n,s,r,a,h){const o=this._renderer,l=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,m=new $i(Ho[s],l),p=l.uniforms,c=Wp[n]-1,f=isFinite(r)?Math.PI/(2*c):2*Math.PI/(2*qr-1),d=r/f,y=isFinite(r)?1+Math.floor(u*d):qr;y>qr&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${qr}`);const _=[];let v=0;for(let b=0;b<qr;++b){const M=b/d,S=Math.exp(-M*M/2);_.push(S),b==0?v+=S:b<y&&(v+=2*S)}for(let b=0;b<_.length;b++)_[b]=_[b]/v;p.envMap.value=t.texture,p.samples.value=y,p.weights.value=_,p.latitudinal.value=a==="latitudinal",h&&(p.poleAxis.value=h),p.dTheta.value=f,p.mipInt.value=Rs-n;const g=Wp[s],x=3*Math.max(0,Wn-2*g),A=(s===0?0:2*Wn)+2*g*(s>Rs-Yr?s-Rs+Yr:0);wh(e,x,A,3*g,2*g),o.setRenderTarget(e),o.render(m,Rc)}}function zA(){const i=[],t=[],e=[];let n=Rs;for(let s=0;s<kp;s++){const r=Math.pow(2,n);t.push(r);let a=1/r;s>Rs-Yr?a=Gp[s-Rs+Yr-1]:s==0&&(a=0),e.push(a);const h=1/(r-1),o=-h/2,l=1+h/2,u=[o,o,l,o,l,l,o,o,l,l,o,l],m=6,p=6,c=3,f=2,d=1,y=new Float32Array(c*p*m),_=new Float32Array(f*p*m),v=new Float32Array(d*p*m);for(let x=0;x<m;x++){const A=x%3*2/3-1,b=x>2?0:-1,M=[A,b,0,A+2/3,b,0,A+2/3,b+1,0,A,b,0,A+2/3,b+1,0,A,b+1,0];y.set(M,c*p*x),_.set(u,f*p*x);const S=[x,x,x,x,x,x];v.set(S,d*p*x)}const g=new Ge;g.setAttribute("position",new ui(y,c)),g.setAttribute("uv",new ui(_,f)),g.setAttribute("faceIndex",new ui(v,d)),i.push(g),n>Yr&&n--}return{_lodPlanes:i,_sizeLods:t,_sigmas:e}}function Jp(i){const t=new pn(3*Wn,3*Wn,i);return t.texture.mapping=Ja,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function wh(i,t,e,n,s){i.viewport.set(t,e,n,s),i.scissor.set(t,e,n,s)}function FA(i){const t=new Float32Array(i),e=new k(0,1,0);return new Ah({name:"SphericalGaussianBlur",defines:{n:i},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:e}},vertexShader:zc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${Fc()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ms,depthTest:!1,depthWrite:!1})}function $p(){const i=new vt(1,1);return new Ah({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:i},inputEncoding:{value:bh[Cn]}},vertexShader:zc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${Fc()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

			}
		`,blending:Ms,depthTest:!1,depthWrite:!1})}function Xp(){return new Ah({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:bh[Cn]}},vertexShader:zc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${Fc()}

			void main() {

				gl_FragColor = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) );

			}
		`,blending:Ms,depthTest:!1,depthWrite:!1})}function zc(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Fc(){return`

		uniform int inputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else {

				return sRGBToLinear( value );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function VA(i){let t=new WeakMap,e=null;function n(h){if(h&&h.isTexture&&h.isRenderTargetTexture===!1){const o=h.mapping,l=o===$l||o===Xl,u=o===Io||o===Ro;if(l||u){if(t.has(h))return t.get(h).texture;{const m=h.image;if(l&&m&&m.height>0||u&&m&&s(m)){const p=i.getRenderTarget();e===null&&(e=new DA(i));const c=l?e.fromEquirectangular(h):e.fromCubemap(h);return t.set(h,c),i.setRenderTarget(p),h.addEventListener("dispose",r),c.texture}else return null}}}return h}function s(h){let o=0;const l=6;for(let u=0;u<l;u++)h[u]!==void 0&&o++;return o===l}function r(h){const o=h.target;o.removeEventListener("dispose",r);const l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function a(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:n,dispose:a}}function NA(i){const t={};function e(n){if(t[n]!==void 0)return t[n];let s;switch(n){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(n)}return t[n]=s,s}return{has:function(n){return e(n)!==null},init:function(n){n.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(n){const s=e(n);return s===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function OA(i,t,e,n){const s={},r=new WeakMap;function a(m){const p=m.target;p.index!==null&&t.remove(p.index);for(const f in p.attributes)t.remove(p.attributes[f]);p.removeEventListener("dispose",a),delete s[p.id];const c=r.get(p);c&&(t.remove(c),r.delete(p)),n.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,e.memory.geometries--}function h(m,p){return s[p.id]===!0||(p.addEventListener("dispose",a),s[p.id]=!0,e.memory.geometries++),p}function o(m){const p=m.attributes;for(const f in p)t.update(p[f],34962);const c=m.morphAttributes;for(const f in c){const d=c[f];for(let y=0,_=d.length;y<_;y++)t.update(d[y],34962)}}function l(m){const p=[],c=m.index,f=m.attributes.position;let d=0;if(c!==null){const v=c.array;d=c.version;for(let g=0,x=v.length;g<x;g+=3){const A=v[g+0],b=v[g+1],M=v[g+2];p.push(A,b,b,M,M,A)}}else{const v=f.array;d=f.version;for(let g=0,x=v.length/3-1;g<x;g+=3){const A=g+0,b=g+1,M=g+2;p.push(A,b,b,M,M,A)}}const y=new(wp(p)>65535?Np:Vp)(p,1);y.version=d;const _=r.get(m);_&&t.remove(_),r.set(m,y)}function u(m){const p=r.get(m);if(p){const c=m.index;c!==null&&p.version<c.version&&l(m)}else l(m);return r.get(m)}return{get:h,update:o,getWireframeAttribute:u}}function UA(i,t,e,n){const s=n.isWebGL2;let r;function a(p){r=p}let h,o;function l(p){h=p.type,o=p.bytesPerElement}function u(p,c){i.drawElements(r,c,h,p*o),e.update(c,r,1)}function m(p,c,f){if(f===0)return;let d,y;if(s)d=i,y="drawElementsInstanced";else if(d=t.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",d===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[y](r,c,h,p*o,f),e.update(c,r,f)}this.setMode=a,this.setIndex=l,this.render=u,this.renderInstances=m}function HA(i){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,a,h){switch(e.calls++,a){case 4:e.triangles+=h*(r/3);break;case 1:e.lines+=h*(r/2);break;case 3:e.lines+=h*(r-1);break;case 2:e.lines+=h*r;break;case 0:e.points+=h*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function s(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:s,update:n}}class Vc extends _i{constructor(t=null,e=1,n=1,s=1){super(null);this.image={data:t,width:e,height:n,depth:s},this.magFilter=ci,this.minFilter=ci,this.wrapR=Qi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Vc.prototype.isDataTexture2DArray=!0;function GA(i,t){return i[0]-t[0]}function kA(i,t){return Math.abs(t[1])-Math.abs(i[1])}function jp(i,t){let e=1;const n=t.isInterleavedBufferAttribute?t.data.array:t.array;n instanceof Int8Array?e=127:n instanceof Int16Array?e=32767:n instanceof Int32Array?e=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),i.divideScalar(e)}function WA(i,t,e){const n={},s=new Float32Array(8),r=new WeakMap,a=new k,h=[];for(let l=0;l<8;l++)h[l]=[l,0];function o(l,u,m,p){const c=l.morphTargetInfluences;if(t.isWebGL2===!0){const f=u.morphAttributes.position.length;let d=r.get(u);if(d===void 0||d.count!==f){d!==void 0&&d.texture.dispose();const v=u.morphAttributes.normal!==void 0,g=u.morphAttributes.position,x=u.morphAttributes.normal||[],A=u.attributes.position.count,b=v===!0?2:1;let M=A*b,S=1;M>t.maxTextureSize&&(S=Math.ceil(M/t.maxTextureSize),M=t.maxTextureSize);const B=new Float32Array(M*S*4*f),E=new Vc(B,M,S,f);E.format=di,E.type=Ss,E.needsUpdate=!0;const T=b*4;for(let w=0;w<f;w++){const C=g[w],P=x[w],R=M*S*4*w;for(let L=0;L<C.count;L++){a.fromBufferAttribute(C,L),C.normalized===!0&&jp(a,C);const I=L*T;B[R+I+0]=a.x,B[R+I+1]=a.y,B[R+I+2]=a.z,B[R+I+3]=0,v===!0&&(a.fromBufferAttribute(P,L),P.normalized===!0&&jp(a,P),B[R+I+4]=a.x,B[R+I+5]=a.y,B[R+I+6]=a.z,B[R+I+7]=0)}}d={count:f,texture:E,size:new vt(M,S)},r.set(u,d)}let y=0;for(let v=0;v<c.length;v++)y+=c[v];const _=u.morphTargetsRelative?1:1-y;p.getUniforms().setValue(i,"morphTargetBaseInfluence",_),p.getUniforms().setValue(i,"morphTargetInfluences",c),p.getUniforms().setValue(i,"morphTargetsTexture",d.texture,e),p.getUniforms().setValue(i,"morphTargetsTextureSize",d.size)}else{const f=c===void 0?0:c.length;let d=n[u.id];if(d===void 0||d.length!==f){d=[];for(let x=0;x<f;x++)d[x]=[x,0];n[u.id]=d}for(let x=0;x<f;x++){const A=d[x];A[0]=x,A[1]=c[x]}d.sort(kA);for(let x=0;x<8;x++)x<f&&d[x][1]?(h[x][0]=d[x][0],h[x][1]=d[x][1]):(h[x][0]=Number.MAX_SAFE_INTEGER,h[x][1]=0);h.sort(GA);const y=u.morphAttributes.position,_=u.morphAttributes.normal;let v=0;for(let x=0;x<8;x++){const A=h[x],b=A[0],M=A[1];b!==Number.MAX_SAFE_INTEGER&&M?(y&&u.getAttribute("morphTarget"+x)!==y[b]&&u.setAttribute("morphTarget"+x,y[b]),_&&u.getAttribute("morphNormal"+x)!==_[b]&&u.setAttribute("morphNormal"+x,_[b]),s[x]=M,v+=M):(y&&u.hasAttribute("morphTarget"+x)===!0&&u.deleteAttribute("morphTarget"+x),_&&u.hasAttribute("morphNormal"+x)===!0&&u.deleteAttribute("morphNormal"+x),s[x]=0)}const g=u.morphTargetsRelative?1:1-v;p.getUniforms().setValue(i,"morphTargetBaseInfluence",g),p.getUniforms().setValue(i,"morphTargetInfluences",s)}}return{update:o}}function YA(i,t,e,n){let s=new WeakMap;function r(o){const l=n.render.frame,u=o.geometry,m=t.get(o,u);return s.get(m)!==l&&(t.update(m),s.set(m,l)),o.isInstancedMesh&&(o.hasEventListener("dispose",h)===!1&&o.addEventListener("dispose",h),e.update(o.instanceMatrix,34962),o.instanceColor!==null&&e.update(o.instanceColor,34962)),m}function a(){s=new WeakMap}function h(o){const l=o.target;l.removeEventListener("dispose",h),e.remove(l.instanceMatrix),l.instanceColor!==null&&e.remove(l.instanceColor)}return{update:r,dispose:a}}class Zp extends _i{constructor(t=null,e=1,n=1,s=1){super(null);this.image={data:t,width:e,height:n,depth:s},this.magFilter=ci,this.minFilter=ci,this.wrapR=Qi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Zp.prototype.isDataTexture3D=!0;const Kp=new _i,Qp=new Vc,tf=new Zp,ef=new yh,nf=[],sf=[],rf=new Float32Array(16),of=new Float32Array(9),af=new Float32Array(4);function $r(i,t,e){const n=i[0];if(n<=0||n>0)return i;const s=t*e;let r=nf[s];if(r===void 0&&(r=new Float32Array(s),nf[s]=r),t!==0){n.toArray(r,0);for(let a=1,h=0;a!==t;++a)h+=e,i[a].toArray(r,h)}return r}function ki(i,t){if(i.length!==t.length)return!1;for(let e=0,n=i.length;e<n;e++)if(i[e]!==t[e])return!1;return!0}function zi(i,t){for(let e=0,n=t.length;e<n;e++)i[e]=t[e]}function Sh(i,t){let e=sf[t];e===void 0&&(e=new Int32Array(t),sf[t]=e);for(let n=0;n!==t;++n)e[n]=i.allocateTextureUnit();return e}function qA(i,t){const e=this.cache;e[0]!==t&&(i.uniform1f(this.addr,t),e[0]=t)}function JA(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(i.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(ki(e,t))return;i.uniform2fv(this.addr,t),zi(e,t)}}function $A(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(i.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(i.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(ki(e,t))return;i.uniform3fv(this.addr,t),zi(e,t)}}function XA(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(i.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(ki(e,t))return;i.uniform4fv(this.addr,t),zi(e,t)}}function jA(i,t){const e=this.cache,n=t.elements;if(n===void 0){if(ki(e,t))return;i.uniformMatrix2fv(this.addr,!1,t),zi(e,t)}else{if(ki(e,n))return;af.set(n),i.uniformMatrix2fv(this.addr,!1,af),zi(e,n)}}function ZA(i,t){const e=this.cache,n=t.elements;if(n===void 0){if(ki(e,t))return;i.uniformMatrix3fv(this.addr,!1,t),zi(e,t)}else{if(ki(e,n))return;of.set(n),i.uniformMatrix3fv(this.addr,!1,of),zi(e,n)}}function KA(i,t){const e=this.cache,n=t.elements;if(n===void 0){if(ki(e,t))return;i.uniformMatrix4fv(this.addr,!1,t),zi(e,t)}else{if(ki(e,n))return;rf.set(n),i.uniformMatrix4fv(this.addr,!1,rf),zi(e,n)}}function QA(i,t){const e=this.cache;e[0]!==t&&(i.uniform1i(this.addr,t),e[0]=t)}function tb(i,t){const e=this.cache;ki(e,t)||(i.uniform2iv(this.addr,t),zi(e,t))}function eb(i,t){const e=this.cache;ki(e,t)||(i.uniform3iv(this.addr,t),zi(e,t))}function ib(i,t){const e=this.cache;ki(e,t)||(i.uniform4iv(this.addr,t),zi(e,t))}function nb(i,t){const e=this.cache;e[0]!==t&&(i.uniform1ui(this.addr,t),e[0]=t)}function sb(i,t){const e=this.cache;ki(e,t)||(i.uniform2uiv(this.addr,t),zi(e,t))}function rb(i,t){const e=this.cache;ki(e,t)||(i.uniform3uiv(this.addr,t),zi(e,t))}function ob(i,t){const e=this.cache;ki(e,t)||(i.uniform4uiv(this.addr,t),zi(e,t))}function ab(i,t,e){const n=this.cache,s=e.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),e.safeSetTexture2D(t||Kp,s)}function hb(i,t,e){const n=this.cache,s=e.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),e.setTexture3D(t||tf,s)}function lb(i,t,e){const n=this.cache,s=e.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),e.safeSetTextureCube(t||ef,s)}function cb(i,t,e){const n=this.cache,s=e.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),e.setTexture2DArray(t||Qp,s)}function ub(i){switch(i){case 5126:return qA;case 35664:return JA;case 35665:return $A;case 35666:return XA;case 35674:return jA;case 35675:return ZA;case 35676:return KA;case 5124:case 35670:return QA;case 35667:case 35671:return tb;case 35668:case 35672:return eb;case 35669:case 35673:return ib;case 5125:return nb;case 36294:return sb;case 36295:return rb;case 36296:return ob;case 35678:case 36198:case 36298:case 36306:case 35682:return ab;case 35679:case 36299:case 36307:return hb;case 35680:case 36300:case 36308:case 36293:return lb;case 36289:case 36303:case 36311:case 36292:return cb}}function mb(i,t){i.uniform1fv(this.addr,t)}function pb(i,t){const e=$r(t,this.size,2);i.uniform2fv(this.addr,e)}function fb(i,t){const e=$r(t,this.size,3);i.uniform3fv(this.addr,e)}function db(i,t){const e=$r(t,this.size,4);i.uniform4fv(this.addr,e)}function _b(i,t){const e=$r(t,this.size,4);i.uniformMatrix2fv(this.addr,!1,e)}function vb(i,t){const e=$r(t,this.size,9);i.uniformMatrix3fv(this.addr,!1,e)}function yb(i,t){const e=$r(t,this.size,16);i.uniformMatrix4fv(this.addr,!1,e)}function gb(i,t){i.uniform1iv(this.addr,t)}function xb(i,t){i.uniform2iv(this.addr,t)}function Ab(i,t){i.uniform3iv(this.addr,t)}function bb(i,t){i.uniform4iv(this.addr,t)}function Mb(i,t){i.uniform1uiv(this.addr,t)}function wb(i,t){i.uniform2uiv(this.addr,t)}function Sb(i,t){i.uniform3uiv(this.addr,t)}function Bb(i,t){i.uniform4uiv(this.addr,t)}function Tb(i,t,e){const n=t.length,s=Sh(e,n);i.uniform1iv(this.addr,s);for(let r=0;r!==n;++r)e.safeSetTexture2D(t[r]||Kp,s[r])}function Cb(i,t,e){const n=t.length,s=Sh(e,n);i.uniform1iv(this.addr,s);for(let r=0;r!==n;++r)e.setTexture3D(t[r]||tf,s[r])}function Eb(i,t,e){const n=t.length,s=Sh(e,n);i.uniform1iv(this.addr,s);for(let r=0;r!==n;++r)e.safeSetTextureCube(t[r]||ef,s[r])}function Lb(i,t,e){const n=t.length,s=Sh(e,n);i.uniform1iv(this.addr,s);for(let r=0;r!==n;++r)e.setTexture2DArray(t[r]||Qp,s[r])}function Pb(i){switch(i){case 5126:return mb;case 35664:return pb;case 35665:return fb;case 35666:return db;case 35674:return _b;case 35675:return vb;case 35676:return yb;case 5124:case 35670:return gb;case 35667:case 35671:return xb;case 35668:case 35672:return Ab;case 35669:case 35673:return bb;case 5125:return Mb;case 36294:return wb;case 36295:return Sb;case 36296:return Bb;case 35678:case 36198:case 36298:case 36306:case 35682:return Tb;case 35679:case 36299:case 36307:return Cb;case 35680:case 36300:case 36308:case 36293:return Eb;case 36289:case 36303:case 36311:case 36292:return Lb}}function Ib(i,t,e){this.id=i,this.addr=e,this.cache=[],this.setValue=ub(t.type)}function hf(i,t,e){this.id=i,this.addr=e,this.cache=[],this.size=t.size,this.setValue=Pb(t.type)}hf.prototype.updateCache=function(i){const t=this.cache;i instanceof Float32Array&&t.length!==i.length&&(this.cache=new Float32Array(i.length)),zi(t,i)};function lf(i){this.id=i,this.seq=[],this.map={}}lf.prototype.setValue=function(i,t,e){const n=this.seq;for(let s=0,r=n.length;s!==r;++s){const a=n[s];a.setValue(i,t[a.id],e)}};const Nc=/(\w+)(\])?(\[|\.)?/g;function cf(i,t){i.seq.push(t),i.map[t.id]=t}function Rb(i,t,e){const n=i.name,s=n.length;for(Nc.lastIndex=0;;){const r=Nc.exec(n),a=Nc.lastIndex;let h=r[1];const o=r[2]==="]",l=r[3];if(o&&(h=h|0),l===void 0||l==="["&&a+2===s){cf(e,l===void 0?new Ib(h,i,t):new hf(h,i,t));break}else{let m=e.map[h];m===void 0&&(m=new lf(h),cf(e,m)),e=m}}}function Ds(i,t){this.seq=[],this.map={};const e=i.getProgramParameter(t,35718);for(let n=0;n<e;++n){const s=i.getActiveUniform(t,n),r=i.getUniformLocation(t,s.name);Rb(s,r,this)}}Ds.prototype.setValue=function(i,t,e,n){const s=this.map[t];s!==void 0&&s.setValue(i,e,n)};Ds.prototype.setOptional=function(i,t,e){const n=t[e];n!==void 0&&this.setValue(i,e,n)};Ds.upload=function(i,t,e,n){for(let s=0,r=t.length;s!==r;++s){const a=t[s],h=e[a.id];h.needsUpdate!==!1&&a.setValue(i,h.value,n)}};Ds.seqWithValue=function(i,t){const e=[];for(let n=0,s=i.length;n!==s;++n){const r=i[n];r.id in t&&e.push(r)}return e};function uf(i,t,e){const n=i.createShader(t);return i.shaderSource(n,e),i.compileShader(n),n}let Db=0;function zb(i){const t=i.split(`
`);for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join(`
`)}function mf(i){switch(i){case Cn:return["Linear","( value )"];case Sr:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function pf(i,t,e){const n=i.getShaderParameter(t,35713),s=i.getShaderInfoLog(t).trim();return n&&s===""?"":e.toUpperCase()+`

`+s+`

`+zb(i.getShaderSource(t))}function or(i,t){const e=mf(t);return"vec4 "+i+"( vec4 value ) { return "+e[0]+"ToLinear"+e[1]+"; }"}function Fb(i,t){const e=mf(t);return"vec4 "+i+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function Vb(i,t){let e;switch(t){case Ly:e="Linear";break;case Py:e="Reinhard";break;case Iy:e="OptimizedCineon";break;case Ry:e="ACESFilmic";break;case Dy:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+i+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function Nb(i){return[i.extensionDerivatives||i.envMapCubeUV||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Go).join(`
`)}function Ob(i){const t=[];for(const e in i){const n=i[e];n!==!1&&t.push("#define "+e+" "+n)}return t.join(`
`)}function Ub(i,t){const e={},n=i.getProgramParameter(t,35721);for(let s=0;s<n;s++){const r=i.getActiveAttrib(t,s),a=r.name;let h=1;r.type===35674&&(h=2),r.type===35675&&(h=3),r.type===35676&&(h=4),e[a]={type:r.type,location:i.getAttribLocation(t,a),locationSize:h}}return e}function Go(i){return i!==""}function ff(i,t){return i.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function df(i,t){return i.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Hb=/^[ \t]*#include +<([\w\d./]+)>/gm;function Oc(i){return i.replace(Hb,Gb)}function Gb(i,t){const e=ee[t];if(e===void 0)throw new Error("Can not resolve #include <"+t+">");return Oc(e)}const kb=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Wb=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function _f(i){return i.replace(Wb,vf).replace(kb,Yb)}function Yb(i,t,e,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),vf(i,t,e,n)}function vf(i,t,e,n){let s="";for(let r=parseInt(t);r<parseInt(e);r++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function yf(i){let t="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?t+=`
#define HIGH_PRECISION`:i.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function qb(i){let t="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===Qm?t="SHADOWMAP_TYPE_PCF":i.shadowMapType===hy?t="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Eo&&(t="SHADOWMAP_TYPE_VSM"),t}function Jb(i){let t="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Io:case Ro:t="ENVMAP_TYPE_CUBE";break;case Ja:case jl:t="ENVMAP_TYPE_CUBE_UV";break}return t}function $b(i){let t="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Ro:case jl:t="ENVMAP_MODE_REFRACTION";break}return t}function Xb(i){let t="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case qa:t="ENVMAP_BLENDING_MULTIPLY";break;case Cy:t="ENVMAP_BLENDING_MIX";break;case Ey:t="ENVMAP_BLENDING_ADD";break}return t}function jb(i,t,e,n){const s=i.getContext(),r=e.defines;let a=e.vertexShader,h=e.fragmentShader;const o=qb(e),l=Jb(e),u=$b(e),m=Xb(e),p=e.isWebGL2?"":Nb(e),c=Ob(r),f=s.createProgram();let d,y,_=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(d=[c].filter(Go).join(`
`),d.length>0&&(d+=`
`),y=[p,c].filter(Go).join(`
`),y.length>0&&(y+=`
`)):(d=[yf(e),"#define SHADER_NAME "+e.shaderName,c,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+e.maxBones,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+u:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.useVertexTexture?"#define BONE_TEXTURE":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphTargets&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargets&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+o:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Go).join(`
`),y=[p,yf(e),"#define SHADER_NAME "+e.shaderName,c,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+l:"",e.envMap?"#define "+u:"",e.envMap?"#define "+m:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+o:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==ws?"#define TONE_MAPPING":"",e.toneMapping!==ws?ee.tonemapping_pars_fragment:"",e.toneMapping!==ws?Vb("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.format===Qs?"#define OPAQUE":"",ee.encodings_pars_fragment,e.map?or("mapTexelToLinear",e.mapEncoding):"",e.matcap?or("matcapTexelToLinear",e.matcapEncoding):"",e.envMap?or("envMapTexelToLinear",e.envMapEncoding):"",e.emissiveMap?or("emissiveMapTexelToLinear",e.emissiveMapEncoding):"",e.specularColorMap?or("specularColorMapTexelToLinear",e.specularColorMapEncoding):"",e.sheenColorMap?or("sheenColorMapTexelToLinear",e.sheenColorMapEncoding):"",e.lightMap?or("lightMapTexelToLinear",e.lightMapEncoding):"",Fb("linearToOutputTexel",e.outputEncoding),e.depthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(Go).join(`
`)),a=Oc(a),a=ff(a,e),a=df(a,e),h=Oc(h),h=ff(h,e),h=df(h,e),a=_f(a),h=_f(h),e.isWebGL2&&e.isRawShaderMaterial!==!0&&(_=`#version 300 es
`,d=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+d,y=["#define varying in",e.glslVersion===bp?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===bp?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const v=_+d+a,g=_+y+h,x=uf(s,35633,v),A=uf(s,35632,g);if(s.attachShader(f,x),s.attachShader(f,A),e.index0AttributeName!==void 0?s.bindAttribLocation(f,0,e.index0AttributeName):e.morphTargets===!0&&s.bindAttribLocation(f,0,"position"),s.linkProgram(f),i.debug.checkShaderErrors){const S=s.getProgramInfoLog(f).trim(),B=s.getShaderInfoLog(x).trim(),E=s.getShaderInfoLog(A).trim();let T=!0,w=!0;if(s.getProgramParameter(f,35714)===!1){T=!1;const C=pf(s,x,"vertex"),P=pf(s,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(f,35715)+`

Program Info Log: `+S+`
`+C+`
`+P)}else S!==""?console.warn("THREE.WebGLProgram: Program Info Log:",S):(B===""||E==="")&&(w=!1);w&&(this.diagnostics={runnable:T,programLog:S,vertexShader:{log:B,prefix:d},fragmentShader:{log:E,prefix:y}})}s.deleteShader(x),s.deleteShader(A);let b;this.getUniforms=function(){return b===void 0&&(b=new Ds(s,f)),b};let M;return this.getAttributes=function(){return M===void 0&&(M=Ub(s,f)),M},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(f),this.program=void 0},this.name=e.shaderName,this.id=Db++,this.cacheKey=t,this.usedTimes=1,this.program=f,this.vertexShader=x,this.fragmentShader=A,this}let Zb=0;class Kb{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,s=this._getShaderStage(e),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(t);return a.has(s)===!1&&(a.add(s),s.usedTimes++),a.has(r)===!1&&(a.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const n of e)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return e.has(t)===!1&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(e.has(t)===!1){const n=new Qb;e.set(t,n)}return e.get(t)}}class Qb{constructor(){this.id=Zb++,this.usedTimes=0}}function tM(i,t,e,n,s,r,a){const h=new Ep,o=new Kb,l=[],u=s.isWebGL2,m=s.logarithmicDepthBuffer,p=s.floatVertexTextures,c=s.maxVertexUniforms,f=s.vertexTextures;let d=s.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(w){const P=w.skeleton.bones;if(p)return 1024;{const L=Math.floor((c-20)/4),I=Math.min(L,P.length);return I<P.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+P.length+" bones. This GPU supports "+I+"."),0):I}}function v(w){let C;return w&&w.isTexture?C=w.encoding:w&&w.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),C=w.texture.encoding):C=Cn,u&&w&&w.isTexture&&w.format===di&&w.type===es&&w.encoding===Sr&&(C=Cn),C}function g(w,C,P,R,L){const I=R.fog,z=w.isMeshStandardMaterial?R.environment:null,F=(w.isMeshStandardMaterial?e:t).get(w.envMap||z),D=y[w.type],V=L.isSkinnedMesh?_(L):0;w.precision!==null&&(d=s.getMaxPrecision(w.precision),d!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",d,"instead."));let G,Y,J,Q;if(D){const ot=kn[D];G=ot.vertexShader,Y=ot.fragmentShader}else G=w.vertexShader,Y=w.fragmentShader,o.update(w),J=o.getVertexShaderID(w),Q=o.getFragmentShaderID(w);const W=i.getRenderTarget(),et=w.alphaTest>0,ct=w.clearcoat>0;return{isWebGL2:u,shaderID:D,shaderName:w.type,vertexShader:G,fragmentShader:Y,defines:w.defines,customVertexShaderID:J,customFragmentShaderID:Q,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:d,instancing:L.isInstancedMesh===!0,instancingColor:L.isInstancedMesh===!0&&L.instanceColor!==null,supportsVertexTextures:f,outputEncoding:W!==null?v(W.texture):i.outputEncoding,map:!!w.map,mapEncoding:v(w.map),matcap:!!w.matcap,matcapEncoding:v(w.matcap),envMap:!!F,envMapMode:F&&F.mapping,envMapEncoding:v(F),envMapCubeUV:!!F&&(F.mapping===Ja||F.mapping===jl),lightMap:!!w.lightMap,lightMapEncoding:v(w.lightMap),aoMap:!!w.aoMap,emissiveMap:!!w.emissiveMap,emissiveMapEncoding:v(w.emissiveMap),bumpMap:!!w.bumpMap,normalMap:!!w.normalMap,objectSpaceNormalMap:w.normalMapType===Rg,tangentSpaceNormalMap:w.normalMapType===Br,clearcoat:ct,clearcoatMap:ct&&!!w.clearcoatMap,clearcoatRoughnessMap:ct&&!!w.clearcoatRoughnessMap,clearcoatNormalMap:ct&&!!w.clearcoatNormalMap,displacementMap:!!w.displacementMap,roughnessMap:!!w.roughnessMap,metalnessMap:!!w.metalnessMap,specularMap:!!w.specularMap,specularIntensityMap:!!w.specularIntensityMap,specularColorMap:!!w.specularColorMap,specularColorMapEncoding:v(w.specularColorMap),alphaMap:!!w.alphaMap,alphaTest:et,gradientMap:!!w.gradientMap,sheen:w.sheen>0,sheenColorMap:!!w.sheenColorMap,sheenColorMapEncoding:v(w.sheenColorMap),sheenRoughnessMap:!!w.sheenRoughnessMap,transmission:w.transmission>0,transmissionMap:!!w.transmissionMap,thicknessMap:!!w.thicknessMap,combine:w.combine,vertexTangents:!!w.normalMap&&!!L.geometry&&!!L.geometry.attributes.tangent,vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!L.geometry&&!!L.geometry.attributes.color&&L.geometry.attributes.color.itemSize===4,vertexUvs:!!w.map||!!w.bumpMap||!!w.normalMap||!!w.specularMap||!!w.alphaMap||!!w.emissiveMap||!!w.roughnessMap||!!w.metalnessMap||!!w.clearcoatMap||!!w.clearcoatRoughnessMap||!!w.clearcoatNormalMap||!!w.displacementMap||!!w.transmissionMap||!!w.thicknessMap||!!w.specularIntensityMap||!!w.specularColorMap||!!w.sheenColorMap||!!w.sheenRoughnessMap,uvsVertexOnly:!(!!w.map||!!w.bumpMap||!!w.normalMap||!!w.specularMap||!!w.alphaMap||!!w.emissiveMap||!!w.roughnessMap||!!w.metalnessMap||!!w.clearcoatNormalMap||w.transmission>0||!!w.transmissionMap||!!w.thicknessMap||!!w.specularIntensityMap||!!w.specularColorMap||w.sheen>0||!!w.sheenColorMap||!!w.sheenRoughnessMap)&&!!w.displacementMap,fog:!!I,useFog:w.fog,fogExp2:I&&I.isFogExp2,flatShading:!!w.flatShading,sizeAttenuation:w.sizeAttenuation,logarithmicDepthBuffer:m,skinning:L.isSkinnedMesh===!0&&V>0,maxBones:V,useVertexTexture:p,morphTargets:!!L.geometry&&!!L.geometry.morphAttributes.position,morphNormals:!!L.geometry&&!!L.geometry.morphAttributes.normal,morphTargetsCount:!!L.geometry&&!!L.geometry.morphAttributes.position?L.geometry.morphAttributes.position.length:0,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,format:w.format,dithering:w.dithering,shadowMapEnabled:i.shadowMap.enabled&&P.length>0,shadowMapType:i.shadowMap.type,toneMapping:w.toneMapped?i.toneMapping:ws,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===gr,flipSided:w.side===li,depthPacking:w.depthPacking!==void 0?w.depthPacking:!1,index0AttributeName:w.index0AttributeName,extensionDerivatives:w.extensions&&w.extensions.derivatives,extensionFragDepth:w.extensions&&w.extensions.fragDepth,extensionDrawBuffers:w.extensions&&w.extensions.drawBuffers,extensionShaderTextureLOD:w.extensions&&w.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:w.customProgramCacheKey()}}function x(w){const C=[];if(w.shaderID?C.push(w.shaderID):(C.push(w.customVertexShaderID),C.push(w.customFragmentShaderID)),w.defines!==void 0)for(const P in w.defines)C.push(P),C.push(w.defines[P]);return w.isRawShaderMaterial===!1&&(A(C,w),b(C,w),C.push(i.outputEncoding)),C.push(w.customProgramCacheKey),C.join()}function A(w,C){w.push(C.precision),w.push(C.outputEncoding),w.push(C.mapEncoding),w.push(C.matcapEncoding),w.push(C.envMapMode),w.push(C.envMapEncoding),w.push(C.lightMapEncoding),w.push(C.emissiveMapEncoding),w.push(C.combine),w.push(C.vertexUvs),w.push(C.fogExp2),w.push(C.sizeAttenuation),w.push(C.maxBones),w.push(C.morphTargetsCount),w.push(C.numDirLights),w.push(C.numPointLights),w.push(C.numSpotLights),w.push(C.numHemiLights),w.push(C.numRectAreaLights),w.push(C.numDirLightShadows),w.push(C.numPointLightShadows),w.push(C.numSpotLightShadows),w.push(C.shadowMapType),w.push(C.toneMapping),w.push(C.numClippingPlanes),w.push(C.numClipIntersection),w.push(C.format),w.push(C.specularColorMapEncoding),w.push(C.sheenColorMapEncoding)}function b(w,C){h.disableAll(),C.isWebGL2&&h.enable(0),C.supportsVertexTextures&&h.enable(1),C.instancing&&h.enable(2),C.instancingColor&&h.enable(3),C.map&&h.enable(4),C.matcap&&h.enable(5),C.envMap&&h.enable(6),C.envMapCubeUV&&h.enable(7),C.lightMap&&h.enable(8),C.aoMap&&h.enable(9),C.emissiveMap&&h.enable(10),C.bumpMap&&h.enable(11),C.normalMap&&h.enable(12),C.objectSpaceNormalMap&&h.enable(13),C.tangentSpaceNormalMap&&h.enable(14),C.clearcoat&&h.enable(15),C.clearcoatMap&&h.enable(16),C.clearcoatRoughnessMap&&h.enable(17),C.clearcoatNormalMap&&h.enable(18),C.displacementMap&&h.enable(19),C.specularMap&&h.enable(20),C.roughnessMap&&h.enable(21),C.metalnessMap&&h.enable(22),C.gradientMap&&h.enable(23),C.alphaMap&&h.enable(24),C.alphaTest&&h.enable(25),C.vertexColors&&h.enable(26),C.vertexAlphas&&h.enable(27),C.vertexUvs&&h.enable(28),C.vertexTangents&&h.enable(29),C.uvsVertexOnly&&h.enable(30),C.fog&&h.enable(31),w.push(h.mask),h.disableAll(),C.useFog&&h.enable(0),C.flatShading&&h.enable(1),C.logarithmicDepthBuffer&&h.enable(2),C.skinning&&h.enable(3),C.useVertexTexture&&h.enable(4),C.morphTargets&&h.enable(5),C.morphNormals&&h.enable(6),C.premultipliedAlpha&&h.enable(7),C.shadowMapEnabled&&h.enable(8),C.physicallyCorrectLights&&h.enable(9),C.doubleSided&&h.enable(10),C.flipSided&&h.enable(11),C.depthPacking&&h.enable(12),C.dithering&&h.enable(13),C.specularIntensityMap&&h.enable(14),C.specularColorMap&&h.enable(15),C.transmission&&h.enable(16),C.transmissionMap&&h.enable(17),C.thicknessMap&&h.enable(18),C.sheen&&h.enable(19),C.sheenColorMap&&h.enable(20),C.sheenRoughnessMap&&h.enable(21),w.push(h.mask)}function M(w){const C=y[w.type];let P;if(C){const R=kn[C];P=jg.clone(R.uniforms)}else P=w.uniforms;return P}function S(w,C){let P;for(let R=0,L=l.length;R<L;R++){const I=l[R];if(I.cacheKey===C){P=I,++P.usedTimes;break}}return P===void 0&&(P=new jb(i,C,w,r),l.push(P)),P}function B(w){if(--w.usedTimes==0){const C=l.indexOf(w);l[C]=l[l.length-1],l.pop(),w.destroy()}}function E(w){o.remove(w)}function T(){o.dispose()}return{getParameters:g,getProgramCacheKey:x,getUniforms:M,acquireProgram:S,releaseProgram:B,releaseShaderCache:E,programs:l,dispose:T}}function eM(){let i=new WeakMap;function t(r){let a=i.get(r);return a===void 0&&(a={},i.set(r,a)),a}function e(r){i.delete(r)}function n(r,a,h){i.get(r)[a]=h}function s(){i=new WeakMap}return{get:t,remove:e,update:n,dispose:s}}function iM(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.material.id!==t.material.id?i.material.id-t.material.id:i.z!==t.z?i.z-t.z:i.id-t.id}function gf(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.z!==t.z?t.z-i.z:i.id-t.id}function xf(){const i=[];let t=0;const e=[],n=[],s=[];function r(){t=0,e.length=0,n.length=0,s.length=0}function a(m,p,c,f,d,y){let _=i[t];return _===void 0?(_={id:m.id,object:m,geometry:p,material:c,groupOrder:f,renderOrder:m.renderOrder,z:d,group:y},i[t]=_):(_.id=m.id,_.object=m,_.geometry=p,_.material=c,_.groupOrder=f,_.renderOrder=m.renderOrder,_.z=d,_.group=y),t++,_}function h(m,p,c,f,d,y){const _=a(m,p,c,f,d,y);c.transmission>0?n.push(_):c.transparent===!0?s.push(_):e.push(_)}function o(m,p,c,f,d,y){const _=a(m,p,c,f,d,y);c.transmission>0?n.unshift(_):c.transparent===!0?s.unshift(_):e.unshift(_)}function l(m,p){e.length>1&&e.sort(m||iM),n.length>1&&n.sort(p||gf),s.length>1&&s.sort(p||gf)}function u(){for(let m=t,p=i.length;m<p;m++){const c=i[m];if(c.id===null)break;c.id=null,c.object=null,c.geometry=null,c.material=null,c.group=null}}return{opaque:e,transmissive:n,transparent:s,init:r,push:h,unshift:o,finish:u,sort:l}}function nM(){let i=new WeakMap;function t(n,s){let r;return i.has(n)===!1?(r=new xf,i.set(n,[r])):s>=i.get(n).length?(r=new xf,i.get(n).push(r)):r=i.get(n)[s],r}function e(){i=new WeakMap}return{get:t,dispose:e}}function sM(){const i={};return{get:function(t){if(i[t.id]!==void 0)return i[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new k,color:new Et};break;case"SpotLight":e={position:new k,direction:new k,color:new Et,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new k,color:new Et,distance:0,decay:0};break;case"HemisphereLight":e={direction:new k,skyColor:new Et,groundColor:new Et};break;case"RectAreaLight":e={color:new Et,position:new k,halfWidth:new k,halfHeight:new k};break}return i[t.id]=e,e}}}function rM(){const i={};return{get:function(t){if(i[t.id]!==void 0)return i[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new vt};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new vt};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new vt,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[t.id]=e,e}}}let oM=0;function aM(i,t){return(t.castShadow?1:0)-(i.castShadow?1:0)}function hM(i,t){const e=new sM,n=rM(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)s.probe.push(new k);const r=new k,a=new Rt,h=new Rt;function o(u,m){let p=0,c=0,f=0;for(let B=0;B<9;B++)s.probe[B].set(0,0,0);let d=0,y=0,_=0,v=0,g=0,x=0,A=0,b=0;u.sort(aM);const M=m!==!0?Math.PI:1;for(let B=0,E=u.length;B<E;B++){const T=u[B],w=T.color,C=T.intensity,P=T.distance,R=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)p+=w.r*C*M,c+=w.g*C*M,f+=w.b*C*M;else if(T.isLightProbe)for(let L=0;L<9;L++)s.probe[L].addScaledVector(T.sh.coefficients[L],C);else if(T.isDirectionalLight){const L=e.get(T);if(L.color.copy(T.color).multiplyScalar(T.intensity*M),T.castShadow){const I=T.shadow,z=n.get(T);z.shadowBias=I.bias,z.shadowNormalBias=I.normalBias,z.shadowRadius=I.radius,z.shadowMapSize=I.mapSize,s.directionalShadow[d]=z,s.directionalShadowMap[d]=R,s.directionalShadowMatrix[d]=T.shadow.matrix,x++}s.directional[d]=L,d++}else if(T.isSpotLight){const L=e.get(T);if(L.position.setFromMatrixPosition(T.matrixWorld),L.color.copy(w).multiplyScalar(C*M),L.distance=P,L.coneCos=Math.cos(T.angle),L.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),L.decay=T.decay,T.castShadow){const I=T.shadow,z=n.get(T);z.shadowBias=I.bias,z.shadowNormalBias=I.normalBias,z.shadowRadius=I.radius,z.shadowMapSize=I.mapSize,s.spotShadow[_]=z,s.spotShadowMap[_]=R,s.spotShadowMatrix[_]=T.shadow.matrix,b++}s.spot[_]=L,_++}else if(T.isRectAreaLight){const L=e.get(T);L.color.copy(w).multiplyScalar(C),L.halfWidth.set(T.width*.5,0,0),L.halfHeight.set(0,T.height*.5,0),s.rectArea[v]=L,v++}else if(T.isPointLight){const L=e.get(T);if(L.color.copy(T.color).multiplyScalar(T.intensity*M),L.distance=T.distance,L.decay=T.decay,T.castShadow){const I=T.shadow,z=n.get(T);z.shadowBias=I.bias,z.shadowNormalBias=I.normalBias,z.shadowRadius=I.radius,z.shadowMapSize=I.mapSize,z.shadowCameraNear=I.camera.near,z.shadowCameraFar=I.camera.far,s.pointShadow[y]=z,s.pointShadowMap[y]=R,s.pointShadowMatrix[y]=T.shadow.matrix,A++}s.point[y]=L,y++}else if(T.isHemisphereLight){const L=e.get(T);L.skyColor.copy(T.color).multiplyScalar(C*M),L.groundColor.copy(T.groundColor).multiplyScalar(C*M),s.hemi[g]=L,g++}}v>0&&(t.isWebGL2||i.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Mt.LTC_FLOAT_1,s.rectAreaLTC2=Mt.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=Mt.LTC_HALF_1,s.rectAreaLTC2=Mt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=p,s.ambient[1]=c,s.ambient[2]=f;const S=s.hash;(S.directionalLength!==d||S.pointLength!==y||S.spotLength!==_||S.rectAreaLength!==v||S.hemiLength!==g||S.numDirectionalShadows!==x||S.numPointShadows!==A||S.numSpotShadows!==b)&&(s.directional.length=d,s.spot.length=_,s.rectArea.length=v,s.point.length=y,s.hemi.length=g,s.directionalShadow.length=x,s.directionalShadowMap.length=x,s.pointShadow.length=A,s.pointShadowMap.length=A,s.spotShadow.length=b,s.spotShadowMap.length=b,s.directionalShadowMatrix.length=x,s.pointShadowMatrix.length=A,s.spotShadowMatrix.length=b,S.directionalLength=d,S.pointLength=y,S.spotLength=_,S.rectAreaLength=v,S.hemiLength=g,S.numDirectionalShadows=x,S.numPointShadows=A,S.numSpotShadows=b,s.version=oM++)}function l(u,m){let p=0,c=0,f=0,d=0,y=0;const _=m.matrixWorldInverse;for(let v=0,g=u.length;v<g;v++){const x=u[v];if(x.isDirectionalLight){const A=s.directional[p];A.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(_),p++}else if(x.isSpotLight){const A=s.spot[f];A.position.setFromMatrixPosition(x.matrixWorld),A.position.applyMatrix4(_),A.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(_),f++}else if(x.isRectAreaLight){const A=s.rectArea[d];A.position.setFromMatrixPosition(x.matrixWorld),A.position.applyMatrix4(_),h.identity(),a.copy(x.matrixWorld),a.premultiply(_),h.extractRotation(a),A.halfWidth.set(x.width*.5,0,0),A.halfHeight.set(0,x.height*.5,0),A.halfWidth.applyMatrix4(h),A.halfHeight.applyMatrix4(h),d++}else if(x.isPointLight){const A=s.point[c];A.position.setFromMatrixPosition(x.matrixWorld),A.position.applyMatrix4(_),c++}else if(x.isHemisphereLight){const A=s.hemi[y];A.direction.setFromMatrixPosition(x.matrixWorld),A.direction.transformDirection(_),A.direction.normalize(),y++}}}return{setup:o,setupView:l,state:s}}function Af(i,t){const e=new hM(i,t),n=[],s=[];function r(){n.length=0,s.length=0}function a(m){n.push(m)}function h(m){s.push(m)}function o(m){e.setup(n,m)}function l(m){e.setupView(n,m)}return{init:r,state:{lightsArray:n,shadowsArray:s,lights:e},setupLights:o,setupLightsView:l,pushLight:a,pushShadow:h}}function lM(i,t){let e=new WeakMap;function n(r,a=0){let h;return e.has(r)===!1?(h=new Af(i,t),e.set(r,[h])):a>=e.get(r).length?(h=new Af(i,t),e.get(r).push(h)):h=e.get(r)[a],h}function s(){e=new WeakMap}return{get:n,dispose:s}}class bf extends Ri{constructor(t){super();this.type="MeshDepthMaterial",this.depthPacking=Pg,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}bf.prototype.isMeshDepthMaterial=!0;class Mf extends Ri{constructor(t){super();this.type="MeshDistanceMaterial",this.referencePosition=new k,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}Mf.prototype.isMeshDistanceMaterial=!0;const cM=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,uM=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function wf(i,t,e){let n=new xh;const s=new vt,r=new vt,a=new Pe,h=new bf({depthPacking:Ig}),o=new Mf,l={},u=e.maxTextureSize,m={0:li,1:Lo,2:gr},p=new sr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new vt},radius:{value:4}},vertexShader:cM,fragmentShader:uM}),c=p.clone();c.defines.HORIZONTAL_PASS=1;const f=new Ge;f.setAttribute("position",new ui(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const d=new $i(f,p),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Qm,this.render=function(x,A,b){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||x.length===0)return;const M=i.getRenderTarget(),S=i.getActiveCubeFace(),B=i.getActiveMipmapLevel(),E=i.state;E.setBlending(Ms),E.buffers.color.setClear(1,1,1,1),E.buffers.depth.setTest(!0),E.setScissorTest(!1);for(let T=0,w=x.length;T<w;T++){const C=x[T],P=C.shadow;if(P===void 0){console.warn("THREE.WebGLShadowMap:",C,"has no shadow.");continue}if(P.autoUpdate===!1&&P.needsUpdate===!1)continue;s.copy(P.mapSize);const R=P.getFrameExtents();if(s.multiply(R),r.copy(P.mapSize),(s.x>u||s.y>u)&&(s.x>u&&(r.x=Math.floor(u/R.x),s.x=r.x*R.x,P.mapSize.x=r.x),s.y>u&&(r.y=Math.floor(u/R.y),s.y=r.y*R.y,P.mapSize.y=r.y)),P.map===null&&!P.isPointLightShadow&&this.type===Eo){const I={minFilter:Gi,magFilter:Gi,format:di};P.map=new pn(s.x,s.y,I),P.map.texture.name=C.name+".shadowMap",P.mapPass=new pn(s.x,s.y,I),P.camera.updateProjectionMatrix()}if(P.map===null){const I={minFilter:ci,magFilter:ci,format:di};P.map=new pn(s.x,s.y,I),P.map.texture.name=C.name+".shadowMap",P.camera.updateProjectionMatrix()}i.setRenderTarget(P.map),i.clear();const L=P.getViewportCount();for(let I=0;I<L;I++){const z=P.getViewport(I);a.set(r.x*z.x,r.y*z.y,r.x*z.z,r.y*z.w),E.viewport(a),P.updateMatrices(C,I),n=P.getFrustum(),g(A,b,P.camera,C,this.type)}!P.isPointLightShadow&&this.type===Eo&&_(P,b),P.needsUpdate=!1}y.needsUpdate=!1,i.setRenderTarget(M,S,B)};function _(x,A){const b=t.update(d);p.defines.VSM_SAMPLES!==x.blurSamples&&(p.defines.VSM_SAMPLES=x.blurSamples,c.defines.VSM_SAMPLES=x.blurSamples,p.needsUpdate=!0,c.needsUpdate=!0),p.uniforms.shadow_pass.value=x.map.texture,p.uniforms.resolution.value=x.mapSize,p.uniforms.radius.value=x.radius,i.setRenderTarget(x.mapPass),i.clear(),i.renderBufferDirect(A,null,b,p,d,null),c.uniforms.shadow_pass.value=x.mapPass.texture,c.uniforms.resolution.value=x.mapSize,c.uniforms.radius.value=x.radius,i.setRenderTarget(x.map),i.clear(),i.renderBufferDirect(A,null,b,c,d,null)}function v(x,A,b,M,S,B,E){let T=null;const w=M.isPointLight===!0?x.customDistanceMaterial:x.customDepthMaterial;if(w!==void 0?T=w:T=M.isPointLight===!0?o:h,i.localClippingEnabled&&b.clipShadows===!0&&b.clippingPlanes.length!==0||b.displacementMap&&b.displacementScale!==0||b.alphaMap&&b.alphaTest>0){const C=T.uuid,P=b.uuid;let R=l[C];R===void 0&&(R={},l[C]=R);let L=R[P];L===void 0&&(L=T.clone(),R[P]=L),T=L}return T.visible=b.visible,T.wireframe=b.wireframe,E===Eo?T.side=b.shadowSide!==null?b.shadowSide:b.side:T.side=b.shadowSide!==null?b.shadowSide:m[b.side],T.alphaMap=b.alphaMap,T.alphaTest=b.alphaTest,T.clipShadows=b.clipShadows,T.clippingPlanes=b.clippingPlanes,T.clipIntersection=b.clipIntersection,T.displacementMap=b.displacementMap,T.displacementScale=b.displacementScale,T.displacementBias=b.displacementBias,T.wireframeLinewidth=b.wireframeLinewidth,T.linewidth=b.linewidth,M.isPointLight===!0&&T.isMeshDistanceMaterial===!0&&(T.referencePosition.setFromMatrixPosition(M.matrixWorld),T.nearDistance=S,T.farDistance=B),T}function g(x,A,b,M,S){if(x.visible===!1)return;if(x.layers.test(A.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&S===Eo)&&(!x.frustumCulled||n.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,x.matrixWorld);const T=t.update(x),w=x.material;if(Array.isArray(w)){const C=T.groups;for(let P=0,R=C.length;P<R;P++){const L=C[P],I=w[L.materialIndex];if(I&&I.visible){const z=v(x,T,I,M,b.near,b.far,S);i.renderBufferDirect(b,null,T,z,x,L)}}}else if(w.visible){const C=v(x,T,w,M,b.near,b.far,S);i.renderBufferDirect(b,null,T,C,x,null)}}const E=x.children;for(let T=0,w=E.length;T<w;T++)g(E[T],A,b,M,S)}}function mM(i,t,e){const n=e.isWebGL2;function s(){let H=!1;const gt=new Pe;let yt=null;const zt=new Pe(0,0,0,0);return{setMask:function(Tt){yt!==Tt&&!H&&(i.colorMask(Tt,Tt,Tt,Tt),yt=Tt)},setLocked:function(Tt){H=Tt},setClear:function(Tt,Gt,bt,Pt,pe){pe===!0&&(Tt*=Pt,Gt*=Pt,bt*=Pt),gt.set(Tt,Gt,bt,Pt),zt.equals(gt)===!1&&(i.clearColor(Tt,Gt,bt,Pt),zt.copy(gt))},reset:function(){H=!1,yt=null,zt.set(-1,0,0,0)}}}function r(){let H=!1,gt=null,yt=null,zt=null;return{setTest:function(Tt){Tt?Y(2929):J(2929)},setMask:function(Tt){gt!==Tt&&!H&&(i.depthMask(Tt),gt=Tt)},setFunc:function(Tt){if(yt!==Tt){if(Tt)switch(Tt){case Ay:i.depthFunc(512);break;case by:i.depthFunc(519);break;case My:i.depthFunc(513);break;case Jl:i.depthFunc(515);break;case wy:i.depthFunc(514);break;case Sy:i.depthFunc(518);break;case By:i.depthFunc(516);break;case Ty:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);yt=Tt}},setLocked:function(Tt){H=Tt},setClear:function(Tt){zt!==Tt&&(i.clearDepth(Tt),zt=Tt)},reset:function(){H=!1,gt=null,yt=null,zt=null}}}function a(){let H=!1,gt=null,yt=null,zt=null,Tt=null,Gt=null,bt=null,Pt=null,pe=null;return{setTest:function(ce){H||(ce?Y(2960):J(2960))},setMask:function(ce){gt!==ce&&!H&&(i.stencilMask(ce),gt=ce)},setFunc:function(ce,sn,mi){(yt!==ce||zt!==sn||Tt!==mi)&&(i.stencilFunc(ce,sn,mi),yt=ce,zt=sn,Tt=mi)},setOp:function(ce,sn,mi){(Gt!==ce||bt!==sn||Pt!==mi)&&(i.stencilOp(ce,sn,mi),Gt=ce,bt=sn,Pt=mi)},setLocked:function(ce){H=ce},setClear:function(ce){pe!==ce&&(i.clearStencil(ce),pe=ce)},reset:function(){H=!1,gt=null,yt=null,zt=null,Tt=null,Gt=null,bt=null,Pt=null,pe=null}}}const h=new s,o=new r,l=new a;let u={},m={},p=null,c=!1,f=null,d=null,y=null,_=null,v=null,g=null,x=null,A=!1,b=null,M=null,S=null,B=null,E=null;const T=i.getParameter(35661);let w=!1,C=0;const P=i.getParameter(7938);P.indexOf("WebGL")!==-1?(C=parseFloat(/^WebGL (\d)/.exec(P)[1]),w=C>=1):P.indexOf("OpenGL ES")!==-1&&(C=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),w=C>=2);let R=null,L={};const I=i.getParameter(3088),z=i.getParameter(2978),F=new Pe().fromArray(I),D=new Pe().fromArray(z);function V(H,gt,yt){const zt=new Uint8Array(4),Tt=i.createTexture();i.bindTexture(H,Tt),i.texParameteri(H,10241,9728),i.texParameteri(H,10240,9728);for(let Gt=0;Gt<yt;Gt++)i.texImage2D(gt+Gt,0,6408,1,1,0,6408,5121,zt);return Tt}const G={};G[3553]=V(3553,3553,1),G[34067]=V(34067,34069,6),h.setClear(0,0,0,1),o.setClear(1),l.setClear(0),Y(2929),o.setFunc(Jl),xt(!1),q(Km),Y(2884),Z(Ms);function Y(H){u[H]!==!0&&(i.enable(H),u[H]=!0)}function J(H){u[H]!==!1&&(i.disable(H),u[H]=!1)}function Q(H,gt){return m[H]!==gt?(i.bindFramebuffer(H,gt),m[H]=gt,n&&(H===36009&&(m[36160]=gt),H===36160&&(m[36009]=gt)),!0):!1}function W(H){return p!==H?(i.useProgram(H),p=H,!0):!1}const et={[xr]:32774,[cy]:32778,[uy]:32779};if(n)et[sp]=32775,et[rp]=32776;else{const H=t.get("EXT_blend_minmax");H!==null&&(et[sp]=H.MIN_EXT,et[rp]=H.MAX_EXT)}const ct={[my]:0,[py]:1,[fy]:768,[op]:770,[xy]:776,[yy]:774,[_y]:772,[dy]:769,[ap]:771,[gy]:775,[vy]:773};function Z(H,gt,yt,zt,Tt,Gt,bt,Pt){if(H===Ms){c===!0&&(J(3042),c=!1);return}if(c===!1&&(Y(3042),c=!0),H!==ly){if(H!==f||Pt!==A){if((d!==xr||v!==xr)&&(i.blendEquation(32774),d=xr,v=xr),Pt)switch(H){case Po:i.blendFuncSeparate(1,771,1,771);break;case ep:i.blendFunc(1,1);break;case ip:i.blendFuncSeparate(0,0,769,771);break;case np:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",H);break}else switch(H){case Po:i.blendFuncSeparate(770,771,1,771);break;case ep:i.blendFunc(770,1);break;case ip:i.blendFunc(0,769);break;case np:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",H);break}y=null,_=null,g=null,x=null,f=H,A=Pt}return}Tt=Tt||gt,Gt=Gt||yt,bt=bt||zt,(gt!==d||Tt!==v)&&(i.blendEquationSeparate(et[gt],et[Tt]),d=gt,v=Tt),(yt!==y||zt!==_||Gt!==g||bt!==x)&&(i.blendFuncSeparate(ct[yt],ct[zt],ct[Gt],ct[bt]),y=yt,_=zt,g=Gt,x=bt),f=H,A=null}function ot(H,gt){H.side===gr?J(2884):Y(2884);let yt=H.side===li;gt&&(yt=!yt),xt(yt),H.blending===Po&&H.transparent===!1?Z(Ms):Z(H.blending,H.blendEquation,H.blendSrc,H.blendDst,H.blendEquationAlpha,H.blendSrcAlpha,H.blendDstAlpha,H.premultipliedAlpha),o.setFunc(H.depthFunc),o.setTest(H.depthTest),o.setMask(H.depthWrite),h.setMask(H.colorWrite);const zt=H.stencilWrite;l.setTest(zt),zt&&(l.setMask(H.stencilWriteMask),l.setFunc(H.stencilFunc,H.stencilRef,H.stencilFuncMask),l.setOp(H.stencilFail,H.stencilZFail,H.stencilZPass)),at(H.polygonOffset,H.polygonOffsetFactor,H.polygonOffsetUnits),H.alphaToCoverage===!0?Y(32926):J(32926)}function xt(H){b!==H&&(H?i.frontFace(2304):i.frontFace(2305),b=H)}function q(H){H!==oy?(Y(2884),H!==M&&(H===Km?i.cullFace(1029):H===ay?i.cullFace(1028):i.cullFace(1032))):J(2884),M=H}function X(H){H!==S&&(w&&i.lineWidth(H),S=H)}function at(H,gt,yt){H?(Y(32823),(B!==gt||E!==yt)&&(i.polygonOffset(gt,yt),B=gt,E=yt)):J(32823)}function ut(H){H?Y(3089):J(3089)}function it(H){H===void 0&&(H=33984+T-1),R!==H&&(i.activeTexture(H),R=H)}function st(H,gt){R===null&&it();let yt=L[R];yt===void 0&&(yt={type:void 0,texture:void 0},L[R]=yt),(yt.type!==H||yt.texture!==gt)&&(i.bindTexture(H,gt||G[H]),yt.type=H,yt.texture=gt)}function dt(){const H=L[R];H!==void 0&&H.type!==void 0&&(i.bindTexture(H.type,null),H.type=void 0,H.texture=void 0)}function mt(){try{i.compressedTexImage2D.apply(i,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function pt(){try{i.texSubImage2D.apply(i,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function U(){try{i.texSubImage3D.apply(i,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function N(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function rt(){try{i.texStorage2D.apply(i,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function ht(){try{i.texStorage3D.apply(i,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function At(){try{i.texImage2D.apply(i,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function ft(){try{i.texImage3D.apply(i,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function It(H){F.equals(H)===!1&&(i.scissor(H.x,H.y,H.z,H.w),F.copy(H))}function Ct(H){D.equals(H)===!1&&(i.viewport(H.x,H.y,H.z,H.w),D.copy(H))}function _t(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),n===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),u={},R=null,L={},m={},p=null,c=!1,f=null,d=null,y=null,_=null,v=null,g=null,x=null,A=!1,b=null,M=null,S=null,B=null,E=null,F.set(0,0,i.canvas.width,i.canvas.height),D.set(0,0,i.canvas.width,i.canvas.height),h.reset(),o.reset(),l.reset()}return{buffers:{color:h,depth:o,stencil:l},enable:Y,disable:J,bindFramebuffer:Q,useProgram:W,setBlending:Z,setMaterial:ot,setFlipSided:xt,setCullFace:q,setLineWidth:X,setPolygonOffset:at,setScissorTest:ut,activeTexture:it,bindTexture:st,unbindTexture:dt,compressedTexImage2D:mt,texImage2D:At,texImage3D:ft,texStorage2D:rt,texStorage3D:ht,texSubImage2D:pt,texSubImage3D:U,compressedTexSubImage2D:N,scissor:It,viewport:Ct,reset:_t}}function pM(i,t,e,n,s,r,a){const h=s.isWebGL2,o=s.maxTextures,l=s.maxCubemapSize,u=s.maxTextureSize,m=s.maxSamples,c=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):void 0,f=new WeakMap;let d,y=!1;try{y=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function _(U,N){return y?new OffscreenCanvas(U,N):th("canvas")}function v(U,N,rt,ht){let At=1;if((U.width>ht||U.height>ht)&&(At=ht/Math.max(U.width,U.height)),At<1||N===!0)if(typeof HTMLImageElement!="undefined"&&U instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&U instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&U instanceof ImageBitmap){const ft=N?Fg:Math.floor,It=ft(At*U.width),Ct=ft(At*U.height);d===void 0&&(d=_(It,Ct));const _t=rt?_(It,Ct):d;return _t.width=It,_t.height=Ct,_t.getContext("2d").drawImage(U,0,0,It,Ct),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+U.width+"x"+U.height+") to ("+It+"x"+Ct+")."),_t}else return"data"in U&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+U.width+"x"+U.height+")."),U;return U}function g(U){return Mp(U.width)&&Mp(U.height)}function x(U){return h?!1:U.wrapS!==Qi||U.wrapT!==Qi||U.minFilter!==ci&&U.minFilter!==Gi}function A(U,N){return U.generateMipmaps&&N&&U.minFilter!==ci&&U.minFilter!==Gi}function b(U){i.generateMipmap(U)}function M(U,N,rt,ht){if(h===!1)return N;if(U!==null){if(i[U]!==void 0)return i[U];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+U+"'")}let At=N;return N===6403&&(rt===5126&&(At=33326),rt===5131&&(At=33325),rt===5121&&(At=33321)),N===6407&&(rt===5126&&(At=34837),rt===5131&&(At=34843),rt===5121&&(At=32849)),N===6408&&(rt===5126&&(At=34836),rt===5131&&(At=34842),rt===5121&&(At=ht===Sr?35907:32856)),(At===33325||At===33326||At===34842||At===34836)&&t.get("EXT_color_buffer_float"),At}function S(U,N,rt){return A(U,rt)===!0||U.isFramebufferTexture&&U.minFilter!==ci&&U.minFilter!==Gi?Math.log2(Math.max(N.width,N.height))+1:U.mipmaps!==void 0&&U.mipmaps.length>0?U.mipmaps.length:U.isCompressedTexture&&Array.isArray(U.image)?N.mipmaps.length:1}function B(U){return U===ci||U===lp||U===cp?9728:9729}function E(U){const N=U.target;N.removeEventListener("dispose",E),w(N),N.isVideoTexture&&f.delete(N),a.memory.textures--}function T(U){const N=U.target;N.removeEventListener("dispose",T),C(N)}function w(U){const N=n.get(U);N.__webglInit!==void 0&&(i.deleteTexture(N.__webglTexture),n.remove(U))}function C(U){const N=U.texture,rt=n.get(U),ht=n.get(N);if(!!U){if(ht.__webglTexture!==void 0&&(i.deleteTexture(ht.__webglTexture),a.memory.textures--),U.depthTexture&&U.depthTexture.dispose(),U.isWebGLCubeRenderTarget)for(let At=0;At<6;At++)i.deleteFramebuffer(rt.__webglFramebuffer[At]),rt.__webglDepthbuffer&&i.deleteRenderbuffer(rt.__webglDepthbuffer[At]);else i.deleteFramebuffer(rt.__webglFramebuffer),rt.__webglDepthbuffer&&i.deleteRenderbuffer(rt.__webglDepthbuffer),rt.__webglMultisampledFramebuffer&&i.deleteFramebuffer(rt.__webglMultisampledFramebuffer),rt.__webglColorRenderbuffer&&i.deleteRenderbuffer(rt.__webglColorRenderbuffer),rt.__webglDepthRenderbuffer&&i.deleteRenderbuffer(rt.__webglDepthRenderbuffer);if(U.isWebGLMultipleRenderTargets)for(let At=0,ft=N.length;At<ft;At++){const It=n.get(N[At]);It.__webglTexture&&(i.deleteTexture(It.__webglTexture),a.memory.textures--),n.remove(N[At])}n.remove(N),n.remove(U)}}let P=0;function R(){P=0}function L(){const U=P;return U>=o&&console.warn("THREE.WebGLTextures: Trying to use "+U+" texture units while this GPU supports only "+o),P+=1,U}function I(U,N){const rt=n.get(U);if(U.isVideoTexture&&it(U),U.version>0&&rt.__version!==U.version){const ht=U.image;if(ht===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(ht.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(rt,U,N);return}}e.activeTexture(33984+N),e.bindTexture(3553,rt.__webglTexture)}function z(U,N){const rt=n.get(U);if(U.version>0&&rt.__version!==U.version){Q(rt,U,N);return}e.activeTexture(33984+N),e.bindTexture(35866,rt.__webglTexture)}function F(U,N){const rt=n.get(U);if(U.version>0&&rt.__version!==U.version){Q(rt,U,N);return}e.activeTexture(33984+N),e.bindTexture(32879,rt.__webglTexture)}function D(U,N){const rt=n.get(U);if(U.version>0&&rt.__version!==U.version){W(rt,U,N);return}e.activeTexture(33984+N),e.bindTexture(34067,rt.__webglTexture)}const V={[Zl]:10497,[Qi]:33071,[Kl]:33648},G={[ci]:9728,[lp]:9984,[cp]:9986,[Gi]:9729,[zy]:9985,[$a]:9987};function Y(U,N,rt){if(rt?(i.texParameteri(U,10242,V[N.wrapS]),i.texParameteri(U,10243,V[N.wrapT]),(U===32879||U===35866)&&i.texParameteri(U,32882,V[N.wrapR]),i.texParameteri(U,10240,G[N.magFilter]),i.texParameteri(U,10241,G[N.minFilter])):(i.texParameteri(U,10242,33071),i.texParameteri(U,10243,33071),(U===32879||U===35866)&&i.texParameteri(U,32882,33071),(N.wrapS!==Qi||N.wrapT!==Qi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(U,10240,B(N.magFilter)),i.texParameteri(U,10241,B(N.minFilter)),N.minFilter!==ci&&N.minFilter!==Gi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){const ht=t.get("EXT_texture_filter_anisotropic");if(N.type===Ss&&t.has("OES_texture_float_linear")===!1||h===!1&&N.type===Ks&&t.has("OES_texture_half_float_linear")===!1)return;(N.anisotropy>1||n.get(N).__currentAnisotropy)&&(i.texParameterf(U,ht.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(N.anisotropy,s.getMaxAnisotropy())),n.get(N).__currentAnisotropy=N.anisotropy)}}function J(U,N){U.__webglInit===void 0&&(U.__webglInit=!0,N.addEventListener("dispose",E),U.__webglTexture=i.createTexture(),a.memory.textures++)}function Q(U,N,rt){let ht=3553;N.isDataTexture2DArray&&(ht=35866),N.isDataTexture3D&&(ht=32879),J(U,N),e.activeTexture(33984+rt),e.bindTexture(ht,U.__webglTexture),i.pixelStorei(37440,N.flipY),i.pixelStorei(37441,N.premultiplyAlpha),i.pixelStorei(3317,N.unpackAlignment),i.pixelStorei(37443,0);const At=x(N)&&g(N.image)===!1,ft=v(N.image,At,!1,u),It=g(ft)||h,Ct=r.convert(N.format);let _t=r.convert(N.type),H=M(N.internalFormat,Ct,_t,N.encoding);Y(ht,N,It);let gt;const yt=N.mipmaps,zt=h&&N.isVideoTexture!==!0,Tt=U.__version===void 0,Gt=S(N,ft,It);if(N.isDepthTexture)H=6402,h?N.type===Ss?H=36012:N.type===Xa?H=33190:N.type===Ar?H=35056:H=33189:N.type===Ss&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),N.format===tr&&H===6402&&N.type!==Do&&N.type!==Xa&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),N.type=Do,_t=r.convert(N.type)),N.format===br&&H===6402&&(H=34041,N.type!==Ar&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),N.type=Ar,_t=r.convert(N.type))),zt&&Tt?e.texStorage2D(3553,1,H,ft.width,ft.height):e.texImage2D(3553,0,H,ft.width,ft.height,0,Ct,_t,null);else if(N.isDataTexture)if(yt.length>0&&It){zt&&Tt&&e.texStorage2D(3553,Gt,H,yt[0].width,yt[0].height);for(let bt=0,Pt=yt.length;bt<Pt;bt++)gt=yt[bt],zt?e.texSubImage2D(3553,0,0,0,gt.width,gt.height,Ct,_t,gt.data):e.texImage2D(3553,bt,H,gt.width,gt.height,0,Ct,_t,gt.data);N.generateMipmaps=!1}else zt?(Tt&&e.texStorage2D(3553,Gt,H,ft.width,ft.height),e.texSubImage2D(3553,0,0,0,ft.width,ft.height,Ct,_t,ft.data)):e.texImage2D(3553,0,H,ft.width,ft.height,0,Ct,_t,ft.data);else if(N.isCompressedTexture){zt&&Tt&&e.texStorage2D(3553,Gt,H,yt[0].width,yt[0].height);for(let bt=0,Pt=yt.length;bt<Pt;bt++)gt=yt[bt],N.format!==di&&N.format!==Qs?Ct!==null?zt?e.compressedTexSubImage2D(3553,bt,0,0,gt.width,gt.height,Ct,gt.data):e.compressedTexImage2D(3553,bt,H,gt.width,gt.height,0,gt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):zt?e.texSubImage2D(3553,bt,0,0,gt.width,gt.height,Ct,_t,gt.data):e.texImage2D(3553,bt,H,gt.width,gt.height,0,Ct,_t,gt.data)}else if(N.isDataTexture2DArray)zt?(Tt&&e.texStorage3D(35866,Gt,H,ft.width,ft.height,ft.depth),e.texSubImage3D(35866,0,0,0,0,ft.width,ft.height,ft.depth,Ct,_t,ft.data)):e.texImage3D(35866,0,H,ft.width,ft.height,ft.depth,0,Ct,_t,ft.data);else if(N.isDataTexture3D)zt?(Tt&&e.texStorage3D(32879,Gt,H,ft.width,ft.height,ft.depth),e.texSubImage3D(32879,0,0,0,0,ft.width,ft.height,ft.depth,Ct,_t,ft.data)):e.texImage3D(32879,0,H,ft.width,ft.height,ft.depth,0,Ct,_t,ft.data);else if(N.isFramebufferTexture)zt&&Tt?e.texStorage2D(3553,Gt,H,ft.width,ft.height):e.texImage2D(3553,0,H,ft.width,ft.height,0,Ct,_t,null);else if(yt.length>0&&It){zt&&Tt&&e.texStorage2D(3553,Gt,H,yt[0].width,yt[0].height);for(let bt=0,Pt=yt.length;bt<Pt;bt++)gt=yt[bt],zt?e.texSubImage2D(3553,bt,0,0,Ct,_t,gt):e.texImage2D(3553,bt,H,Ct,_t,gt);N.generateMipmaps=!1}else zt?(Tt&&e.texStorage2D(3553,Gt,H,ft.width,ft.height),e.texSubImage2D(3553,0,0,0,Ct,_t,ft)):e.texImage2D(3553,0,H,Ct,_t,ft);A(N,It)&&b(ht),U.__version=N.version,N.onUpdate&&N.onUpdate(N)}function W(U,N,rt){if(N.image.length!==6)return;J(U,N),e.activeTexture(33984+rt),e.bindTexture(34067,U.__webglTexture),i.pixelStorei(37440,N.flipY),i.pixelStorei(37441,N.premultiplyAlpha),i.pixelStorei(3317,N.unpackAlignment),i.pixelStorei(37443,0);const ht=N&&(N.isCompressedTexture||N.image[0].isCompressedTexture),At=N.image[0]&&N.image[0].isDataTexture,ft=[];for(let bt=0;bt<6;bt++)!ht&&!At?ft[bt]=v(N.image[bt],!1,!0,l):ft[bt]=At?N.image[bt].image:N.image[bt];const It=ft[0],Ct=g(It)||h,_t=r.convert(N.format),H=r.convert(N.type),gt=M(N.internalFormat,_t,H,N.encoding),yt=h&&N.isVideoTexture!==!0,zt=U.__version===void 0;let Tt=S(N,It,Ct);Y(34067,N,Ct);let Gt;if(ht){yt&&zt&&e.texStorage2D(34067,Tt,gt,It.width,It.height);for(let bt=0;bt<6;bt++){Gt=ft[bt].mipmaps;for(let Pt=0;Pt<Gt.length;Pt++){const pe=Gt[Pt];N.format!==di&&N.format!==Qs?_t!==null?yt?e.compressedTexSubImage2D(34069+bt,Pt,0,0,pe.width,pe.height,_t,pe.data):e.compressedTexImage2D(34069+bt,Pt,gt,pe.width,pe.height,0,pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):yt?e.texSubImage2D(34069+bt,Pt,0,0,pe.width,pe.height,_t,H,pe.data):e.texImage2D(34069+bt,Pt,gt,pe.width,pe.height,0,_t,H,pe.data)}}}else{Gt=N.mipmaps,yt&&zt&&(Gt.length>0&&Tt++,e.texStorage2D(34067,Tt,gt,ft[0].width,ft[0].height));for(let bt=0;bt<6;bt++)if(At){yt?e.texSubImage2D(34069+bt,0,0,0,ft[bt].width,ft[bt].height,_t,H,ft[bt].data):e.texImage2D(34069+bt,0,gt,ft[bt].width,ft[bt].height,0,_t,H,ft[bt].data);for(let Pt=0;Pt<Gt.length;Pt++){const ce=Gt[Pt].image[bt].image;yt?e.texSubImage2D(34069+bt,Pt+1,0,0,ce.width,ce.height,_t,H,ce.data):e.texImage2D(34069+bt,Pt+1,gt,ce.width,ce.height,0,_t,H,ce.data)}}else{yt?e.texSubImage2D(34069+bt,0,0,0,_t,H,ft[bt]):e.texImage2D(34069+bt,0,gt,_t,H,ft[bt]);for(let Pt=0;Pt<Gt.length;Pt++){const pe=Gt[Pt];yt?e.texSubImage2D(34069+bt,Pt+1,0,0,_t,H,pe.image[bt]):e.texImage2D(34069+bt,Pt+1,gt,_t,H,pe.image[bt])}}}A(N,Ct)&&b(34067),U.__version=N.version,N.onUpdate&&N.onUpdate(N)}function et(U,N,rt,ht,At){const ft=r.convert(rt.format),It=r.convert(rt.type),Ct=M(rt.internalFormat,ft,It,rt.encoding);n.get(N).__hasExternalTextures||(At===32879||At===35866?e.texImage3D(At,0,Ct,N.width,N.height,N.depth,0,ft,It,null):e.texImage2D(At,0,Ct,N.width,N.height,0,ft,It,null)),e.bindFramebuffer(36160,U),N.useRenderToTexture?c.framebufferTexture2DMultisampleEXT(36160,ht,At,n.get(rt).__webglTexture,0,ut(N)):i.framebufferTexture2D(36160,ht,At,n.get(rt).__webglTexture,0),e.bindFramebuffer(36160,null)}function ct(U,N,rt){if(i.bindRenderbuffer(36161,U),N.depthBuffer&&!N.stencilBuffer){let ht=33189;if(rt||N.useRenderToTexture){const At=N.depthTexture;At&&At.isDepthTexture&&(At.type===Ss?ht=36012:At.type===Xa&&(ht=33190));const ft=ut(N);N.useRenderToTexture?c.renderbufferStorageMultisampleEXT(36161,ft,ht,N.width,N.height):i.renderbufferStorageMultisample(36161,ft,ht,N.width,N.height)}else i.renderbufferStorage(36161,ht,N.width,N.height);i.framebufferRenderbuffer(36160,36096,36161,U)}else if(N.depthBuffer&&N.stencilBuffer){const ht=ut(N);rt&&N.useRenderbuffer?i.renderbufferStorageMultisample(36161,ht,35056,N.width,N.height):N.useRenderToTexture?c.renderbufferStorageMultisampleEXT(36161,ht,35056,N.width,N.height):i.renderbufferStorage(36161,34041,N.width,N.height),i.framebufferRenderbuffer(36160,33306,36161,U)}else{const ht=N.isWebGLMultipleRenderTargets===!0?N.texture[0]:N.texture,At=r.convert(ht.format),ft=r.convert(ht.type),It=M(ht.internalFormat,At,ft,ht.encoding),Ct=ut(N);rt&&N.useRenderbuffer?i.renderbufferStorageMultisample(36161,Ct,It,N.width,N.height):N.useRenderToTexture?c.renderbufferStorageMultisampleEXT(36161,Ct,It,N.width,N.height):i.renderbufferStorage(36161,It,N.width,N.height)}i.bindRenderbuffer(36161,null)}function Z(U,N){if(N&&N.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,U),!(N.depthTexture&&N.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(N.depthTexture).__webglTexture||N.depthTexture.image.width!==N.width||N.depthTexture.image.height!==N.height)&&(N.depthTexture.image.width=N.width,N.depthTexture.image.height=N.height,N.depthTexture.needsUpdate=!0),I(N.depthTexture,0);const ht=n.get(N.depthTexture).__webglTexture,At=ut(N);if(N.depthTexture.format===tr)N.useRenderToTexture?c.framebufferTexture2DMultisampleEXT(36160,36096,3553,ht,0,At):i.framebufferTexture2D(36160,36096,3553,ht,0);else if(N.depthTexture.format===br)N.useRenderToTexture?c.framebufferTexture2DMultisampleEXT(36160,33306,3553,ht,0,At):i.framebufferTexture2D(36160,33306,3553,ht,0);else throw new Error("Unknown depthTexture format")}function ot(U){const N=n.get(U),rt=U.isWebGLCubeRenderTarget===!0;if(U.depthTexture&&!N.__autoAllocateDepthBuffer){if(rt)throw new Error("target.depthTexture not supported in Cube render targets");Z(N.__webglFramebuffer,U)}else if(rt){N.__webglDepthbuffer=[];for(let ht=0;ht<6;ht++)e.bindFramebuffer(36160,N.__webglFramebuffer[ht]),N.__webglDepthbuffer[ht]=i.createRenderbuffer(),ct(N.__webglDepthbuffer[ht],U,!1)}else e.bindFramebuffer(36160,N.__webglFramebuffer),N.__webglDepthbuffer=i.createRenderbuffer(),ct(N.__webglDepthbuffer,U,!1);e.bindFramebuffer(36160,null)}function xt(U,N,rt){const ht=n.get(U);N!==void 0&&et(ht.__webglFramebuffer,U,U.texture,36064,3553),rt!==void 0&&ot(U)}function q(U){const N=U.texture,rt=n.get(U),ht=n.get(N);U.addEventListener("dispose",T),U.isWebGLMultipleRenderTargets!==!0&&(ht.__webglTexture===void 0&&(ht.__webglTexture=i.createTexture()),ht.__version=N.version,a.memory.textures++);const At=U.isWebGLCubeRenderTarget===!0,ft=U.isWebGLMultipleRenderTargets===!0,It=N.isDataTexture3D||N.isDataTexture2DArray,Ct=g(U)||h;if(h&&N.format===Qs&&(N.type===Ss||N.type===Ks)&&(N.format=di,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),At){rt.__webglFramebuffer=[];for(let _t=0;_t<6;_t++)rt.__webglFramebuffer[_t]=i.createFramebuffer()}else if(rt.__webglFramebuffer=i.createFramebuffer(),ft)if(s.drawBuffers){const _t=U.texture;for(let H=0,gt=_t.length;H<gt;H++){const yt=n.get(_t[H]);yt.__webglTexture===void 0&&(yt.__webglTexture=i.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(U.useRenderbuffer)if(h){rt.__webglMultisampledFramebuffer=i.createFramebuffer(),rt.__webglColorRenderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,rt.__webglColorRenderbuffer);const _t=r.convert(N.format),H=r.convert(N.type),gt=M(N.internalFormat,_t,H,N.encoding),yt=ut(U);i.renderbufferStorageMultisample(36161,yt,gt,U.width,U.height),e.bindFramebuffer(36160,rt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064,36161,rt.__webglColorRenderbuffer),i.bindRenderbuffer(36161,null),U.depthBuffer&&(rt.__webglDepthRenderbuffer=i.createRenderbuffer(),ct(rt.__webglDepthRenderbuffer,U,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(At){e.bindTexture(34067,ht.__webglTexture),Y(34067,N,Ct);for(let _t=0;_t<6;_t++)et(rt.__webglFramebuffer[_t],U,N,36064,34069+_t);A(N,Ct)&&b(34067),e.unbindTexture()}else if(ft){const _t=U.texture;for(let H=0,gt=_t.length;H<gt;H++){const yt=_t[H],zt=n.get(yt);e.bindTexture(3553,zt.__webglTexture),Y(3553,yt,Ct),et(rt.__webglFramebuffer,U,yt,36064+H,3553),A(yt,Ct)&&b(3553)}e.unbindTexture()}else{let _t=3553;It&&(h?_t=N.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),e.bindTexture(_t,ht.__webglTexture),Y(_t,N,Ct),et(rt.__webglFramebuffer,U,N,36064,_t),A(N,Ct)&&b(_t),e.unbindTexture()}U.depthBuffer&&ot(U)}function X(U){const N=g(U)||h,rt=U.isWebGLMultipleRenderTargets===!0?U.texture:[U.texture];for(let ht=0,At=rt.length;ht<At;ht++){const ft=rt[ht];if(A(ft,N)){const It=U.isWebGLCubeRenderTarget?34067:3553,Ct=n.get(ft).__webglTexture;e.bindTexture(It,Ct),b(It),e.unbindTexture()}}}function at(U){if(U.useRenderbuffer)if(h){const N=U.width,rt=U.height;let ht=16384;const At=[36064],ft=U.stencilBuffer?33306:36096;U.depthBuffer&&At.push(ft),U.ignoreDepthForMultisampleCopy||(U.depthBuffer&&(ht|=256),U.stencilBuffer&&(ht|=1024));const It=n.get(U);e.bindFramebuffer(36008,It.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,It.__webglFramebuffer),U.ignoreDepthForMultisampleCopy&&(i.invalidateFramebuffer(36008,[ft]),i.invalidateFramebuffer(36009,[ft])),i.blitFramebuffer(0,0,N,rt,0,0,N,rt,ht,9728),i.invalidateFramebuffer(36008,At),e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,It.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function ut(U){return h&&(U.useRenderbuffer||U.useRenderToTexture)?Math.min(m,U.samples):0}function it(U){const N=a.render.frame;f.get(U)!==N&&(f.set(U,N),U.update())}let st=!1,dt=!1;function mt(U,N){U&&U.isWebGLRenderTarget&&(st===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),st=!0),U=U.texture),I(U,N)}function pt(U,N){U&&U.isWebGLCubeRenderTarget&&(dt===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),dt=!0),U=U.texture),D(U,N)}this.allocateTextureUnit=L,this.resetTextureUnits=R,this.setTexture2D=I,this.setTexture2DArray=z,this.setTexture3D=F,this.setTextureCube=D,this.rebindTextures=xt,this.setupRenderTarget=q,this.updateRenderTargetMipmap=X,this.updateMultisampleRenderTarget=at,this.setupDepthRenderbuffer=ot,this.setupFrameBufferTexture=et,this.safeSetTexture2D=mt,this.safeSetTextureCube=pt}function fM(i,t,e){const n=e.isWebGL2;function s(r){let a;if(r===es)return 5121;if(r===Oy)return 32819;if(r===Uy)return 32820;if(r===Hy)return 33635;if(r===Fy)return 5120;if(r===Vy)return 5122;if(r===Do)return 5123;if(r===Ny)return 5124;if(r===Xa)return 5125;if(r===Ss)return 5126;if(r===Ks)return n?5131:(a=t.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===Gy)return 6406;if(r===Qs)return 6407;if(r===di)return 6408;if(r===ky)return 6409;if(r===Wy)return 6410;if(r===tr)return 6402;if(r===br)return 34041;if(r===Yy)return 6403;if(r===qy)return 36244;if(r===Jy)return 33319;if(r===$y)return 33320;if(r===Xy)return 36248;if(r===jy)return 36249;if(r===up||r===mp||r===pp||r===fp)if(a=t.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===up)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===mp)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===pp)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===fp)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===dp||r===_p||r===vp||r===yp)if(a=t.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===dp)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===_p)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===vp)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===yp)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===Zy)return a=t.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if((r===gp||r===xp)&&(a=t.get("WEBGL_compressed_texture_etc"),a!==null)){if(r===gp)return a.COMPRESSED_RGB8_ETC2;if(r===xp)return a.COMPRESSED_RGBA8_ETC2_EAC}if(r===Ky||r===Qy||r===tg||r===eg||r===ig||r===ng||r===sg||r===rg||r===og||r===ag||r===hg||r===lg||r===cg||r===ug||r===pg||r===fg||r===dg||r===_g||r===vg||r===yg||r===gg||r===xg||r===Ag||r===bg||r===Mg||r===wg||r===Sg||r===Bg)return a=t.get("WEBGL_compressed_texture_astc"),a!==null?r:null;if(r===mg)return a=t.get("EXT_texture_compression_bptc"),a!==null?r:null;if(r===Ar)return n?34042:(a=t.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:s}}class Sf extends Xi{constructor(t=[]){super();this.cameras=t}}Sf.prototype.isArrayCamera=!0;class ko extends we{constructor(){super();this.type="Group"}}ko.prototype.isGroup=!0;const dM={type:"move"};class Uc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ko,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ko,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new k,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new k),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ko,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new k,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new k),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,n){let s=null,r=null,a=null;const h=this._targetRay,o=this._grip,l=this._hand;if(t&&e.session.visibilityState!=="visible-blurred")if(h!==null&&(s=e.getPose(t.targetRaySpace,n),s!==null&&(h.matrix.fromArray(s.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),s.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(s.linearVelocity)):h.hasLinearVelocity=!1,s.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(s.angularVelocity)):h.hasAngularVelocity=!1,this.dispatchEvent(dM))),l&&t.hand){a=!0;for(const d of t.hand.values()){const y=e.getJointPose(d,n);if(l.joints[d.jointName]===void 0){const v=new ko;v.matrixAutoUpdate=!1,v.visible=!1,l.joints[d.jointName]=v,l.add(v)}const _=l.joints[d.jointName];y!==null&&(_.matrix.fromArray(y.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.jointRadius=y.radius),_.visible=y!==null}const u=l.joints["index-finger-tip"],m=l.joints["thumb-tip"],p=u.position.distanceTo(m.position),c=.02,f=.005;l.inputState.pinching&&p>c+f?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&p<=c-f&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else o!==null&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),r!==null&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));return h!==null&&(h.visible=s!==null),o!==null&&(o.visible=r!==null),l!==null&&(l.visible=a!==null),this}}class Hc extends _i{constructor(t,e,n,s,r,a,h,o,l,u){if(u=u!==void 0?u:tr,u!==tr&&u!==br)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===tr&&(n=Do),n===void 0&&u===br&&(n=Ar);super(null,s,r,a,h,o,u,n,l);this.image={width:t,height:e},this.magFilter=h!==void 0?h:ci,this.minFilter=o!==void 0?o:ci,this.flipY=!1,this.generateMipmaps=!1}}Hc.prototype.isDepthTexture=!0;class _M extends er{constructor(t,e){super();const n=this;let s=null,r=1,a=null,h="local-floor";const o=t.extensions.has("WEBGL_multisampled_render_to_texture");let l=null,u=null,m=null,p=null,c=!1,f=null;const d=e.getContextAttributes();let y=null,_=null;const v=[],g=new Map,x=new Xi;x.layers.enable(1),x.viewport=new Pe;const A=new Xi;A.layers.enable(2),A.viewport=new Pe;const b=[x,A],M=new Sf;M.layers.enable(1),M.layers.enable(2);let S=null,B=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(D){let V=v[D];return V===void 0&&(V=new Uc,v[D]=V),V.getTargetRaySpace()},this.getControllerGrip=function(D){let V=v[D];return V===void 0&&(V=new Uc,v[D]=V),V.getGripSpace()},this.getHand=function(D){let V=v[D];return V===void 0&&(V=new Uc,v[D]=V),V.getHandSpace()};function E(D){const V=g.get(D.inputSource);V&&V.dispatchEvent({type:D.type,data:D.inputSource})}function T(){g.forEach(function(D,V){D.disconnect(V)}),g.clear(),S=null,B=null,t.setRenderTarget(y),p=null,m=null,u=null,s=null,_=null,F.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(D){r=D,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(D){h=D,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getBaseLayer=function(){return m!==null?m:p},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return s},this.setSession=async function(D){if(s=D,s!==null){if(y=t.getRenderTarget(),s.addEventListener("select",E),s.addEventListener("selectstart",E),s.addEventListener("selectend",E),s.addEventListener("squeeze",E),s.addEventListener("squeezestart",E),s.addEventListener("squeezeend",E),s.addEventListener("end",T),s.addEventListener("inputsourceschange",w),d.xrCompatible!==!0&&await e.makeXRCompatible(),s.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const V={antialias:s.renderState.layers===void 0?d.antialias:!0,alpha:d.alpha,depth:d.depth,stencil:d.stencil,framebufferScaleFactor:r};p=new XRWebGLLayer(s,e,V),s.updateRenderState({baseLayer:p}),_=new pn(p.framebufferWidth,p.framebufferHeight,{format:di,type:es,encoding:t.outputEncoding})}else{c=d.antialias;let V=null,G=null,Y=null;d.depth&&(Y=d.stencil?35056:33190,V=d.stencil?br:tr,G=d.stencil?Ar:Do);const J={colorFormat:d.alpha||c?32856:32849,depthFormat:Y,scaleFactor:r};u=new XRWebGLBinding(s,e),m=u.createProjectionLayer(J),s.updateRenderState({layers:[m]}),c?_=new oc(m.textureWidth,m.textureHeight,{format:di,type:es,depthTexture:new Hc(m.textureWidth,m.textureHeight,G,void 0,void 0,void 0,void 0,void 0,void 0,V),stencilBuffer:d.stencil,ignoreDepth:m.ignoreDepthValues,useRenderToTexture:o,encoding:t.outputEncoding}):_=new pn(m.textureWidth,m.textureHeight,{format:d.alpha?di:Qs,type:es,depthTexture:new Hc(m.textureWidth,m.textureHeight,G,void 0,void 0,void 0,void 0,void 0,void 0,V),stencilBuffer:d.stencil,ignoreDepth:m.ignoreDepthValues,encoding:t.outputEncoding})}this.setFoveation(1),a=await s.requestReferenceSpace(h),F.setContext(s),F.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function w(D){const V=s.inputSources;for(let G=0;G<v.length;G++)g.set(V[G],v[G]);for(let G=0;G<D.removed.length;G++){const Y=D.removed[G],J=g.get(Y);J&&(J.dispatchEvent({type:"disconnected",data:Y}),g.delete(Y))}for(let G=0;G<D.added.length;G++){const Y=D.added[G],J=g.get(Y);J&&J.dispatchEvent({type:"connected",data:Y})}}const C=new k,P=new k;function R(D,V,G){C.setFromMatrixPosition(V.matrixWorld),P.setFromMatrixPosition(G.matrixWorld);const Y=C.distanceTo(P),J=V.projectionMatrix.elements,Q=G.projectionMatrix.elements,W=J[14]/(J[10]-1),et=J[14]/(J[10]+1),ct=(J[9]+1)/J[5],Z=(J[9]-1)/J[5],ot=(J[8]-1)/J[0],xt=(Q[8]+1)/Q[0],q=W*ot,X=W*xt,at=Y/(-ot+xt),ut=at*-ot;V.matrixWorld.decompose(D.position,D.quaternion,D.scale),D.translateX(ut),D.translateZ(at),D.matrixWorld.compose(D.position,D.quaternion,D.scale),D.matrixWorldInverse.copy(D.matrixWorld).invert();const it=W+at,st=et+at,dt=q-ut,mt=X+(Y-ut),pt=ct*et/st*it,U=Z*et/st*it;D.projectionMatrix.makePerspective(dt,mt,pt,U,it,st)}function L(D,V){V===null?D.matrixWorld.copy(D.matrix):D.matrixWorld.multiplyMatrices(V.matrixWorld,D.matrix),D.matrixWorldInverse.copy(D.matrixWorld).invert()}this.updateCamera=function(D){if(s===null)return;M.near=A.near=x.near=D.near,M.far=A.far=x.far=D.far,(S!==M.near||B!==M.far)&&(s.updateRenderState({depthNear:M.near,depthFar:M.far}),S=M.near,B=M.far);const V=D.parent,G=M.cameras;L(M,V);for(let J=0;J<G.length;J++)L(G[J],V);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),D.position.copy(M.position),D.quaternion.copy(M.quaternion),D.scale.copy(M.scale),D.matrix.copy(M.matrix),D.matrixWorld.copy(M.matrixWorld);const Y=D.children;for(let J=0,Q=Y.length;J<Q;J++)Y[J].updateMatrixWorld(!0);G.length===2?R(M,x,A):M.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){if(m!==null)return m.fixedFoveation;if(p!==null)return p.fixedFoveation},this.setFoveation=function(D){m!==null&&(m.fixedFoveation=D),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=D)};let I=null;function z(D,V){if(l=V.getViewerPose(a),f=V,l!==null){const Y=l.views;p!==null&&(t.setRenderTargetFramebuffer(_,p.framebuffer),t.setRenderTarget(_));let J=!1;Y.length!==M.cameras.length&&(M.cameras.length=0,J=!0);for(let Q=0;Q<Y.length;Q++){const W=Y[Q];let et=null;if(p!==null)et=p.getViewport(W);else{const Z=u.getViewSubImage(m,W);et=Z.viewport,Q===0&&(t.setRenderTargetTextures(_,Z.colorTexture,m.ignoreDepthValues?void 0:Z.depthStencilTexture),t.setRenderTarget(_))}const ct=b[Q];ct.matrix.fromArray(W.transform.matrix),ct.projectionMatrix.fromArray(W.projectionMatrix),ct.viewport.set(et.x,et.y,et.width,et.height),Q===0&&M.matrix.copy(ct.matrix),J===!0&&M.cameras.push(ct)}}const G=s.inputSources;for(let Y=0;Y<v.length;Y++){const J=v[Y],Q=G[Y];J.update(Q,V,a)}I&&I(D,V),f=null}const F=new Hp;F.setAnimationLoop(z),this.setAnimationLoop=function(D){I=D},this.dispose=function(){}}}function vM(i){function t(_,v){_.fogColor.value.copy(v.color),v.isFog?(_.fogNear.value=v.near,_.fogFar.value=v.far):v.isFogExp2&&(_.fogDensity.value=v.density)}function e(_,v,g,x,A){v.isMeshBasicMaterial?n(_,v):v.isMeshLambertMaterial?(n(_,v),o(_,v)):v.isMeshToonMaterial?(n(_,v),u(_,v)):v.isMeshPhongMaterial?(n(_,v),l(_,v)):v.isMeshStandardMaterial?(n(_,v),v.isMeshPhysicalMaterial?p(_,v,A):m(_,v)):v.isMeshMatcapMaterial?(n(_,v),c(_,v)):v.isMeshDepthMaterial?(n(_,v),f(_,v)):v.isMeshDistanceMaterial?(n(_,v),d(_,v)):v.isMeshNormalMaterial?(n(_,v),y(_,v)):v.isLineBasicMaterial?(s(_,v),v.isLineDashedMaterial&&r(_,v)):v.isPointsMaterial?a(_,v,g,x):v.isSpriteMaterial?h(_,v):v.isShadowMaterial?(_.color.value.copy(v.color),_.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function n(_,v){_.opacity.value=v.opacity,v.color&&_.diffuse.value.copy(v.color),v.emissive&&_.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(_.map.value=v.map),v.alphaMap&&(_.alphaMap.value=v.alphaMap),v.specularMap&&(_.specularMap.value=v.specularMap),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest);const g=i.get(v).envMap;g&&(_.envMap.value=g,_.flipEnvMap.value=g.isCubeTexture&&g.isRenderTargetTexture===!1?-1:1,_.reflectivity.value=v.reflectivity,_.ior.value=v.ior,_.refractionRatio.value=v.refractionRatio),v.lightMap&&(_.lightMap.value=v.lightMap,_.lightMapIntensity.value=v.lightMapIntensity),v.aoMap&&(_.aoMap.value=v.aoMap,_.aoMapIntensity.value=v.aoMapIntensity);let x;v.map?x=v.map:v.specularMap?x=v.specularMap:v.displacementMap?x=v.displacementMap:v.normalMap?x=v.normalMap:v.bumpMap?x=v.bumpMap:v.roughnessMap?x=v.roughnessMap:v.metalnessMap?x=v.metalnessMap:v.alphaMap?x=v.alphaMap:v.emissiveMap?x=v.emissiveMap:v.clearcoatMap?x=v.clearcoatMap:v.clearcoatNormalMap?x=v.clearcoatNormalMap:v.clearcoatRoughnessMap?x=v.clearcoatRoughnessMap:v.specularIntensityMap?x=v.specularIntensityMap:v.specularColorMap?x=v.specularColorMap:v.transmissionMap?x=v.transmissionMap:v.thicknessMap?x=v.thicknessMap:v.sheenColorMap?x=v.sheenColorMap:v.sheenRoughnessMap&&(x=v.sheenRoughnessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),_.uvTransform.value.copy(x.matrix));let A;v.aoMap?A=v.aoMap:v.lightMap&&(A=v.lightMap),A!==void 0&&(A.isWebGLRenderTarget&&(A=A.texture),A.matrixAutoUpdate===!0&&A.updateMatrix(),_.uv2Transform.value.copy(A.matrix))}function s(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity}function r(_,v){_.dashSize.value=v.dashSize,_.totalSize.value=v.dashSize+v.gapSize,_.scale.value=v.scale}function a(_,v,g,x){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.size.value=v.size*g,_.scale.value=x*.5,v.map&&(_.map.value=v.map),v.alphaMap&&(_.alphaMap.value=v.alphaMap),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest);let A;v.map?A=v.map:v.alphaMap&&(A=v.alphaMap),A!==void 0&&(A.matrixAutoUpdate===!0&&A.updateMatrix(),_.uvTransform.value.copy(A.matrix))}function h(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.rotation.value=v.rotation,v.map&&(_.map.value=v.map),v.alphaMap&&(_.alphaMap.value=v.alphaMap),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest);let g;v.map?g=v.map:v.alphaMap&&(g=v.alphaMap),g!==void 0&&(g.matrixAutoUpdate===!0&&g.updateMatrix(),_.uvTransform.value.copy(g.matrix))}function o(_,v){v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap)}function l(_,v){_.specular.value.copy(v.specular),_.shininess.value=Math.max(v.shininess,1e-4),v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap),v.bumpMap&&(_.bumpMap.value=v.bumpMap,_.bumpScale.value=v.bumpScale,v.side===li&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,_.normalScale.value.copy(v.normalScale),v.side===li&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias)}function u(_,v){v.gradientMap&&(_.gradientMap.value=v.gradientMap),v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap),v.bumpMap&&(_.bumpMap.value=v.bumpMap,_.bumpScale.value=v.bumpScale,v.side===li&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,_.normalScale.value.copy(v.normalScale),v.side===li&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias)}function m(_,v){_.roughness.value=v.roughness,_.metalness.value=v.metalness,v.roughnessMap&&(_.roughnessMap.value=v.roughnessMap),v.metalnessMap&&(_.metalnessMap.value=v.metalnessMap),v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap),v.bumpMap&&(_.bumpMap.value=v.bumpMap,_.bumpScale.value=v.bumpScale,v.side===li&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,_.normalScale.value.copy(v.normalScale),v.side===li&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias),i.get(v).envMap&&(_.envMapIntensity.value=v.envMapIntensity)}function p(_,v,g){m(_,v),_.ior.value=v.ior,v.sheen>0&&(_.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),_.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(_.sheenColorMap.value=v.sheenColorMap),v.sheenRoughnessMap&&(_.sheenRoughnessMap.value=v.sheenRoughnessMap)),v.clearcoat>0&&(_.clearcoat.value=v.clearcoat,_.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(_.clearcoatMap.value=v.clearcoatMap),v.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap),v.clearcoatNormalMap&&(_.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),_.clearcoatNormalMap.value=v.clearcoatNormalMap,v.side===li&&_.clearcoatNormalScale.value.negate())),v.transmission>0&&(_.transmission.value=v.transmission,_.transmissionSamplerMap.value=g.texture,_.transmissionSamplerSize.value.set(g.width,g.height),v.transmissionMap&&(_.transmissionMap.value=v.transmissionMap),_.thickness.value=v.thickness,v.thicknessMap&&(_.thicknessMap.value=v.thicknessMap),_.attenuationDistance.value=v.attenuationDistance,_.attenuationColor.value.copy(v.attenuationColor)),_.specularIntensity.value=v.specularIntensity,_.specularColor.value.copy(v.specularColor),v.specularIntensityMap&&(_.specularIntensityMap.value=v.specularIntensityMap),v.specularColorMap&&(_.specularColorMap.value=v.specularColorMap)}function c(_,v){v.matcap&&(_.matcap.value=v.matcap),v.bumpMap&&(_.bumpMap.value=v.bumpMap,_.bumpScale.value=v.bumpScale,v.side===li&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,_.normalScale.value.copy(v.normalScale),v.side===li&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias)}function f(_,v){v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias)}function d(_,v){v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias),_.referencePosition.value.copy(v.referencePosition),_.nearDistance.value=v.nearDistance,_.farDistance.value=v.farDistance}function y(_,v){v.bumpMap&&(_.bumpMap.value=v.bumpMap,_.bumpScale.value=v.bumpScale,v.side===li&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,_.normalScale.value.copy(v.normalScale),v.side===li&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias)}return{refreshFogUniforms:t,refreshMaterialUniforms:e}}function yM(){const i=th("canvas");return i.style.display="block",i}function Te(i={}){const t=i.canvas!==void 0?i.canvas:yM(),e=i.context!==void 0?i.context:null,n=i.alpha!==void 0?i.alpha:!1,s=i.depth!==void 0?i.depth:!0,r=i.stencil!==void 0?i.stencil:!0,a=i.antialias!==void 0?i.antialias:!1,h=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,o=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,l=i.powerPreference!==void 0?i.powerPreference:"default",u=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let m=null,p=null;const c=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Cn,this.physicallyCorrectLights=!1,this.toneMapping=ws,this.toneMappingExposure=1;const d=this;let y=!1,_=0,v=0,g=null,x=-1,A=null;const b=new Pe,M=new Pe;let S=null,B=t.width,E=t.height,T=1,w=null,C=null;const P=new Pe(0,0,B,E),R=new Pe(0,0,B,E);let L=!1;const I=[],z=new xh;let F=!1,D=!1,V=null;const G=new Rt,Y=new k,J={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Q(){return g===null?T:1}let W=e;function et(O,$){for(let K=0;K<O.length;K++){const j=O[K],lt=t.getContext(j,$);if(lt!==null)return lt}return null}try{const O={alpha:n,depth:s,stencil:r,antialias:a,premultipliedAlpha:h,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${ql}`),t.addEventListener("webglcontextlost",zt,!1),t.addEventListener("webglcontextrestored",Tt,!1),W===null){const $=["webgl2","webgl","experimental-webgl"];if(d.isWebGL1Renderer===!0&&$.shift(),W=et($,O),W===null)throw et($)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}W.getShaderPrecisionFormat===void 0&&(W.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(O){throw console.error("THREE.WebGLRenderer: "+O.message),O}let ct,Z,ot,xt,q,X,at,ut,it,st,dt,mt,pt,U,N,rt,ht,At,ft,It,Ct,_t,H;function gt(){ct=new NA(W),Z=new PA(W,ct,i),ct.init(Z),_t=new fM(W,ct,Z),ot=new mM(W,ct,Z),I[0]=1029,xt=new HA(W),q=new eM,X=new pM(W,ct,ot,q,Z,_t,xt),at=new RA(d),ut=new VA(d),it=new ex(W,Z),H=new EA(W,ct,it,Z),st=new OA(W,it,xt,H),dt=new YA(W,st,it,xt),ft=new WA(W,Z,X),rt=new IA(q),mt=new tM(d,at,ut,ct,Z,H,rt),pt=new vM(q),U=new nM,N=new lM(ct,Z),At=new CA(d,at,ot,dt,h),ht=new wf(d,dt,Z),It=new LA(W,ct,xt,Z),Ct=new UA(W,ct,xt,Z),xt.programs=mt.programs,d.capabilities=Z,d.extensions=ct,d.properties=q,d.renderLists=U,d.shadowMap=ht,d.state=ot,d.info=xt}gt();const yt=new _M(d,W);this.xr=yt,this.getContext=function(){return W},this.getContextAttributes=function(){return W.getContextAttributes()},this.forceContextLoss=function(){const O=ct.get("WEBGL_lose_context");O&&O.loseContext()},this.forceContextRestore=function(){const O=ct.get("WEBGL_lose_context");O&&O.restoreContext()},this.getPixelRatio=function(){return T},this.setPixelRatio=function(O){O!==void 0&&(T=O,this.setSize(B,E,!1))},this.getSize=function(O){return O.set(B,E)},this.setSize=function(O,$,K){if(yt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}B=O,E=$,t.width=Math.floor(O*T),t.height=Math.floor($*T),K!==!1&&(t.style.width=O+"px",t.style.height=$+"px"),this.setViewport(0,0,O,$)},this.getDrawingBufferSize=function(O){return O.set(B*T,E*T).floor()},this.setDrawingBufferSize=function(O,$,K){B=O,E=$,T=K,t.width=Math.floor(O*K),t.height=Math.floor($*K),this.setViewport(0,0,O,$)},this.getCurrentViewport=function(O){return O.copy(b)},this.getViewport=function(O){return O.copy(P)},this.setViewport=function(O,$,K,j){O.isVector4?P.set(O.x,O.y,O.z,O.w):P.set(O,$,K,j),ot.viewport(b.copy(P).multiplyScalar(T).floor())},this.getScissor=function(O){return O.copy(R)},this.setScissor=function(O,$,K,j){O.isVector4?R.set(O.x,O.y,O.z,O.w):R.set(O,$,K,j),ot.scissor(M.copy(R).multiplyScalar(T).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(O){ot.setScissorTest(L=O)},this.setOpaqueSort=function(O){w=O},this.setTransparentSort=function(O){C=O},this.getClearColor=function(O){return O.copy(At.getClearColor())},this.setClearColor=function(){At.setClearColor.apply(At,arguments)},this.getClearAlpha=function(){return At.getClearAlpha()},this.setClearAlpha=function(){At.setClearAlpha.apply(At,arguments)},this.clear=function(O,$,K){let j=0;(O===void 0||O)&&(j|=16384),($===void 0||$)&&(j|=256),(K===void 0||K)&&(j|=1024),W.clear(j)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",zt,!1),t.removeEventListener("webglcontextrestored",Tt,!1),U.dispose(),N.dispose(),q.dispose(),at.dispose(),ut.dispose(),dt.dispose(),H.dispose(),mt.dispose(),yt.dispose(),yt.removeEventListener("sessionstart",sn),yt.removeEventListener("sessionend",mi),V&&(V.dispose(),V=null),Us.stop()};function zt(O){O.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function Tt(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const O=xt.autoReset,$=ht.enabled,K=ht.autoUpdate,j=ht.needsUpdate,lt=ht.type;gt(),xt.autoReset=O,ht.enabled=$,ht.autoUpdate=K,ht.needsUpdate=j,ht.type=lt}function Gt(O){const $=O.target;$.removeEventListener("dispose",Gt),bt($)}function bt(O){Pt(O),q.remove(O)}function Pt(O){const $=q.get(O).programs;$!==void 0&&($.forEach(function(K){mt.releaseProgram(K)}),O.isShaderMaterial&&mt.releaseShaderCache(O))}this.renderBufferDirect=function(O,$,K,j,lt,Ft){$===null&&($=J);const Nt=lt.isMesh&&lt.matrixWorld.determinant()<0,$t=xd(O,$,K,j,lt);ot.setMaterial(j,Nt);let Vt=K.index;const le=K.attributes.position;if(Vt===null){if(le===void 0||le.count===0)return}else if(Vt.count===0)return;let Xt=1;j.wireframe===!0&&(Vt=st.getWireframeAttribute(K),Xt=2),H.setup(lt,j,$t,K,Vt);let ae,Je=It;Vt!==null&&(ae=it.get(Vt),Je=Ct,Je.setIndex(ae));const Hs=Vt!==null?Vt.count:le.count,ar=K.drawRange.start*Xt,fe=K.drawRange.count*Xt,Rn=Ft!==null?Ft.start*Xt:0,ni=Ft!==null?Ft.count*Xt:1/0,Dn=Math.max(ar,Rn),oa=Math.min(Hs,ar+fe,Rn+ni)-1,zn=Math.max(0,oa-Dn+1);if(zn!==0){if(lt.isMesh)j.wireframe===!0?(ot.setLineWidth(j.wireframeLinewidth*Q()),Je.setMode(1)):Je.setMode(4);else if(lt.isLine){let Jn=j.linewidth;Jn===void 0&&(Jn=1),ot.setLineWidth(Jn*Q()),lt.isLineSegments?Je.setMode(1):lt.isLineLoop?Je.setMode(2):Je.setMode(3)}else lt.isPoints?Je.setMode(0):lt.isSprite&&Je.setMode(4);if(lt.isInstancedMesh)Je.renderInstances(Dn,zn,lt.count);else if(K.isInstancedBufferGeometry){const Jn=Math.min(K.instanceCount,K._maxInstanceCount);Je.renderInstances(Dn,zn,Jn)}else Je.render(Dn,zn)}},this.compile=function(O,$){p=N.get(O),p.init(),f.push(p),O.traverseVisible(function(K){K.isLight&&K.layers.test($.layers)&&(p.pushLight(K),K.castShadow&&p.pushShadow(K))}),p.setupLights(d.physicallyCorrectLights),O.traverse(function(K){const j=K.material;if(j)if(Array.isArray(j))for(let lt=0;lt<j.length;lt++){const Ft=j[lt];kh(Ft,O,K)}else kh(j,O,K)}),f.pop(),p=null};let pe=null;function ce(O){pe&&pe(O)}function sn(){Us.stop()}function mi(){Us.start()}const Us=new Hp;Us.setAnimationLoop(ce),typeof window!="undefined"&&Us.setContext(window),this.setAnimationLoop=function(O){pe=O,yt.setAnimationLoop(O),O===null?Us.stop():Us.start()},yt.addEventListener("sessionstart",sn),yt.addEventListener("sessionend",mi),this.render=function(O,$){if($!==void 0&&$.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;O.autoUpdate===!0&&O.updateMatrixWorld(),$.parent===null&&$.updateMatrixWorld(),yt.enabled===!0&&yt.isPresenting===!0&&(yt.cameraAutoUpdate===!0&&yt.updateCamera($),$=yt.getCamera()),O.isScene===!0&&O.onBeforeRender(d,O,$,g),p=N.get(O,f.length),p.init(),f.push(p),G.multiplyMatrices($.projectionMatrix,$.matrixWorldInverse),z.setFromProjectionMatrix(G),D=this.localClippingEnabled,F=rt.init(this.clippingPlanes,D,$),m=U.get(O,c.length),m.init(),c.push(m),uu(O,$,0,d.sortObjects),m.finish(),d.sortObjects===!0&&m.sort(w,C),F===!0&&rt.beginShadows();const K=p.state.shadowsArray;if(ht.render(K,O,$),F===!0&&rt.endShadows(),this.info.autoReset===!0&&this.info.reset(),At.render(m,O),p.setupLights(d.physicallyCorrectLights),$.isArrayCamera){const j=$.cameras;for(let lt=0,Ft=j.length;lt<Ft;lt++){const Nt=j[lt];mu(m,O,Nt,Nt.viewport)}}else mu(m,O,$);g!==null&&(X.updateMultisampleRenderTarget(g),X.updateRenderTargetMipmap(g)),O.isScene===!0&&O.onAfterRender(d,O,$),ot.buffers.depth.setTest(!0),ot.buffers.depth.setMask(!0),ot.buffers.color.setMask(!0),ot.setPolygonOffset(!1),H.resetDefaultState(),x=-1,A=null,f.pop(),f.length>0?p=f[f.length-1]:p=null,c.pop(),c.length>0?m=c[c.length-1]:m=null};function uu(O,$,K,j){if(O.visible===!1)return;if(O.layers.test($.layers)){if(O.isGroup)K=O.renderOrder;else if(O.isLOD)O.autoUpdate===!0&&O.update($);else if(O.isLight)p.pushLight(O),O.castShadow&&p.pushShadow(O);else if(O.isSprite){if(!O.frustumCulled||z.intersectsSprite(O)){j&&Y.setFromMatrixPosition(O.matrixWorld).applyMatrix4(G);const Nt=dt.update(O),$t=O.material;$t.visible&&m.push(O,Nt,$t,K,Y.z,null)}}else if((O.isMesh||O.isLine||O.isPoints)&&(O.isSkinnedMesh&&O.skeleton.frame!==xt.render.frame&&(O.skeleton.update(),O.skeleton.frame=xt.render.frame),!O.frustumCulled||z.intersectsObject(O))){j&&Y.setFromMatrixPosition(O.matrixWorld).applyMatrix4(G);const Nt=dt.update(O),$t=O.material;if(Array.isArray($t)){const Vt=Nt.groups;for(let le=0,Xt=Vt.length;le<Xt;le++){const ae=Vt[le],Je=$t[ae.materialIndex];Je&&Je.visible&&m.push(O,Nt,Je,K,Y.z,ae)}}else $t.visible&&m.push(O,Nt,$t,K,Y.z,null)}}const Ft=O.children;for(let Nt=0,$t=Ft.length;Nt<$t;Nt++)uu(Ft[Nt],$,K,j)}function mu(O,$,K,j){const lt=O.opaque,Ft=O.transmissive,Nt=O.transparent;p.setupLightsView(K),Ft.length>0&&yd(lt,$,K),j&&ot.viewport(b.copy(j)),lt.length>0&&ra(lt,$,K),Ft.length>0&&ra(Ft,$,K),Nt.length>0&&ra(Nt,$,K)}function yd(O,$,K){if(V===null){const Nt=a===!0&&Z.isWebGL2===!0?oc:pn;V=new Nt(1024,1024,{generateMipmaps:!0,type:_t.convert(Ks)!==null?Ks:es,minFilter:$a,magFilter:ci,wrapS:Qi,wrapT:Qi,useRenderToTexture:ct.has("WEBGL_multisampled_render_to_texture")})}const j=d.getRenderTarget();d.setRenderTarget(V),d.clear();const lt=d.toneMapping;d.toneMapping=ws,ra(O,$,K),d.toneMapping=lt,X.updateMultisampleRenderTarget(V),X.updateRenderTargetMipmap(V),d.setRenderTarget(j)}function ra(O,$,K){const j=$.isScene===!0?$.overrideMaterial:null;for(let lt=0,Ft=O.length;lt<Ft;lt++){const Nt=O[lt],$t=Nt.object,Vt=Nt.geometry,le=j===null?Nt.material:j,Xt=Nt.group;$t.layers.test(K.layers)&&gd($t,$,K,Vt,le,Xt)}}function gd(O,$,K,j,lt,Ft){O.onBeforeRender(d,$,K,j,lt,Ft),O.modelViewMatrix.multiplyMatrices(K.matrixWorldInverse,O.matrixWorld),O.normalMatrix.getNormalMatrix(O.modelViewMatrix),lt.onBeforeRender(d,$,K,j,O,Ft),lt.transparent===!0&&lt.side===gr?(lt.side=li,lt.needsUpdate=!0,d.renderBufferDirect(K,$,j,lt,O,Ft),lt.side=Lo,lt.needsUpdate=!0,d.renderBufferDirect(K,$,j,lt,O,Ft),lt.side=gr):d.renderBufferDirect(K,$,j,lt,O,Ft),O.onAfterRender(d,$,K,j,lt,Ft)}function kh(O,$,K){$.isScene!==!0&&($=J);const j=q.get(O),lt=p.state.lights,Ft=p.state.shadowsArray,Nt=lt.state.version,$t=mt.getParameters(O,lt.state,Ft,$,K),Vt=mt.getProgramCacheKey($t);let le=j.programs;j.environment=O.isMeshStandardMaterial?$.environment:null,j.fog=$.fog,j.envMap=(O.isMeshStandardMaterial?ut:at).get(O.envMap||j.environment),le===void 0&&(O.addEventListener("dispose",Gt),le=new Map,j.programs=le);let Xt=le.get(Vt);if(Xt!==void 0){if(j.currentProgram===Xt&&j.lightsStateVersion===Nt)return pu(O,$t),Xt}else $t.uniforms=mt.getUniforms(O),O.onBuild(K,$t,d),O.onBeforeCompile($t,d),Xt=mt.acquireProgram($t,Vt),le.set(Vt,Xt),j.uniforms=$t.uniforms;const ae=j.uniforms;(!O.isShaderMaterial&&!O.isRawShaderMaterial||O.clipping===!0)&&(ae.clippingPlanes=rt.uniform),pu(O,$t),j.needsLights=bd(O),j.lightsStateVersion=Nt,j.needsLights&&(ae.ambientLightColor.value=lt.state.ambient,ae.lightProbe.value=lt.state.probe,ae.directionalLights.value=lt.state.directional,ae.directionalLightShadows.value=lt.state.directionalShadow,ae.spotLights.value=lt.state.spot,ae.spotLightShadows.value=lt.state.spotShadow,ae.rectAreaLights.value=lt.state.rectArea,ae.ltc_1.value=lt.state.rectAreaLTC1,ae.ltc_2.value=lt.state.rectAreaLTC2,ae.pointLights.value=lt.state.point,ae.pointLightShadows.value=lt.state.pointShadow,ae.hemisphereLights.value=lt.state.hemi,ae.directionalShadowMap.value=lt.state.directionalShadowMap,ae.directionalShadowMatrix.value=lt.state.directionalShadowMatrix,ae.spotShadowMap.value=lt.state.spotShadowMap,ae.spotShadowMatrix.value=lt.state.spotShadowMatrix,ae.pointShadowMap.value=lt.state.pointShadowMap,ae.pointShadowMatrix.value=lt.state.pointShadowMatrix);const Je=Xt.getUniforms(),Hs=Ds.seqWithValue(Je.seq,ae);return j.currentProgram=Xt,j.uniformsList=Hs,Xt}function pu(O,$){const K=q.get(O);K.outputEncoding=$.outputEncoding,K.instancing=$.instancing,K.skinning=$.skinning,K.morphTargets=$.morphTargets,K.morphNormals=$.morphNormals,K.morphTargetsCount=$.morphTargetsCount,K.numClippingPlanes=$.numClippingPlanes,K.numIntersection=$.numClipIntersection,K.vertexAlphas=$.vertexAlphas,K.vertexTangents=$.vertexTangents,K.toneMapping=$.toneMapping}function xd(O,$,K,j,lt){$.isScene!==!0&&($=J),X.resetTextureUnits();const Ft=$.fog,Nt=j.isMeshStandardMaterial?$.environment:null,$t=g===null?d.outputEncoding:g.texture.encoding,Vt=(j.isMeshStandardMaterial?ut:at).get(j.envMap||Nt),le=j.vertexColors===!0&&!!K.attributes.color&&K.attributes.color.itemSize===4,Xt=!!j.normalMap&&!!K.attributes.tangent,ae=!!K.morphAttributes.position,Je=!!K.morphAttributes.normal,Hs=K.morphAttributes.position?K.morphAttributes.position.length:0,ar=j.toneMapped?d.toneMapping:ws,fe=q.get(j),Rn=p.state.lights;if(F===!0&&(D===!0||O!==A)){const _n=O===A&&j.id===x;rt.setState(j,O,_n)}let ni=!1;j.version===fe.__version?(fe.needsLights&&fe.lightsStateVersion!==Rn.state.version||fe.outputEncoding!==$t||lt.isInstancedMesh&&fe.instancing===!1||!lt.isInstancedMesh&&fe.instancing===!0||lt.isSkinnedMesh&&fe.skinning===!1||!lt.isSkinnedMesh&&fe.skinning===!0||fe.envMap!==Vt||j.fog&&fe.fog!==Ft||fe.numClippingPlanes!==void 0&&(fe.numClippingPlanes!==rt.numPlanes||fe.numIntersection!==rt.numIntersection)||fe.vertexAlphas!==le||fe.vertexTangents!==Xt||fe.morphTargets!==ae||fe.morphNormals!==Je||fe.toneMapping!==ar||Z.isWebGL2===!0&&fe.morphTargetsCount!==Hs)&&(ni=!0):(ni=!0,fe.__version=j.version);let Dn=fe.currentProgram;ni===!0&&(Dn=kh(j,$,lt));let oa=!1,zn=!1,Jn=!1;const Bi=Dn.getUniforms(),so=fe.uniforms;if(ot.useProgram(Dn.program)&&(oa=!0,zn=!0,Jn=!0),j.id!==x&&(x=j.id,zn=!0),oa||A!==O){if(Bi.setValue(W,"projectionMatrix",O.projectionMatrix),Z.logarithmicDepthBuffer&&Bi.setValue(W,"logDepthBufFC",2/(Math.log(O.far+1)/Math.LN2)),A!==O&&(A=O,zn=!0,Jn=!0),j.isShaderMaterial||j.isMeshPhongMaterial||j.isMeshToonMaterial||j.isMeshStandardMaterial||j.envMap){const _n=Bi.map.cameraPosition;_n!==void 0&&_n.setValue(W,Y.setFromMatrixPosition(O.matrixWorld))}(j.isMeshPhongMaterial||j.isMeshToonMaterial||j.isMeshLambertMaterial||j.isMeshBasicMaterial||j.isMeshStandardMaterial||j.isShaderMaterial)&&Bi.setValue(W,"isOrthographic",O.isOrthographicCamera===!0),(j.isMeshPhongMaterial||j.isMeshToonMaterial||j.isMeshLambertMaterial||j.isMeshBasicMaterial||j.isMeshStandardMaterial||j.isShaderMaterial||j.isShadowMaterial||lt.isSkinnedMesh)&&Bi.setValue(W,"viewMatrix",O.matrixWorldInverse)}if(lt.isSkinnedMesh){Bi.setOptional(W,lt,"bindMatrix"),Bi.setOptional(W,lt,"bindMatrixInverse");const _n=lt.skeleton;_n&&(Z.floatVertexTextures?(_n.boneTexture===null&&_n.computeBoneTexture(),Bi.setValue(W,"boneTexture",_n.boneTexture,X),Bi.setValue(W,"boneTextureSize",_n.boneTextureSize)):Bi.setOptional(W,_n,"boneMatrices"))}return!!K&&(K.morphAttributes.position!==void 0||K.morphAttributes.normal!==void 0)&&ft.update(lt,K,j,Dn),(zn||fe.receiveShadow!==lt.receiveShadow)&&(fe.receiveShadow=lt.receiveShadow,Bi.setValue(W,"receiveShadow",lt.receiveShadow)),zn&&(Bi.setValue(W,"toneMappingExposure",d.toneMappingExposure),fe.needsLights&&Ad(so,Jn),Ft&&j.fog&&pt.refreshFogUniforms(so,Ft),pt.refreshMaterialUniforms(so,j,T,E,V),Ds.upload(W,fe.uniformsList,so,X)),j.isShaderMaterial&&j.uniformsNeedUpdate===!0&&(Ds.upload(W,fe.uniformsList,so,X),j.uniformsNeedUpdate=!1),j.isSpriteMaterial&&Bi.setValue(W,"center",lt.center),Bi.setValue(W,"modelViewMatrix",lt.modelViewMatrix),Bi.setValue(W,"normalMatrix",lt.normalMatrix),Bi.setValue(W,"modelMatrix",lt.matrixWorld),Dn}function Ad(O,$){O.ambientLightColor.needsUpdate=$,O.lightProbe.needsUpdate=$,O.directionalLights.needsUpdate=$,O.directionalLightShadows.needsUpdate=$,O.pointLights.needsUpdate=$,O.pointLightShadows.needsUpdate=$,O.spotLights.needsUpdate=$,O.spotLightShadows.needsUpdate=$,O.rectAreaLights.needsUpdate=$,O.hemisphereLights.needsUpdate=$}function bd(O){return O.isMeshLambertMaterial||O.isMeshToonMaterial||O.isMeshPhongMaterial||O.isMeshStandardMaterial||O.isShadowMaterial||O.isShaderMaterial&&O.lights===!0}this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return g},this.setRenderTargetTextures=function(O,$,K){q.get(O.texture).__webglTexture=$,q.get(O.depthTexture).__webglTexture=K;const j=q.get(O);j.__hasExternalTextures=!0,j.__hasExternalTextures&&(j.__autoAllocateDepthBuffer=K===void 0,j.__autoAllocateDepthBuffer||O.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),O.useRenderToTexture=!1,O.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(O,$){const K=q.get(O);K.__webglFramebuffer=$,K.__useDefaultFramebuffer=$===void 0},this.setRenderTarget=function(O,$=0,K=0){g=O,_=$,v=K;let j=!0;if(O){const Vt=q.get(O);Vt.__useDefaultFramebuffer!==void 0?(ot.bindFramebuffer(36160,null),j=!1):Vt.__webglFramebuffer===void 0?X.setupRenderTarget(O):Vt.__hasExternalTextures&&X.rebindTextures(O,q.get(O.texture).__webglTexture,q.get(O.depthTexture).__webglTexture)}let lt=null,Ft=!1,Nt=!1;if(O){const Vt=O.texture;(Vt.isDataTexture3D||Vt.isDataTexture2DArray)&&(Nt=!0);const le=q.get(O).__webglFramebuffer;O.isWebGLCubeRenderTarget?(lt=le[$],Ft=!0):O.useRenderbuffer?lt=q.get(O).__webglMultisampledFramebuffer:lt=le,b.copy(O.viewport),M.copy(O.scissor),S=O.scissorTest}else b.copy(P).multiplyScalar(T).floor(),M.copy(R).multiplyScalar(T).floor(),S=L;if(ot.bindFramebuffer(36160,lt)&&Z.drawBuffers&&j){let Vt=!1;if(O)if(O.isWebGLMultipleRenderTargets){const le=O.texture;if(I.length!==le.length||I[0]!==36064){for(let Xt=0,ae=le.length;Xt<ae;Xt++)I[Xt]=36064+Xt;I.length=le.length,Vt=!0}}else(I.length!==1||I[0]!==36064)&&(I[0]=36064,I.length=1,Vt=!0);else(I.length!==1||I[0]!==1029)&&(I[0]=1029,I.length=1,Vt=!0);Vt&&(Z.isWebGL2?W.drawBuffers(I):ct.get("WEBGL_draw_buffers").drawBuffersWEBGL(I))}if(ot.viewport(b),ot.scissor(M),ot.setScissorTest(S),Ft){const Vt=q.get(O.texture);W.framebufferTexture2D(36160,36064,34069+$,Vt.__webglTexture,K)}else if(Nt){const Vt=q.get(O.texture),le=$||0;W.framebufferTextureLayer(36160,36064,Vt.__webglTexture,K||0,le)}x=-1},this.readRenderTargetPixels=function(O,$,K,j,lt,Ft,Nt){if(!(O&&O.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let $t=q.get(O).__webglFramebuffer;if(O.isWebGLCubeRenderTarget&&Nt!==void 0&&($t=$t[Nt]),$t){ot.bindFramebuffer(36160,$t);try{const Vt=O.texture,le=Vt.format,Xt=Vt.type;if(le!==di&&_t.convert(le)!==W.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ae=Xt===Ks&&(ct.has("EXT_color_buffer_half_float")||Z.isWebGL2&&ct.has("EXT_color_buffer_float"));if(Xt!==es&&_t.convert(Xt)!==W.getParameter(35738)&&!(Xt===Ss&&(Z.isWebGL2||ct.has("OES_texture_float")||ct.has("WEBGL_color_buffer_float")))&&!ae){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}W.checkFramebufferStatus(36160)===36053?$>=0&&$<=O.width-j&&K>=0&&K<=O.height-lt&&W.readPixels($,K,j,lt,_t.convert(le),_t.convert(Xt),Ft):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const Vt=g!==null?q.get(g).__webglFramebuffer:null;ot.bindFramebuffer(36160,Vt)}}},this.copyFramebufferToTexture=function(O,$,K=0){if($.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}const j=Math.pow(2,-K),lt=Math.floor($.image.width*j),Ft=Math.floor($.image.height*j);X.setTexture2D($,0),W.copyTexSubImage2D(3553,K,0,0,O.x,O.y,lt,Ft),ot.unbindTexture()},this.copyTextureToTexture=function(O,$,K,j=0){const lt=$.image.width,Ft=$.image.height,Nt=_t.convert(K.format),$t=_t.convert(K.type);X.setTexture2D(K,0),W.pixelStorei(37440,K.flipY),W.pixelStorei(37441,K.premultiplyAlpha),W.pixelStorei(3317,K.unpackAlignment),$.isDataTexture?W.texSubImage2D(3553,j,O.x,O.y,lt,Ft,Nt,$t,$.image.data):$.isCompressedTexture?W.compressedTexSubImage2D(3553,j,O.x,O.y,$.mipmaps[0].width,$.mipmaps[0].height,Nt,$.mipmaps[0].data):W.texSubImage2D(3553,j,O.x,O.y,Nt,$t,$.image),j===0&&K.generateMipmaps&&W.generateMipmap(3553),ot.unbindTexture()},this.copyTextureToTexture3D=function(O,$,K,j,lt=0){if(d.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Ft=O.max.x-O.min.x+1,Nt=O.max.y-O.min.y+1,$t=O.max.z-O.min.z+1,Vt=_t.convert(j.format),le=_t.convert(j.type);let Xt;if(j.isDataTexture3D)X.setTexture3D(j,0),Xt=32879;else if(j.isDataTexture2DArray)X.setTexture2DArray(j,0),Xt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}W.pixelStorei(37440,j.flipY),W.pixelStorei(37441,j.premultiplyAlpha),W.pixelStorei(3317,j.unpackAlignment);const ae=W.getParameter(3314),Je=W.getParameter(32878),Hs=W.getParameter(3316),ar=W.getParameter(3315),fe=W.getParameter(32877),Rn=K.isCompressedTexture?K.mipmaps[0]:K.image;W.pixelStorei(3314,Rn.width),W.pixelStorei(32878,Rn.height),W.pixelStorei(3316,O.min.x),W.pixelStorei(3315,O.min.y),W.pixelStorei(32877,O.min.z),K.isDataTexture||K.isDataTexture3D?W.texSubImage3D(Xt,lt,$.x,$.y,$.z,Ft,Nt,$t,Vt,le,Rn.data):K.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),W.compressedTexSubImage3D(Xt,lt,$.x,$.y,$.z,Ft,Nt,$t,Vt,Rn.data)):W.texSubImage3D(Xt,lt,$.x,$.y,$.z,Ft,Nt,$t,Vt,le,Rn),W.pixelStorei(3314,ae),W.pixelStorei(32878,Je),W.pixelStorei(3316,Hs),W.pixelStorei(3315,ar),W.pixelStorei(32877,fe),lt===0&&j.generateMipmaps&&W.generateMipmap(Xt),ot.unbindTexture()},this.initTexture=function(O){X.setTexture2D(O,0),ot.unbindTexture()},this.resetState=function(){_=0,v=0,g=null,ot.reset(),H.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Te.prototype.isWebGLRenderer=!0;class gM extends Te{}gM.prototype.isWebGL1Renderer=!0;class Bf extends we{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),e}}Bf.prototype.isScene=!0;class Wo{constructor(t,e){this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=zo,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Gn()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let s=0,r=this.stride;s<r;s++)this.array[t+s]=e.array[n+s];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Gn()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Gn()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Wo.prototype.isInterleavedBuffer=!0;const Xe=new k;class Yo{constructor(t,e,n,s=!1){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=s===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Xe.x=this.getX(e),Xe.y=this.getY(e),Xe.z=this.getZ(e),Xe.applyMatrix4(t),this.setXYZ(e,Xe.x,Xe.y,Xe.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Xe.x=this.getX(e),Xe.y=this.getY(e),Xe.z=this.getZ(e),Xe.applyNormalMatrix(t),this.setXYZ(e,Xe.x,Xe.y,Xe.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Xe.x=this.getX(e),Xe.y=this.getY(e),Xe.z=this.getZ(e),Xe.transformDirection(t),this.setXYZ(e,Xe.x,Xe.y,Xe.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,s){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=s,this}setXYZW(t,e,n,s,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=s,this.data.array[t+3]=r,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[s+r])}return new ui(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Yo(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Yo.prototype.isInterleavedBufferAttribute=!0;class Tf extends Ri{constructor(t){super();this.type="SpriteMaterial",this.color=new Et(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}Tf.prototype.isSpriteMaterial=!0;let Xr;const qo=new k,jr=new k,Zr=new k,Kr=new vt,Jo=new vt,Cf=new Rt,Bh=new k,$o=new k,Th=new k,Ef=new vt,Gc=new vt,Lf=new vt;class xM extends we{constructor(t){super();if(this.type="Sprite",Xr===void 0){Xr=new Ge;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Wo(e,5);Xr.setIndex([0,1,2,0,2,3]),Xr.setAttribute("position",new Yo(n,3,0,!1)),Xr.setAttribute("uv",new Yo(n,2,3,!1))}this.geometry=Xr,this.material=t!==void 0?t:new Tf,this.center=new vt(.5,.5)}raycast(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),jr.setFromMatrixScale(this.matrixWorld),Cf.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Zr.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&jr.multiplyScalar(-Zr.z);const n=this.material.rotation;let s,r;n!==0&&(r=Math.cos(n),s=Math.sin(n));const a=this.center;Ch(Bh.set(-.5,-.5,0),Zr,a,jr,s,r),Ch($o.set(.5,-.5,0),Zr,a,jr,s,r),Ch(Th.set(.5,.5,0),Zr,a,jr,s,r),Ef.set(0,0),Gc.set(1,0),Lf.set(1,1);let h=t.ray.intersectTriangle(Bh,$o,Th,!1,qo);if(h===null&&(Ch($o.set(-.5,.5,0),Zr,a,jr,s,r),Gc.set(0,1),h=t.ray.intersectTriangle(Bh,Th,$o,!1,qo),h===null))return;const o=t.ray.origin.distanceTo(qo);o<t.near||o>t.far||e.push({distance:o,point:qo.clone(),uv:ii.getUV(qo,Bh,$o,Th,Ef,Gc,Lf,new vt),face:null,object:this})}copy(t){return super.copy(t),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}xM.prototype.isSprite=!0;function Ch(i,t,e,n,s,r){Kr.subVectors(i,e).addScalar(.5).multiply(n),s!==void 0?(Jo.x=r*Kr.x-s*Kr.y,Jo.y=s*Kr.x+r*Kr.y):Jo.copy(Kr),i.copy(t),i.x+=Jo.x,i.y+=Jo.y,i.applyMatrix4(Cf)}const Pf=new k,If=new Pe,Rf=new Pe,AM=new k,Df=new Rt;class zf extends $i{constructor(t,e){super(t,e);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Rt,this.bindMatrixInverse=new Rt}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Pe,e=this.geometry.attributes.skinWeight;for(let n=0,s=e.count;n<s;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const n=this.skeleton,s=this.geometry;If.fromBufferAttribute(s.attributes.skinIndex,t),Rf.fromBufferAttribute(s.attributes.skinWeight,t),Pf.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const a=Rf.getComponent(r);if(a!==0){const h=If.getComponent(r);Df.multiplyMatrices(n.bones[h].matrixWorld,n.boneInverses[h]),e.addScaledVector(AM.copy(Pf).applyMatrix4(Df),a)}}return e.applyMatrix4(this.bindMatrixInverse)}}zf.prototype.isSkinnedMesh=!0;class bM extends we{constructor(){super();this.type="Bone"}}bM.prototype.isBone=!0;class MM extends _i{constructor(t=null,e=1,n=1,s,r,a,h,o,l=ci,u=ci,m,p){super(null,a,h,o,l,u,s,r,m,p);this.image={data:t,width:e,height:n},this.magFilter=l,this.minFilter=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}MM.prototype.isDataTexture=!0;class kc extends ui{constructor(t,e,n,s=1){typeof n=="number"&&(s=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(t,e,n);this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}kc.prototype.isInstancedBufferAttribute=!0;const Ff=new Rt,Vf=new Rt,Eh=[],Xo=new $i;class wM extends $i{constructor(t,e,n){super(t,e);this.instanceMatrix=new kc(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){const n=this.matrixWorld,s=this.count;if(Xo.geometry=this.geometry,Xo.material=this.material,Xo.material!==void 0)for(let r=0;r<s;r++){this.getMatrixAt(r,Ff),Vf.multiplyMatrices(n,Ff),Xo.matrixWorld=Vf,Xo.raycast(t,Eh);for(let a=0,h=Eh.length;a<h;a++){const o=Eh[a];o.instanceId=r,o.object=this,e.push(o)}Eh.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new kc(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}wM.prototype.isInstancedMesh=!0;class jo extends Ri{constructor(t){super();this.type="LineBasicMaterial",this.color=new Et(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}jo.prototype.isLineBasicMaterial=!0;const Nf=new k,Of=new k,Uf=new Rt,Wc=new Rr,Lh=new Ir;class Yc extends we{constructor(t=new Ge,e=new jo){super();this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(t.index===null){const e=t.attributes.position,n=[0];for(let s=1,r=e.count;s<r;s++)Nf.fromBufferAttribute(e,s-1),Of.fromBufferAttribute(e,s),n[s]=n[s-1],n[s]+=Nf.distanceTo(Of);t.setAttribute("lineDistance",new vi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const n=this.geometry,s=this.matrixWorld,r=t.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Lh.copy(n.boundingSphere),Lh.applyMatrix4(s),Lh.radius+=r,t.ray.intersectsSphere(Lh)===!1)return;Uf.copy(s).invert(),Wc.copy(t.ray).applyMatrix4(Uf);const h=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=h*h,l=new k,u=new k,m=new k,p=new k,c=this.isLineSegments?2:1;if(n.isBufferGeometry){const f=n.index,y=n.attributes.position;if(f!==null){const _=Math.max(0,a.start),v=Math.min(f.count,a.start+a.count);for(let g=_,x=v-1;g<x;g+=c){const A=f.getX(g),b=f.getX(g+1);if(l.fromBufferAttribute(y,A),u.fromBufferAttribute(y,b),Wc.distanceSqToSegment(l,u,p,m)>o)continue;p.applyMatrix4(this.matrixWorld);const S=t.ray.origin.distanceTo(p);S<t.near||S>t.far||e.push({distance:S,point:m.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}else{const _=Math.max(0,a.start),v=Math.min(y.count,a.start+a.count);for(let g=_,x=v-1;g<x;g+=c){if(l.fromBufferAttribute(y,g),u.fromBufferAttribute(y,g+1),Wc.distanceSqToSegment(l,u,p,m)>o)continue;p.applyMatrix4(this.matrixWorld);const b=t.ray.origin.distanceTo(p);b<t.near||b>t.far||e.push({distance:b,point:m.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const h=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[h]=r}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Yc.prototype.isLine=!0;const Hf=new k,Gf=new k;class qc extends Yc{constructor(t,e){super(t,e);this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(t.index===null){const e=t.attributes.position,n=[];for(let s=0,r=e.count;s<r;s+=2)Hf.fromBufferAttribute(e,s),Gf.fromBufferAttribute(e,s+1),n[s]=s===0?0:n[s-1],n[s+1]=n[s]+Hf.distanceTo(Gf);t.setAttribute("lineDistance",new vi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}qc.prototype.isLineSegments=!0;class SM extends Yc{constructor(t,e){super(t,e);this.type="LineLoop"}}SM.prototype.isLineLoop=!0;class kf extends Ri{constructor(t){super();this.type="PointsMaterial",this.color=new Et(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}kf.prototype.isPointsMaterial=!0;const Wf=new Rt,Jc=new Rr,Ph=new Ir,Ih=new k;class BM extends we{constructor(t=new Ge,e=new kf){super();this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,s=this.matrixWorld,r=t.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Ph.copy(n.boundingSphere),Ph.applyMatrix4(s),Ph.radius+=r,t.ray.intersectsSphere(Ph)===!1)return;Wf.copy(s).invert(),Jc.copy(t.ray).applyMatrix4(Wf);const h=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=h*h;if(n.isBufferGeometry){const l=n.index,m=n.attributes.position;if(l!==null){const p=Math.max(0,a.start),c=Math.min(l.count,a.start+a.count);for(let f=p,d=c;f<d;f++){const y=l.getX(f);Ih.fromBufferAttribute(m,y),Yf(Ih,y,o,s,t,e,this)}}else{const p=Math.max(0,a.start),c=Math.min(m.count,a.start+a.count);for(let f=p,d=c;f<d;f++)Ih.fromBufferAttribute(m,f),Yf(Ih,f,o,s,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){const h=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[h]=r}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}BM.prototype.isPoints=!0;function Yf(i,t,e,n,s,r,a){const h=Jc.distanceSqToPoint(i);if(h<e){const o=new k;Jc.closestPointToPoint(i,o),o.applyMatrix4(n);const l=s.ray.origin.distanceTo(o);if(l<s.near||l>s.far)return;r.push({distance:l,distanceToRay:Math.sqrt(h),point:o,index:t,face:null,object:a})}}class TM extends _i{constructor(t,e,n,s,r,a,h,o,l){super(t,e,n,s,r,a,h,o,l);this.format=h!==void 0?h:Qs,this.minFilter=a!==void 0?a:Gi,this.magFilter=r!==void 0?r:Gi,this.generateMipmaps=!1;const u=this;function m(){u.needsUpdate=!0,t.requestVideoFrameCallback(m)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(m)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}TM.prototype.isVideoTexture=!0;class CM extends _i{constructor(t,e,n){super({width:t,height:e});this.format=n,this.magFilter=ci,this.minFilter=ci,this.generateMipmaps=!1,this.needsUpdate=!0}}CM.prototype.isFramebufferTexture=!0;class EM extends _i{constructor(t,e,n,s,r,a,h,o,l,u,m,p){super(null,a,h,o,l,u,s,r,m,p);this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}EM.prototype.isCompressedTexture=!0;class LM extends _i{constructor(t,e,n,s,r,a,h,o,l){super(t,e,n,s,r,a,h,o,l);this.needsUpdate=!0}}LM.prototype.isCanvasTexture=!0;new k;new k;new k;new ii;class dn{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,s=this.getPoint(0),r=0;e.push(0);for(let a=1;a<=t;a++)n=this.getPoint(a/t),r+=n.distanceTo(s),e.push(r),s=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let s=0;const r=n.length;let a;e?a=e:a=t*n[r-1];let h=0,o=r-1,l;for(;h<=o;)if(s=Math.floor(h+(o-h)/2),l=n[s]-a,l<0)h=s+1;else if(l>0)o=s-1;else{o=s;break}if(s=o,n[s]===a)return s/(r-1);const u=n[s],p=n[s+1]-u,c=(a-u)/p;return(s+c)/(r-1)}getTangent(t,e){const n=1e-4;let s=t-n,r=t+n;s<0&&(s=0),r>1&&(r=1);const a=this.getPoint(s),h=this.getPoint(r),o=e||(a.isVector2?new vt:new k);return o.copy(h).sub(a).normalize(),o}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new k,s=[],r=[],a=[],h=new k,o=new Rt;for(let c=0;c<=t;c++){const f=c/t;s[c]=this.getTangentAt(f,new k)}r[0]=new k,a[0]=new k;let l=Number.MAX_VALUE;const u=Math.abs(s[0].x),m=Math.abs(s[0].y),p=Math.abs(s[0].z);u<=l&&(l=u,n.set(1,0,0)),m<=l&&(l=m,n.set(0,1,0)),p<=l&&n.set(0,0,1),h.crossVectors(s[0],n).normalize(),r[0].crossVectors(s[0],h),a[0].crossVectors(s[0],r[0]);for(let c=1;c<=t;c++){if(r[c]=r[c-1].clone(),a[c]=a[c-1].clone(),h.crossVectors(s[c-1],s[c]),h.length()>Number.EPSILON){h.normalize();const f=Math.acos(tn(s[c-1].dot(s[c]),-1,1));r[c].applyMatrix4(o.makeRotationAxis(h,f))}a[c].crossVectors(s[c],r[c])}if(e===!0){let c=Math.acos(tn(r[0].dot(r[t]),-1,1));c/=t,s[0].dot(h.crossVectors(r[0],r[t]))>0&&(c=-c);for(let f=1;f<=t;f++)r[f].applyMatrix4(o.makeRotationAxis(s[f],c*f)),a[f].crossVectors(s[f],r[f])}return{tangents:s,normals:r,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Rh extends dn{constructor(t=0,e=0,n=1,s=1,r=0,a=Math.PI*2,h=!1,o=0){super();this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=s,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=h,this.aRotation=o}getPoint(t,e){const n=e||new vt,s=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=s;for(;r>s;)r-=s;r<Number.EPSILON&&(a?r=0:r=s),this.aClockwise===!0&&!a&&(r===s?r=-s:r=r-s);const h=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(h),l=this.aY+this.yRadius*Math.sin(h);if(this.aRotation!==0){const u=Math.cos(this.aRotation),m=Math.sin(this.aRotation),p=o-this.aX,c=l-this.aY;o=p*u-c*m+this.aX,l=p*m+c*u+this.aY}return n.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Rh.prototype.isEllipseCurve=!0;class qf extends Rh{constructor(t,e,n,s,r,a){super(t,e,n,n,s,r,a);this.type="ArcCurve"}}qf.prototype.isArcCurve=!0;function $c(){let i=0,t=0,e=0,n=0;function s(r,a,h,o){i=r,t=h,e=-3*r+3*a-2*h-o,n=2*r-2*a+h+o}return{initCatmullRom:function(r,a,h,o,l){s(a,h,l*(h-r),l*(o-a))},initNonuniformCatmullRom:function(r,a,h,o,l,u,m){let p=(a-r)/l-(h-r)/(l+u)+(h-a)/u,c=(h-a)/u-(o-a)/(u+m)+(o-h)/m;p*=u,c*=u,s(a,h,p,c)},calc:function(r){const a=r*r,h=a*r;return i+t*r+e*a+n*h}}}const Dh=new k,Xc=new $c,jc=new $c,Zc=new $c;class Jf extends dn{constructor(t=[],e=!1,n="centripetal",s=.5){super();this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=s}getPoint(t,e=new k){const n=e,s=this.points,r=s.length,a=(r-(this.closed?0:1))*t;let h=Math.floor(a),o=a-h;this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/r)+1)*r:o===0&&h===r-1&&(h=r-2,o=1);let l,u;this.closed||h>0?l=s[(h-1)%r]:(Dh.subVectors(s[0],s[1]).add(s[0]),l=Dh);const m=s[h%r],p=s[(h+1)%r];if(this.closed||h+2<r?u=s[(h+2)%r]:(Dh.subVectors(s[r-1],s[r-2]).add(s[r-1]),u=Dh),this.curveType==="centripetal"||this.curveType==="chordal"){const c=this.curveType==="chordal"?.5:.25;let f=Math.pow(l.distanceToSquared(m),c),d=Math.pow(m.distanceToSquared(p),c),y=Math.pow(p.distanceToSquared(u),c);d<1e-4&&(d=1),f<1e-4&&(f=d),y<1e-4&&(y=d),Xc.initNonuniformCatmullRom(l.x,m.x,p.x,u.x,f,d,y),jc.initNonuniformCatmullRom(l.y,m.y,p.y,u.y,f,d,y),Zc.initNonuniformCatmullRom(l.z,m.z,p.z,u.z,f,d,y)}else this.curveType==="catmullrom"&&(Xc.initCatmullRom(l.x,m.x,p.x,u.x,this.tension),jc.initCatmullRom(l.y,m.y,p.y,u.y,this.tension),Zc.initCatmullRom(l.z,m.z,p.z,u.z,this.tension));return n.set(Xc.calc(o),jc.calc(o),Zc.calc(o)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(s.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const s=this.points[e];t.points.push(s.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(new k().fromArray(s))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}Jf.prototype.isCatmullRomCurve3=!0;function $f(i,t,e,n,s){const r=(n-t)*.5,a=(s-e)*.5,h=i*i,o=i*h;return(2*e-2*n+r+a)*o+(-3*e+3*n-2*r-a)*h+r*i+e}function PM(i,t){const e=1-i;return e*e*t}function IM(i,t){return 2*(1-i)*i*t}function RM(i,t){return i*i*t}function Zo(i,t,e,n){return PM(i,t)+IM(i,e)+RM(i,n)}function DM(i,t){const e=1-i;return e*e*e*t}function zM(i,t){const e=1-i;return 3*e*e*i*t}function FM(i,t){return 3*(1-i)*i*i*t}function VM(i,t){return i*i*i*t}function Ko(i,t,e,n,s){return DM(i,t)+zM(i,e)+FM(i,n)+VM(i,s)}class Kc extends dn{constructor(t=new vt,e=new vt,n=new vt,s=new vt){super();this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=s}getPoint(t,e=new vt){const n=e,s=this.v0,r=this.v1,a=this.v2,h=this.v3;return n.set(Ko(t,s.x,r.x,a.x,h.x),Ko(t,s.y,r.y,a.y,h.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Kc.prototype.isCubicBezierCurve=!0;class Xf extends dn{constructor(t=new k,e=new k,n=new k,s=new k){super();this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=s}getPoint(t,e=new k){const n=e,s=this.v0,r=this.v1,a=this.v2,h=this.v3;return n.set(Ko(t,s.x,r.x,a.x,h.x),Ko(t,s.y,r.y,a.y,h.y),Ko(t,s.z,r.z,a.z,h.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Xf.prototype.isCubicBezierCurve3=!0;class zh extends dn{constructor(t=new vt,e=new vt){super();this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new vt){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new vt;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}zh.prototype.isLineCurve=!0;class NM extends dn{constructor(t=new k,e=new k){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new k){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Qc extends dn{constructor(t=new vt,e=new vt,n=new vt){super();this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new vt){const n=e,s=this.v0,r=this.v1,a=this.v2;return n.set(Zo(t,s.x,r.x,a.x),Zo(t,s.y,r.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Qc.prototype.isQuadraticBezierCurve=!0;class jf extends dn{constructor(t=new k,e=new k,n=new k){super();this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new k){const n=e,s=this.v0,r=this.v1,a=this.v2;return n.set(Zo(t,s.x,r.x,a.x),Zo(t,s.y,r.y,a.y),Zo(t,s.z,r.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}jf.prototype.isQuadraticBezierCurve3=!0;class tu extends dn{constructor(t=[]){super();this.type="SplineCurve",this.points=t}getPoint(t,e=new vt){const n=e,s=this.points,r=(s.length-1)*t,a=Math.floor(r),h=r-a,o=s[a===0?a:a-1],l=s[a],u=s[a>s.length-2?s.length-1:a+1],m=s[a>s.length-3?s.length-1:a+2];return n.set($f(h,o.x,l.x,u.x,m.x),$f(h,o.y,l.y,u.y,m.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(s.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const s=this.points[e];t.points.push(s.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(new vt().fromArray(s))}return this}}tu.prototype.isSplineCurve=!0;var Zf=Object.freeze({__proto__:null,ArcCurve:qf,CatmullRomCurve3:Jf,CubicBezierCurve:Kc,CubicBezierCurve3:Xf,EllipseCurve:Rh,LineCurve:zh,LineCurve3:NM,QuadraticBezierCurve:Qc,QuadraticBezierCurve3:jf,SplineCurve:tu});class OM extends dn{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new zh(e,t))}getPoint(t,e){const n=t*this.getLength(),s=this.getCurveLengths();let r=0;for(;r<s.length;){if(s[r]>=n){const a=s[r]-n,h=this.curves[r],o=h.getLength(),l=o===0?0:1-a/o;return h.getPointAt(l,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,s=this.curves.length;n<s;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let s=0,r=this.curves;s<r.length;s++){const a=r[s],h=a&&a.isEllipseCurve?t*2:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,o=a.getPoints(h);for(let l=0;l<o.length;l++){const u=o[l];n&&n.equals(u)||(e.push(u),n=u)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const s=t.curves[e];this.curves.push(s.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const s=this.curves[e];t.curves.push(s.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const s=t.curves[e];this.curves.push(new Zf[s.type]().fromJSON(s))}return this}}class eu extends OM{constructor(t){super();this.type="Path",this.currentPoint=new vt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new zh(this.currentPoint.clone(),new vt(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,s){const r=new Qc(this.currentPoint.clone(),new vt(t,e),new vt(n,s));return this.curves.push(r),this.currentPoint.set(n,s),this}bezierCurveTo(t,e,n,s,r,a){const h=new Kc(this.currentPoint.clone(),new vt(t,e),new vt(n,s),new vt(r,a));return this.curves.push(h),this.currentPoint.set(r,a),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new tu(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,s,r,a){const h=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+h,e+o,n,s,r,a),this}absarc(t,e,n,s,r,a){return this.absellipse(t,e,n,n,s,r,a),this}ellipse(t,e,n,s,r,a,h,o){const l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+l,e+u,n,s,r,a,h,o),this}absellipse(t,e,n,s,r,a,h,o){const l=new Rh(t,e,n,s,r,a,h,o);if(this.curves.length>0){const m=l.getPoint(0);m.equals(this.currentPoint)||this.lineTo(m.x,m.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Qo extends eu{constructor(t){super(t);this.uuid=Gn(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,s=this.holes.length;n<s;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const s=t.holes[e];this.holes.push(s.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const s=this.holes[e];t.holes.push(s.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const s=t.holes[e];this.holes.push(new eu().fromJSON(s))}return this}}const UM={triangulate:function(i,t,e=2){const n=t&&t.length,s=n?t[0]*e:i.length;let r=Kf(i,0,s,e,!0);const a=[];if(!r||r.next===r.prev)return a;let h,o,l,u,m,p,c;if(n&&(r=YM(i,t,r,e)),i.length>80*e){h=l=i[0],o=u=i[1];for(let f=e;f<s;f+=e)m=i[f],p=i[f+1],m<h&&(h=m),p<o&&(o=p),m>l&&(l=m),p>u&&(u=p);c=Math.max(l-h,u-o),c=c!==0?1/c:0}return ta(r,a,e,h,o,c),a}};function Kf(i,t,e,n,s){let r,a;if(s===iw(i,t,e,n)>0)for(r=t;r<e;r+=n)a=ed(r,i[r],i[r+1],a);else for(r=e-n;r>=t;r-=n)a=ed(r,i[r],i[r+1],a);return a&&Fh(a,a.next)&&(ia(a),a=a.next),a}function zs(i,t){if(!i)return i;t||(t=i);let e=i,n;do if(n=!1,!e.steiner&&(Fh(e,e.next)||qe(e.prev,e,e.next)===0)){if(ia(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function ta(i,t,e,n,s,r,a){if(!i)return;!a&&r&&jM(i,n,s,r);let h=i,o,l;for(;i.prev!==i.next;){if(o=i.prev,l=i.next,r?GM(i,n,s,r):HM(i)){t.push(o.i/e),t.push(i.i/e),t.push(l.i/e),ia(i),i=l.next,h=l.next;continue}if(i=l,i===h){a?a===1?(i=kM(zs(i),t,e),ta(i,t,e,n,s,r,2)):a===2&&WM(i,t,e,n,s,r):ta(zs(i),t,e,n,s,r,1);break}}}function HM(i){const t=i.prev,e=i,n=i.next;if(qe(t,e,n)>=0)return!1;let s=i.next.next;for(;s!==i.prev;){if(Qr(t.x,t.y,e.x,e.y,n.x,n.y,s.x,s.y)&&qe(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function GM(i,t,e,n){const s=i.prev,r=i,a=i.next;if(qe(s,r,a)>=0)return!1;const h=s.x<r.x?s.x<a.x?s.x:a.x:r.x<a.x?r.x:a.x,o=s.y<r.y?s.y<a.y?s.y:a.y:r.y<a.y?r.y:a.y,l=s.x>r.x?s.x>a.x?s.x:a.x:r.x>a.x?r.x:a.x,u=s.y>r.y?s.y>a.y?s.y:a.y:r.y>a.y?r.y:a.y,m=iu(h,o,t,e,n),p=iu(l,u,t,e,n);let c=i.prevZ,f=i.nextZ;for(;c&&c.z>=m&&f&&f.z<=p;){if(c!==i.prev&&c!==i.next&&Qr(s.x,s.y,r.x,r.y,a.x,a.y,c.x,c.y)&&qe(c.prev,c,c.next)>=0||(c=c.prevZ,f!==i.prev&&f!==i.next&&Qr(s.x,s.y,r.x,r.y,a.x,a.y,f.x,f.y)&&qe(f.prev,f,f.next)>=0))return!1;f=f.nextZ}for(;c&&c.z>=m;){if(c!==i.prev&&c!==i.next&&Qr(s.x,s.y,r.x,r.y,a.x,a.y,c.x,c.y)&&qe(c.prev,c,c.next)>=0)return!1;c=c.prevZ}for(;f&&f.z<=p;){if(f!==i.prev&&f!==i.next&&Qr(s.x,s.y,r.x,r.y,a.x,a.y,f.x,f.y)&&qe(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function kM(i,t,e){let n=i;do{const s=n.prev,r=n.next.next;!Fh(s,r)&&Qf(s,n,n.next,r)&&ea(s,r)&&ea(r,s)&&(t.push(s.i/e),t.push(n.i/e),t.push(r.i/e),ia(n),ia(n.next),n=i=r),n=n.next}while(n!==i);return zs(n)}function WM(i,t,e,n,s,r){let a=i;do{let h=a.next.next;for(;h!==a.prev;){if(a.i!==h.i&&QM(a,h)){let o=td(a,h);a=zs(a,a.next),o=zs(o,o.next),ta(a,t,e,n,s,r),ta(o,t,e,n,s,r);return}h=h.next}a=a.next}while(a!==i)}function YM(i,t,e,n){const s=[];let r,a,h,o,l;for(r=0,a=t.length;r<a;r++)h=t[r]*n,o=r<a-1?t[r+1]*n:i.length,l=Kf(i,h,o,n,!1),l===l.next&&(l.steiner=!0),s.push(KM(l));for(s.sort(qM),r=0;r<s.length;r++)JM(s[r],e),e=zs(e,e.next);return e}function qM(i,t){return i.x-t.x}function JM(i,t){if(t=$M(i,t),t){const e=td(t,i);zs(t,t.next),zs(e,e.next)}}function $M(i,t){let e=t;const n=i.x,s=i.y;let r=-1/0,a;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){const p=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(p<=n&&p>r){if(r=p,p===n){if(s===e.y)return e;if(s===e.next.y)return e.next}a=e.x<e.next.x?e:e.next}}e=e.next}while(e!==t);if(!a)return null;if(n===r)return a;const h=a,o=a.x,l=a.y;let u=1/0,m;e=a;do n>=e.x&&e.x>=o&&n!==e.x&&Qr(s<l?n:r,s,o,l,s<l?r:n,s,e.x,e.y)&&(m=Math.abs(s-e.y)/(n-e.x),ea(e,i)&&(m<u||m===u&&(e.x>a.x||e.x===a.x&&XM(a,e)))&&(a=e,u=m)),e=e.next;while(e!==h);return a}function XM(i,t){return qe(i.prev,i,t.prev)<0&&qe(t.next,i,i.next)<0}function jM(i,t,e,n){let s=i;do s.z===null&&(s.z=iu(s.x,s.y,t,e,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,ZM(s)}function ZM(i){let t,e,n,s,r,a,h,o,l=1;do{for(e=i,i=null,r=null,a=0;e;){for(a++,n=e,h=0,t=0;t<l&&(h++,n=n.nextZ,!!n);t++);for(o=l;h>0||o>0&&n;)h!==0&&(o===0||!n||e.z<=n.z)?(s=e,e=e.nextZ,h--):(s=n,n=n.nextZ,o--),r?r.nextZ=s:i=s,s.prevZ=r,r=s;e=n}r.nextZ=null,l*=2}while(a>1);return i}function iu(i,t,e,n,s){return i=32767*(i-e)*s,t=32767*(t-n)*s,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function KM(i){let t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function Qr(i,t,e,n,s,r,a,h){return(s-a)*(t-h)-(i-a)*(r-h)>=0&&(i-a)*(n-h)-(e-a)*(t-h)>=0&&(e-a)*(r-h)-(s-a)*(n-h)>=0}function QM(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!tw(i,t)&&(ea(i,t)&&ea(t,i)&&ew(i,t)&&(qe(i.prev,i,t.prev)||qe(i,t.prev,t))||Fh(i,t)&&qe(i.prev,i,i.next)>0&&qe(t.prev,t,t.next)>0)}function qe(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function Fh(i,t){return i.x===t.x&&i.y===t.y}function Qf(i,t,e,n){const s=Nh(qe(i,t,e)),r=Nh(qe(i,t,n)),a=Nh(qe(e,n,i)),h=Nh(qe(e,n,t));return!!(s!==r&&a!==h||s===0&&Vh(i,e,t)||r===0&&Vh(i,n,t)||a===0&&Vh(e,i,n)||h===0&&Vh(e,t,n))}function Vh(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function Nh(i){return i>0?1:i<0?-1:0}function tw(i,t){let e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&Qf(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function ea(i,t){return qe(i.prev,i,i.next)<0?qe(i,t,i.next)>=0&&qe(i,i.prev,t)>=0:qe(i,t,i.prev)<0||qe(i,i.next,t)<0}function ew(i,t){let e=i,n=!1;const s=(i.x+t.x)/2,r=(i.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&s<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==i);return n}function td(i,t){const e=new nu(i.i,i.x,i.y),n=new nu(t.i,t.x,t.y),s=i.next,r=t.prev;return i.next=t,t.prev=i,e.next=s,s.prev=e,n.next=e,e.prev=n,r.next=n,n.prev=r,n}function ed(i,t,e,n){const s=new nu(i,t,e);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function ia(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function nu(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function iw(i,t,e,n){let s=0;for(let r=t,a=e-n;r<e;r+=n)s+=(i[a]-i[r])*(i[r+1]+i[a+1]),a=r;return s}class Fs{static area(t){const e=t.length;let n=0;for(let s=e-1,r=0;r<e;s=r++)n+=t[s].x*t[r].y-t[r].x*t[s].y;return n*.5}static isClockWise(t){return Fs.area(t)<0}static triangulateShape(t,e){const n=[],s=[],r=[];id(t),nd(n,t);let a=t.length;e.forEach(id);for(let o=0;o<e.length;o++)s.push(a),a+=e[o].length,nd(n,e[o]);const h=UM.triangulate(n,s);for(let o=0;o<h.length;o+=3)r.push(h.slice(o,o+3));return r}}function id(i){const t=i.length;t>2&&i[t-1].equals(i[0])&&i.pop()}function nd(i,t){for(let e=0;e<t.length;e++)i.push(t[e].x),i.push(t[e].y)}class to extends Ge{constructor(t=new Qo([new vt(.5,.5),new vt(-.5,.5),new vt(-.5,-.5),new vt(.5,-.5)]),e={}){super();this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,s=[],r=[];for(let h=0,o=t.length;h<o;h++){const l=t[h];a(l)}this.setAttribute("position",new vi(s,3)),this.setAttribute("uv",new vi(r,2)),this.computeVertexNormals();function a(h){const o=[],l=e.curveSegments!==void 0?e.curveSegments:12,u=e.steps!==void 0?e.steps:1;let m=e.depth!==void 0?e.depth:1,p=e.bevelEnabled!==void 0?e.bevelEnabled:!0,c=e.bevelThickness!==void 0?e.bevelThickness:.2,f=e.bevelSize!==void 0?e.bevelSize:c-.1,d=e.bevelOffset!==void 0?e.bevelOffset:0,y=e.bevelSegments!==void 0?e.bevelSegments:3;const _=e.extrudePath,v=e.UVGenerator!==void 0?e.UVGenerator:nw;e.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),m=e.amount);let g,x=!1,A,b,M,S;_&&(g=_.getSpacedPoints(u),x=!0,p=!1,A=_.computeFrenetFrames(u,!1),b=new k,M=new k,S=new k),p||(y=0,c=0,f=0,d=0);const B=h.extractPoints(l);let E=B.shape;const T=B.holes;if(!Fs.isClockWise(E)){E=E.reverse();for(let q=0,X=T.length;q<X;q++){const at=T[q];Fs.isClockWise(at)&&(T[q]=at.reverse())}}const C=Fs.triangulateShape(E,T),P=E;for(let q=0,X=T.length;q<X;q++){const at=T[q];E=E.concat(at)}function R(q,X,at){return X||console.error("THREE.ExtrudeGeometry: vec does not exist"),X.clone().multiplyScalar(at).add(q)}const L=E.length,I=C.length;function z(q,X,at){let ut,it,st;const dt=q.x-X.x,mt=q.y-X.y,pt=at.x-q.x,U=at.y-q.y,N=dt*dt+mt*mt,rt=dt*U-mt*pt;if(Math.abs(rt)>Number.EPSILON){const ht=Math.sqrt(N),At=Math.sqrt(pt*pt+U*U),ft=X.x-mt/ht,It=X.y+dt/ht,Ct=at.x-U/At,_t=at.y+pt/At,H=((Ct-ft)*U-(_t-It)*pt)/(dt*U-mt*pt);ut=ft+dt*H-q.x,it=It+mt*H-q.y;const gt=ut*ut+it*it;if(gt<=2)return new vt(ut,it);st=Math.sqrt(gt/2)}else{let ht=!1;dt>Number.EPSILON?pt>Number.EPSILON&&(ht=!0):dt<-Number.EPSILON?pt<-Number.EPSILON&&(ht=!0):Math.sign(mt)===Math.sign(U)&&(ht=!0),ht?(ut=-mt,it=dt,st=Math.sqrt(N)):(ut=dt,it=mt,st=Math.sqrt(N/2))}return new vt(ut/st,it/st)}const F=[];for(let q=0,X=P.length,at=X-1,ut=q+1;q<X;q++,at++,ut++)at===X&&(at=0),ut===X&&(ut=0),F[q]=z(P[q],P[at],P[ut]);const D=[];let V,G=F.concat();for(let q=0,X=T.length;q<X;q++){const at=T[q];V=[];for(let ut=0,it=at.length,st=it-1,dt=ut+1;ut<it;ut++,st++,dt++)st===it&&(st=0),dt===it&&(dt=0),V[ut]=z(at[ut],at[st],at[dt]);D.push(V),G=G.concat(V)}for(let q=0;q<y;q++){const X=q/y,at=c*Math.cos(X*Math.PI/2),ut=f*Math.sin(X*Math.PI/2)+d;for(let it=0,st=P.length;it<st;it++){const dt=R(P[it],F[it],ut);et(dt.x,dt.y,-at)}for(let it=0,st=T.length;it<st;it++){const dt=T[it];V=D[it];for(let mt=0,pt=dt.length;mt<pt;mt++){const U=R(dt[mt],V[mt],ut);et(U.x,U.y,-at)}}}const Y=f+d;for(let q=0;q<L;q++){const X=p?R(E[q],G[q],Y):E[q];x?(M.copy(A.normals[0]).multiplyScalar(X.x),b.copy(A.binormals[0]).multiplyScalar(X.y),S.copy(g[0]).add(M).add(b),et(S.x,S.y,S.z)):et(X.x,X.y,0)}for(let q=1;q<=u;q++)for(let X=0;X<L;X++){const at=p?R(E[X],G[X],Y):E[X];x?(M.copy(A.normals[q]).multiplyScalar(at.x),b.copy(A.binormals[q]).multiplyScalar(at.y),S.copy(g[q]).add(M).add(b),et(S.x,S.y,S.z)):et(at.x,at.y,m/u*q)}for(let q=y-1;q>=0;q--){const X=q/y,at=c*Math.cos(X*Math.PI/2),ut=f*Math.sin(X*Math.PI/2)+d;for(let it=0,st=P.length;it<st;it++){const dt=R(P[it],F[it],ut);et(dt.x,dt.y,m+at)}for(let it=0,st=T.length;it<st;it++){const dt=T[it];V=D[it];for(let mt=0,pt=dt.length;mt<pt;mt++){const U=R(dt[mt],V[mt],ut);x?et(U.x,U.y+g[u-1].y,g[u-1].x+at):et(U.x,U.y,m+at)}}}J(),Q();function J(){const q=s.length/3;if(p){let X=0,at=L*X;for(let ut=0;ut<I;ut++){const it=C[ut];ct(it[2]+at,it[1]+at,it[0]+at)}X=u+y*2,at=L*X;for(let ut=0;ut<I;ut++){const it=C[ut];ct(it[0]+at,it[1]+at,it[2]+at)}}else{for(let X=0;X<I;X++){const at=C[X];ct(at[2],at[1],at[0])}for(let X=0;X<I;X++){const at=C[X];ct(at[0]+L*u,at[1]+L*u,at[2]+L*u)}}n.addGroup(q,s.length/3-q,0)}function Q(){const q=s.length/3;let X=0;W(P,X),X+=P.length;for(let at=0,ut=T.length;at<ut;at++){const it=T[at];W(it,X),X+=it.length}n.addGroup(q,s.length/3-q,1)}function W(q,X){let at=q.length;for(;--at>=0;){const ut=at;let it=at-1;it<0&&(it=q.length-1);for(let st=0,dt=u+y*2;st<dt;st++){const mt=L*st,pt=L*(st+1),U=X+ut+mt,N=X+it+mt,rt=X+it+pt,ht=X+ut+pt;Z(U,N,rt,ht)}}}function et(q,X,at){o.push(q),o.push(X),o.push(at)}function ct(q,X,at){ot(q),ot(X),ot(at);const ut=s.length/3,it=v.generateTopUV(n,s,ut-3,ut-2,ut-1);xt(it[0]),xt(it[1]),xt(it[2])}function Z(q,X,at,ut){ot(q),ot(X),ot(ut),ot(X),ot(at),ot(ut);const it=s.length/3,st=v.generateSideWallUV(n,s,it-6,it-3,it-2,it-1);xt(st[0]),xt(st[1]),xt(st[3]),xt(st[1]),xt(st[2]),xt(st[3])}function ot(q){s.push(o[q*3+0]),s.push(o[q*3+1]),s.push(o[q*3+2])}function xt(q){r.push(q.x),r.push(q.y)}}}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,n=this.parameters.options;return sw(e,n,t)}static fromJSON(t,e){const n=[];for(let r=0,a=t.shapes.length;r<a;r++){const h=e[t.shapes[r]];n.push(h)}const s=t.options.extrudePath;return s!==void 0&&(t.options.extrudePath=new Zf[s.type]().fromJSON(s)),new to(n,t.options)}}const nw={generateTopUV:function(i,t,e,n,s){const r=t[e*3],a=t[e*3+1],h=t[n*3],o=t[n*3+1],l=t[s*3],u=t[s*3+1];return[new vt(r,a),new vt(h,o),new vt(l,u)]},generateSideWallUV:function(i,t,e,n,s,r){const a=t[e*3],h=t[e*3+1],o=t[e*3+2],l=t[n*3],u=t[n*3+1],m=t[n*3+2],p=t[s*3],c=t[s*3+1],f=t[s*3+2],d=t[r*3],y=t[r*3+1],_=t[r*3+2];return Math.abs(h-u)<Math.abs(a-l)?[new vt(a,1-o),new vt(l,1-m),new vt(p,1-f),new vt(d,1-_)]:[new vt(h,1-o),new vt(u,1-m),new vt(c,1-f),new vt(y,1-_)]}};function sw(i,t,e){if(e.shapes=[],Array.isArray(i))for(let n=0,s=i.length;n<s;n++){const r=i[n];e.shapes.push(r.uuid)}else e.shapes.push(i.uuid);return t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class su extends Ge{constructor(t=new Qo([new vt(0,.5),new vt(-.5,-.5),new vt(.5,-.5)]),e=12){super();this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],s=[],r=[],a=[];let h=0,o=0;if(Array.isArray(t)===!1)l(t);else for(let u=0;u<t.length;u++)l(t[u]),this.addGroup(h,o,u),h+=o,o=0;this.setIndex(n),this.setAttribute("position",new vi(s,3)),this.setAttribute("normal",new vi(r,3)),this.setAttribute("uv",new vi(a,2));function l(u){const m=s.length/3,p=u.extractPoints(e);let c=p.shape;const f=p.holes;Fs.isClockWise(c)===!1&&(c=c.reverse());for(let y=0,_=f.length;y<_;y++){const v=f[y];Fs.isClockWise(v)===!0&&(f[y]=v.reverse())}const d=Fs.triangulateShape(c,f);for(let y=0,_=f.length;y<_;y++){const v=f[y];c=c.concat(v)}for(let y=0,_=c.length;y<_;y++){const v=c[y];s.push(v.x,v.y,0),r.push(0,0,1),a.push(v.x,v.y)}for(let y=0,_=d.length;y<_;y++){const v=d[y],g=v[0]+m,x=v[1]+m,A=v[2]+m;n.push(g,x,A),o+=3}}}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return rw(e,t)}static fromJSON(t,e){const n=[];for(let s=0,r=t.shapes.length;s<r;s++){const a=e[t.shapes[s]];n.push(a)}return new su(n,t.curveSegments)}}function rw(i,t){if(t.shapes=[],Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const s=i[e];t.shapes.push(s.uuid)}else t.shapes.push(i.uuid);return t}class ow extends Ri{constructor(t){super();this.type="ShadowMaterial",this.color=new Et(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}ow.prototype.isShadowMaterial=!0;class sd extends Ri{constructor(t){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Et(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}sd.prototype.isMeshStandardMaterial=!0;class aw extends sd{constructor(t){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new vt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return tn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new Et(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Et(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Et(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}aw.prototype.isMeshPhysicalMaterial=!0;class hw extends Ri{constructor(t){super();this.type="MeshPhongMaterial",this.color=new Et(16777215),this.specular=new Et(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=qa,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}hw.prototype.isMeshPhongMaterial=!0;class lw extends Ri{constructor(t){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Et(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}lw.prototype.isMeshToonMaterial=!0;class cw extends Ri{constructor(t){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}cw.prototype.isMeshNormalMaterial=!0;class uw extends Ri{constructor(t){super();this.type="MeshLambertMaterial",this.color=new Et(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=qa,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}uw.prototype.isMeshLambertMaterial=!0;class mw extends Ri{constructor(t){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Et(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Br,this.normalScale=new vt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}mw.prototype.isMeshMatcapMaterial=!0;class pw extends jo{constructor(t){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}pw.prototype.isLineDashedMaterial=!0;const ke={arraySlice:function(i,t,e){return ke.isTypedArray(i)?new i.constructor(i.subarray(t,e!==void 0?e:i.length)):i.slice(t,e)},convertArray:function(i,t,e){return!i||!e&&i.constructor===t?i:typeof t.BYTES_PER_ELEMENT=="number"?new t(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){function t(s,r){return i[s]-i[r]}const e=i.length,n=new Array(e);for(let s=0;s!==e;++s)n[s]=s;return n.sort(t),n},sortedArray:function(i,t,e){const n=i.length,s=new i.constructor(n);for(let r=0,a=0;a!==n;++r){const h=e[r]*t;for(let o=0;o!==t;++o)s[a++]=i[h+o]}return s},flattenJSON:function(i,t,e,n){let s=1,r=i[0];for(;r!==void 0&&r[n]===void 0;)r=i[s++];if(r===void 0)return;let a=r[n];if(a!==void 0)if(Array.isArray(a))do a=r[n],a!==void 0&&(t.push(r.time),e.push.apply(e,a)),r=i[s++];while(r!==void 0);else if(a.toArray!==void 0)do a=r[n],a!==void 0&&(t.push(r.time),a.toArray(e,e.length)),r=i[s++];while(r!==void 0);else do a=r[n],a!==void 0&&(t.push(r.time),e.push(a)),r=i[s++];while(r!==void 0)},subclip:function(i,t,e,n,s=30){const r=i.clone();r.name=t;const a=[];for(let o=0;o<r.tracks.length;++o){const l=r.tracks[o],u=l.getValueSize(),m=[],p=[];for(let c=0;c<l.times.length;++c){const f=l.times[c]*s;if(!(f<e||f>=n)){m.push(l.times[c]);for(let d=0;d<u;++d)p.push(l.values[c*u+d])}}m.length!==0&&(l.times=ke.convertArray(m,l.times.constructor),l.values=ke.convertArray(p,l.values.constructor),a.push(l))}r.tracks=a;let h=1/0;for(let o=0;o<r.tracks.length;++o)h>r.tracks[o].times[0]&&(h=r.tracks[o].times[0]);for(let o=0;o<r.tracks.length;++o)r.tracks[o].shift(-1*h);return r.resetDuration(),r},makeClipAdditive:function(i,t=0,e=i,n=30){n<=0&&(n=30);const s=e.tracks.length,r=t/n;for(let a=0;a<s;++a){const h=e.tracks[a],o=h.ValueTypeName;if(o==="bool"||o==="string")continue;const l=i.tracks.find(function(_){return _.name===h.name&&_.ValueTypeName===o});if(l===void 0)continue;let u=0;const m=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=m/3);let p=0;const c=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=c/3);const f=h.times.length-1;let d;if(r<=h.times[0]){const _=u,v=m-u;d=ke.arraySlice(h.values,_,v)}else if(r>=h.times[f]){const _=f*m+u,v=_+m-u;d=ke.arraySlice(h.values,_,v)}else{const _=h.createInterpolant(),v=u,g=m-u;_.evaluate(r),d=ke.arraySlice(_.resultBuffer,v,g)}o==="quaternion"&&new Ji().fromArray(d).normalize().conjugate().toArray(d);const y=l.times.length;for(let _=0;_<y;++_){const v=_*c+p;if(o==="quaternion")Ji.multiplyQuaternionsFlat(l.values,v,d,0,l.values,v);else{const g=c-p*2;for(let x=0;x<g;++x)l.values[v+x]-=d[x]}}}return i.blendMode=Ap,i}};class Vs{constructor(t,e,n,s){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,s=e[n],r=e[n-1];t:{e:{let a;i:{n:if(!(t<s)){for(let h=n+2;;){if(s===void 0){if(t<r)break n;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===h)break;if(r=s,s=e[++n],t<s)break e}a=e.length;break i}if(!(t>=r)){const h=e[1];t<h&&(n=2,r=h);for(let o=n-2;;){if(r===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,s);if(n===o)break;if(s=r,r=e[--n-1],t>=r)break e}a=n,n=0;break i}break t}for(;n<a;){const h=n+a>>>1;t<e[h]?a=h:n=h+1}if(s=e[n],r=e[n-1],r===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,s);if(s===void 0)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,s)}return this.interpolate_(n,r,t,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=t*s;for(let a=0;a!==s;++a)e[a]=n[r+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Vs.prototype.beforeStart_=Vs.prototype.copySampleValue_;Vs.prototype.afterEnd_=Vs.prototype.copySampleValue_;class fw extends Vs{constructor(t,e,n,s){super(t,e,n,s);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Mr,endingEnd:Mr}}intervalChanged_(t,e,n){const s=this.parameterPositions;let r=t-2,a=t+1,h=s[r],o=s[a];if(h===void 0)switch(this.getSettings_().endingStart){case wr:r=t,h=2*e-n;break;case Ka:r=s.length-2,h=e+s[r]-s[r+1];break;default:r=t,h=n}if(o===void 0)switch(this.getSettings_().endingEnd){case wr:a=t,o=2*n-e;break;case Ka:a=1,o=n+s[1]-s[0];break;default:a=t-1,o=e}const l=(n-e)*.5,u=this.valueSize;this._weightPrev=l/(e-h),this._weightNext=l/(o-n),this._offsetPrev=r*u,this._offsetNext=a*u}interpolate_(t,e,n,s){const r=this.resultBuffer,a=this.sampleValues,h=this.valueSize,o=t*h,l=o-h,u=this._offsetPrev,m=this._offsetNext,p=this._weightPrev,c=this._weightNext,f=(n-e)/(s-e),d=f*f,y=d*f,_=-p*y+2*p*d-p*f,v=(1+p)*y+(-1.5-2*p)*d+(-.5+p)*f+1,g=(-1-c)*y+(1.5+c)*d+.5*f,x=c*y-c*d;for(let A=0;A!==h;++A)r[A]=_*a[u+A]+v*a[l+A]+g*a[o+A]+x*a[m+A];return r}}class rd extends Vs{constructor(t,e,n,s){super(t,e,n,s)}interpolate_(t,e,n,s){const r=this.resultBuffer,a=this.sampleValues,h=this.valueSize,o=t*h,l=o-h,u=(n-e)/(s-e),m=1-u;for(let p=0;p!==h;++p)r[p]=a[l+p]*m+a[o+p]*u;return r}}class dw extends Vs{constructor(t,e,n,s){super(t,e,n,s)}interpolate_(t){return this.copySampleValue_(t-1)}}class Yn{constructor(t,e,n,s){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ke.convertArray(e,this.TimeBufferType),this.values=ke.convertArray(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:ke.convertArray(t.times,Array),values:ke.convertArray(t.values,Array)};const s=t.getInterpolation();s!==t.DefaultInterpolation&&(n.interpolation=s)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new dw(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new rd(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new fw(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case ja:e=this.InterpolantFactoryMethodDiscrete;break;case Za:e=this.InterpolantFactoryMethodLinear;break;case Ql:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ja;case this.InterpolantFactoryMethodLinear:return Za;case this.InterpolantFactoryMethodSmooth:return Ql}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let n=0,s=e.length;n!==s;++n)e[n]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let n=0,s=e.length;n!==s;++n)e[n]*=t}return this}trim(t,e){const n=this.times,s=n.length;let r=0,a=s-1;for(;r!==s&&n[r]<t;)++r;for(;a!==-1&&n[a]>e;)--a;if(++a,r!==0||a!==s){r>=a&&(a=Math.max(a,1),r=a-1);const h=this.getValueSize();this.times=ke.arraySlice(n,r,a),this.values=ke.arraySlice(this.values,r*h,a*h)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,s=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let h=0;h!==r;h++){const o=n[h];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,h,o),t=!1;break}if(a!==null&&a>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,h,o,a),t=!1;break}a=o}if(s!==void 0&&ke.isTypedArray(s))for(let h=0,o=s.length;h!==o;++h){const l=s[h];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,h,l),t=!1;break}}return t}optimize(){const t=ke.arraySlice(this.times),e=ke.arraySlice(this.values),n=this.getValueSize(),s=this.getInterpolation()===Ql,r=t.length-1;let a=1;for(let h=1;h<r;++h){let o=!1;const l=t[h],u=t[h+1];if(l!==u&&(h!==1||l!==t[0]))if(s)o=!0;else{const m=h*n,p=m-n,c=m+n;for(let f=0;f!==n;++f){const d=e[m+f];if(d!==e[p+f]||d!==e[c+f]){o=!0;break}}}if(o){if(h!==a){t[a]=t[h];const m=h*n,p=a*n;for(let c=0;c!==n;++c)e[p+c]=e[m+c]}++a}}if(r>0){t[a]=t[r];for(let h=r*n,o=a*n,l=0;l!==n;++l)e[o+l]=e[h+l];++a}return a!==t.length?(this.times=ke.arraySlice(t,0,a),this.values=ke.arraySlice(e,0,a*n)):(this.times=t,this.values=e),this}clone(){const t=ke.arraySlice(this.times,0),e=ke.arraySlice(this.values,0),n=this.constructor,s=new n(this.name,t,e);return s.createInterpolant=this.createInterpolant,s}}Yn.prototype.TimeBufferType=Float32Array;Yn.prototype.ValueBufferType=Float32Array;Yn.prototype.DefaultInterpolation=Za;class eo extends Yn{}eo.prototype.ValueTypeName="bool";eo.prototype.ValueBufferType=Array;eo.prototype.DefaultInterpolation=ja;eo.prototype.InterpolantFactoryMethodLinear=void 0;eo.prototype.InterpolantFactoryMethodSmooth=void 0;class od extends Yn{}od.prototype.ValueTypeName="color";class Oh extends Yn{}Oh.prototype.ValueTypeName="number";class _w extends Vs{constructor(t,e,n,s){super(t,e,n,s)}interpolate_(t,e,n,s){const r=this.resultBuffer,a=this.sampleValues,h=this.valueSize,o=(n-e)/(s-e);let l=t*h;for(let u=l+h;l!==u;l+=4)Ji.slerpFlat(r,0,a,l-h,a,l,o);return r}}class na extends Yn{InterpolantFactoryMethodLinear(t){return new _w(this.times,this.values,this.getValueSize(),t)}}na.prototype.ValueTypeName="quaternion";na.prototype.DefaultInterpolation=Za;na.prototype.InterpolantFactoryMethodSmooth=void 0;class io extends Yn{}io.prototype.ValueTypeName="string";io.prototype.ValueBufferType=Array;io.prototype.DefaultInterpolation=ja;io.prototype.InterpolantFactoryMethodLinear=void 0;io.prototype.InterpolantFactoryMethodSmooth=void 0;class Uh extends Yn{}Uh.prototype.ValueTypeName="vector";class ad{constructor(t,e=-1,n,s=tc){this.name=t,this.tracks=n,this.duration=e,this.blendMode=s,this.uuid=Gn(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,s=1/(t.fps||1);for(let a=0,h=n.length;a!==h;++a)e.push(yw(n[a]).scale(s));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,s={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let r=0,a=n.length;r!==a;++r)e.push(Yn.toJSON(n[r]));return s}static CreateFromMorphTargetSequence(t,e,n,s){const r=e.length,a=[];for(let h=0;h<r;h++){let o=[],l=[];o.push((h+r-1)%r,h,(h+1)%r),l.push(0,1,0);const u=ke.getKeyframeOrder(o);o=ke.sortedArray(o,1,u),l=ke.sortedArray(l,1,u),!s&&o[0]===0&&(o.push(r),l.push(l[0])),a.push(new Oh(".morphTargetInfluences["+e[h].name+"]",o,l).scale(1/n))}return new this(t,-1,a)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const s=t;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===e)return n[s];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const s={},r=/^([\w-]*?)([\d]+)$/;for(let h=0,o=t.length;h<o;h++){const l=t[h],u=l.name.match(r);if(u&&u.length>1){const m=u[1];let p=s[m];p||(s[m]=p=[]),p.push(l)}}const a=[];for(const h in s)a.push(this.CreateFromMorphTargetSequence(h,s[h],e,n));return a}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(m,p,c,f,d){if(c.length!==0){const y=[],_=[];ke.flattenJSON(c,y,_,f),y.length!==0&&d.push(new m(p,y,_))}},s=[],r=t.name||"default",a=t.fps||30,h=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let m=0;m<l.length;m++){const p=l[m].keys;if(!(!p||p.length===0))if(p[0].morphTargets){const c={};let f;for(f=0;f<p.length;f++)if(p[f].morphTargets)for(let d=0;d<p[f].morphTargets.length;d++)c[p[f].morphTargets[d]]=-1;for(const d in c){const y=[],_=[];for(let v=0;v!==p[f].morphTargets.length;++v){const g=p[f];y.push(g.time),_.push(g.morphTarget===d?1:0)}s.push(new Oh(".morphTargetInfluence["+d+"]",y,_))}o=c.length*(a||1)}else{const c=".bones["+e[m].name+"]";n(Uh,c+".position",p,"pos",s),n(na,c+".quaternion",p,"rot",s),n(Uh,c+".scale",p,"scl",s)}}return s.length===0?null:new this(r,o,s,h)}resetDuration(){const t=this.tracks;let e=0;for(let n=0,s=t.length;n!==s;++n){const r=this.tracks[n];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function vw(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Oh;case"vector":case"vector2":case"vector3":case"vector4":return Uh;case"color":return od;case"quaternion":return na;case"bool":case"boolean":return eo;case"string":return io}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function yw(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=vw(i.type);if(i.times===void 0){const e=[],n=[];ke.flattenJSON(i.keys,e,n,"value"),i.times=e,i.values=n}return t.parse!==void 0?t.parse(i):new t(i.name,i.times,i.values,i.interpolation)}const no={enabled:!1,files:{},add:function(i,t){this.enabled!==!1&&(this.files[i]=t)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class gw{constructor(t,e,n){const s=this;let r=!1,a=0,h=0,o;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(u){h++,r===!1&&s.onStart!==void 0&&s.onStart(u,a,h),r=!0},this.itemEnd=function(u){a++,s.onProgress!==void 0&&s.onProgress(u,a,h),a===h&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return o?o(u):u},this.setURLModifier=function(u){return o=u,this},this.addHandler=function(u,m){return l.push(u,m),this},this.removeHandler=function(u){const m=l.indexOf(u);return m!==-1&&l.splice(m,2),this},this.getHandler=function(u){for(let m=0,p=l.length;m<p;m+=2){const c=l[m],f=l[m+1];if(c.global&&(c.lastIndex=0),c.test(u))return f}return null}}}const xw=new gw;class Ns{constructor(t){this.manager=t!==void 0?t:xw,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise(function(s,r){n.load(t,s,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const hs={};class Aw extends Ns{constructor(t){super(t)}load(t,e,n,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=no.get(t);if(r!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(r),this.manager.itemEnd(t)},0),r;if(hs[t]!==void 0){hs[t].push({onLoad:e,onProgress:n,onError:s});return}hs[t]=[],hs[t].push({onLoad:e,onProgress:n,onError:s});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(a).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||h.body.getReader===void 0)return h;const o=hs[t],l=h.body.getReader(),u=h.headers.get("Content-Length"),m=u?parseInt(u):0,p=m!==0;let c=0;const f=new ReadableStream({start(d){y();function y(){l.read().then(({done:_,value:v})=>{if(_)d.close();else{c+=v.byteLength;const g=new ProgressEvent("progress",{lengthComputable:p,loaded:c,total:m});for(let x=0,A=o.length;x<A;x++){const b=o[x];b.onProgress&&b.onProgress(g)}d.enqueue(v),y()}})}}});return new Response(f)}else throw Error(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`)}).then(h=>{switch(this.responseType){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(o=>new DOMParser().parseFromString(o,this.mimeType));case"json":return h.json();default:return h.text()}}).then(h=>{no.add(t,h);const o=hs[t];delete hs[t];for(let l=0,u=o.length;l<u;l++){const m=o[l];m.onLoad&&m.onLoad(h)}}).catch(h=>{const o=hs[t];if(o===void 0)throw this.manager.itemError(t),h;delete hs[t];for(let l=0,u=o.length;l<u;l++){const m=o[l];m.onError&&m.onError(h)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class hd extends Ns{constructor(t){super(t)}load(t,e,n,s){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=no.get(t);if(a!==void 0)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;const h=th("img");function o(){u(),no.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(m){u(),s&&s(m),r.manager.itemError(t),r.manager.itemEnd(t)}function u(){h.removeEventListener("load",o,!1),h.removeEventListener("error",l,!1)}return h.addEventListener("load",o,!1),h.addEventListener("error",l,!1),t.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(h.crossOrigin=this.crossOrigin),r.manager.itemStart(t),h.src=t,h}}class bw extends Ns{constructor(t){super(t)}load(t,e,n,s){const r=new yh,a=new hd(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let h=0;function o(l){a.load(t[l],function(u){r.images[l]=u,h++,h===6&&(r.needsUpdate=!0,e&&e(r))},void 0,s)}for(let l=0;l<t.length;++l)o(l);return r}}class Mw extends Ns{constructor(t){super(t)}load(t,e,n,s){const r=new _i,a=new hd(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(h){r.image=h,r.needsUpdate=!0,e!==void 0&&e(r)},n,s),r}}class qn extends we{constructor(t,e=1){super();this.type="Light",this.color=new Et(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}}qn.prototype.isLight=!0;class ww extends qn{constructor(t,e,n){super(t,n);this.type="HemisphereLight",this.position.copy(we.DefaultUp),this.updateMatrix(),this.groundColor=new Et(e)}copy(t){return qn.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}ww.prototype.isHemisphereLight=!0;const ld=new Rt,cd=new k,ud=new k;class ru{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new vt(512,512),this.map=null,this.mapPass=null,this.matrix=new Rt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new xh,this._frameExtents=new vt(1,1),this._viewportCount=1,this._viewports=[new Pe(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;cd.setFromMatrixPosition(t.matrixWorld),e.position.copy(cd),ud.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(ud),e.updateMatrixWorld(),ld.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ld),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class md extends ru{constructor(){super(new Xi(50,1,.5,500));this.focus=1}updateMatrices(t){const e=this.camera,n=nc*2*t.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;(n!==e.fov||s!==e.aspect||r!==e.far)&&(e.fov=n,e.aspect=s,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}md.prototype.isSpotLightShadow=!0;class Sw extends qn{constructor(t,e,n=0,s=Math.PI/3,r=0,a=1){super(t,e);this.type="SpotLight",this.position.copy(we.DefaultUp),this.updateMatrix(),this.target=new we,this.distance=n,this.angle=s,this.penumbra=r,this.decay=a,this.shadow=new md}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Sw.prototype.isSpotLight=!0;const pd=new Rt,sa=new k,ou=new k;class fd extends ru{constructor(){super(new Xi(90,1,.5,500));this._frameExtents=new vt(4,2),this._viewportCount=6,this._viewports=[new Pe(2,1,1,1),new Pe(0,1,1,1),new Pe(3,1,1,1),new Pe(1,1,1,1),new Pe(3,0,1,1),new Pe(1,0,1,1)],this._cubeDirections=[new k(1,0,0),new k(-1,0,0),new k(0,0,1),new k(0,0,-1),new k(0,1,0),new k(0,-1,0)],this._cubeUps=[new k(0,1,0),new k(0,1,0),new k(0,1,0),new k(0,1,0),new k(0,0,1),new k(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,s=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),sa.setFromMatrixPosition(t.matrixWorld),n.position.copy(sa),ou.copy(n.position),ou.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(ou),n.updateMatrixWorld(),s.makeTranslation(-sa.x,-sa.y,-sa.z),pd.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pd)}}fd.prototype.isPointLightShadow=!0;class Bw extends qn{constructor(t,e,n=0,s=1){super(t,e);this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new fd}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}Bw.prototype.isPointLight=!0;class dd extends ru{constructor(){super(new Ic(-5,5,5,-5,.5,500))}}dd.prototype.isDirectionalLightShadow=!0;class Tw extends qn{constructor(t,e){super(t,e);this.type="DirectionalLight",this.position.copy(we.DefaultUp),this.updateMatrix(),this.target=new we,this.shadow=new dd}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Tw.prototype.isDirectionalLight=!0;class Cw extends qn{constructor(t,e){super(t,e);this.type="AmbientLight"}}Cw.prototype.isAmbientLight=!0;class Ew extends qn{constructor(t,e,n=10,s=10){super(t,e);this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}Ew.prototype.isRectAreaLight=!0;class _d{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new k)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,s=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*s),e.addScaledVector(a[2],.488603*r),e.addScaledVector(a[3],.488603*n),e.addScaledVector(a[4],1.092548*(n*s)),e.addScaledVector(a[5],1.092548*(s*r)),e.addScaledVector(a[6],.315392*(3*r*r-1)),e.addScaledVector(a[7],1.092548*(n*r)),e.addScaledVector(a[8],.546274*(n*n-s*s)),e}getIrradianceAt(t,e){const n=t.x,s=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],2*.511664*s),e.addScaledVector(a[2],2*.511664*r),e.addScaledVector(a[3],2*.511664*n),e.addScaledVector(a[4],2*.429043*n*s),e.addScaledVector(a[5],2*.429043*s*r),e.addScaledVector(a[6],.743125*r*r-.247708),e.addScaledVector(a[7],2*.429043*n*r),e.addScaledVector(a[8],.429043*(n*n-s*s)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(t,e+s*3);return this}toArray(t=[],e=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(t,e+s*3);return t}static getBasisAt(t,e){const n=t.x,s=t.y,r=t.z;e[0]=.282095,e[1]=.488603*s,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*s,e[5]=1.092548*s*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-s*s)}}_d.prototype.isSphericalHarmonics3=!0;class au extends qn{constructor(t=new _d,e=1){super(void 0,e);this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}au.prototype.isLightProbe=!0;class Lw{static decodeText(t){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(t);let e="";for(let n=0,s=t.length;n<s;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.substr(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Pw extends Ge{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}Pw.prototype.isInstancedBufferGeometry=!0;class Iw extends Ns{constructor(t){super(t);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=no.get(t);if(a!==void 0)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;const h={};h.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",h.headers=this.requestHeader,fetch(t,h).then(function(o){return o.blob()}).then(function(o){return createImageBitmap(o,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(o){no.add(t,o),e&&e(o),r.manager.itemEnd(t)}).catch(function(o){s&&s(o),r.manager.itemError(t),r.manager.itemEnd(t)}),r.manager.itemStart(t)}}Iw.prototype.isImageBitmapLoader=!0;let Hh;const Rw={getContext:function(){return Hh===void 0&&(Hh=new(window.AudioContext||window.webkitAudioContext)),Hh},setContext:function(i){Hh=i}};class Dw extends Ns{constructor(t){super(t)}load(t,e,n,s){const r=this,a=new Aw(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(h){try{const o=h.slice(0);Rw.getContext().decodeAudioData(o,function(u){e(u)})}catch(o){s?s(o):console.error(o),r.manager.itemError(t)}},n,s)}}class zw extends au{constructor(t,e,n=1){super(void 0,n);const s=new Et().set(t),r=new Et().set(e),a=new k(s.r,s.g,s.b),h=new k(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(h).multiplyScalar(o),this.sh.coefficients[1].copy(a).sub(h).multiplyScalar(l)}}zw.prototype.isHemisphereLightProbe=!0;class Fw extends au{constructor(t,e=1){super(void 0,e);const n=new Et().set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Fw.prototype.isAmbientLightProbe=!0;class Vw extends we{constructor(t){super();this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}class Nw{constructor(t,e,n){this.binding=t,this.valueSize=n;let s,r,a;switch(e){case"quaternion":s=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:s=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,s=this.valueSize,r=t*s+s;let a=this.cumulativeWeight;if(a===0){for(let h=0;h!==s;++h)n[r+h]=n[h];a=e}else{a+=e;const h=e/a;this._mixBufferRegion(n,r,0,h,s)}this.cumulativeWeight=a}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,s=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,s,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,s=t*e+e,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,h=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const o=e*this._origIndex;this._mixBufferRegion(n,s,o,1-r,e)}a>0&&this._mixBufferRegionAdditive(n,s,this._addIndex*e,1,e);for(let o=e,l=e+e;o!==l;++o)if(n[o]!==n[o+e]){h.setValue(n,s);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,s=n*this._origIndex;t.getValue(e,s);for(let r=n,a=s;r!==a;++r)e[r]=e[s+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,s,r){if(s>=.5)for(let a=0;a!==r;++a)t[e+a]=t[n+a]}_slerp(t,e,n,s){Ji.slerpFlat(t,e,t,e,t,n,s)}_slerpAdditive(t,e,n,s,r){const a=this._workIndex*r;Ji.multiplyQuaternionsFlat(t,a,t,e,t,n),Ji.slerpFlat(t,e,t,e,t,a,s)}_lerp(t,e,n,s,r){const a=1-s;for(let h=0;h!==r;++h){const o=e+h;t[o]=t[o]*a+t[n+h]*s}}_lerpAdditive(t,e,n,s,r){for(let a=0;a!==r;++a){const h=e+a;t[h]=t[h]+t[n+a]*s}}}const hu="\\[\\]\\.:\\/",Ow=new RegExp("["+hu+"]","g"),lu="[^"+hu+"]",Uw="[^"+hu.replace("\\.","")+"]",Hw=/((?:WC+[\/:])*)/.source.replace("WC",lu),Gw=/(WCOD+)?/.source.replace("WCOD",Uw),kw=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",lu),Ww=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",lu),Yw=new RegExp("^"+Hw+Gw+kw+Ww+"$"),qw=["material","materials","bones"];class Jw{constructor(t,e,n){const s=n||Se.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,s)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=n.length;s!==r;++s)n[s].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}class Se{constructor(t,e,n){this.path=e,this.parsedPath=n||Se.parseTrackName(e),this.node=Se.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new Se.Composite(t,e,n):new Se(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Ow,"")}static parseTrackName(t){const e=Yw.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=n.nodeName.substring(s+1);qw.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(!e||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(n!==void 0)return n}if(t.children){const n=function(r){for(let a=0;a<r.length;a++){const h=r[a];if(h.name===e||h.uuid===e)return h;const o=n(h.children);if(o)return o}return null},s=n(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)t[e++]=n[s]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,s=e.propertyName;let r=e.propertyIndex;if(t||(t=Se.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let l=e.objectIndex;switch(n){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let u=0;u<t.length;u++)if(t[u].name===l){l=u;break}break;default:if(t[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[n]}if(l!==void 0){if(t[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[l]}}const a=t[s];if(a===void 0){const l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+s+" but it wasn't found.",t);return}let h=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?h=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(h=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[r]!==void 0&&(r=t.morphTargetDictionary[r])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else a.fromArray!==void 0&&a.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][h]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Se.Composite=Jw;Se.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Se.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Se.prototype.GetterByBindingType=[Se.prototype._getValue_direct,Se.prototype._getValue_array,Se.prototype._getValue_arrayElement,Se.prototype._getValue_toArray];Se.prototype.SetterByBindingTypeAndVersioning=[[Se.prototype._setValue_direct,Se.prototype._setValue_direct_setNeedsUpdate,Se.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Se.prototype._setValue_array,Se.prototype._setValue_array_setNeedsUpdate,Se.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Se.prototype._setValue_arrayElement,Se.prototype._setValue_arrayElement_setNeedsUpdate,Se.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Se.prototype._setValue_fromArray,Se.prototype._setValue_fromArray_setNeedsUpdate,Se.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class $w{constructor(t,e,n=null,s=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=s;const r=e.tracks,a=r.length,h=new Array(a),o={endingStart:Mr,endingEnd:Mr};for(let l=0;l!==a;++l){const u=r[l].createInterpolant(null);h[l]=u,u.settings=o}this._interpolantSettings=o,this._interpolants=h,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Cg,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const s=this._clip.duration,r=t._clip.duration,a=r/s,h=s/r;t.warp(1,a,e),this.warp(h,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const s=this._mixer,r=s.time,a=this.timeScale;let h=this._timeScaleInterpolant;h===null&&(h=s._lendControlInterpolant(),this._timeScaleInterpolant=h);const o=h.parameterPositions,l=h.sampleValues;return o[0]=r,o[1]=r+n,l[0]=t/a,l[1]=e/a,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,s){if(!this.enabled){this._updateWeight(t);return}const r=this._startTime;if(r!==null){const o=(t-r)*n;if(o<0||n===0)return;this._startTime=null,e=n*o}e*=this._updateTimeScale(t);const a=this._updateTime(e),h=this._updateWeight(t);if(h>0){const o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case Ap:for(let u=0,m=o.length;u!==m;++u)o[u].evaluate(a),l[u].accumulateAdditive(h);break;case tc:default:for(let u=0,m=o.length;u!==m;++u)o[u].evaluate(a),l[u].accumulate(s,h)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(n!==null){const s=n.evaluate(t)[0];e*=s,t>n.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;n!==null&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let s=this.time+t,r=this._loopCount;const a=n===Eg;if(t===0)return r===-1?s:a&&(r&1)==1?e-s:s;if(n===Tg){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(s>=e)s=e;else if(s<0)s=0;else{this.time=s;break t}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(r===-1&&(t>=0?(r=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),s>=e||s<0){const h=Math.floor(s/e);s-=e*h,r+=Math.abs(h);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=t>0?e:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(o===1){const l=t<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:h})}}else this.time=s;if(a&&(r&1)==1)return e-s}return s}_setEndings(t,e,n){const s=this._interpolantSettings;n?(s.endingStart=wr,s.endingEnd=wr):(t?s.endingStart=this.zeroSlopeAtStart?wr:Mr:s.endingStart=Ka,e?s.endingEnd=this.zeroSlopeAtEnd?wr:Mr:s.endingEnd=Ka)}_scheduleFading(t,e,n){const s=this._mixer,r=s.time;let a=this._weightInterpolant;a===null&&(a=s._lendControlInterpolant(),this._weightInterpolant=a);const h=a.parameterPositions,o=a.sampleValues;return h[0]=r,o[0]=e,h[1]=r+t,o[1]=n,this}}class Xw extends er{constructor(t){super();this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,s=t._clip.tracks,r=s.length,a=t._propertyBindings,h=t._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let u=l[o];u===void 0&&(u={},l[o]=u);for(let m=0;m!==r;++m){const p=s[m],c=p.name;let f=u[c];if(f!==void 0)a[m]=f;else{if(f=a[m],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,o,c));continue}const d=e&&e._propertyBindings[m].binding.parsedPath;f=new Nw(Se.create(n,c,d),p.ValueTypeName,p.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,o,c),a[m]=f}h[m].resultBuffer=f.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const n=(t._localRoot||this._root).uuid,s=t._clip.uuid,r=this._actionsByClip[s];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,s,n)}const e=t._propertyBindings;for(let n=0,s=e.length;n!==s;++n){const r=e[n];r.useCount++==0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let n=0,s=e.length;n!==s;++n){const r=e[n];--r.useCount==0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,n){const s=this._actions,r=this._actionsByClip;let a=r[e];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=a;else{const h=a.knownActions;t._byClipCacheIndex=h.length,h.push(t)}t._cacheIndex=s.length,s.push(t),a.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],s=t._cacheIndex;n._cacheIndex=s,e[s]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,a=this._actionsByClip,h=a[r],o=h.knownActions,l=o[o.length-1],u=t._byClipCacheIndex;l._byClipCacheIndex=u,o[u]=l,o.pop(),t._byClipCacheIndex=null;const m=h.actionByRoot,p=(t._localRoot||this._root).uuid;delete m[p],o.length===0&&delete a[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,s=e.length;n!==s;++n){const r=e[n];--r.referenceCount==0&&this._removeInactiveBinding(r)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,s=this._nActiveActions++,r=e[s];t._cacheIndex=s,e[s]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,s=--this._nActiveActions,r=e[s];t._cacheIndex=s,e[s]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const s=this._bindingsByRootAndName,r=this._bindings;let a=s[e];a===void 0&&(a={},s[e]=a),a[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,s=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,h=a[s],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete h[r],Object.keys(h).length===0&&delete a[s]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,s=this._nActiveBindings++,r=e[s];t._cacheIndex=s,e[s]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,s=--this._nActiveBindings,r=e[s];t._cacheIndex=s,e[s]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return n===void 0&&(n=new rd(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,s=--this._nActiveControlInterpolants,r=e[s];t.__cacheIndex=s,e[s]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const s=e||this._root,r=s.uuid;let a=typeof t=="string"?ad.findByName(s,t):t;const h=a!==null?a.uuid:t,o=this._actionsByClip[h];let l=null;if(n===void 0&&(a!==null?n=a.blendMode:n=tc),o!==void 0){const m=o.actionByRoot[r];if(m!==void 0&&m.blendMode===n)return m;l=o.knownActions[0],a===null&&(a=l._clip)}if(a===null)return null;const u=new $w(this,a,e,n);return this._bindAction(u,l),this._addInactiveAction(u,h,r),u}existingAction(t,e){const n=e||this._root,s=n.uuid,r=typeof t=="string"?ad.findByName(n,t):t,a=r?r.uuid:t,h=this._actionsByClip[a];return h!==void 0&&h.actionByRoot[s]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let n=e-1;n>=0;--n)t[n].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,s=this.time+=t,r=Math.sign(t),a=this._accuIndex^=1;for(let l=0;l!==n;++l)e[l]._update(s,t,r,a);const h=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)h[l].apply(a);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,s=this._actionsByClip,r=s[n];if(r!==void 0){const a=r.knownActions;for(let h=0,o=a.length;h!==o;++h){const l=a[h];this._deactivateAction(l);const u=l._cacheIndex,m=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,m._cacheIndex=u,e[u]=m,e.pop(),this._removeInactiveBindingsForAction(l)}delete s[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const a in n){const h=n[a].actionByRoot,o=h[e];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}const s=this._bindingsByRootAndName,r=s[e];if(r!==void 0)for(const a in r){const h=r[a];h.restoreOriginalState(),this._removeInactiveBinding(h)}}uncacheAction(t,e){const n=this.existingAction(t,e);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}Xw.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class jw extends Wo{constructor(t,e,n=1){super(t,e);this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}jw.prototype.isInstancedInterleavedBuffer=!0;const Os=new k,Gh=new Rt,cu=new Rt;class Zw extends qc{constructor(t){const e=vd(t),n=new Ge,s=[],r=[],a=new Et(0,0,1),h=new Et(0,1,0);for(let l=0;l<e.length;l++){const u=e[l];u.parent&&u.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),r.push(a.r,a.g,a.b),r.push(h.r,h.g,h.b))}n.setAttribute("position",new vi(s,3)),n.setAttribute("color",new vi(r,3));const o=new jo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,o);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,s=n.getAttribute("position");cu.copy(this.root.matrixWorld).invert();for(let r=0,a=0;r<e.length;r++){const h=e[r];h.parent&&h.parent.isBone&&(Gh.multiplyMatrices(cu,h.matrixWorld),Os.setFromMatrixPosition(Gh),s.setXYZ(a,Os.x,Os.y,Os.z),Gh.multiplyMatrices(cu,h.parent.matrixWorld),Os.setFromMatrixPosition(Gh),s.setXYZ(a+1,Os.x,Os.y,Os.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function vd(i){const t=[];i&&i.isBone&&t.push(i);for(let e=0;e<i.children.length;e++)t.push.apply(t,vd(i.children[e]));return t}class Kw extends qc{constructor(t=10,e=10,n=4473924,s=8947848){n=new Et(n),s=new Et(s);const r=e/2,a=t/e,h=t/2,o=[],l=[];for(let p=0,c=0,f=-h;p<=e;p++,f+=a){o.push(-h,0,f,h,0,f),o.push(f,0,-h,f,0,h);const d=p===r?n:s;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}const u=new Ge;u.setAttribute("position",new vi(o,3)),u.setAttribute("color",new vi(l,3));const m=new jo({vertexColors:!0,toneMapped:!1});super(u,m);this.type="GridHelper"}}const Qw=new Float32Array(1);new Int32Array(Qw.buffer);dn.create=function(i,t){return console.log("THREE.Curve.create() has been deprecated"),i.prototype=Object.create(dn.prototype),i.prototype.constructor=i,i.prototype.getPoint=t,i};eu.prototype.fromPoints=function(i){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(i)};Kw.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Zw.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Ns.prototype.extractUrlBase=function(i){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Lw.extractUrlBase(i)};Ns.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};En.prototype.center=function(i){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(i)};En.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};En.prototype.isIntersectionBox=function(i){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};En.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};En.prototype.size=function(i){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(i)};Ir.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};xh.prototype.setFromMatrix=function(i){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(i)};Si.prototype.flattenToArrayOffset=function(i,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,t)};Si.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};Si.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Si.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};Si.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Si.prototype.getInverse=function(i){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};Rt.prototype.extractPosition=function(i){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(i)};Rt.prototype.flattenToArrayOffset=function(i,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,t)};Rt.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new k().setFromMatrixColumn(this,3)};Rt.prototype.setRotationFromQuaternion=function(i){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(i)};Rt.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Rt.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Rt.prototype.multiplyVector4=function(i){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Rt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Rt.prototype.rotateAxis=function(i){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),i.transformDirection(this)};Rt.prototype.crossVector=function(i){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Rt.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Rt.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Rt.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Rt.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Rt.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Rt.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Rt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Rt.prototype.makeFrustum=function(i,t,e,n,s,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(i,t,n,e,s,r)};Rt.prototype.getInverse=function(i){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};as.prototype.isIntersectionLine=function(i){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(i)};Ji.prototype.multiplyVector3=function(i){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),i.applyQuaternion(this)};Ji.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};Rr.prototype.isIntersectionBox=function(i){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};Rr.prototype.isIntersectionPlane=function(i){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(i)};Rr.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};ii.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};ii.prototype.barycoordFromPoint=function(i,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(i,t)};ii.prototype.midpoint=function(i){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(i)};ii.prototypenormal=function(i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(i)};ii.prototype.plane=function(i){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(i)};ii.barycoordFromPoint=function(i,t,e,n,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ii.getBarycoord(i,t,e,n,s)};ii.normal=function(i,t,e,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ii.getNormal(i,t,e,n)};Qo.prototype.extractAllPoints=function(i){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(i)};Qo.prototype.extrude=function(i){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new to(this,i)};Qo.prototype.makeGeometry=function(i){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new su(this,i)};vt.prototype.fromAttribute=function(i,t,e){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,t,e)};vt.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};vt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};k.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};k.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};k.prototype.getPositionFromMatrix=function(i){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(i)};k.prototype.getScaleFromMatrix=function(i){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(i)};k.prototype.getColumnFromMatrix=function(i,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,i)};k.prototype.applyProjection=function(i){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(i)};k.prototype.fromAttribute=function(i,t,e){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,t,e)};k.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};k.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Pe.prototype.fromAttribute=function(i,t,e){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,t,e)};Pe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};we.prototype.getChildByName=function(i){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(i)};we.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};we.prototype.translate=function(i,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,i)};we.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};we.prototype.applyMatrix=function(i){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(we.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});$i.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties($i.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Lg},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});zf.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Xi.prototype.setLens=function(i,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(i)};Object.defineProperties(qn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}});Object.defineProperties(ui.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Qa},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Qa)}}});ui.prototype.setDynamic=function(i){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?Qa:zo),this};ui.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},ui.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Ge.prototype.addIndex=function(i){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(i)};Ge.prototype.addAttribute=function(i,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(i,new ui(arguments[1],arguments[2]))):i==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(i,t)};Ge.prototype.addDrawCall=function(i,t,e){e!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(i,t)};Ge.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};Ge.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};Ge.prototype.removeAttribute=function(i){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(i)};Ge.prototype.applyMatrix=function(i){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(Ge.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Wo.prototype.setDynamic=function(i){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?Qa:zo),this};Wo.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};to.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};to.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};to.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Bf.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(Ri.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Et}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===tp}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(sr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}});Te.prototype.clearTarget=function(i,t,e,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(i),this.clear(t,e,n)};Te.prototype.animate=function(i){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(i)};Te.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Te.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Te.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Te.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Te.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Te.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Te.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Te.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Te.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Te.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Te.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Te.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Te.prototype.enableScissorTest=function(i){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(i)};Te.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Te.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Te.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Te.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Te.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Te.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Te.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Te.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Te.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Te.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Te.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?Sr:Cn}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});Object.defineProperties(wf.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(pn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}});Vw.prototype.load=function(i){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return new Dw().load(i,function(n){t.setBuffer(n)}),this};Ec.prototype.updateCubeMap=function(i,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(i,t)};Ec.prototype.clear=function(i,t,e,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(i,t,e,n)};Cr.crossOrigin=void 0;Cr.loadTexture=function(i,t,e,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const s=new Mw;s.setCrossOrigin(this.crossOrigin);const r=s.load(i,e,void 0,n);return t&&(r.mapping=t),r};Cr.loadTextureCube=function(i,t,e,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const s=new bw;s.setCrossOrigin(this.crossOrigin);const r=s.load(i,e,void 0,n);return t&&(r.mapping=t),r};Cr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Cr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ql}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ql);export{Ge as B,Et as C,MM as D,jo as L,Ac as M,ci as N,Xi as P,di as R,Bf as S,es as U,k as V,Te as W,hp as a,iS as b,Pc as c,$i as d,Yc as e,Td as l,eS as p};
